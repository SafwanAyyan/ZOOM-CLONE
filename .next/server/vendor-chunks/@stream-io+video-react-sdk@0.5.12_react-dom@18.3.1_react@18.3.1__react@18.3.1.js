"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/@stream-io+video-react-sdk@0.5.12_react-dom@18.3.1_react@18.3.1__react@18.3.1";
exports.ids = ["vendor-chunks/@stream-io+video-react-sdk@0.5.12_react-dom@18.3.1_react@18.3.1__react@18.3.1"];
exports.modules = {

/***/ "(ssr)/./node_modules/.pnpm/@stream-io+video-react-sdk@0.5.12_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@stream-io/video-react-sdk/dist/index.es.js":
/*!*******************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@stream-io+video-react-sdk@0.5.12_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@stream-io/video-react-sdk/dist/index.es.js ***!
  \*******************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AcceptCallButton: () => (/* binding */ AcceptCallButton),\n/* harmony export */   Audio: () => (/* binding */ Audio),\n/* harmony export */   AudioSettingsDefaultDeviceEnum: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.AudioSettingsDefaultDeviceEnum),\n/* harmony export */   AudioSettingsRequestDefaultDeviceEnum: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.AudioSettingsRequestDefaultDeviceEnum),\n/* harmony export */   Avatar: () => (/* binding */ Avatar),\n/* harmony export */   AvatarFallback: () => (/* binding */ AvatarFallback),\n/* harmony export */   AxiosError: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.AxiosError),\n/* harmony export */   BackgroundFiltersProvider: () => (/* binding */ BackgroundFiltersProvider),\n/* harmony export */   BaseVideo: () => (/* binding */ BaseVideo),\n/* harmony export */   Browsers: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.Browsers),\n/* harmony export */   Call: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.Call),\n/* harmony export */   CallControls: () => (/* binding */ CallControls),\n/* harmony export */   CallParticipantListing: () => (/* binding */ CallParticipantListing),\n/* harmony export */   CallParticipantListingItem: () => (/* binding */ CallParticipantListingItem),\n/* harmony export */   CallParticipantsList: () => (/* binding */ CallParticipantsList),\n/* harmony export */   CallPreview: () => (/* binding */ CallPreview),\n/* harmony export */   CallRecordingList: () => (/* binding */ CallRecordingList),\n/* harmony export */   CallRecordingListHeader: () => (/* binding */ CallRecordingListHeader),\n/* harmony export */   CallRecordingListItem: () => (/* binding */ CallRecordingListItem),\n/* harmony export */   CallState: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallState),\n/* harmony export */   CallStats: () => (/* binding */ CallStats),\n/* harmony export */   CallStatsButton: () => (/* binding */ CallStatsButton),\n/* harmony export */   CallStatsLatencyChart: () => (/* binding */ CallStatsLatencyChart),\n/* harmony export */   CallType: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallType),\n/* harmony export */   CallTypes: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallTypes),\n/* harmony export */   CallingState: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallingState),\n/* harmony export */   CameraManager: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CameraManager),\n/* harmony export */   CameraManagerState: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CameraManagerState),\n/* harmony export */   CancelCallButton: () => (/* binding */ CancelCallButton),\n/* harmony export */   CancelCallConfirmButton: () => (/* binding */ CancelCallConfirmButton),\n/* harmony export */   CompositeButton: () => (/* binding */ CompositeButton),\n/* harmony export */   CreateDeviceRequestPushProviderEnum: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CreateDeviceRequestPushProviderEnum),\n/* harmony export */   DEFAULT_LANGUAGE: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.DEFAULT_LANGUAGE),\n/* harmony export */   DEFAULT_NAMESPACE: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.DEFAULT_NAMESPACE),\n/* harmony export */   DebounceType: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.DebounceType),\n/* harmony export */   DefaultParticipantViewUI: () => (/* binding */ DefaultParticipantViewUI),\n/* harmony export */   DefaultReactionsMenu: () => (/* binding */ DefaultReactionsMenu),\n/* harmony export */   DefaultScreenShareOverlay: () => (/* binding */ DefaultScreenShareOverlay),\n/* harmony export */   DefaultVideoPlaceholder: () => (/* binding */ DefaultVideoPlaceholder),\n/* harmony export */   DeviceSelector: () => (/* binding */ DeviceSelector),\n/* harmony export */   DeviceSelectorAudioInput: () => (/* binding */ DeviceSelectorAudioInput),\n/* harmony export */   DeviceSelectorAudioOutput: () => (/* binding */ DeviceSelectorAudioOutput),\n/* harmony export */   DeviceSelectorVideo: () => (/* binding */ DeviceSelectorVideo),\n/* harmony export */   DeviceSettings: () => (/* binding */ DeviceSettings),\n/* harmony export */   DropDownSelect: () => (/* binding */ DropDownSelect),\n/* harmony export */   DropDownSelectOption: () => (/* binding */ DropDownSelectOption),\n/* harmony export */   DynascaleManager: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.DynascaleManager),\n/* harmony export */   EmptyCallRecordingListing: () => (/* binding */ EmptyCallRecordingListing),\n/* harmony export */   ErrorFromResponse: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.ErrorFromResponse),\n/* harmony export */   GenericMenu: () => (/* binding */ GenericMenu),\n/* harmony export */   GenericMenuButtonItem: () => (/* binding */ GenericMenuButtonItem),\n/* harmony export */   Icon: () => (/* binding */ Icon),\n/* harmony export */   IconButton: () => (/* binding */ IconButton),\n/* harmony export */   InputMediaDeviceManager: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.InputMediaDeviceManager),\n/* harmony export */   InputMediaDeviceManagerState: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.InputMediaDeviceManagerState),\n/* harmony export */   LayoutSettingsNameEnum: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.LayoutSettingsNameEnum),\n/* harmony export */   LayoutSettingsRequestNameEnum: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.LayoutSettingsRequestNameEnum),\n/* harmony export */   LivestreamLayout: () => (/* binding */ LivestreamLayout),\n/* harmony export */   LoadingCallRecordingListing: () => (/* binding */ LoadingCallRecordingListing),\n/* harmony export */   LoadingIndicator: () => (/* binding */ LoadingIndicator),\n/* harmony export */   MenuToggle: () => (/* binding */ MenuToggle),\n/* harmony export */   MenuVisualType: () => (/* binding */ MenuVisualType),\n/* harmony export */   MicrophoneManager: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.MicrophoneManager),\n/* harmony export */   MicrophoneManagerState: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.MicrophoneManagerState),\n/* harmony export */   Notification: () => (/* binding */ Notification),\n/* harmony export */   OwnCapability: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability),\n/* harmony export */   PaginatedGridLayout: () => (/* binding */ PaginatedGridLayout),\n/* harmony export */   ParticipantActionsContextMenu: () => (/* binding */ ParticipantActionsContextMenu),\n/* harmony export */   ParticipantDetails: () => (/* binding */ ParticipantDetails),\n/* harmony export */   ParticipantView: () => (/* binding */ ParticipantView),\n/* harmony export */   ParticipantViewContext: () => (/* binding */ ParticipantViewContext),\n/* harmony export */   ParticipantsAudio: () => (/* binding */ ParticipantsAudio),\n/* harmony export */   PermissionNotification: () => (/* binding */ PermissionNotification),\n/* harmony export */   PermissionRequestList: () => (/* binding */ PermissionRequestList),\n/* harmony export */   PermissionRequests: () => (/* binding */ PermissionRequests),\n/* harmony export */   ReactionsButton: () => (/* binding */ ReactionsButton),\n/* harmony export */   RecordCallButton: () => (/* binding */ RecordCallButton),\n/* harmony export */   RecordCallConfirmationButton: () => (/* binding */ RecordCallConfirmationButton),\n/* harmony export */   RecordSettingsRequestModeEnum: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.RecordSettingsRequestModeEnum),\n/* harmony export */   RecordSettingsRequestQualityEnum: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.RecordSettingsRequestQualityEnum),\n/* harmony export */   RecordingInProgressNotification: () => (/* binding */ RecordingInProgressNotification),\n/* harmony export */   Restricted: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.Restricted),\n/* harmony export */   RingingCall: () => (/* binding */ RingingCall),\n/* harmony export */   RingingCallControls: () => (/* binding */ RingingCallControls),\n/* harmony export */   RxUtils: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.RxUtils),\n/* harmony export */   ScreenShareButton: () => (/* binding */ ScreenShareButton),\n/* harmony export */   ScreenShareManager: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.ScreenShareManager),\n/* harmony export */   ScreenShareState: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.ScreenShareState),\n/* harmony export */   SearchInput: () => (/* binding */ SearchInput),\n/* harmony export */   SearchResults: () => (/* binding */ SearchResults),\n/* harmony export */   SfuEvents: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuEvents),\n/* harmony export */   SfuModels: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels),\n/* harmony export */   SpeakerLayout: () => (/* binding */ SpeakerLayout),\n/* harmony export */   SpeakerManager: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SpeakerManager),\n/* harmony export */   SpeakerState: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SpeakerState),\n/* harmony export */   SpeakingWhileMutedNotification: () => (/* binding */ SpeakingWhileMutedNotification),\n/* harmony export */   SpeechIndicator: () => (/* binding */ SpeechIndicator),\n/* harmony export */   StatCard: () => (/* binding */ StatCard),\n/* harmony export */   StatCardExplanation: () => (/* binding */ StatCardExplanation),\n/* harmony export */   StatsTag: () => (/* binding */ StatsTag),\n/* harmony export */   Statuses: () => (/* binding */ Statuses),\n/* harmony export */   StreamCall: () => (/* binding */ StreamCall),\n/* harmony export */   StreamCallProvider: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.StreamCallProvider),\n/* harmony export */   StreamI18n: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.StreamI18n),\n/* harmony export */   StreamI18nProvider: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.StreamI18nProvider),\n/* harmony export */   StreamSfuClient: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.StreamSfuClient),\n/* harmony export */   StreamTheme: () => (/* binding */ StreamTheme),\n/* harmony export */   StreamVideo: () => (/* binding */ StreamVideo),\n/* harmony export */   StreamVideoClient: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.StreamVideoClient),\n/* harmony export */   StreamVideoProvider: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.StreamVideoProvider),\n/* harmony export */   StreamVideoReadOnlyStateStore: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.StreamVideoReadOnlyStateStore),\n/* harmony export */   StreamVideoServerClient: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.StreamVideoServerClient),\n/* harmony export */   StreamVideoWriteableStateStore: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.StreamVideoWriteableStateStore),\n/* harmony export */   TextButton: () => (/* binding */ TextButton),\n/* harmony export */   ToggleAudioOutputButton: () => (/* binding */ ToggleAudioOutputButton),\n/* harmony export */   ToggleAudioPreviewButton: () => (/* binding */ ToggleAudioPreviewButton),\n/* harmony export */   ToggleAudioPublishingButton: () => (/* binding */ ToggleAudioPublishingButton),\n/* harmony export */   ToggleVideoPreviewButton: () => (/* binding */ ToggleVideoPreviewButton),\n/* harmony export */   ToggleVideoPublishingButton: () => (/* binding */ ToggleVideoPublishingButton),\n/* harmony export */   Tooltip: () => (/* binding */ Tooltip),\n/* harmony export */   TranscriptionSettingsModeEnum: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.TranscriptionSettingsModeEnum),\n/* harmony export */   TranscriptionSettingsRequestModeEnum: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.TranscriptionSettingsRequestModeEnum),\n/* harmony export */   Video: () => (/* binding */ Video$1),\n/* harmony export */   VideoPreview: () => (/* binding */ VideoPreview),\n/* harmony export */   VideoSettingsCameraFacingEnum: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.VideoSettingsCameraFacingEnum),\n/* harmony export */   VideoSettingsRequestCameraFacingEnum: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.VideoSettingsRequestCameraFacingEnum),\n/* harmony export */   ViewportTracker: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.ViewportTracker),\n/* harmony export */   VisibilityState: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.VisibilityState),\n/* harmony export */   WithTooltip: () => (/* binding */ WithTooltip),\n/* harmony export */   checkIfAudioOutputChangeSupported: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.checkIfAudioOutputChangeSupported),\n/* harmony export */   combineComparators: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.combineComparators),\n/* harmony export */   conditional: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.conditional),\n/* harmony export */   createSoundDetector: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.createSoundDetector),\n/* harmony export */   defaultReactions: () => (/* binding */ defaultReactions),\n/* harmony export */   defaultSortPreset: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.defaultSortPreset),\n/* harmony export */   defaultTranslationFunction: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.defaultTranslationFunction),\n/* harmony export */   descending: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.descending),\n/* harmony export */   deviceIds$: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.deviceIds$),\n/* harmony export */   disposeOfMediaStream: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.disposeOfMediaStream),\n/* harmony export */   dominantSpeaker: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.dominantSpeaker),\n/* harmony export */   getAudioDevices: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.getAudioDevices),\n/* harmony export */   getAudioOutputDevices: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.getAudioOutputDevices),\n/* harmony export */   getAudioStream: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.getAudioStream),\n/* harmony export */   getClientDetails: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.getClientDetails),\n/* harmony export */   getDeviceInfo: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.getDeviceInfo),\n/* harmony export */   getLogger: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.getLogger),\n/* harmony export */   getOSInfo: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.getOSInfo),\n/* harmony export */   getScreenShareStream: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.getScreenShareStream),\n/* harmony export */   getSdkInfo: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.getSdkInfo),\n/* harmony export */   getVideoDevices: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.getVideoDevices),\n/* harmony export */   getVideoStream: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.getVideoStream),\n/* harmony export */   getWebRTCInfo: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.getWebRTCInfo),\n/* harmony export */   livestreamOrAudioRoomSortPreset: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.livestreamOrAudioRoomSortPreset),\n/* harmony export */   logLevels: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.logLevels),\n/* harmony export */   logToConsole: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.logToConsole),\n/* harmony export */   mapToRegistry: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.mapToRegistry),\n/* harmony export */   name: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.name),\n/* harmony export */   noopComparator: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.noopComparator),\n/* harmony export */   paginatedLayoutSortPreset: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.paginatedLayoutSortPreset),\n/* harmony export */   pinned: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.pinned),\n/* harmony export */   publishingAudio: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.publishingAudio),\n/* harmony export */   publishingVideo: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.publishingVideo),\n/* harmony export */   reactionType: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.reactionType),\n/* harmony export */   role: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.role),\n/* harmony export */   screenSharing: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.screenSharing),\n/* harmony export */   setDeviceInfo: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.setDeviceInfo),\n/* harmony export */   setLogLevel: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.setLogLevel),\n/* harmony export */   setLogger: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.setLogger),\n/* harmony export */   setOSInfo: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.setOSInfo),\n/* harmony export */   setSdkInfo: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.setSdkInfo),\n/* harmony export */   setWebRTCInfo: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.setWebRTCInfo),\n/* harmony export */   speakerLayoutSortPreset: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.speakerLayoutSortPreset),\n/* harmony export */   speaking: () => (/* reexport safe */ _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.speaking),\n/* harmony export */   translations: () => (/* binding */ translations),\n/* harmony export */   useBackgroundFilters: () => (/* binding */ useBackgroundFilters),\n/* harmony export */   useCall: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall),\n/* harmony export */   useCallStateHooks: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks),\n/* harmony export */   useCalls: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCalls),\n/* harmony export */   useConnectedUser: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useConnectedUser),\n/* harmony export */   useCreateI18n: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCreateI18n),\n/* harmony export */   useHorizontalScrollPosition: () => (/* binding */ useHorizontalScrollPosition),\n/* harmony export */   useI18n: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n),\n/* harmony export */   useMenuContext: () => (/* binding */ useMenuContext),\n/* harmony export */   useParticipantViewContext: () => (/* binding */ useParticipantViewContext),\n/* harmony export */   usePersistedDevicePreferences: () => (/* binding */ usePersistedDevicePreferences),\n/* harmony export */   useRequestPermission: () => (/* binding */ useRequestPermission),\n/* harmony export */   useStore: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useStore),\n/* harmony export */   useStreamVideoClient: () => (/* reexport safe */ _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useStreamVideoClient),\n/* harmony export */   useTrackElementVisibility: () => (/* binding */ useTrackElementVisibility),\n/* harmony export */   useVerticalScrollPosition: () => (/* binding */ useVerticalScrollPosition)\n/* harmony export */ });\n/* harmony import */ var _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @stream-io/video-client */ \"(ssr)/./node_modules/.pnpm/@stream-io+video-client@0.6.10/node_modules/@stream-io/video-client/dist/index.es.js\");\n/* harmony import */ var _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @stream-io/video-react-bindings */ \"(ssr)/./node_modules/.pnpm/@stream-io+video-react-bindings@0.4.10_@stream-io+video-client@0.6.10_react@18.3.1/node_modules/@stream-io/video-react-bindings/dist/index.es.js\");\n/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! react/jsx-runtime */ \"(ssr)/./node_modules/.pnpm/next@14.1.3_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react-jsx-runtime.js\");\n/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/.pnpm/next@14.1.3_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var clsx__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! clsx */ \"(ssr)/./node_modules/.pnpm/clsx@2.1.1/node_modules/clsx/dist/clsx.mjs\");\n/* harmony import */ var _stream_io_video_filters_web__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @stream-io/video-filters-web */ \"(ssr)/./node_modules/.pnpm/@stream-io+video-filters-web@0.0.1/node_modules/@stream-io/video-filters-web/dist/index.es.js\");\n/* harmony import */ var _floating_ui_react__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @floating-ui/react */ \"(ssr)/./node_modules/.pnpm/@floating-ui+react@0.26.13_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@floating-ui/react/dist/floating-ui.react.mjs\");\n/* harmony import */ var _floating_ui_react__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @floating-ui/react */ \"(ssr)/./node_modules/.pnpm/@floating-ui+dom@1.6.5/node_modules/@floating-ui/dom/dist/floating-ui.dom.mjs\");\n/* harmony import */ var chart_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! chart.js */ \"(ssr)/./node_modules/.pnpm/chart.js@4.4.2/node_modules/chart.js/dist/chart.js\");\n/* harmony import */ var react_chartjs_2__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! react-chartjs-2 */ \"(ssr)/./node_modules/.pnpm/react-chartjs-2@5.2.0_chart.js@4.4.2_react@18.3.1/node_modules/react-chartjs-2/dist/index.js\");\n\n\n\n\n\n\n\n\n\n\n\n\nconst Audio = ({ participant, trackType = 'audioTrack', ...rest }) => {\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const [audioElement, setAudioElement] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    const { userId, sessionId } = participant;\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!call || !audioElement)\n            return;\n        const cleanup = call.bindAudioElement(audioElement, sessionId, trackType);\n        return () => {\n            cleanup?.();\n        };\n    }, [call, sessionId, audioElement, trackType]);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"audio\", { autoPlay: true, ...rest, ref: setAudioElement, \"data-user-id\": userId, \"data-session-id\": sessionId, \"data-track-type\": trackType }));\n};\n\nconst ParticipantsAudio = (props) => {\n    const { participants, audioProps } = props;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: participants.map((participant) => {\n            if (participant.isLocalParticipant)\n                return null;\n            const { publishedTracks, audioStream, screenShareAudioStream, sessionId, } = participant;\n            const hasAudio = publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.AUDIO);\n            const audioTrackElement = hasAudio && audioStream && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Audio, { ...audioProps, trackType: \"audioTrack\", participant: participant }));\n            const hasScreenShareAudio = publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.SCREEN_SHARE_AUDIO);\n            const screenShareAudioTrackElement = hasScreenShareAudio &&\n                screenShareAudioStream && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Audio, { ...audioProps, trackType: \"screenShareAudioTrack\", participant: participant }));\n            return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react__WEBPACK_IMPORTED_MODULE_3__.Fragment, { children: [audioTrackElement, screenShareAudioTrackElement] }, sessionId));\n        }) }));\n};\n\nconst ParticipantViewContext = (0,react__WEBPACK_IMPORTED_MODULE_3__.createContext)(undefined);\nconst useParticipantViewContext = () => (0,react__WEBPACK_IMPORTED_MODULE_3__.useContext)(ParticipantViewContext);\n\nconst Avatar = ({ imageSrc, name, style, className, ...rest }) => {\n    const [error, setError] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(false);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [(!imageSrc || error) && name && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(AvatarFallback, { className: className, style: style, names: [name] })), imageSrc && !error && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"img\", { onError: () => setError(true), alt: \"avatar\", className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__avatar', className), src: imageSrc, style: style, ...rest }))] }));\n};\nconst AvatarFallback = ({ className, names, style, }) => {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__avatar--initials-fallback', className), style: style, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { children: [names[0][0], names[1]?.[0]] }) }));\n};\n\n/**\n * The context for the background filters.\n */\nconst BackgroundFiltersContext = (0,react__WEBPACK_IMPORTED_MODULE_3__.createContext)(undefined);\n/**\n * A hook to access the background filters context API.\n */\nconst useBackgroundFilters = () => {\n    const context = (0,react__WEBPACK_IMPORTED_MODULE_3__.useContext)(BackgroundFiltersContext);\n    if (!context) {\n        throw new Error('useBackgroundFilters must be used within a BackgroundFiltersProvider');\n    }\n    return context;\n};\n/**\n * A provider component that enables the use of background filters in your app.\n *\n * Please make sure you have the `@stream-io/video-filters-web` package installed\n * in your project before using this component.\n */\nconst BackgroundFiltersProvider = (props) => {\n    const { children, isBlurringEnabled = true, backgroundImages = [], backgroundFilter: bgFilterFromProps = undefined, backgroundImage: bgImageFromProps = undefined, backgroundBlurLevel: bgBlurLevelFromProps = 'high', tfFilePath, modelFilePath, basePath, } = props;\n    const [backgroundFilter, setBackgroundFilter] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(bgFilterFromProps);\n    const [backgroundImage, setBackgroundImage] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(bgImageFromProps);\n    const [backgroundBlurLevel, setBackgroundBlurLevel] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(bgBlurLevelFromProps);\n    const applyBackgroundImageFilter = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)((imageUrl) => {\n        setBackgroundFilter('image');\n        setBackgroundImage(imageUrl);\n    }, []);\n    const applyBackgroundBlurFilter = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)((blurLevel = 'high') => {\n        setBackgroundFilter('blur');\n        setBackgroundBlurLevel(blurLevel);\n    }, []);\n    const disableBackgroundFilter = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)(() => {\n        setBackgroundFilter(undefined);\n        setBackgroundImage(undefined);\n        setBackgroundBlurLevel('high');\n    }, []);\n    const [isSupported, setIsSupported] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(false);\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        (0,_stream_io_video_filters_web__WEBPACK_IMPORTED_MODULE_5__.isPlatformSupported)().then(setIsSupported);\n    }, []);\n    const [tfLite, setTfLite] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)();\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        // don't try to load TFLite if the platform is not supported\n        if (!isSupported)\n            return;\n        (0,_stream_io_video_filters_web__WEBPACK_IMPORTED_MODULE_5__.loadTFLite)({ basePath, modelFilePath, tfFilePath })\n            .then(setTfLite)\n            .catch((err) => console.error('Failed to load TFLite', err));\n    }, [basePath, isSupported, modelFilePath, tfFilePath]);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(BackgroundFiltersContext.Provider, { value: {\n            isSupported,\n            isReady: !!tfLite,\n            backgroundImage,\n            backgroundBlurLevel,\n            backgroundFilter,\n            disableBackgroundFilter,\n            applyBackgroundBlurFilter,\n            applyBackgroundImageFilter,\n            backgroundImages,\n            isBlurringEnabled,\n            tfFilePath,\n            modelFilePath,\n            basePath,\n        }, children: [children, tfLite && backgroundFilter && (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(BackgroundFilters, { tfLite: tfLite })] }));\n};\nconst BackgroundFilters = (props) => {\n    const { tfLite } = props;\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const { backgroundImage, backgroundFilter } = useBackgroundFilters();\n    const [videoRef, setVideoRef] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    const [bgImageRef, setBgImageRef] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    const [canvasRef, setCanvasRef] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    const [width, setWidth] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(1920);\n    const [height, setHeight] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(1080);\n    const resolveFilterRef = (0,react__WEBPACK_IMPORTED_MODULE_3__.useRef)();\n    const [mediaStream, setMediaStream] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)();\n    const registerFilterRef = (0,react__WEBPACK_IMPORTED_MODULE_3__.useRef)(Promise.resolve(async () => { }));\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!call || !backgroundFilter)\n            return;\n        registerFilterRef.current = registerFilterRef.current.then(() => call.camera.registerFilter(async (ms) => {\n            return new Promise((resolve) => {\n                setMediaStream(ms);\n                resolveFilterRef.current = resolve;\n            });\n        }));\n        return () => {\n            registerFilterRef.current\n                .then((unregister) => unregister())\n                .then(() => setMediaStream(undefined))\n                .catch((err) => console.error('Failed to unregister filter', err));\n        };\n    }, [backgroundFilter, call]);\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!mediaStream || !videoRef || !canvasRef)\n            return;\n        const handleOnPlay = () => {\n            const [track] = mediaStream.getVideoTracks();\n            if (track) {\n                const { width: w = 0, height: h = 0 } = track.getSettings();\n                setWidth(w);\n                setHeight(h);\n            }\n            const resolveFilter = resolveFilterRef.current;\n            if (!resolveFilter)\n                return;\n            const filter = canvasRef.captureStream();\n            resolveFilter(filter);\n        };\n        videoRef.addEventListener('play', handleOnPlay);\n        videoRef.srcObject = mediaStream;\n        videoRef.play().catch((err) => console.error('Failed to play video', err));\n        return () => {\n            videoRef.removeEventListener('play', handleOnPlay);\n            videoRef.srcObject = null;\n        };\n    }, [canvasRef, mediaStream, videoRef]);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__background-filters\", style: {\n            width: `${width}px`,\n            height: `${height}px`,\n        }, children: [mediaStream && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(RenderPipeline, { tfLite: tfLite, videoRef: videoRef, canvasRef: canvasRef, backgroundImageRef: bgImageRef })), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"video\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__background-filters__video', height > width && 'str-video__background-filters__video--tall'), ref: setVideoRef, autoPlay: true, playsInline: true, controls: false, width: width, height: height, muted: true, loop: true }), backgroundImage && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"img\", { className: \"str-video__background-filters__background-image\", alt: \"Background\", ref: setBgImageRef, src: backgroundImage, width: width, height: height }, backgroundImage)), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"canvas\", { className: \"str-video__background-filters__target-canvas\", width: width, height: height, ref: setCanvasRef }, `key-${width}${height}`)] }));\n};\nconst RenderPipeline = (props) => {\n    const { tfLite, videoRef, canvasRef, backgroundImageRef } = props;\n    const { backgroundFilter, backgroundBlurLevel } = useBackgroundFilters();\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!videoRef || !canvasRef || !backgroundFilter)\n            return;\n        if (backgroundFilter === 'image' && !backgroundImageRef)\n            return;\n        const renderer = (0,_stream_io_video_filters_web__WEBPACK_IMPORTED_MODULE_5__.createRenderer)(tfLite, videoRef, canvasRef, {\n            backgroundFilter,\n            backgroundImage: backgroundImageRef ?? undefined,\n            backgroundBlurLevel,\n        });\n        return () => {\n            renderer.dispose();\n        };\n    }, [\n        backgroundBlurLevel,\n        backgroundFilter,\n        backgroundImageRef,\n        canvasRef,\n        tfLite,\n        videoRef,\n    ]);\n    return null;\n};\n\nconst useFloatingUIPreset = ({ placement, strategy, offset: offsetInPx = 10, }) => {\n    const { refs, x, y, update, elements: { domReference, floating }, } = (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_6__.useFloating)({\n        placement,\n        strategy,\n        middleware: [\n            (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_7__.offset)(offsetInPx),\n            (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_7__.shift)(),\n            (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_7__.flip)(),\n            (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_7__.size)({\n                padding: 10,\n                apply: ({ availableHeight, elements }) => {\n                    Object.assign(elements.floating.style, {\n                        maxHeight: `${availableHeight}px`,\n                    });\n                },\n            }),\n        ],\n    });\n    // handle window resizing\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!domReference || !floating)\n            return;\n        const cleanup = (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_7__.autoUpdate)(domReference, floating, update);\n        return () => cleanup();\n    }, [domReference, floating, update]);\n    return { refs, x, y, domReference, floating, strategy };\n};\n\n/**\n * This hook will persist the device settings to local storage.\n *\n * @param key the key to use for local storage.\n */\nconst usePersistDevicePreferences = (key) => {\n    const { useMicrophoneState, useCameraState, useSpeakerState, useCallSettings, } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const mic = useMicrophoneState();\n    const camera = useCameraState();\n    const speaker = useSpeakerState();\n    const settings = useCallSettings();\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!call || !settings)\n            return;\n        if (call.state.callingState === _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallingState.LEFT)\n            return;\n        try {\n            const hasPreferences = !!window.localStorage.getItem(key);\n            const { audio, video } = settings;\n            const defaultDevice = 'default';\n            const preferences = {\n                mic: {\n                    selectedDeviceId: mic.selectedDevice || defaultDevice,\n                    muted: hasPreferences ? mic.isMute : !audio.mic_default_on,\n                },\n                camera: {\n                    selectedDeviceId: camera.selectedDevice || defaultDevice,\n                    muted: hasPreferences ? camera.isMute : !video.camera_default_on,\n                },\n                speaker: {\n                    selectedDeviceId: speaker.selectedDevice || defaultDevice,\n                    muted: false,\n                },\n            };\n            window.localStorage.setItem(key, JSON.stringify(preferences));\n        }\n        catch (err) {\n            console.warn('Failed to save device preferences', err);\n        }\n    }, [\n        call,\n        camera.isMute,\n        camera.selectedDevice,\n        key,\n        mic.isMute,\n        mic.selectedDevice,\n        settings,\n        speaker.selectedDevice,\n    ]);\n};\n/**\n * This hook will apply the device settings from local storage.\n *\n * @param key the key to use for local storage.\n */\nconst useApplyDevicePreferences = (key) => {\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const { useCallSettings } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const settings = useCallSettings();\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!call || !settings)\n            return;\n        const apply = async () => {\n            const initMic = async (setting) => {\n                await call.microphone.select(setting.selectedDeviceId);\n                if (setting.muted) {\n                    await call.microphone.disable();\n                }\n                else {\n                    await call.microphone.enable();\n                }\n            };\n            const initCamera = async (setting) => {\n                await call.camera.select(setting.selectedDeviceId);\n                if (setting.muted) {\n                    await call.camera.disable();\n                }\n                else {\n                    await call.camera.enable();\n                }\n            };\n            const initSpeaker = (setting) => {\n                call.speaker.select(setting.selectedDeviceId);\n            };\n            let preferences = null;\n            try {\n                preferences = JSON.parse(window.localStorage.getItem(key));\n            }\n            catch (err) {\n                console.warn('Failed to load device preferences', err);\n            }\n            if (preferences) {\n                await initMic(preferences.mic);\n                await initCamera(preferences.camera);\n                initSpeaker(preferences.speaker);\n            }\n            else {\n                const { audio, video } = settings;\n                if (audio.mic_default_on)\n                    await call.microphone.enable();\n                if (video.camera_default_on)\n                    await call.camera.enable();\n            }\n        };\n        apply().catch((err) => {\n            console.warn('Failed to apply device preferences', err);\n        });\n    }, [call, key, settings]);\n};\n/**\n * This hook will apply and persist the device preferences from local storage.\n *\n * @param key the key to use for local storage.\n */\nconst usePersistedDevicePreferences = (key = '@stream-io/device-preferences') => {\n    useApplyDevicePreferences(key);\n    usePersistDevicePreferences(key);\n};\n\nconst SCROLL_THRESHOLD = 10;\n/**\n * Hook which observes element's scroll position and returns text value based on the\n * position of the scrollbar (`top`, `bottom`, `between` and `null` if no scrollbar is available)\n */\nconst useVerticalScrollPosition = (scrollElement, threshold = SCROLL_THRESHOLD) => {\n    const [scrollPosition, setScrollPosition] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!scrollElement)\n            return;\n        const scrollHandler = () => {\n            const element = scrollElement;\n            const hasVerticalScrollbar = element.scrollHeight > element.clientHeight;\n            if (!hasVerticalScrollbar)\n                return setScrollPosition(null);\n            const isAtTheTop = element.scrollTop <= threshold;\n            if (isAtTheTop)\n                return setScrollPosition('top');\n            const isAtTheBottom = Math.abs(element.scrollHeight - element.scrollTop - element.clientHeight) <= threshold;\n            if (isAtTheBottom)\n                return setScrollPosition('bottom');\n            setScrollPosition('between');\n        };\n        const resizeObserver = new ResizeObserver(scrollHandler);\n        resizeObserver.observe(scrollElement);\n        scrollElement.addEventListener('scroll', scrollHandler);\n        return () => {\n            scrollElement.removeEventListener('scroll', scrollHandler);\n            resizeObserver.disconnect();\n        };\n    }, [scrollElement, threshold]);\n    return scrollPosition;\n};\nconst useHorizontalScrollPosition = (scrollElement, threshold = SCROLL_THRESHOLD) => {\n    const [scrollPosition, setScrollPosition] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!scrollElement)\n            return;\n        const scrollHandler = () => {\n            const element = scrollElement;\n            const hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;\n            if (!hasHorizontalScrollbar)\n                return setScrollPosition(null);\n            const isAtTheStart = element.scrollLeft <= threshold;\n            if (isAtTheStart)\n                return setScrollPosition('start');\n            const isAtTheEnd = Math.abs(element.scrollWidth - element.scrollLeft - element.clientWidth) <= threshold;\n            if (isAtTheEnd)\n                return setScrollPosition('end');\n            setScrollPosition('between');\n        };\n        const resizeObserver = new ResizeObserver(scrollHandler);\n        resizeObserver.observe(scrollElement);\n        scrollElement.addEventListener('scroll', scrollHandler);\n        return () => {\n            scrollElement.removeEventListener('scroll', scrollHandler);\n            resizeObserver.disconnect();\n        };\n    }, [scrollElement, threshold]);\n    return scrollPosition;\n};\n\nconst useToggleCallRecording = () => {\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const { useIsCallRecordingInProgress } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const isCallRecordingInProgress = useIsCallRecordingInProgress();\n    const [isAwaitingResponse, setIsAwaitingResponse] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(false);\n    // TODO: add permissions\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        // we wait until call.recording_started/stopped event to flips the\n        // `isCallRecordingInProgress` state variable.\n        // Once the flip happens, we remove the loading indicator\n        setIsAwaitingResponse((isAwaiting) => {\n            if (isAwaiting)\n                return false;\n            return isAwaiting;\n        });\n    }, [isCallRecordingInProgress]);\n    const toggleCallRecording = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)(async () => {\n        try {\n            setIsAwaitingResponse(true);\n            if (isCallRecordingInProgress) {\n                await call?.stopRecording();\n            }\n            else {\n                await call?.startRecording();\n            }\n        }\n        catch (e) {\n            console.error(`Failed start recording`, e);\n        }\n    }, [call, isCallRecordingInProgress]);\n    return { toggleCallRecording, isAwaitingResponse, isCallRecordingInProgress };\n};\n\nconst useRequestPermission = (permission) => {\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const { useHasPermissions } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const hasPermission = useHasPermissions(permission);\n    const [isAwaitingPermission, setIsAwaitingPermission] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(false); // TODO: load with possibly pending state\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        const reset = () => setIsAwaitingPermission(false);\n        if (hasPermission)\n            reset();\n    }, [hasPermission]);\n    const requestPermission = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)(async () => {\n        if (hasPermission)\n            return true;\n        const canRequestPermission = !!call?.permissionsContext.canRequest(permission);\n        if (isAwaitingPermission || !canRequestPermission)\n            return false;\n        setIsAwaitingPermission(true);\n        try {\n            await call?.requestPermissions({\n                permissions: [permission],\n            });\n        }\n        catch (error) {\n            setIsAwaitingPermission(false);\n            throw new Error(`requestPermission failed: ${error}`);\n        }\n        return false;\n    }, [call, hasPermission, isAwaitingPermission, permission]);\n    return {\n        requestPermission,\n        hasPermission,\n        canRequestPermission: !!call?.permissionsContext.canRequest(permission),\n        isAwaitingPermission,\n    };\n};\n\nvar MenuVisualType;\n(function (MenuVisualType) {\n    MenuVisualType[\"PORTAL\"] = \"portal\";\n    MenuVisualType[\"MENU\"] = \"menu\";\n})(MenuVisualType || (MenuVisualType = {}));\n/**\n * Used to provide utility APIs to the components rendered inside the portal.\n */\nconst MenuContext = (0,react__WEBPACK_IMPORTED_MODULE_3__.createContext)({});\n/**\n * Access to the closes MenuContext.\n */\nconst useMenuContext = () => {\n    return (0,react__WEBPACK_IMPORTED_MODULE_3__.useContext)(MenuContext);\n};\nconst MenuPortal = ({ children, refs, }) => {\n    const portalId = (0,react__WEBPACK_IMPORTED_MODULE_3__.useMemo)(() => `str-video-portal-${Math.random().toString(36).substring(2, 9)}`, []);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { id: portalId, className: \"str-video__portal\" }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_floating_ui_react__WEBPACK_IMPORTED_MODULE_6__.FloatingOverlay, { children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_floating_ui_react__WEBPACK_IMPORTED_MODULE_6__.FloatingPortal, { id: portalId, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__portal-content\", ref: refs.setFloating, children: children }) }) })] }));\n};\nconst MenuToggle = ({ ToggleButton, placement = 'top-start', strategy = 'absolute', offset, visualType = MenuVisualType.MENU, children, }) => {\n    const [menuShown, setMenuShown] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(false);\n    const { floating, domReference, refs, x, y } = useFloatingUIPreset({\n        placement,\n        strategy,\n        offset,\n    });\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        const handleClick = (event) => {\n            if (!floating && domReference?.contains(event.target)) {\n                setMenuShown(true);\n            }\n            else if (floating && !floating?.contains(event.target)) {\n                setMenuShown(false);\n            }\n        };\n        const handleKeyDown = (event) => {\n            if (event.key.toLowerCase() === 'escape' &&\n                !event.altKey &&\n                !event.ctrlKey) {\n                setMenuShown(false);\n            }\n        };\n        document?.addEventListener('click', handleClick, { capture: true });\n        document?.addEventListener('keydown', handleKeyDown);\n        return () => {\n            document?.removeEventListener('click', handleClick, { capture: true });\n            document?.removeEventListener('keydown', handleKeyDown);\n        };\n    }, [floating, domReference]);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [menuShown && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MenuContext.Provider, { value: { close: () => setMenuShown(false) }, children: visualType === MenuVisualType.PORTAL ? ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MenuPortal, { refs: refs, children: children })) : visualType === MenuVisualType.MENU ? ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__menu-container\", ref: refs.setFloating, style: {\n                        position: strategy,\n                        top: y ?? 0,\n                        left: x ?? 0,\n                        overflowY: 'auto',\n                    }, children: children })) : null })), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ToggleButton, { menuShown: menuShown, ref: refs.setReference })] }));\n};\n\nconst GenericMenu = ({ children, onItemClick, }) => {\n    const ref = (0,react__WEBPACK_IMPORTED_MODULE_3__.useRef)(null);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"ul\", { className: \"str-video__generic-menu\", ref: ref, onClick: (e) => {\n            if (onItemClick &&\n                e.target !== ref.current &&\n                ref.current?.contains(e.target)) {\n                onItemClick(e);\n            }\n        }, children: children }));\n};\nconst GenericMenuButtonItem = ({ children, ...rest }) => {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"li\", { className: \"str-video__generic-menu--item\", children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"button\", { ...rest, children: children }) }));\n};\n\nconst Icon = ({ className, icon }) => ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__icon', icon && `str-video__icon--${icon}`, className) }));\n\nconst IconButton = (0,react__WEBPACK_IMPORTED_MODULE_3__.forwardRef)(function IconButton(props, ref) {\n    const { icon, enabled, variant, onClick, className, ...rest } = props;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"button\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__call-controls__button', className, {\n            [`str-video__call-controls__button--variant-${variant}`]: variant,\n            'str-video__call-controls__button--enabled': enabled,\n        }), onClick: (e) => {\n            e.preventDefault();\n            onClick?.(e);\n        }, ref: ref, ...rest, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: icon }) }));\n});\n\nconst isComponentType = (elementOrComponent) => {\n    return elementOrComponent === null\n        ? false\n        : !(0,react__WEBPACK_IMPORTED_MODULE_3__.isValidElement)(elementOrComponent);\n};\n\nconst chunk = (array, size) => {\n    const chunkCount = Math.ceil(array.length / size);\n    return Array.from({ length: chunkCount }, (_, index) => array.slice(size * index, size * index + size));\n};\n\nconst applyElementToRef = (ref, element) => {\n    if (!ref)\n        return;\n    if (typeof ref === 'function')\n        return ref(element);\n    ref.current = element;\n};\n\nconst CompositeButton = (0,react__WEBPACK_IMPORTED_MODULE_3__.forwardRef)(function CompositeButton({ caption, children, className, active, Menu, menuPlacement, menuOffset, title, ToggleMenuButton = DefaultToggleMenuButton, variant, onClick, ...restButtonProps }, ref) {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__composite-button', className, {\n            'str-video__composite-button--caption': caption,\n            'str-video__composite-button--menu': Menu,\n        }), title: title, ref: ref, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__composite-button__button-group', {\n                    'str-video__composite-button__button-group--active': active,\n                    'str-video__composite-button__button-group--active-primary': active && variant === 'primary',\n                    'str-video__composite-button__button-group--active-secondary': active && variant === 'secondary',\n                }), children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"button\", { type: \"button\", className: \"str-video__composite-button__button\", onClick: (e) => {\n                            e.preventDefault();\n                            onClick?.(e);\n                        }, ...restButtonProps, children: children }), Menu && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MenuToggle, { offset: menuOffset, placement: menuPlacement, ToggleButton: ToggleMenuButton, children: isComponentType(Menu) ? (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Menu, {}) : Menu }))] }), caption && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__composite-button__caption\", children: caption }))] }));\n});\nconst DefaultToggleMenuButton = (0,react__WEBPACK_IMPORTED_MODULE_3__.forwardRef)(function DefaultToggleMenuButton({ menuShown }, ref) {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(IconButton, { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__menu-toggle-button', {\n            'str-video__menu-toggle-button--active': menuShown,\n        }), icon: menuShown ? 'caret-down' : 'caret-up', ref: ref }));\n});\n\nconst TextButton = ({ children, ...rest }) => {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"button\", { ...rest, className: \"str-video__text-button\", children: children }));\n};\n\nconst AcceptCallButton = ({ disabled, onAccept, onClick, }) => {\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const handleClick = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)(async (e) => {\n        if (onClick) {\n            onClick(e);\n        }\n        else if (call) {\n            await call.join();\n            onAccept?.();\n        }\n    }, [onClick, onAccept, call]);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(IconButton, { disabled: disabled, icon: \"call-accept\", variant: \"success\", \"data-testid\": \"accept-call-button\", onClick: handleClick }));\n};\n\nconst Notification = (props) => {\n    const { isVisible, message, children, visibilityTimeout, resetIsVisible, placement = 'top', iconClassName = 'str-video__notification__icon', close, } = props;\n    const { refs, x, y, strategy } = useFloatingUIPreset({\n        placement,\n        strategy: 'absolute',\n    });\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!isVisible || !visibilityTimeout || !resetIsVisible)\n            return;\n        const timeout = setTimeout(() => {\n            resetIsVisible();\n        }, visibilityTimeout);\n        return () => clearTimeout(timeout);\n    }, [isVisible, resetIsVisible, visibilityTimeout]);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { ref: refs.setReference, children: [isVisible && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__notification\", ref: refs.setFloating, style: {\n                    position: strategy,\n                    top: y ?? 0,\n                    left: x ?? 0,\n                    overflowY: 'auto',\n                }, children: [iconClassName && (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"i\", { className: iconClassName }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__notification__message\", children: message }), close ? ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"i\", { className: \"str-video__icon str-video__icon--close str-video__notification__close\", onClick: close })) : null] })), children] }));\n};\n\nconst PermissionNotification = (props) => {\n    const { permission, isAwaitingApproval, messageApproved, messageAwaitingApproval, messageRevoked, visibilityTimeout = 3500, children, } = props;\n    const { useHasPermissions } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const hasPermission = useHasPermissions(permission);\n    const prevHasPermission = (0,react__WEBPACK_IMPORTED_MODULE_3__.useRef)(hasPermission);\n    const [showNotification, setShowNotification] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)();\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (hasPermission && !prevHasPermission.current) {\n            setShowNotification('granted');\n            prevHasPermission.current = true;\n        }\n        else if (!hasPermission && prevHasPermission.current) {\n            setShowNotification('revoked');\n            prevHasPermission.current = false;\n        }\n    }, [hasPermission]);\n    const resetIsVisible = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)(() => setShowNotification(undefined), []);\n    if (isAwaitingApproval) {\n        return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Notification, { isVisible: isAwaitingApproval && !hasPermission, message: messageAwaitingApproval, children: children }));\n    }\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Notification, { isVisible: !!showNotification, visibilityTimeout: visibilityTimeout, resetIsVisible: resetIsVisible, message: showNotification === 'granted' ? messageApproved : messageRevoked, children: children }));\n};\n\nconst SpeakingWhileMutedNotification = ({ children, text, placement, }) => {\n    const { useMicrophoneState } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const { isSpeakingWhileMuted } = useMicrophoneState();\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const message = text ?? t('You are muted. Unmute to speak.');\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Notification, { message: message, isVisible: isSpeakingWhileMuted, placement: placement || 'top-start', children: children }));\n};\n\nconst RecordingInProgressNotification = ({ children, text, }) => {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const { isCallRecordingInProgress } = useToggleCallRecording();\n    const [isVisible, setVisible] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(false);\n    const message = text ?? t('Recording in progress...');\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (isCallRecordingInProgress) {\n            setVisible(true);\n        }\n        else {\n            setVisible(false);\n        }\n    }, [isCallRecordingInProgress]);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Notification, { message: message, iconClassName: \"str-video__icon str-video__icon--recording-on\", isVisible: isVisible, placement: \"top-start\", close: () => setVisible(false), children: children }));\n};\n\nconst LoadingIndicator = ({ className, type = 'spinner', text, tooltip, }) => {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__loading-indicator', className), title: tooltip, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__loading-indicator__icon', type) }), text && (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"p\", { className: \"str-video__loading-indicator-text\", children: text })] }));\n};\n\nconst RecordEndConfirmation = () => {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const { toggleCallRecording, isAwaitingResponse } = useToggleCallRecording();\n    const { close } = useMenuContext();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__end-recording__confirmation\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__end-recording__header\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"recording-on\" }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"h2\", { className: \"str-video__end-recording__heading\", children: t('End recording') })] }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"p\", { className: \"str-video__end-recording__description\", children: t('Are you sure you want end the recording?') }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__end-recording__actions\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CompositeButton, { variant: \"secondary\", onClick: close, children: t('Cancel') }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CompositeButton, { variant: \"primary\", onClick: toggleCallRecording, children: isAwaitingResponse ? (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(LoadingIndicator, {}) : t('End recording') })] })] }));\n};\nconst ToggleEndRecordingMenuButton = (0,react__WEBPACK_IMPORTED_MODULE_3__.forwardRef)(function ToggleEndRecordingMenuButton(props, ref) {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CompositeButton, { ref: ref, active: true, variant: \"secondary\", \"data-testid\": \"recording-stop-button\", children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"recording-off\" }) }));\n});\nconst RecordCallConfirmationButton = ({ caption, }) => {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const { toggleCallRecording, isAwaitingResponse, isCallRecordingInProgress } = useToggleCallRecording();\n    if (isCallRecordingInProgress) {\n        return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.Restricted, { requiredGrants: [\n                _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.START_RECORD_CALL,\n                _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.STOP_RECORD_CALL,\n            ], children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MenuToggle, { ToggleButton: ToggleEndRecordingMenuButton, visualType: MenuVisualType.PORTAL, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(RecordEndConfirmation, {}) }) }));\n    }\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.Restricted, { requiredGrants: [\n            _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.START_RECORD_CALL,\n            _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.STOP_RECORD_CALL,\n        ], children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CompositeButton, { active: isCallRecordingInProgress, caption: caption, title: caption || t('Record call'), variant: \"secondary\", \"data-testid\": \"recording-start-button\", onClick: isAwaitingResponse ? undefined : toggleCallRecording, children: isAwaitingResponse ? ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(LoadingIndicator, { tooltip: t('Waiting for recording to start...') })) : ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"recording-off\" })) }) }));\n};\nconst RecordCallButton = ({ caption }) => {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const { toggleCallRecording, isAwaitingResponse, isCallRecordingInProgress } = useToggleCallRecording();\n    let title = caption || t('Record call');\n    if (isAwaitingResponse) {\n        title = isCallRecordingInProgress\n            ? t('Waiting for recording to stop...')\n            : t('Waiting for recording to start...');\n    }\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.Restricted, { requiredGrants: [\n            _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.START_RECORD_CALL,\n            _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.STOP_RECORD_CALL,\n        ], children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CompositeButton, { active: isCallRecordingInProgress, caption: caption, variant: \"secondary\", \"data-testid\": isCallRecordingInProgress\n                ? 'recording-stop-button'\n                : 'recording-start-button', title: title, onClick: isAwaitingResponse ? undefined : toggleCallRecording, children: isAwaitingResponse ? ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(LoadingIndicator, {})) : ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: isCallRecordingInProgress ? 'recording-on' : 'recording-off' })) }) }));\n};\n\nconst defaultEmojiReactionMap = {\n    ':like:': '',\n    ':raise-hand:': '',\n    ':fireworks:': '',\n    ':dislike:': '',\n    ':heart:': '',\n    ':smile:': '',\n};\nconst Reaction = ({ participant: { reaction, sessionId }, hideAfterTimeoutInMs = 5500, emojiReactionMap = defaultEmojiReactionMap, }) => {\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!call || !reaction)\n            return;\n        const timeoutId = setTimeout(() => {\n            call.resetReaction(sessionId);\n        }, hideAfterTimeoutInMs);\n        return () => {\n            clearTimeout(timeoutId);\n        };\n    }, [call, hideAfterTimeoutInMs, reaction, sessionId]);\n    if (!reaction)\n        return null;\n    const { emoji_code: emojiCode } = reaction;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__reaction\", children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__reaction__emoji\", children: emojiCode && emojiReactionMap[emojiCode] }) }));\n};\n\nconst defaultReactions = [\n    {\n        type: 'reaction',\n        emoji_code: ':like:',\n    },\n    {\n        // TODO OL: use `prompt` type?\n        type: 'raised-hand',\n        emoji_code: ':raise-hand:',\n    },\n    {\n        type: 'reaction',\n        emoji_code: ':fireworks:',\n    },\n    {\n        type: 'reaction',\n        emoji_code: ':dislike:',\n    },\n    {\n        type: 'reaction',\n        emoji_code: ':heart:',\n    },\n    {\n        type: 'reaction',\n        emoji_code: ':smile:',\n    },\n];\nconst ReactionsButton = ({ reactions = defaultReactions, }) => {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.Restricted, { requiredGrants: [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.CREATE_REACTION], children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MenuToggle, { placement: \"top\", ToggleButton: ToggleReactionsMenuButton, visualType: MenuVisualType.MENU, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DefaultReactionsMenu, { reactions: reactions }) }) }));\n};\nconst ToggleReactionsMenuButton = (0,react__WEBPACK_IMPORTED_MODULE_3__.forwardRef)(function ToggleReactionsMenuButton({ menuShown }, ref) {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CompositeButton, { ref: ref, active: menuShown, variant: \"primary\", title: t('Reactions'), children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"reactions\" }) }));\n});\nconst DefaultReactionsMenu = ({ reactions, layout = 'horizontal', }) => {\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__reactions-menu', {\n            'str-video__reactions-menu--horizontal': layout === 'horizontal',\n            'str-video__reactions-menu--vertical': layout === 'vertical',\n        }), children: reactions.map((reaction) => ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"button\", { type: \"button\", className: \"str-video__reactions-menu__button\", onClick: () => {\n                call?.sendReaction(reaction);\n            }, children: reaction.emoji_code && defaultEmojiReactionMap[reaction.emoji_code] }, reaction.emoji_code))) }));\n};\n\nconst ScreenShareButton = (props) => {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const { caption } = props;\n    const { useHasOngoingScreenShare, useScreenShareState, useCallSettings } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const isSomeoneScreenSharing = useHasOngoingScreenShare();\n    const { hasPermission, requestPermission, isAwaitingPermission } = useRequestPermission(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SCREENSHARE);\n    const callSettings = useCallSettings();\n    const isScreenSharingAllowed = callSettings?.screensharing.enabled;\n    const { screenShare, isMute: amIScreenSharing } = useScreenShareState();\n    const disableScreenShareButton = amIScreenSharing\n        ? isSomeoneScreenSharing || isScreenSharingAllowed === false\n        : false;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.Restricted, { requiredGrants: [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SCREENSHARE], children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(PermissionNotification, { permission: _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SCREENSHARE, isAwaitingApproval: isAwaitingPermission, messageApproved: t('You can now share your screen.'), messageAwaitingApproval: t('Awaiting for an approval to share screen.'), messageRevoked: t('You can no longer share your screen.'), children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CompositeButton, { active: isSomeoneScreenSharing, caption: caption, title: caption || t('Share screen'), variant: \"primary\", \"data-testid\": isSomeoneScreenSharing\n                    ? 'screen-share-stop-button'\n                    : 'screen-share-start-button', disabled: disableScreenShareButton, onClick: async () => {\n                    if (!hasPermission) {\n                        await requestPermission();\n                    }\n                    else {\n                        await screenShare.toggle();\n                    }\n                }, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: isSomeoneScreenSharing ? 'screen-share-on' : 'screen-share-off' }) }) }) }));\n};\n\nconst SelectContext = (0,react__WEBPACK_IMPORTED_MODULE_3__.createContext)({});\nconst Select = (props) => {\n    const { children, icon, defaultSelectedLabel, defaultSelectedIndex, handleSelect: handleSelectProp, } = props;\n    const [isOpen, setIsOpen] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(false);\n    const [activeIndex, setActiveIndex] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    const [selectedIndex, setSelectedIndex] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(defaultSelectedIndex);\n    const [selectedLabel, setSelectedLabel] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(defaultSelectedLabel);\n    const { refs, context } = (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_6__.useFloating)({\n        placement: 'bottom-start',\n        open: isOpen,\n        onOpenChange: setIsOpen,\n        whileElementsMounted: _floating_ui_react__WEBPACK_IMPORTED_MODULE_7__.autoUpdate,\n        middleware: [(0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_7__.flip)()],\n    });\n    const elementsRef = (0,react__WEBPACK_IMPORTED_MODULE_3__.useRef)([]);\n    const labelsRef = (0,react__WEBPACK_IMPORTED_MODULE_3__.useRef)([]);\n    const handleSelect = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)((index) => {\n        setSelectedIndex(index);\n        handleSelectProp(index || 0);\n        setIsOpen(false);\n        if (index !== null) {\n            setSelectedLabel(labelsRef.current[index]);\n        }\n    }, [handleSelectProp]);\n    const handleTypeaheadMatch = (index) => {\n        if (isOpen) {\n            setActiveIndex(index);\n        }\n        else {\n            handleSelect(index);\n        }\n    };\n    const listNav = (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_6__.useListNavigation)(context, {\n        listRef: elementsRef,\n        activeIndex,\n        selectedIndex,\n        onNavigate: setActiveIndex,\n    });\n    const typeahead = (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_6__.useTypeahead)(context, {\n        listRef: labelsRef,\n        activeIndex,\n        selectedIndex,\n        onMatch: handleTypeaheadMatch,\n    });\n    const click = (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_6__.useClick)(context);\n    const dismiss = (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_6__.useDismiss)(context);\n    const role = (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_6__.useRole)(context, { role: 'listbox' });\n    const { getReferenceProps, getFloatingProps, getItemProps } = (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_6__.useInteractions)([listNav, typeahead, click, dismiss, role]);\n    const selectContext = (0,react__WEBPACK_IMPORTED_MODULE_3__.useMemo)(() => ({\n        activeIndex,\n        selectedIndex,\n        getItemProps,\n        handleSelect,\n    }), [activeIndex, selectedIndex, getItemProps, handleSelect]);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__dropdown\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__dropdown-selected\", ref: refs.setReference, tabIndex: 0, ...getReferenceProps(), children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"label\", { className: \"str-video__dropdown-selected__label\", children: [icon && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { className: \"str-video__dropdown-selected__icon\", icon: icon })), selectedLabel] }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { className: \"str-video__dropdown-selected__chevron\", icon: isOpen ? 'chevron-up' : 'chevron-down' })] }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(SelectContext.Provider, { value: selectContext, children: isOpen && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_floating_ui_react__WEBPACK_IMPORTED_MODULE_6__.FloatingFocusManager, { context: context, modal: false, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__dropdown-list\", ref: refs.setFloating, ...getFloatingProps(), children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_floating_ui_react__WEBPACK_IMPORTED_MODULE_6__.FloatingList, { elementsRef: elementsRef, labelsRef: labelsRef, children: children }) }) })) })] }));\n};\nconst DropDownSelectOption = (props) => {\n    const { selected, label, icon } = props;\n    const { getItemProps, handleSelect } = (0,react__WEBPACK_IMPORTED_MODULE_3__.useContext)(SelectContext);\n    const { ref, index } = (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_6__.useListItem)();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__dropdown-option', {\n            'str-video__dropdown-option--selected': selected,\n        }), ref: ref, ...getItemProps({\n            onClick: () => handleSelect(index),\n        }), children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { className: \"str-video__dropdown-icon\", icon: icon }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__dropdown-label\", children: label })] }));\n};\nconst DropDownSelect = (props) => {\n    const { children, icon, handleSelect, defaultSelectedLabel, defaultSelectedIndex, } = props;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Select, { icon: icon, handleSelect: handleSelect, defaultSelectedIndex: defaultSelectedIndex, defaultSelectedLabel: defaultSelectedLabel, children: children }));\n};\n\nconst DeviceSelectorOption = ({ disabled, id, label, onChange, name, selected, defaultChecked, value, }) => {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"label\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__device-settings__option', {\n            'str-video__device-settings__option--selected': selected,\n            'str-video__device-settings__option--disabled': disabled,\n        }), htmlFor: id, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"input\", { type: \"radio\", name: name, onChange: onChange, value: value, id: id, checked: selected, defaultChecked: defaultChecked, disabled: disabled }), label] }));\n};\nconst DeviceSelectorList = (props) => {\n    const { devices = [], selectedDeviceId: selectedDeviceFromProps, title, type, onChange, } = props;\n    // sometimes the browser (Chrome) will report the system-default device\n    // with an id of 'default'. In case when it doesn't, we'll select the first\n    // available device.\n    let selectedDeviceId = selectedDeviceFromProps;\n    if (devices.length > 0 &&\n        !devices.find((d) => d.deviceId === selectedDeviceId)) {\n        selectedDeviceId = devices[0].deviceId;\n    }\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__device-settings__device-kind\", children: [title && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__device-settings__device-selector-title\", children: title })), !devices.length ? ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DeviceSelectorOption, { id: `${type}--default`, label: \"Default\", name: type, defaultChecked: true, value: \"default\" })) : (devices.map((device) => {\n                return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DeviceSelectorOption, { id: `${type}--${device.deviceId}`, value: device.deviceId, label: device.label, onChange: (e) => {\n                        onChange?.(e.target.value);\n                    }, name: type, selected: device.deviceId === selectedDeviceId || devices.length === 1 }, device.deviceId));\n            }))] }));\n};\nconst DeviceSelectorDropdown = (props) => {\n    const { devices = [], selectedDeviceId: selectedDeviceFromProps, title, onChange, icon, } = props;\n    // sometimes the browser (Chrome) will report the system-default device\n    // with an id of 'default'. In case when it doesn't, we'll select the first\n    // available device.\n    let selectedDeviceId = selectedDeviceFromProps;\n    if (devices.length > 0 &&\n        !devices.find((d) => d.deviceId === selectedDeviceId)) {\n        selectedDeviceId = devices[0].deviceId;\n    }\n    const selectedIndex = devices.findIndex((d) => d.deviceId === selectedDeviceId);\n    const handleSelect = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)((index) => {\n        onChange?.(devices[index].deviceId);\n    }, [devices, onChange]);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__device-settings__device-kind\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__device-settings__device-selector-title\", children: title }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DropDownSelect, { icon: icon, defaultSelectedIndex: selectedIndex, defaultSelectedLabel: devices[selectedIndex]?.label, handleSelect: handleSelect, children: devices.map((device) => {\n                    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DropDownSelectOption, { icon: icon, label: device.label, selected: device.deviceId === selectedDeviceId || devices.length === 1 }, device.deviceId));\n                }) })] }));\n};\nconst DeviceSelector = (props) => {\n    const { visualType = 'list', icon, placeholder, ...rest } = props;\n    if (visualType === 'list') {\n        return (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DeviceSelectorList, { ...rest });\n    }\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DeviceSelectorDropdown, { ...rest, icon: icon, placeholder: placeholder }));\n};\n\nconst DeviceSelectorAudioInput = ({ title, visualType, }) => {\n    const { useMicrophoneState } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const { microphone, selectedDevice, devices } = useMicrophoneState();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DeviceSelector, { devices: devices || [], selectedDeviceId: selectedDevice, type: \"audioinput\", onChange: async (deviceId) => {\n            await microphone.select(deviceId);\n        }, title: title, visualType: visualType, icon: \"mic\" }));\n};\nconst DeviceSelectorAudioOutput = ({ title, visualType, }) => {\n    const { useSpeakerState } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const { speaker, selectedDevice, devices, isDeviceSelectionSupported } = useSpeakerState();\n    if (!isDeviceSelectionSupported)\n        return null;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DeviceSelector, { devices: devices, type: \"audiooutput\", selectedDeviceId: selectedDevice, onChange: (deviceId) => {\n            speaker.select(deviceId);\n        }, title: title, visualType: visualType, icon: \"speaker\" }));\n};\n\nconst DeviceSelectorVideo = ({ title, visualType, }) => {\n    const { useCameraState } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const { camera, devices, selectedDevice } = useCameraState();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DeviceSelector, { devices: devices || [], type: \"videoinput\", selectedDeviceId: selectedDevice, onChange: async (deviceId) => {\n            await camera.select(deviceId);\n        }, title: title, visualType: visualType, icon: \"camera\" }));\n};\n\nconst DeviceSettings = ({ visualType = MenuVisualType.MENU, }) => {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MenuToggle, { placement: \"bottom-end\", ToggleButton: ToggleDeviceSettingsMenuButton, visualType: visualType, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Menu, {}) }));\n};\nconst Menu = () => {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__device-settings\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DeviceSelectorVideo, { title: t('Select a Camera') }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DeviceSelectorAudioInput, { title: t('Select a Mic') }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DeviceSelectorAudioOutput, { title: t('Select Speakers') })] }));\n};\nconst ToggleDeviceSettingsMenuButton = (0,react__WEBPACK_IMPORTED_MODULE_3__.forwardRef)(function ToggleDeviceSettingsMenuButton({ menuShown }, ref) {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(IconButton, { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__device-settings__button', {\n            'str-video__device-settings__button--active': menuShown,\n        }), title: t('Toggle device menu'), icon: \"device-settings\", ref: ref }));\n});\n\nconst ToggleAudioPreviewButton = (props) => {\n    const { caption, Menu, menuPlacement, ...restCompositeButtonProps } = props;\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const { useMicrophoneState } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const { microphone, isMute, hasBrowserPermission } = useMicrophoneState();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(CompositeButton, { active: isMute, caption: caption, className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])(!hasBrowserPermission && 'str-video__device-unavailable'), variant: \"secondary\", title: !hasBrowserPermission\n            ? t('Check your browser audio permissions')\n            : caption || t('Mic'), disabled: !hasBrowserPermission, \"data-testid\": isMute ? 'preview-audio-unmute-button' : 'preview-audio-mute-button', onClick: () => microphone.toggle(), Menu: Menu, menuPlacement: menuPlacement, ...restCompositeButtonProps, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: !isMute ? 'mic' : 'mic-off' }), !hasBrowserPermission && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__no-media-permission\", title: t('Check your browser audio permissions'), children: \"!\" }))] }));\n};\nconst ToggleAudioPublishingButton = (props) => {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const { caption, Menu = (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DeviceSelectorAudioInput, { visualType: \"list\" }), menuPlacement = 'top', ...restCompositeButtonProps } = props;\n    const { hasPermission, requestPermission, isAwaitingPermission } = useRequestPermission(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SEND_AUDIO);\n    const { useMicrophoneState } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const { microphone, isMute, hasBrowserPermission } = useMicrophoneState();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.Restricted, { requiredGrants: [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SEND_AUDIO], children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(PermissionNotification, { permission: _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SEND_AUDIO, isAwaitingApproval: isAwaitingPermission, messageApproved: t('You can now speak.'), messageAwaitingApproval: t('Awaiting for an approval to speak.'), messageRevoked: t('You can no longer speak.'), children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(CompositeButton, { active: isMute, caption: caption, title: !hasPermission\n                    ? t('You have no permission to share your audio')\n                    : !hasBrowserPermission\n                        ? t('Check your browser mic permissions')\n                        : caption || t('Mic'), variant: \"secondary\", disabled: !hasBrowserPermission || !hasPermission, \"data-testid\": isMute ? 'audio-unmute-button' : 'audio-mute-button', onClick: async () => {\n                    if (!hasPermission) {\n                        await requestPermission();\n                    }\n                    else {\n                        await microphone.toggle();\n                    }\n                }, Menu: Menu, menuPlacement: menuPlacement, menuOffset: 16, ...restCompositeButtonProps, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: isMute ? 'mic-off' : 'mic' }), (!hasBrowserPermission || !hasPermission) && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__no-media-permission\", children: \"!\" }))] }) }) }));\n};\n\nconst ToggleVideoPreviewButton = (props) => {\n    const { caption, Menu = DeviceSelectorVideo, menuPlacement = 'top', ...restCompositeButtonProps } = props;\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const { useCameraState } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const { camera, isMute, hasBrowserPermission } = useCameraState();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(CompositeButton, { active: isMute, caption: caption, className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])(!hasBrowserPermission && 'str-video__device-unavailable'), title: !hasBrowserPermission\n            ? t('Check your browser video permissions')\n            : caption || t('Video'), variant: \"secondary\", \"data-testid\": isMute ? 'preview-video-unmute-button' : 'preview-video-mute-button', onClick: () => camera.toggle(), disabled: !hasBrowserPermission, Menu: Menu, menuPlacement: menuPlacement, ...restCompositeButtonProps, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: !isMute ? 'camera' : 'camera-off' }), !hasBrowserPermission && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__no-media-permission\", title: t('Check your browser video permissions'), children: \"!\" }))] }));\n};\nconst ToggleVideoPublishingButton = (props) => {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const { caption, Menu = (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DeviceSelectorVideo, { visualType: \"list\" }), menuPlacement = 'top', ...restCompositeButtonProps } = props;\n    const { hasPermission, requestPermission, isAwaitingPermission } = useRequestPermission(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SEND_VIDEO);\n    const { useCameraState, useCallSettings } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const { camera, isMute, hasBrowserPermission } = useCameraState();\n    const callSettings = useCallSettings();\n    const isPublishingVideoAllowed = callSettings?.video.enabled;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.Restricted, { requiredGrants: [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SEND_VIDEO], children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(PermissionNotification, { permission: _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SEND_VIDEO, isAwaitingApproval: isAwaitingPermission, messageApproved: t('You can now share your video.'), messageAwaitingApproval: t('Awaiting for an approval to share your video.'), messageRevoked: t('You can no longer share your video.'), children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(CompositeButton, { active: isMute, caption: caption, variant: \"secondary\", title: !hasPermission\n                    ? t('You have no permission to share your video')\n                    : !hasBrowserPermission\n                        ? t('Check your browser video permissions')\n                        : !isPublishingVideoAllowed\n                            ? t('Video publishing is disabled by the system')\n                            : caption || t('Video'), disabled: !hasBrowserPermission || !hasPermission || !isPublishingVideoAllowed, \"data-testid\": isMute ? 'video-unmute-button' : 'video-mute-button', onClick: async () => {\n                    if (!hasPermission) {\n                        await requestPermission();\n                    }\n                    else {\n                        await camera.toggle();\n                    }\n                }, Menu: Menu, menuPlacement: menuPlacement, menuOffset: 16, ...restCompositeButtonProps, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: isMute ? 'camera-off' : 'camera' }), (!hasBrowserPermission ||\n                        !hasPermission ||\n                        !isPublishingVideoAllowed) && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__no-media-permission\", children: \"!\" }))] }) }) }));\n};\n\nconst EndCallMenu = (props) => {\n    const { onLeave, onEnd } = props;\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__end-call__confirmation\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"button\", { className: \"str-video__button str-video__end-call__leave\", type: \"button\", \"data-testid\": \"leave-call-button\", onClick: onLeave, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { className: \"str-video__button__icon str-video__end-call__leave-icon\", icon: \"logout\" }), t('Leave call')] }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.Restricted, { requiredGrants: [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.END_CALL], children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"button\", { className: \"str-video__button str-video__end-call__end\", type: \"button\", \"data-testid\": \"end-call-for-all-button\", onClick: onEnd, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { className: \"str-video__button__icon str-video__end-call__end-icon\", icon: \"call-end\" }), t('End call for all')] }) })] }));\n};\nconst CancelCallToggleMenuButton = (0,react__WEBPACK_IMPORTED_MODULE_3__.forwardRef)(function CancelCallToggleMenuButton(props, ref) {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(IconButton, { icon: \"call-end\", variant: \"danger\", title: t('Leave call'), \"data-testid\": \"leave-call-button\", ref: ref }));\n});\nconst CancelCallConfirmButton = ({ onClick, onLeave, }) => {\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const handleLeave = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)(async (e) => {\n        if (onClick) {\n            onClick(e);\n        }\n        else if (call) {\n            await call.leave();\n            onLeave?.();\n        }\n    }, [onClick, onLeave, call]);\n    const handleEndCall = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)(async (e) => {\n        if (onClick) {\n            onClick(e);\n        }\n        else if (call) {\n            await call.endCall();\n            onLeave?.();\n        }\n    }, [onClick, onLeave, call]);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MenuToggle, { placement: \"top-start\", ToggleButton: CancelCallToggleMenuButton, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(EndCallMenu, { onEnd: handleEndCall, onLeave: handleLeave }) }));\n};\nconst CancelCallButton = ({ disabled, onClick, onLeave, }) => {\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const handleClick = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)(async (e) => {\n        if (onClick) {\n            onClick(e);\n        }\n        else if (call) {\n            await call.leave();\n            onLeave?.();\n        }\n    }, [onClick, onLeave, call]);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(IconButton, { disabled: disabled, icon: \"call-end\", variant: \"danger\", title: t('Leave call'), \"data-testid\": \"cancel-call-button\", onClick: handleClick }));\n};\n\nconst CallControls = ({ onLeave }) => ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__call-controls\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(RecordCallButton, {}), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ReactionsButton, {}), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ScreenShareButton, {}), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(SpeakingWhileMutedNotification, { children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ToggleAudioPublishingButton, {}) }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ToggleVideoPublishingButton, {}), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CancelCallButton, { onLeave: onLeave })] }));\n\nchart_js__WEBPACK_IMPORTED_MODULE_8__.Chart.register(chart_js__WEBPACK_IMPORTED_MODULE_8__.CategoryScale, chart_js__WEBPACK_IMPORTED_MODULE_8__.LinearScale, chart_js__WEBPACK_IMPORTED_MODULE_8__.LineElement, chart_js__WEBPACK_IMPORTED_MODULE_8__.PointElement);\nconst CallStatsLatencyChart = (props) => {\n    const { values } = props;\n    let max = 0;\n    const data = {\n        labels: values.map((point) => {\n            const date = new Date(point.x * 1000);\n            return `${date.getHours()}:${date.getMinutes()}`;\n        }),\n        datasets: [\n            {\n                data: values.map((point) => {\n                    const { y } = point;\n                    max = Math.max(max, y);\n                    return point;\n                }),\n                borderColor: '#00e2a1',\n                backgroundColor: '#00e2a1',\n            },\n        ],\n    };\n    const options = (0,react__WEBPACK_IMPORTED_MODULE_3__.useMemo)(() => {\n        return {\n            maintainAspectRatio: false,\n            animation: {\n                duration: 0,\n            },\n            elements: {\n                line: {\n                    borderWidth: 1,\n                },\n                point: {\n                    radius: 2,\n                },\n            },\n            scales: {\n                y: {\n                    position: 'right',\n                    stacked: true,\n                    min: 0,\n                    max: Math.max(180, Math.ceil((max + 10) / 10) * 10),\n                    grid: {\n                        display: true,\n                        color: '#979ca0',\n                    },\n                    ticks: {\n                        stepSize: 30,\n                    },\n                },\n                x: {\n                    grid: {\n                        display: false,\n                    },\n                    ticks: {\n                        display: false,\n                    },\n                },\n            },\n        };\n    }, [max]);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-stats-line-chart-container\", children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(react_chartjs_2__WEBPACK_IMPORTED_MODULE_9__.Line, { options: options, data: data, className: \"str-video__call-stats__latencychart\" }) }));\n};\n\nvar Statuses;\n(function (Statuses) {\n    Statuses[\"GOOD\"] = \"Good\";\n    Statuses[\"OK\"] = \"Ok\";\n    Statuses[\"BAD\"] = \"Bad\";\n})(Statuses || (Statuses = {}));\nconst statsStatus = ({ value, lowBound, highBound, }) => {\n    if (value <= lowBound) {\n        return Statuses.GOOD;\n    }\n    if (value >= lowBound && value <= highBound) {\n        return Statuses.OK;\n    }\n    if (value >= highBound) {\n        return Statuses.BAD;\n    }\n    return Statuses.GOOD;\n};\nconst CallStats = (props) => {\n    const { latencyLowBound = 75, latencyHighBound = 400 } = props;\n    const [latencyBuffer, setLatencyBuffer] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(() => {\n        const now = Date.now();\n        return Array.from({ length: 20 }, (_, i) => ({ x: now + i, y: 0 }));\n    });\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const [publishBitrate, setPublishBitrate] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)('-');\n    const [subscribeBitrate, setSubscribeBitrate] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)('-');\n    const previousStats = (0,react__WEBPACK_IMPORTED_MODULE_3__.useRef)();\n    const { useCallStatsReport } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const callStatsReport = useCallStatsReport();\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!callStatsReport)\n            return;\n        if (!previousStats.current) {\n            previousStats.current = callStatsReport;\n            return;\n        }\n        const previousCallStatsReport = previousStats.current;\n        setPublishBitrate(() => {\n            return calculatePublishBitrate(previousCallStatsReport, callStatsReport);\n        });\n        setSubscribeBitrate(() => {\n            return calculateSubscribeBitrate(previousCallStatsReport, callStatsReport);\n        });\n        setLatencyBuffer((latencyBuf) => {\n            const newLatencyBuffer = latencyBuf.slice(-19);\n            newLatencyBuffer.push({\n                x: callStatsReport.timestamp,\n                y: callStatsReport.publisherStats.averageRoundTripTimeInMs,\n            });\n            return newLatencyBuffer;\n        });\n        previousStats.current = callStatsReport;\n    }, [callStatsReport]);\n    const latencyComparison = {\n        lowBound: latencyLowBound,\n        highBound: latencyHighBound,\n        value: callStatsReport?.publisherStats.averageRoundTripTimeInMs || 0,\n    };\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-stats\", children: callStatsReport && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__call-stats__header\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"h3\", { className: \"str-video__call-stats__heading\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { className: \"str-video__call-stats__icon\", icon: \"call-latency\" }), t('Call Latency')] }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"p\", { className: \"str-video__call-stats__description\", children: t('Very high latency values may reduce call quality, cause lag, and make the call less enjoyable.') })] }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-stats__latencychart\", children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CallStatsLatencyChart, { values: latencyBuffer }) }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__call-stats__header\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"h3\", { className: \"str-video__call-stats__heading\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { className: \"str-video__call-stats__icon\", icon: \"network-quality\" }), t('Call performance')] }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"p\", { className: \"str-video__call-stats__description\", children: t('Very high latency values may reduce call quality, cause lag, and make the call less enjoyable.') })] }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__call-stats__card-container\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StatCard, { label: \"Region\", value: callStatsReport.datacenter }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StatCard, { label: \"Latency\", value: `${callStatsReport.publisherStats.averageRoundTripTimeInMs} ms.`, comparison: latencyComparison }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StatCard, { label: \"Receive jitter\", value: `${callStatsReport.subscriberStats.averageJitterInMs} ms.`, comparison: {\n                                ...latencyComparison,\n                                value: callStatsReport.subscriberStats.averageJitterInMs,\n                            } }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StatCard, { label: \"Publish jitter\", value: `${callStatsReport.publisherStats.averageJitterInMs} ms.`, comparison: {\n                                ...latencyComparison,\n                                value: callStatsReport.publisherStats.averageJitterInMs,\n                            } }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StatCard, { label: \"Publish resolution\", value: toFrameSize(callStatsReport.publisherStats) }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StatCard, { label: \"Publish quality drop reason\", value: callStatsReport.publisherStats.qualityLimitationReasons }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StatCard, { label: \"Receiving resolution\", value: toFrameSize(callStatsReport.subscriberStats) }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StatCard, { label: \"Receive quality drop reason\", value: callStatsReport.subscriberStats.qualityLimitationReasons }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StatCard, { label: \"Publish bitrate\", value: publishBitrate }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StatCard, { label: \"Receiving bitrate\", value: subscribeBitrate })] })] })) }));\n};\nconst StatCardExplanation = (props) => {\n    const { description } = props;\n    const [isOpen, setIsOpen] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(false);\n    const { refs, floatingStyles, context } = (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_6__.useFloating)({\n        open: isOpen,\n        onOpenChange: setIsOpen,\n    });\n    const hover = (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_6__.useHover)(context);\n    const { getReferenceProps, getFloatingProps } = (0,_floating_ui_react__WEBPACK_IMPORTED_MODULE_6__.useInteractions)([hover]);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-explanation\", ref: refs.setReference, ...getReferenceProps(), children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { className: \"str-video__call-explanation__icon\", icon: \"info\" }) }), isOpen && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-explanation__description\", ref: refs.setFloating, style: floatingStyles, ...getFloatingProps(), children: description }))] }));\n};\nconst StatsTag = ({ children, status = Statuses.GOOD, }) => {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__call-stats__tag', {\n            'str-video__call-stats__tag--good': status === Statuses.GOOD,\n            'str-video__call-stats__tag--ok': status === Statuses.OK,\n            'str-video__call-stats__tag--bad': status === Statuses.BAD,\n        }), children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-stats__tag__text\", children: children }) }));\n};\nconst StatCard = (props) => {\n    const { label, value, description, comparison } = props;\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const status = comparison ? statsStatus(comparison) : undefined;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__call-stats__card\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__call-stats__card-content\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__call-stats__card-label\", children: [label, description && (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StatCardExplanation, { description: description })] }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-stats__card-value\", children: value })] }), comparison && status && (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StatsTag, { status: status, children: t(status) })] }));\n};\nconst toFrameSize = (stats) => {\n    const { highestFrameWidth: w, highestFrameHeight: h, highestFramesPerSecond: fps, } = stats;\n    let size = `-`;\n    if (w && h) {\n        size = `${w}x${h}`;\n        if (fps) {\n            size += `@${fps}fps.`;\n        }\n    }\n    return size;\n};\nconst calculatePublishBitrate = (previousCallStatsReport, callStatsReport) => {\n    const { publisherStats: { totalBytesSent: previousTotalBytesSent, timestamp: previousTimestamp, }, } = previousCallStatsReport;\n    const { publisherStats: { totalBytesSent, timestamp }, } = callStatsReport;\n    const bytesSent = totalBytesSent - previousTotalBytesSent;\n    const timeElapsed = timestamp - previousTimestamp;\n    return `${((bytesSent * 8) / timeElapsed).toFixed(2)} kbps`;\n};\nconst calculateSubscribeBitrate = (previousCallStatsReport, callStatsReport) => {\n    const { subscriberStats: { totalBytesReceived: previousTotalBytesReceived, timestamp: previousTimestamp, }, } = previousCallStatsReport;\n    const { subscriberStats: { totalBytesReceived, timestamp }, } = callStatsReport;\n    const bytesReceived = totalBytesReceived - previousTotalBytesReceived;\n    const timeElapsed = timestamp - previousTimestamp;\n    return `${((bytesReceived * 8) / timeElapsed).toFixed(2)} kbps`;\n};\n\nconst CallStatsButton = () => ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MenuToggle, { placement: \"top-end\", ToggleButton: ToggleMenuButton, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CallStats, {}) }));\nconst ToggleMenuButton = (0,react__WEBPACK_IMPORTED_MODULE_3__.forwardRef)(function ToggleMenuButton(props, ref) {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const { caption, menuShown } = props;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CompositeButton, { ref: ref, active: menuShown, caption: caption, title: caption || t('Statistics'), \"data-testid\": \"stats-button\", children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"stats\" }) }));\n});\n\nconst ToggleAudioOutputButton = (props) => {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const { caption, Menu = DeviceSelectorAudioOutput, menuPlacement = 'top', } = props;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CompositeButton, { Menu: Menu, menuPlacement: menuPlacement, caption: caption, title: caption || t('Speakers'), \"data-testid\": \"audio-output-button\", children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"speaker\" }) }));\n};\n\nconst BlockedUserListing = ({ data }) => {\n    if (!data.length)\n        return null;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__participant-listing\", children: data.map((userId) => ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(BlockedUserListingItem, { userId: userId }, userId))) }) }));\n};\nconst BlockedUserListingItem = ({ userId }) => {\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const unblockUserClickHandler = () => {\n        if (userId)\n            call?.unblockUser(userId);\n    };\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__participant-listing-item\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__participant-listing-item__display-name\", children: userId }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.Restricted, { requiredGrants: [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.BLOCK_USERS], children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(TextButton, { onClick: unblockUserClickHandler, children: \"Unblock\" }) })] }));\n};\n\nconst CallParticipantListHeader = ({ onClose, }) => {\n    const { useParticipants, useAnonymousParticipantCount } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const participants = useParticipants();\n    const anonymousParticipantCount = useAnonymousParticipantCount();\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__participant-list-header\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__participant-list-header__title\", children: [t('Participants'), ' ', (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"span\", { className: \"str-video__participant-list-header__title-count\", children: [\"[\", participants.length, \"]\"] }), anonymousParticipantCount > 0 && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__participant-list-header__title-anonymous\", children: t('Anonymous', { count: anonymousParticipantCount }) }))] }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(IconButton, { onClick: onClose, className: \"str-video__participant-list-header__close-button\", icon: \"close\" })] }));\n};\n\nconst Tooltip = ({ children, referenceElement, tooltipClassName, tooltipPlacement = 'top', visible = false, }) => {\n    const { refs, x, y, strategy } = useFloatingUIPreset({\n        placement: tooltipPlacement,\n        strategy: 'absolute',\n    });\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        refs.setReference(referenceElement);\n    }, [referenceElement, refs]);\n    if (!visible)\n        return null;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__tooltip', tooltipClassName), ref: refs.setFloating, style: {\n            position: strategy,\n            top: y ?? 0,\n            left: x ?? 0,\n            overflowY: 'auto',\n        }, children: children }));\n};\n\nconst useEnterLeaveHandlers = ({ onMouseEnter, onMouseLeave, } = {}) => {\n    const [tooltipVisible, setTooltipVisible] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(false);\n    const handleMouseEnter = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)((e) => {\n        setTooltipVisible(true);\n        onMouseEnter?.(e);\n    }, [onMouseEnter]);\n    const handleMouseLeave = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)((e) => {\n        setTooltipVisible(false);\n        onMouseLeave?.(e);\n    }, [onMouseLeave]);\n    return { handleMouseEnter, handleMouseLeave, tooltipVisible };\n};\n\n// todo: duplicate of CallParticipantList.tsx#MediaIndicator - refactor to a single component\nconst WithTooltip = ({ title, tooltipClassName, tooltipPlacement, ...props }) => {\n    const { handleMouseEnter, handleMouseLeave, tooltipVisible } = useEnterLeaveHandlers();\n    const [tooltipAnchor, setTooltipAnchor] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Tooltip, { referenceElement: tooltipAnchor, visible: tooltipVisible, tooltipClassName: tooltipClassName, tooltipPlacement: tooltipPlacement, children: title || '' }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { ref: setTooltipAnchor, onMouseEnter: handleMouseEnter, onMouseLeave: handleMouseLeave, ...props })] }));\n};\n\nconst CallParticipantListingItem = ({ participant, DisplayName = DefaultDisplayName, }) => {\n    const isAudioOn = participant.publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.AUDIO);\n    const isVideoOn = participant.publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.VIDEO);\n    const isPinned = !!participant.pin;\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__participant-listing-item\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Avatar, { name: participant.name, imageSrc: participant.image }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DisplayName, { participant: participant }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__participant-listing-item__media-indicator-group\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MediaIndicator, { title: isAudioOn ? t('Microphone on') : t('Microphone off'), className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__participant-listing-item__icon', `str-video__participant-listing-item__icon-${isAudioOn ? 'mic' : 'mic-off'}`) }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MediaIndicator, { title: isVideoOn ? t('Camera on') : t('Camera off'), className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__participant-listing-item__icon', `str-video__participant-listing-item__icon-${isVideoOn ? 'camera' : 'camera-off'}`) }), isPinned && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MediaIndicator, { title: t('Pinned'), className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__participant-listing-item__icon', 'str-video__participant-listing-item__icon-pinned') })), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MenuToggle, { placement: \"bottom-end\", ToggleButton: ToggleButton$2, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantViewContext.Provider, { value: { participant, trackType: 'none' }, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantActionsContextMenu, {}) }) })] })] }));\n};\nconst MediaIndicator = (props) => ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(WithTooltip, { ...props }));\nconst DefaultDisplayName = ({ participant }) => {\n    const connectedUser = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useConnectedUser)();\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const meFlag = participant.userId === connectedUser?.id ? t('Me') : '';\n    const nameOrId = participant.name || participant.userId || t('Unknown');\n    let displayName;\n    if (!participant.name) {\n        displayName = meFlag || nameOrId || t('Unknown');\n    }\n    else if (meFlag) {\n        displayName = `${nameOrId} (${meFlag})`;\n    }\n    else {\n        displayName = nameOrId;\n    }\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(WithTooltip, { className: \"str-video__participant-listing-item__display-name\", title: displayName, children: displayName }));\n};\nconst ToggleButton$2 = (0,react__WEBPACK_IMPORTED_MODULE_3__.forwardRef)(function ToggleButton(props, ref) {\n    return (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(IconButton, { enabled: props.menuShown, icon: \"ellipsis\", ref: ref });\n});\n\nconst CallParticipantListing = ({ data, }) => ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__participant-listing\", children: data.map((participant) => ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CallParticipantListingItem, { participant: participant }, participant.sessionId))) }));\n\nconst EmptyParticipantSearchList = () => {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__participant-list--empty\", children: t('No participants found') }));\n};\n\nconst SearchInput = ({ exitSearch, isActive, ...rest }) => {\n    const [inputElement, setInputElement] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!inputElement)\n            return;\n        const handleKeyDown = (e) => {\n            if (e.key.toLowerCase() === 'escape')\n                exitSearch();\n        };\n        inputElement.addEventListener('keydown', handleKeyDown);\n        return () => {\n            inputElement.removeEventListener('keydown', handleKeyDown);\n        };\n    }, [exitSearch, inputElement]);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__search-input__container', {\n            'str-video__search-input__container--active': isActive,\n        }), children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"input\", { placeholder: \"Search\", ...rest, ref: setInputElement }), isActive ? ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"button\", { className: \"str-video__search-input__clear-btn\", onClick: exitSearch, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__search-input__icon--active\" }) })) : ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__search-input__icon\" }))] }));\n};\n\nconst SearchResults = ({ EmptySearchResultComponent, LoadingIndicator: LoadingIndicator$1 = LoadingIndicator, searchQueryInProgress, searchResults, SearchResultList, }) => {\n    if (searchQueryInProgress) {\n        return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__search-results--loading\", children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(LoadingIndicator$1, {}) }));\n    }\n    if (!searchResults.length) {\n        return (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(EmptySearchResultComponent, {});\n    }\n    return (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(SearchResultList, { data: searchResults });\n};\n\nconst useSearch = ({ debounceInterval, searchFn, searchQuery = '', }) => {\n    const [searchResults, setSearchResults] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)([]);\n    const [searchQueryInProgress, setSearchQueryInProgress] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(false);\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!searchQuery.length) {\n            setSearchQueryInProgress(false);\n            setSearchResults([]);\n            return;\n        }\n        setSearchQueryInProgress(true);\n        const timeout = setTimeout(async () => {\n            try {\n                const results = await searchFn(searchQuery);\n                setSearchResults(results);\n            }\n            catch (error) {\n                console.error(error);\n            }\n            finally {\n                setSearchQueryInProgress(false);\n            }\n        }, debounceInterval);\n        return () => {\n            clearTimeout(timeout);\n        };\n    }, [debounceInterval, searchFn, searchQuery]);\n    return {\n        searchQueryInProgress,\n        searchResults,\n    };\n};\n\nconst UserListTypes = {\n    active: 'Active users',\n    blocked: 'Blocked users',\n};\nconst DEFAULT_DEBOUNCE_SEARCH_INTERVAL = 200;\nconst CallParticipantsList = ({ onClose, activeUsersSearchFn, blockedUsersSearchFn, debounceSearchInterval, }) => {\n    const [searchQuery, setSearchQuery] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)('');\n    const [userListType, setUserListType] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)('active');\n    const exitSearch = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)(() => setSearchQuery(''), []);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__participant-list\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CallParticipantListHeader, { onClose: onClose }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(SearchInput, { value: searchQuery, onChange: ({ currentTarget }) => setSearchQuery(currentTarget.value), exitSearch: exitSearch, isActive: !!searchQuery }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CallParticipantListContentHeader, { userListType: userListType, setUserListType: setUserListType }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__participant-list__content\", children: [userListType === 'active' && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ActiveUsersSearchResults, { searchQuery: searchQuery, activeUsersSearchFn: activeUsersSearchFn, debounceSearchInterval: debounceSearchInterval })), userListType === 'blocked' && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(BlockedUsersSearchResults, { searchQuery: searchQuery, blockedUsersSearchFn: blockedUsersSearchFn, debounceSearchInterval: debounceSearchInterval }))] })] }));\n};\nconst CallParticipantListContentHeader = ({ userListType, setUserListType, }) => {\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const muteAll = () => {\n        call?.muteAllUsers('audio');\n    };\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__participant-list__content-header\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__participant-list__content-header-title\", children: userListType === 'active' && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.Restricted, { requiredGrants: [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.MUTE_USERS], hasPermissionsOnly: true, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(TextButton, { onClick: muteAll, children: \"Mute all\" }) })) }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MenuToggle, { placement: \"bottom-end\", ToggleButton: ToggleButton$1, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GenericMenu, { children: Object.keys(UserListTypes).map((lt) => ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GenericMenuButtonItem, { \"aria-selected\": lt === userListType, onClick: () => setUserListType(lt), children: UserListTypes[lt] }, lt))) }) })] }));\n};\nconst ActiveUsersSearchResults = ({ searchQuery, activeUsersSearchFn: activeUsersSearchFnFromProps, debounceSearchInterval = DEFAULT_DEBOUNCE_SEARCH_INTERVAL, }) => {\n    const { useParticipants } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const participants = useParticipants({ sortBy: _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.name });\n    const activeUsersSearchFn = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)((queryString) => {\n        const queryRegExp = new RegExp(queryString, 'i');\n        return Promise.resolve(participants.filter((participant) => {\n            return participant.name.match(queryRegExp);\n        }));\n    }, [participants]);\n    const { searchQueryInProgress, searchResults } = useSearch({\n        searchFn: activeUsersSearchFnFromProps ?? activeUsersSearchFn,\n        debounceInterval: debounceSearchInterval,\n        searchQuery,\n    });\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(SearchResults, { EmptySearchResultComponent: EmptyParticipantSearchList, LoadingIndicator: LoadingIndicator, searchQueryInProgress: searchQueryInProgress, searchResults: searchQuery ? searchResults : participants, SearchResultList: CallParticipantListing }));\n};\nconst BlockedUsersSearchResults = ({ blockedUsersSearchFn: blockedUsersSearchFnFromProps, debounceSearchInterval = DEFAULT_DEBOUNCE_SEARCH_INTERVAL, searchQuery, }) => {\n    const { useCallBlockedUserIds } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const blockedUsers = useCallBlockedUserIds();\n    const blockedUsersSearchFn = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)((queryString) => {\n        const queryRegExp = new RegExp(queryString, 'i');\n        return Promise.resolve(blockedUsers.filter((blockedUser) => {\n            return blockedUser.match(queryRegExp);\n        }));\n    }, [blockedUsers]);\n    const { searchQueryInProgress, searchResults } = useSearch({\n        searchFn: blockedUsersSearchFnFromProps ?? blockedUsersSearchFn,\n        debounceInterval: debounceSearchInterval,\n        searchQuery,\n    });\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(SearchResults, { EmptySearchResultComponent: EmptyParticipantSearchList, LoadingIndicator: LoadingIndicator, searchQueryInProgress: searchQueryInProgress, searchResults: searchQuery ? searchResults : blockedUsers, SearchResultList: BlockedUserListing }));\n};\nconst ToggleButton$1 = (0,react__WEBPACK_IMPORTED_MODULE_3__.forwardRef)(function ToggleButton(props, ref) {\n    return (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(IconButton, { enabled: props.menuShown, icon: \"filter\", ref: ref });\n});\n\nconst CallPreview = (props) => {\n    const { className, style } = props;\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const { useCallThumbnail } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const thumbnail = useCallThumbnail();\n    const [imageRef, setImageRef] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!imageRef || !call)\n            return;\n        const cleanup = call.bindCallThumbnailElement(imageRef);\n        return () => cleanup();\n    }, [imageRef, call]);\n    if (!thumbnail)\n        return null;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"img\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__call-preview', className), style: style, alt: \"Call Preview Thumbnail\", ref: setImageRef }));\n};\n\nconst CallRecordingListHeader = ({ callRecordings, onRefresh, }) => {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__call-recording-list__header\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__call-recording-list__title\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { children: t('Call Recordings') }), callRecordings.length ? (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"span\", { children: [\"(\", callRecordings.length, \")\"] }) : null] }), onRefresh && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(IconButton, { icon: \"refresh\", title: t('Refresh'), onClick: onRefresh }))] }));\n};\n\nconst dateFormat = (date) => {\n    const format = new Date(date);\n    return format.toTimeString().split(' ')[0];\n};\nconst CallRecordingListItem = ({ recording, }) => {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"li\", { className: \"str-video__call-recording-list__item\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-recording-list__table-cell str-video__call-recording-list__filename\", children: recording.filename }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-recording-list__table-cell str-video__call-recording-list__time\", children: dateFormat(recording.start_time) }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-recording-list__table-cell str-video__call-recording-list__time\", children: dateFormat(recording.end_time) }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-recording-list__table-cell str-video__call-recording-list__download\", children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"a\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__call-recording-list-item__action-button', 'str-video__call-recording-list-item__action-button--download'), role: \"button\", href: recording.url, download: recording.filename, title: \"Download the recording\", children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"download\" }) }) })] }));\n};\n\nconst EmptyCallRecordingListing = () => {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__call-recording-list__listing str-video__call-recording-list__listing--empty\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-recording-list__listing--icon-empty\" }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"p\", { className: \"str-video__call-recording-list__listing--text-empty\", children: \"No recordings available\" })] }));\n};\n\nconst LoadingCallRecordingListing = ({ callRecordings, }) => {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [callRecordings.map((recording) => ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CallRecordingListItem, { recording: recording }, recording.filename))), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(LoadingIndicator, { text: \"Recording getting ready\" })] }));\n};\n\nconst CallRecordingList = ({ callRecordings, CallRecordingListHeader: CallRecordingListHeader$1 = CallRecordingListHeader, CallRecordingListItem: CallRecordingListItem$1 = CallRecordingListItem, EmptyCallRecordingList = EmptyCallRecordingListing, loading, LoadingCallRecordingList = LoadingCallRecordingListing, onRefresh, }) => {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__call-recording-list\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CallRecordingListHeader$1, { callRecordings: callRecordings, onRefresh: onRefresh }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-recording-list__listing\", children: loading ? ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(LoadingCallRecordingList, { callRecordings: callRecordings })) : callRecordings.length ? ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"ul\", { className: \"str-video__call-recording-list__list\", children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"li\", { className: \"str-video__call-recording-list__item\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-recording-list__filename\", children: \"Name\" }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-recording-list__time\", children: \"Start time\" }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-recording-list__time\", children: \"End time\" }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-recording-list__download\" })] }) }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"ul\", { className: \"str-video__call-recording-list__list\", children: callRecordings.map((recording) => ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CallRecordingListItem$1, { recording: recording }, recording.filename))) })] })) : ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(EmptyCallRecordingList, {})) })] }));\n};\n\nconst RingingCallControls = () => {\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const { useCallCallingState } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const callCallingState = useCallCallingState();\n    if (!call)\n        return null;\n    const buttonsDisabled = callCallingState !== _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallingState.RINGING;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__pending-call-controls\", children: call.isCreatedByMe ? ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CancelCallButton, { disabled: buttonsDisabled })) : ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(AcceptCallButton, { disabled: buttonsDisabled }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(CancelCallButton, { onClick: () => call.leave({ reject: true }), disabled: buttonsDisabled })] })) }));\n};\n\nconst CALLING_STATE_TO_LABEL = {\n    [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallingState.JOINING]: 'Joining',\n    [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallingState.RINGING]: 'Ringing',\n    [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallingState.MIGRATING]: 'Migrating',\n    [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallingState.RECONNECTING]: 'Re-connecting',\n    [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallingState.RECONNECTING_FAILED]: 'Failed',\n    [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallingState.OFFLINE]: 'No internet connection',\n    [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallingState.IDLE]: '',\n    [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallingState.UNKNOWN]: '',\n    [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallingState.JOINED]: 'Joined',\n    [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallingState.LEFT]: 'Left call',\n};\nconst RingingCall = (props) => {\n    const { includeSelf = false, totalMembersToShow = 3 } = props;\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const { useCallCallingState, useCallMembers } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const callingState = useCallCallingState();\n    const members = useCallMembers();\n    const connectedUser = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useConnectedUser)();\n    if (!call)\n        return null;\n    // take the first N members to show their avatars\n    const membersToShow = (members || [])\n        .slice(0, totalMembersToShow)\n        .map(({ user }) => user)\n        .filter((user) => user.id !== connectedUser?.id || includeSelf);\n    if (includeSelf &&\n        !membersToShow.find((user) => user.id === connectedUser?.id)) {\n        // if the current user is not in the initial batch of members,\n        // replace the first item in membersToShow array with the current user\n        const self = members.find(({ user }) => user.id === connectedUser?.id);\n        if (self) {\n            membersToShow.splice(0, 1, self.user);\n        }\n    }\n    const callingStateLabel = CALLING_STATE_TO_LABEL[callingState];\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__call-panel str-video__call-panel--ringing\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-panel__members-list\", children: membersToShow.map((user) => ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__call-panel__member-box\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Avatar, { name: user.name, imageSrc: user.image }), user.name && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__member_details\", children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__member_name\", children: user.name }) }))] }, user.id))) }), callingStateLabel && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__call-panel__calling-state-label\", children: t(callingStateLabel) })), [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallingState.RINGING, _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallingState.JOINING].includes(callingState) && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(RingingCallControls, {}))] }));\n};\n\nconst byNameOrId = (a, b) => {\n    if (a.name && b.name && a.name < b.name)\n        return -1;\n    if (a.name && b.name && a.name > b.name)\n        return 1;\n    if (a.id < b.id)\n        return -1;\n    if (a.id > b.id)\n        return 1;\n    return 0;\n};\nconst PermissionRequests = () => {\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const { useLocalParticipant, useHasPermissions } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const localParticipant = useLocalParticipant();\n    const [expanded, setExpanded] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(false);\n    const [permissionRequests, setPermissionRequests] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)([]);\n    const canUpdateCallPermissions = useHasPermissions(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.UPDATE_CALL_PERMISSIONS);\n    const localUserId = localParticipant?.userId;\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!call || !canUpdateCallPermissions)\n            return;\n        return call.on('call.permission_request', (event) => {\n            if (event.user.id !== localUserId) {\n                setPermissionRequests((requests) => [...requests, event].sort((a, b) => byNameOrId(a.user, b.user)));\n            }\n        });\n    }, [call, canUpdateCallPermissions, localUserId]);\n    const handleUpdatePermission = (request, type) => {\n        return async () => {\n            const { user, permissions } = request;\n            switch (type) {\n                case 'grant':\n                    await call?.grantPermissions(user.id, permissions);\n                    break;\n                case 'revoke':\n                    await call?.revokePermissions(user.id, permissions);\n                    break;\n            }\n            setPermissionRequests((requests) => requests.filter((r) => r !== request));\n        };\n    };\n    const { refs, x, y, strategy } = useFloatingUIPreset({\n        placement: 'bottom',\n        strategy: 'absolute',\n    });\n    // don't render anything if there are no permission requests\n    if (permissionRequests.length === 0)\n        return null;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__permission-requests\", ref: refs.setReference, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__permission-requests__notification\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"span\", { className: \"str-video__permission-requests__notification__message\", children: [permissionRequests.length, \" pending permission requests\"] }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Button, { type: \"button\", onClick: () => {\n                            setExpanded((e) => !e);\n                        }, children: expanded ? 'Hide requests' : 'Show requests' })] }), expanded && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(PermissionRequestList, { ref: refs.setFloating, style: {\n                    position: strategy,\n                    top: y ?? 0,\n                    left: x ?? 0,\n                    overflowY: 'auto',\n                }, permissionRequests: permissionRequests, handleUpdatePermission: handleUpdatePermission }))] }));\n};\nconst PermissionRequestList = (0,react__WEBPACK_IMPORTED_MODULE_3__.forwardRef)(function PermissionRequestList(props, ref) {\n    const { permissionRequests, handleUpdatePermission, ...rest } = props;\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__permission-requests-list\", ref: ref, ...rest, children: permissionRequests.map((request, reqIndex) => {\n            const { user, permissions } = request;\n            return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(react__WEBPACK_IMPORTED_MODULE_3__.Fragment, { children: permissions.map((permission) => ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__permission-request\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__permission-request__message\", children: messageForPermission(user.name || user.id, permission, t) }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Button, { className: \"str-video__permission-request__button--allow\", type: \"button\", onClick: handleUpdatePermission(request, 'grant'), children: t('Allow') }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Button, { className: \"str-video__permission-request__button--reject\", type: \"button\", onClick: handleUpdatePermission(request, 'revoke'), children: t('Revoke') }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Button, { className: \"str-video__permission-request__button--reject\", type: \"button\", onClick: handleUpdatePermission(request, 'dismiss'), children: t('Dismiss') })] }, permission))) }, `${user.id}/${reqIndex}`));\n        }) }));\n});\nconst Button = (props) => {\n    const { className, ...rest } = props;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"button\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__permission-request__button', className), ...rest }));\n};\nconst messageForPermission = (userName, permission, t) => {\n    switch (permission) {\n        case _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SEND_AUDIO:\n            return t('{{ userName }} is requesting to speak', { userName });\n        case _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SEND_VIDEO:\n            return t('{{ userName }} is requesting to share their camera', {\n                userName,\n            });\n        case _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SCREENSHARE:\n            return t('{{ userName }} is requesting to present their screen', {\n                userName,\n            });\n        default:\n            return t('{{ userName }} is requesting permission: {{ permission }}', {\n                userName,\n                permission,\n            });\n    }\n};\n\nconst StreamTheme = ({ as: Component = 'div', className, children, ...props }) => {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Component, { ...props, className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video', className), children: children }));\n};\n\nconst DefaultVideoPlaceholder = (0,react__WEBPACK_IMPORTED_MODULE_3__.forwardRef)(function DefaultVideoPlaceholder({ participant, style }, ref) {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const [error, setError] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(false);\n    const name = participant.name || participant.userId;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__video-placeholder\", style: style, ref: ref, children: [(!participant.image || error) &&\n                (name ? ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(InitialsFallback, { name: name })) : ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__video-placeholder__no-video-label\", children: t('Video is disabled') }))), participant.image && !error && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"img\", { onError: () => setError(true), alt: \"video-placeholder\", className: \"str-video__video-placeholder__avatar\", src: participant.image }))] }));\n});\nconst InitialsFallback = (props) => {\n    const { name } = props;\n    const initials = name\n        .split(' ')\n        .slice(0, 2)\n        .map((n) => n[0])\n        .join('');\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__video-placeholder__initials-fallback\", children: initials }));\n};\n\nconst Video$1 = ({ trackType, participant, className, VideoPlaceholder = DefaultVideoPlaceholder, refs, ...rest }) => {\n    const { sessionId, videoStream, screenShareStream, publishedTracks, viewportVisibilityState, isLocalParticipant, userId, } = participant;\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const [videoElement, setVideoElement] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    // start with true, will flip once the video starts playing\n    const [isVideoPaused, setIsVideoPaused] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(true);\n    const [isWideMode, setIsWideMode] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(true);\n    const stream = trackType === 'videoTrack'\n        ? videoStream\n        : trackType === 'screenShareTrack'\n            ? screenShareStream\n            : undefined;\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useLayoutEffect)(() => {\n        if (!call || !videoElement || trackType === 'none')\n            return;\n        const cleanup = call.bindVideoElement(videoElement, sessionId, trackType);\n        return () => {\n            cleanup?.();\n        };\n    }, [call, trackType, sessionId, videoElement]);\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!stream || !videoElement)\n            return;\n        const [track] = stream.getVideoTracks();\n        if (!track)\n            return;\n        const handlePlayPause = () => {\n            setIsVideoPaused(videoElement.paused);\n            const { width = 0, height = 0 } = track.getSettings();\n            setIsWideMode(width >= height);\n        };\n        // playback may have started before we had a chance to\n        // attach the 'play/pause' event listener, so we set the state\n        // here to make sure it's in sync\n        setIsVideoPaused(videoElement.paused);\n        videoElement.addEventListener('play', handlePlayPause);\n        videoElement.addEventListener('pause', handlePlayPause);\n        track.addEventListener('unmute', handlePlayPause);\n        return () => {\n            videoElement.removeEventListener('play', handlePlayPause);\n            videoElement.removeEventListener('pause', handlePlayPause);\n            track.removeEventListener('unmute', handlePlayPause);\n            // reset the 'pause' state once we unmount the video element\n            setIsVideoPaused(true);\n        };\n    }, [stream, videoElement]);\n    if (!call)\n        return null;\n    const isPublishingTrack = trackType === 'videoTrack'\n        ? publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.VIDEO)\n        : trackType === 'screenShareTrack'\n            ? publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.SCREEN_SHARE)\n            : false;\n    const isInvisible = trackType === 'none' ||\n        viewportVisibilityState?.[trackType] === _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.VisibilityState.INVISIBLE;\n    const hasNoVideoOrInvisible = !isPublishingTrack || isInvisible;\n    const mirrorVideo = isLocalParticipant && trackType === 'videoTrack';\n    const isScreenShareTrack = trackType === 'screenShareTrack';\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [!hasNoVideoOrInvisible && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"video\", { ...rest, className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__video', className, {\n                    'str-video__video--not-playing': isVideoPaused,\n                    'str-video__video--tall': !isWideMode,\n                    'str-video__video--mirror': mirrorVideo,\n                    'str-video__video--screen-share': isScreenShareTrack,\n                }), \"data-user-id\": userId, \"data-session-id\": sessionId, ref: (element) => {\n                    setVideoElement(element);\n                    refs?.setVideoElement?.(element);\n                } })), (hasNoVideoOrInvisible || isVideoPaused) && VideoPlaceholder && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(VideoPlaceholder, { style: { position: 'absolute' }, participant: participant, ref: refs?.setVideoPlaceholderElement }))] }));\n};\n\n/**\n * @description Extends video element with `stream` property\n * (`srcObject`) to reactively handle stream changes\n */\nconst BaseVideo = (0,react__WEBPACK_IMPORTED_MODULE_3__.forwardRef)(function BaseVideo({ stream, ...rest }, ref) {\n    const [videoElement, setVideoElement] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!videoElement || !stream)\n            return;\n        if (stream === videoElement.srcObject)\n            return;\n        videoElement.srcObject = stream;\n        if (_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.Browsers.isSafari() || _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.Browsers.isFirefox()) {\n            // Firefox and Safari have some timing issue\n            setTimeout(() => {\n                videoElement.srcObject = stream;\n                videoElement.play().catch((e) => {\n                    console.error(`Failed to play stream`, e);\n                });\n            }, 0);\n        }\n        return () => {\n            videoElement.pause();\n            videoElement.srcObject = null;\n        };\n    }, [stream, videoElement]);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"video\", { autoPlay: true, playsInline: true, ...rest, ref: (element) => {\n            applyElementToRef(ref, element);\n            setVideoElement(element);\n        } }));\n});\n\nconst DefaultDisabledVideoPreview = () => {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str_video__video-preview__disabled-video-preview\", children: t('Video is disabled') }));\n};\nconst DefaultNoCameraPreview = () => {\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str_video__video-preview__no-camera-preview\", children: t('No camera found') }));\n};\nconst VideoPreview = ({ className, mirror = true, DisabledVideoPreview = DefaultDisabledVideoPreview, NoCameraPreview = DefaultNoCameraPreview, StartingCameraPreview = LoadingIndicator, }) => {\n    const { useCameraState } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const { devices, status, isMute, mediaStream } = useCameraState();\n    let contents;\n    if (isMute && devices?.length === 0) {\n        contents = (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(NoCameraPreview, {});\n    }\n    else if (status === 'enabled') {\n        const loading = !mediaStream;\n        contents = ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [mediaStream && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(BaseVideo, { stream: mediaStream, className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__video-preview', {\n                        'str-video__video-preview--mirror': mirror,\n                        'str-video__video-preview--loading': loading,\n                    }) })), loading && (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(StartingCameraPreview, {})] }));\n    }\n    else {\n        contents = (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DisabledVideoPreview, {});\n    }\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__video-preview-container', className), children: contents }));\n};\n\nconst ParticipantActionsContextMenu = () => {\n    const { participant, participantViewElement, videoElement } = useParticipantViewContext();\n    const [fullscreenModeOn, setFullscreenModeOn] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(!!document.fullscreenElement);\n    const [pictureInPictureElement, setPictureInPictureElement] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(document.pictureInPictureElement);\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const { pin, publishedTracks, sessionId, userId } = participant;\n    const hasAudio = publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.AUDIO);\n    const hasVideo = publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.VIDEO);\n    const hasScreenShare = publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.SCREEN_SHARE);\n    const hasScreenShareAudio = publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.SCREEN_SHARE_AUDIO);\n    const blockUser = () => call?.blockUser(userId);\n    const muteAudio = () => call?.muteUser(userId, 'audio');\n    const muteVideo = () => call?.muteUser(userId, 'video');\n    const muteScreenShare = () => call?.muteUser(userId, 'screenshare');\n    const muteScreenShareAudio = () => call?.muteUser(userId, 'screenshare_audio');\n    const grantPermission = (permission) => () => {\n        call?.updateUserPermissions({\n            user_id: userId,\n            grant_permissions: [permission],\n        });\n    };\n    const revokePermission = (permission) => () => {\n        call?.updateUserPermissions({\n            user_id: userId,\n            revoke_permissions: [permission],\n        });\n    };\n    const toggleParticipantPin = () => {\n        if (pin) {\n            call?.unpin(sessionId);\n        }\n        else {\n            call?.pin(sessionId);\n        }\n    };\n    const pinForEveryone = () => {\n        call\n            ?.pinForEveryone({\n            user_id: userId,\n            session_id: sessionId,\n        })\n            .catch((err) => {\n            console.error(`Failed to pin participant ${userId}`, err);\n        });\n    };\n    const unpinForEveryone = () => {\n        call\n            ?.unpinForEveryone({\n            user_id: userId,\n            session_id: sessionId,\n        })\n            .catch((err) => {\n            console.error(`Failed to unpin participant ${userId}`, err);\n        });\n    };\n    const toggleFullscreenMode = () => {\n        if (!fullscreenModeOn) {\n            return participantViewElement?.requestFullscreen().catch(console.error);\n        }\n        return document.exitFullscreen().catch(console.error);\n    };\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        // handles the case when fullscreen mode is toggled externally,\n        // e.g., by pressing ESC key or some other keyboard shortcut\n        const handleFullscreenChange = () => {\n            setFullscreenModeOn(!!document.fullscreenElement);\n        };\n        document.addEventListener('fullscreenchange', handleFullscreenChange);\n        return () => {\n            document.removeEventListener('fullscreenchange', handleFullscreenChange);\n        };\n    }, []);\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!videoElement)\n            return;\n        const handlePiP = () => {\n            setPictureInPictureElement(document.pictureInPictureElement);\n        };\n        videoElement.addEventListener('enterpictureinpicture', handlePiP);\n        videoElement.addEventListener('leavepictureinpicture', handlePiP);\n        return () => {\n            videoElement.removeEventListener('enterpictureinpicture', handlePiP);\n            videoElement.removeEventListener('leavepictureinpicture', handlePiP);\n        };\n    }, [videoElement]);\n    const togglePictureInPicture = () => {\n        if (videoElement && pictureInPictureElement !== videoElement) {\n            return videoElement\n                .requestPictureInPicture()\n                .catch(console.error);\n        }\n        return document.exitPictureInPicture().catch(console.error);\n    };\n    const { close } = useMenuContext() || {};\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(GenericMenu, { onItemClick: close, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(GenericMenuButtonItem, { onClick: toggleParticipantPin, disabled: pin && !pin.isLocalPin, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"pin\" }), pin ? t('Unpin') : t('Pin')] }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.Restricted, { requiredGrants: [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.PIN_FOR_EVERYONE], children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(GenericMenuButtonItem, { onClick: pinForEveryone, disabled: pin && !pin.isLocalPin, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"pin\" }), t('Pin for everyone')] }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(GenericMenuButtonItem, { onClick: unpinForEveryone, disabled: !pin || pin.isLocalPin, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"pin\" }), t('Unpin for everyone')] })] }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.Restricted, { requiredGrants: [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.BLOCK_USERS], children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(GenericMenuButtonItem, { onClick: blockUser, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"not-allowed\" }), t('Block')] }) }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.Restricted, { requiredGrants: [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.MUTE_USERS], children: [hasVideo && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(GenericMenuButtonItem, { onClick: muteVideo, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"camera-off-outline\" }), t('Turn off video')] })), hasScreenShare && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(GenericMenuButtonItem, { onClick: muteScreenShare, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"screen-share-off\" }), t('Turn off screen share')] })), hasAudio && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(GenericMenuButtonItem, { onClick: muteAudio, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"no-audio\" }), t('Mute audio')] })), hasScreenShareAudio && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(GenericMenuButtonItem, { onClick: muteScreenShareAudio, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"no-audio\" }), t('Mute screen share audio')] }))] }), participantViewElement && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GenericMenuButtonItem, { onClick: toggleFullscreenMode, children: t('{{ direction }} fullscreen', {\n                    direction: fullscreenModeOn ? t('Leave') : t('Enter'),\n                }) })), videoElement && document.pictureInPictureEnabled && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GenericMenuButtonItem, { onClick: togglePictureInPicture, children: t('{{ direction }} picture-in-picture', {\n                    direction: pictureInPictureElement === videoElement\n                        ? t('Leave')\n                        : t('Enter'),\n                }) })), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.Restricted, { requiredGrants: [_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.UPDATE_CALL_PERMISSIONS], children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GenericMenuButtonItem, { onClick: grantPermission(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SEND_AUDIO), children: t('Allow audio') }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GenericMenuButtonItem, { onClick: grantPermission(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SEND_VIDEO), children: t('Allow video') }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GenericMenuButtonItem, { onClick: grantPermission(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SCREENSHARE), children: t('Allow screen sharing') }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GenericMenuButtonItem, { onClick: revokePermission(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SEND_AUDIO), children: t('Disable audio') }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GenericMenuButtonItem, { onClick: revokePermission(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SEND_VIDEO), children: t('Disable video') }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(GenericMenuButtonItem, { onClick: revokePermission(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.OwnCapability.SCREENSHARE), children: t('Disable screen sharing') })] })] }));\n};\n\nconst useTrackElementVisibility = ({ trackedElement, dynascaleManager: propsDynascaleManager, sessionId, trackType, }) => {\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const manager = propsDynascaleManager ?? call?.dynascaleManager;\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!trackedElement || !manager || !call || trackType === 'none')\n            return;\n        const unobserve = manager.trackElementVisibility(trackedElement, sessionId, trackType);\n        return () => {\n            unobserve();\n        };\n    }, [trackedElement, manager, call, sessionId, trackType]);\n};\n\nconst ToggleButton = (0,react__WEBPACK_IMPORTED_MODULE_3__.forwardRef)(function ToggleButton(props, ref) {\n    return (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(IconButton, { enabled: props.menuShown, icon: \"ellipsis\", ref: ref });\n});\nconst DefaultScreenShareOverlay = () => {\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const stopScreenShare = () => {\n        call?.screenShare.disable();\n    };\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__screen-share-overlay\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"screen-share-off\" }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__screen-share-overlay__title\", children: t('You are presenting your screen') }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"button\", { onClick: stopScreenShare, className: \"str-video__screen-share-overlay__button\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Icon, { icon: \"close\" }), \" \", t('Stop Screen Sharing')] })] }));\n};\nconst DefaultParticipantViewUI = ({ indicatorsVisible = true, menuPlacement = 'bottom-start', showMenuButton = true, ParticipantActionsContextMenu: ParticipantActionsContextMenu$1 = ParticipantActionsContextMenu, }) => {\n    const { participant, trackType } = useParticipantViewContext();\n    const { publishedTracks } = participant;\n    const hasScreenShare = publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.SCREEN_SHARE);\n    if (participant.isLocalParticipant &&\n        hasScreenShare &&\n        trackType === 'screenShareTrack') {\n        return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DefaultScreenShareOverlay, {}), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantDetails, { indicatorsVisible: indicatorsVisible })] }));\n    }\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [showMenuButton && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(MenuToggle, { strategy: \"fixed\", placement: menuPlacement, ToggleButton: ToggleButton, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantActionsContextMenu$1, {}) })), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Reaction, { participant: participant }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantDetails, { indicatorsVisible: indicatorsVisible })] }));\n};\nconst ParticipantDetails = ({ indicatorsVisible = true, }) => {\n    const { participant } = useParticipantViewContext();\n    const { isLocalParticipant, connectionQuality, publishedTracks, pin, sessionId, name, userId, } = participant;\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    const connectionQualityAsString = !!connectionQuality &&\n        _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.ConnectionQuality[connectionQuality].toLowerCase();\n    const hasAudio = publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.AUDIO);\n    const hasVideo = publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.VIDEO);\n    const canUnpin = !!pin && pin.isLocalPin;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__participant-details\", children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"span\", { className: \"str-video__participant-details__name\", children: [name || userId, indicatorsVisible && !hasAudio && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__participant-details__name--audio-muted\" })), indicatorsVisible && !hasVideo && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__participant-details__name--video-muted\" })), indicatorsVisible && canUnpin && (\n                        // TODO: remove this monstrosity once we have a proper design\n                        (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { title: t('Unpin'), onClick: () => call?.unpin(sessionId), className: \"str-video__participant-details__name--pinned\" })), indicatorsVisible && (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(SpeechIndicator, {})] }) }), indicatorsVisible && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Notification, { isVisible: isLocalParticipant &&\n                    connectionQuality === _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.ConnectionQuality.POOR, message: t('Poor connection quality'), children: connectionQualityAsString && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__participant-details__connection-quality', `str-video__participant-details__connection-quality--${connectionQualityAsString}`), title: connectionQualityAsString })) }))] }));\n};\nconst SpeechIndicator = () => {\n    const { participant } = useParticipantViewContext();\n    const { isSpeaking, isDominantSpeaker } = participant;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"span\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__speech-indicator', isSpeaking && 'str-video__speech-indicator--speaking', isDominantSpeaker && 'str-video__speech-indicator--dominant'), children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__speech-indicator__bar\" }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__speech-indicator__bar\" }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__speech-indicator__bar\" })] }));\n};\n\nconst ParticipantView = (0,react__WEBPACK_IMPORTED_MODULE_3__.forwardRef)(function ParticipantView({ participant, trackType = 'videoTrack', muteAudio, refs: { setVideoElement, setVideoPlaceholderElement } = {}, className, VideoPlaceholder, ParticipantViewUI = DefaultParticipantViewUI, }, ref) {\n    const { isLocalParticipant, isSpeaking, isDominantSpeaker, publishedTracks, sessionId, } = participant;\n    const hasAudio = publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.AUDIO);\n    const hasVideo = publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.VIDEO);\n    const hasScreenShareAudio = publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.SCREEN_SHARE_AUDIO);\n    const [trackedElement, setTrackedElement] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    const [contextVideoElement, setContextVideoElement] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    const [contextVideoPlaceholderElement, setContextVideoPlaceholderElement] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    // TODO: allow to pass custom ViewportTracker instance from props\n    useTrackElementVisibility({\n        sessionId,\n        trackedElement,\n        trackType,\n    });\n    const participantViewContextValue = (0,react__WEBPACK_IMPORTED_MODULE_3__.useMemo)(() => ({\n        participant,\n        participantViewElement: trackedElement,\n        videoElement: contextVideoElement,\n        videoPlaceholderElement: contextVideoPlaceholderElement,\n        trackType,\n    }), [\n        contextVideoElement,\n        contextVideoPlaceholderElement,\n        participant,\n        trackedElement,\n        trackType,\n    ]);\n    const videoRefs = (0,react__WEBPACK_IMPORTED_MODULE_3__.useMemo)(() => ({\n        setVideoElement: (element) => {\n            setVideoElement?.(element);\n            setContextVideoElement(element);\n        },\n        setVideoPlaceholderElement: (element) => {\n            setVideoPlaceholderElement?.(element);\n            setContextVideoPlaceholderElement(element);\n        },\n    }), [setVideoElement, setVideoPlaceholderElement]);\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { \"data-testid\": \"participant-view\", ref: (element) => {\n            applyElementToRef(ref, element);\n            setTrackedElement(element);\n        }, className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__participant-view', isDominantSpeaker && 'str-video__participant-view--dominant-speaker', isSpeaking && 'str-video__participant-view--speaking', !hasVideo && 'str-video__participant-view--no-video', !hasAudio && 'str-video__participant-view--no-audio', className), children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(ParticipantViewContext.Provider, { value: participantViewContextValue, children: [!isLocalParticipant && !muteAudio && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [hasAudio && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Audio, { participant: participant, trackType: \"audioTrack\" })), hasScreenShareAudio && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Audio, { participant: participant, trackType: \"screenShareAudioTrack\" }))] })), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(Video$1, { VideoPlaceholder: VideoPlaceholder, participant: participant, trackType: trackType, refs: videoRefs, autoPlay: true }), isComponentType(ParticipantViewUI) ? ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantViewUI, {})) : (ParticipantViewUI)] }) }));\n});\n\n// re-exporting the StreamCallProvider as StreamCall\nconst StreamCall = _stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.StreamCallProvider;\n\nvar Joining = \"Joining\";\nvar Mic = \"Mic\";\nvar Ringing = \"Ringing\";\nvar Speakers = \"Speakers\";\nvar Video = \"Video\";\nvar Live = \"Live\";\nvar Reactions = \"Reactions\";\nvar Statistics = \"Statistics\";\nvar Invite = \"Invite\";\nvar Join = \"Join\";\nvar You = \"You\";\nvar Me = \"Me\";\nvar Unknown = \"Unknown\";\nvar Refresh = \"Refresh\";\nvar Allow = \"Allow\";\nvar Revoke = \"Revoke\";\nvar Dismiss = \"Dismiss\";\nvar Pinned = \"Pinned\";\nvar Unpin = \"Unpin\";\nvar Pin = \"Pin\";\nvar Block = \"Block\";\nvar Enter = \"Enter\";\nvar Leave = \"Leave\";\nvar Participants = \"Participants\";\nvar Anonymous = \", and ({{ count }}) anonymous\";\nvar en = {\n\tJoining: Joining,\n\tMic: Mic,\n\t\"No internet connection\": \"No internet connection\",\n\t\"Re-connecting\": \"Re-connecting\",\n\tRinging: Ringing,\n\t\"Screen Share\": \"Screen Share\",\n\t\"Select a Camera\": \"Select a Camera\",\n\t\"Select a Mic\": \"Select a Mic\",\n\t\"Select Speakers\": \"Select Speakers\",\n\tSpeakers: Speakers,\n\tVideo: Video,\n\t\"You are muted. Unmute to speak.\": \"You are muted. Unmute to speak.\",\n\tLive: Live,\n\t\"You can now speak.\": \"You can now speak.\",\n\t\"Awaiting for an approval to speak.\": \"Awaiting for an approval to speak.\",\n\t\"You can no longer speak.\": \"You can no longer speak.\",\n\t\"You can now share your video.\": \"You can now share your video.\",\n\t\"Awaiting for an approval to share your video.\": \"Awaiting for an approval to share your video.\",\n\t\"You can no longer share your video.\": \"You can no longer share your video.\",\n\t\"Waiting for recording to stop...\": \"Waiting for recording to stop...\",\n\t\"Waiting for recording to start...\": \"Waiting for recording to start...\",\n\t\"Record call\": \"Record call\",\n\tReactions: Reactions,\n\tStatistics: Statistics,\n\t\"You can now share your screen.\": \"You can now share your screen.\",\n\t\"Awaiting for an approval to share screen.\": \"Awaiting for an approval to share screen.\",\n\t\"You can no longer share your screen.\": \"You can no longer share your screen.\",\n\t\"Share screen\": \"Share screen\",\n\t\"Incoming Call...\": \"Incoming Call...\",\n\t\"Calling...\": \"Calling...\",\n\t\"Mute All\": \"Mute All\",\n\tInvite: Invite,\n\tJoin: Join,\n\tYou: You,\n\tMe: Me,\n\tUnknown: Unknown,\n\t\"Toggle device menu\": \"Toggle device menu\",\n\t\"Call Recordings\": \"Call Recordings\",\n\tRefresh: Refresh,\n\t\"Check your browser video permissions\": \"Check your browser video permissions\",\n\t\"Video publishing is disabled by the system\": \"Video publishing is disabled by the system\",\n\t\"You have no permission to share your video\": \"You have no permission to share your video\",\n\t\"You have no permission to share your audio\": \"You have no permission to share your audio\",\n\t\"You are presenting your screen\": \"You are presenting your screen\",\n\t\"Stop Screen Sharing\": \"Stop Screen Sharing\",\n\tAllow: Allow,\n\tRevoke: Revoke,\n\tDismiss: Dismiss,\n\t\"Microphone on\": \"Microphone on\",\n\t\"Microphone off\": \"Microphone off\",\n\t\"Camera on\": \"Camera on\",\n\t\"Camera off\": \"Camera off\",\n\t\"No camera found\": \"No camera found\",\n\t\"Video is disabled\": \"Video is disabled\",\n\tPinned: Pinned,\n\tUnpin: Unpin,\n\tPin: Pin,\n\t\"Pin for everyone\": \"Pin for everyone\",\n\t\"Unpin for everyone\": \"Unpin for everyone\",\n\tBlock: Block,\n\t\"Turn off video\": \"Turn off video\",\n\t\"Turn off screen share\": \"Turn off screen share\",\n\t\"Mute audio\": \"Mute audio\",\n\t\"Mute screen share audio\": \"Mute screen share audio\",\n\t\"Allow audio\": \"Allow audio\",\n\t\"Allow video\": \"Allow video\",\n\t\"Allow screen sharing\": \"Allow screen sharing\",\n\t\"Disable audio\": \"Disable audio\",\n\t\"Disable video\": \"Disable video\",\n\t\"Disable screen sharing\": \"Disable screen sharing\",\n\tEnter: Enter,\n\tLeave: Leave,\n\t\"Leave call\": \"Leave call\",\n\t\"End call for all\": \"End call for all\",\n\t\"{{ direction }} fullscreen\": \"{{ direction }} fullscreen\",\n\t\"{{ direction }} picture-in-picture\": \"{{ direction }} picture-in-picture\",\n\t\"Dominant Speaker\": \"Dominant Speaker\",\n\t\"Poor connection quality\": \"Poor connection quality. Please check your internet connection.\",\n\tParticipants: Participants,\n\tAnonymous: Anonymous,\n\t\"No participants found\": \"No participants found\",\n\t\"Participants ({{ numberOfParticipants }})\": \"Participants ({{ numberOfParticipants }})\",\n\t\"{{ userName }} is sharing their screen\": \"{{ userName }} is sharing their screen\",\n\t\"{{ userName }} is requesting to speak\": \"{{ userName }} is requesting to speak\",\n\t\"{{ userName }} is requesting to share their camera\": \"{{ userName }} is requesting to share their camera\",\n\t\"{{ userName }} is requesting to present their screen\": \"{{ userName }} is requesting to present their screen\",\n\t\"{{ userName }} is requesting permission: {{ permission }}\": \"{{ userName }} is requesting permission: {{ permission }}\"\n};\n\nconst translations = { en };\n\nconst StreamVideo = (props) => {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.StreamVideoProvider, { translationsOverrides: translations, ...props }));\n};\n\nconst usePaginatedLayoutSortPreset = (call) => {\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!call)\n            return;\n        call.setSortParticipantsBy(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.paginatedLayoutSortPreset);\n        return () => {\n            resetSortPreset(call);\n        };\n    }, [call]);\n};\nconst useSpeakerLayoutSortPreset = (call, isOneOnOneCall) => {\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!call)\n            return;\n        // always show the remote participant in the spotlight\n        if (isOneOnOneCall) {\n            call.setSortParticipantsBy((0,_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.combineComparators)(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.screenSharing, loggedIn));\n        }\n        else {\n            call.setSortParticipantsBy(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.speakerLayoutSortPreset);\n        }\n        return () => {\n            resetSortPreset(call);\n        };\n    }, [call, isOneOnOneCall]);\n};\nconst resetSortPreset = (call) => {\n    // reset the sorting to the default for the call type\n    const callConfig = _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.CallTypes.get(call.type);\n    call.setSortParticipantsBy(callConfig.options.sortParticipantsBy || _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.defaultSortPreset);\n};\nconst loggedIn = (a, b) => {\n    if (a.isLocalParticipant)\n        return 1;\n    if (b.isLocalParticipant)\n        return -1;\n    return 0;\n};\n\nconst LivestreamLayout = (props) => {\n    const { useParticipants, useRemoteParticipants, useHasOngoingScreenShare } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const [currentSpeaker, ...otherParticipants] = useParticipants();\n    const remoteParticipants = useRemoteParticipants();\n    const hasOngoingScreenShare = useHasOngoingScreenShare();\n    const presenter = hasOngoingScreenShare\n        ? hasScreenShare$1(currentSpeaker) && currentSpeaker\n        : otherParticipants.find(hasScreenShare$1);\n    usePaginatedLayoutSortPreset(call);\n    const Overlay = ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantOverlay, { showParticipantCount: props.showParticipantCount, showDuration: props.showDuration, showLiveBadge: props.showLiveBadge, showSpeakerName: props.showSpeakerName }));\n    const { floatingParticipantProps } = props;\n    const FloatingParticipantOverlay = hasOngoingScreenShare && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantOverlay\n    // these elements aren't needed for the video feed\n    , { \n        // these elements aren't needed for the video feed\n        showParticipantCount: floatingParticipantProps?.showParticipantCount ?? false, showDuration: floatingParticipantProps?.showDuration ?? false, showLiveBadge: floatingParticipantProps?.showLiveBadge ?? false, showSpeakerName: floatingParticipantProps?.showSpeakerName ?? true }));\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__livestream-layout__wrapper\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantsAudio, { participants: remoteParticipants }), hasOngoingScreenShare && presenter && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantView, { className: \"str-video__livestream-layout__screen-share\", participant: presenter, ParticipantViewUI: Overlay, trackType: \"screenShareTrack\", muteAudio // audio is rendered by ParticipantsAudio\n                : true })), currentSpeaker && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantView, { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])(hasOngoingScreenShare &&\n                    (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__livestream-layout__floating-participant', `str-video__livestream-layout__floating-participant--${floatingParticipantProps?.position ?? 'top-right'}`)), participant: currentSpeaker, ParticipantViewUI: FloatingParticipantOverlay || Overlay, muteAudio // audio is rendered by ParticipantsAudio\n                : true }))] }));\n};\nconst hasScreenShare$1 = (p) => !!p?.publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.SCREEN_SHARE);\nconst ParticipantOverlay = (props) => {\n    const { enableFullScreen = true, showParticipantCount = true, showDuration = true, showLiveBadge = true, showSpeakerName = false, } = props;\n    const { participant } = useParticipantViewContext();\n    const { useParticipantCount } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const participantCount = useParticipantCount();\n    const duration = useUpdateCallDuration();\n    const toggleFullScreen = useToggleFullScreen();\n    const { t } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useI18n)();\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__livestream-layout__overlay\", children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__livestream-layout__overlay__bar\", children: [showLiveBadge && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__livestream-layout__live-badge\", children: t('Live') })), showParticipantCount && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__livestream-layout__viewers-count\", children: participantCount })), showSpeakerName && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__livestream-layout__speaker-name\", title: participant.name || participant.userId || '', children: participant.name || participant.userId || '' })), showDuration && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__livestream-layout__duration\", children: formatDuration(duration) })), enableFullScreen && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"span\", { className: \"str-video__livestream-layout__go-fullscreen\", onClick: toggleFullScreen }))] }) }));\n};\nconst useUpdateCallDuration = () => {\n    const { useIsCallLive, useCallSession } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const isCallLive = useIsCallLive();\n    const session = useCallSession();\n    const [duration, setDuration] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(() => {\n        if (!session || !session.live_started_at)\n            return 0;\n        const liveStartTime = new Date(session.live_started_at);\n        const now = new Date();\n        return Math.floor((now.getTime() - liveStartTime.getTime()) / 1000);\n    });\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!isCallLive)\n            return;\n        const interval = setInterval(() => {\n            setDuration((d) => d + 1);\n        }, 1000);\n        return () => {\n            clearInterval(interval);\n        };\n    }, [isCallLive]);\n    return duration;\n};\nconst useToggleFullScreen = () => {\n    const { participantViewElement } = useParticipantViewContext();\n    const [isFullscreen, setIsFullscreen] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(false);\n    return (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)(() => {\n        if (isFullscreen) {\n            document.exitFullscreen().then(() => {\n                setIsFullscreen(false);\n            });\n        }\n        else {\n            participantViewElement?.requestFullscreen().then(() => {\n                setIsFullscreen(true);\n            });\n        }\n    }, [isFullscreen, participantViewElement]);\n};\nconst formatDuration = (durationInMs) => {\n    const days = Math.floor(durationInMs / 86400);\n    const hours = Math.floor(durationInMs / 3600);\n    const minutes = Math.floor((durationInMs % 3600) / 60);\n    const seconds = durationInMs % 60;\n    return `${days ? days + ' ' : ''}${hours ? hours + ':' : ''}${minutes < 10 ? '0' : ''}${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;\n};\n\nconst GROUP_SIZE = 16;\nconst PaginatedGridLayoutGroup = ({ group, VideoPlaceholder, ParticipantViewUI, }) => {\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__paginated-grid-layout__group', {\n            'str-video__paginated-grid-layout--one': group.length === 1,\n            'str-video__paginated-grid-layout--two-four': group.length >= 2 && group.length <= 4,\n            'str-video__paginated-grid-layout--five-nine': group.length >= 5 && group.length <= 9,\n        }), children: group.map((participant) => ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantView, { participant: participant, muteAudio: true, VideoPlaceholder: VideoPlaceholder, ParticipantViewUI: ParticipantViewUI }, participant.sessionId))) }));\n};\nconst PaginatedGridLayout = ({ groupSize = GROUP_SIZE, excludeLocalParticipant = false, pageArrowsVisible = true, VideoPlaceholder, ParticipantViewUI = DefaultParticipantViewUI, }) => {\n    const [page, setPage] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(0);\n    const [paginatedGridLayoutWrapperElement, setPaginatedGridLayoutWrapperElement,] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const { useParticipants, useRemoteParticipants } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const participants = useParticipants();\n    // used to render audio elements\n    const remoteParticipants = useRemoteParticipants();\n    usePaginatedLayoutSortPreset(call);\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!paginatedGridLayoutWrapperElement || !call)\n            return;\n        const cleanup = call.setViewport(paginatedGridLayoutWrapperElement);\n        return () => cleanup();\n    }, [paginatedGridLayoutWrapperElement, call]);\n    // only used to render video elements\n    const participantGroups = (0,react__WEBPACK_IMPORTED_MODULE_3__.useMemo)(() => chunk(excludeLocalParticipant ? remoteParticipants : participants, groupSize), [excludeLocalParticipant, remoteParticipants, participants, groupSize]);\n    const pageCount = participantGroups.length;\n    // update page when page count is reduced and selected page no longer exists\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (page > pageCount - 1) {\n            setPage(Math.max(0, pageCount - 1));\n        }\n    }, [page, pageCount]);\n    const selectedGroup = participantGroups[page];\n    if (!call)\n        return null;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__paginated-grid-layout__wrapper\", ref: setPaginatedGridLayoutWrapperElement, children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantsAudio, { participants: remoteParticipants }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__paginated-grid-layout\", children: [pageArrowsVisible && pageCount > 1 && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(IconButton, { icon: \"caret-left\", disabled: page === 0, onClick: () => setPage((currentPage) => Math.max(0, currentPage - 1)) })), selectedGroup && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(PaginatedGridLayoutGroup, { group: participantGroups[page], VideoPlaceholder: VideoPlaceholder, ParticipantViewUI: ParticipantViewUI })), pageArrowsVisible && pageCount > 1 && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(IconButton, { disabled: page === pageCount - 1, icon: \"caret-right\", onClick: () => setPage((currentPage) => Math.min(pageCount - 1, currentPage + 1)) }))] })] }));\n};\n\nconst useCalculateHardLimit = (\n/**\n * Element that stretches to 100% of the whole layout component\n */\nwrapperElement, \n/**\n * Element that directly hosts individual `ParticipantView` (or wrapper) elements\n */\nhostElement, limit) => {\n    const [calculatedLimit, setCalculatedLimit] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)({\n        vertical: typeof limit === 'number' ? limit : null,\n        horizontal: typeof limit === 'number' ? limit : null,\n    });\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!hostElement ||\n            !wrapperElement ||\n            typeof limit === 'number' ||\n            typeof limit === 'undefined')\n            return;\n        let childWidth = null;\n        let childHeight = null;\n        const resizeObserver = new ResizeObserver((entries, observer) => {\n            // this part should ideally run as little times as possible\n            // get child measurements and disconnect\n            // does not consider dynamically sized children\n            // this hook is for SpeakerLayout use only, where children in the bar are fixed size\n            if (entries.length > 1) {\n                const child = hostElement.firstChild;\n                if (child) {\n                    childHeight = child.clientHeight;\n                    childWidth = child.clientWidth;\n                    observer.unobserve(hostElement);\n                }\n            }\n            // keep the state at { vertical: 1, horizontal: 1 }\n            // until we get the proper child measurements\n            if (childHeight === null || childWidth === null)\n                return;\n            const vertical = Math.floor(wrapperElement.clientHeight / childHeight);\n            const horizontal = Math.floor(wrapperElement.clientWidth / childWidth);\n            setCalculatedLimit((pv) => {\n                if (pv.vertical !== vertical || pv.horizontal !== horizontal)\n                    return { vertical, horizontal };\n                return pv;\n            });\n        });\n        resizeObserver.observe(wrapperElement);\n        resizeObserver.observe(hostElement);\n        return () => {\n            resizeObserver.disconnect();\n        };\n    }, [hostElement, limit, wrapperElement]);\n    return calculatedLimit;\n};\n\nconst DefaultParticipantViewUIBar = () => ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DefaultParticipantViewUI, { menuPlacement: \"top-end\" }));\nconst DefaultParticipantViewUISpotlight = () => (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(DefaultParticipantViewUI, {});\nconst SpeakerLayout = ({ ParticipantViewUIBar = DefaultParticipantViewUIBar, ParticipantViewUISpotlight = DefaultParticipantViewUISpotlight, VideoPlaceholder, participantsBarPosition = 'bottom', participantsBarLimit, }) => {\n    const call = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCall)();\n    const { useParticipants, useRemoteParticipants } = (0,_stream_io_video_react_bindings__WEBPACK_IMPORTED_MODULE_1__.useCallStateHooks)();\n    const [participantInSpotlight, ...otherParticipants] = useParticipants();\n    const remoteParticipants = useRemoteParticipants();\n    const [participantsBarWrapperElement, setParticipantsBarWrapperElement] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    const [participantsBarElement, setParticipantsBarElement] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    const [buttonsWrapperElement, setButtonsWrapperElement] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)(null);\n    const isSpeakerScreenSharing = hasScreenShare(participantInSpotlight);\n    const hardLimit = useCalculateHardLimit(buttonsWrapperElement, participantsBarElement, participantsBarLimit);\n    const isVertical = participantsBarPosition === 'left' || participantsBarPosition === 'right';\n    const isHorizontal = participantsBarPosition === 'top' || participantsBarPosition === 'bottom';\n    (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n        if (!participantsBarWrapperElement || !call)\n            return;\n        const cleanup = call.setViewport(participantsBarWrapperElement);\n        return () => cleanup();\n    }, [participantsBarWrapperElement, call]);\n    const isOneOnOneCall = otherParticipants.length === 1;\n    useSpeakerLayoutSortPreset(call, isOneOnOneCall);\n    let participantsWithAppliedLimit = otherParticipants;\n    const hardLimitToApply = isVertical\n        ? hardLimit.vertical\n        : hardLimit.horizontal;\n    if (typeof participantsBarLimit !== 'undefined' &&\n        hardLimitToApply !== null) {\n        participantsWithAppliedLimit = otherParticipants.slice(0, \n        // subtract 1 if speaker is sharing screen as\n        // that one is rendered independently from otherParticipants array\n        hardLimitToApply - (isSpeakerScreenSharing ? 1 : 0));\n    }\n    if (!call)\n        return null;\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: \"str-video__speaker-layout__wrapper\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantsAudio, { participants: remoteParticipants }), (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { className: (0,clsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"])('str-video__speaker-layout', participantsBarPosition &&\n                    `str-video__speaker-layout--variant-${participantsBarPosition}`), children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__speaker-layout__spotlight\", children: participantInSpotlight && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantView, { participant: participantInSpotlight, muteAudio: true, trackType: isSpeakerScreenSharing ? 'screenShareTrack' : 'videoTrack', ParticipantViewUI: ParticipantViewUISpotlight, VideoPlaceholder: VideoPlaceholder })) }), participantsWithAppliedLimit.length > 0 && participantsBarPosition && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { ref: setButtonsWrapperElement, className: \"str-video__speaker-layout__participants-bar-buttons-wrapper\", children: [(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__speaker-layout__participants-bar-wrapper\", ref: setParticipantsBarWrapperElement, children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(\"div\", { ref: setParticipantsBarElement, className: \"str-video__speaker-layout__participants-bar\", children: [isSpeakerScreenSharing && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__speaker-layout__participant-tile\", children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantView, { participant: participantInSpotlight, ParticipantViewUI: ParticipantViewUIBar, VideoPlaceholder: VideoPlaceholder, muteAudio: true }) }, participantInSpotlight.sessionId)), participantsWithAppliedLimit.map((participant) => ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(\"div\", { className: \"str-video__speaker-layout__participant-tile\", children: (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(ParticipantView, { participant: participant, ParticipantViewUI: ParticipantViewUIBar, VideoPlaceholder: VideoPlaceholder, muteAudio: true }) }, participant.sessionId)))] }) }), isVertical && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(VerticalScrollButtons, { scrollWrapper: participantsBarWrapperElement })), isHorizontal && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(HorizontalScrollButtons, { scrollWrapper: participantsBarWrapperElement }))] }))] })] }));\n};\nconst HorizontalScrollButtons = ({ scrollWrapper, }) => {\n    const scrollPosition = useHorizontalScrollPosition(scrollWrapper);\n    const scrollStartClickHandler = () => {\n        scrollWrapper?.scrollBy({ left: -150, behavior: 'smooth' });\n    };\n    const scrollEndClickHandler = () => {\n        scrollWrapper?.scrollBy({ left: 150, behavior: 'smooth' });\n    };\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [scrollPosition && scrollPosition !== 'start' && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(IconButton, { onClick: scrollStartClickHandler, icon: \"caret-left\", className: \"str-video__speaker-layout__participants-bar--button-left\" })), scrollPosition && scrollPosition !== 'end' && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(IconButton, { onClick: scrollEndClickHandler, icon: \"caret-right\", className: \"str-video__speaker-layout__participants-bar--button-right\" }))] }));\n};\nconst VerticalScrollButtons = ({ scrollWrapper, }) => {\n    const scrollPosition = useVerticalScrollPosition(scrollWrapper);\n    const scrollTopClickHandler = () => {\n        scrollWrapper?.scrollBy({ top: -150, behavior: 'smooth' });\n    };\n    const scrollBottomClickHandler = () => {\n        scrollWrapper?.scrollBy({ top: 150, behavior: 'smooth' });\n    };\n    return ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.Fragment, { children: [scrollPosition && scrollPosition !== 'top' && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(IconButton, { onClick: scrollTopClickHandler, icon: \"caret-up\", className: \"str-video__speaker-layout__participants-bar--button-top\" })), scrollPosition && scrollPosition !== 'bottom' && ((0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(IconButton, { onClick: scrollBottomClickHandler, icon: \"caret-down\", className: \"str-video__speaker-layout__participants-bar--button-bottom\" }))] }));\n};\nconst hasScreenShare = (p) => !!p?.publishedTracks.includes(_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.TrackType.SCREEN_SHARE);\n\nconst [major, minor, patch] = (\"0.5.12\" ).split('.');\n(0,_stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.setSdkInfo)({\n    type: _stream_io_video_client__WEBPACK_IMPORTED_MODULE_0__.SfuModels.SdkType.REACT,\n    major,\n    minor,\n    patch,\n});\n\n\n//# sourceMappingURL=index.es.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvLnBucG0vQHN0cmVhbS1pbyt2aWRlby1yZWFjdC1zZGtAMC41LjEyX3JlYWN0LWRvbUAxOC4zLjFfcmVhY3RAMTguMy4xX19yZWFjdEAxOC4zLjEvbm9kZV9tb2R1bGVzL0BzdHJlYW0taW8vdmlkZW8tcmVhY3Qtc2RrL2Rpc3QvaW5kZXguZXMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFtUDtBQUMzTTtBQUNxSDtBQUM3RztBQUNRO0FBQ2tIO0FBQ2xKO0FBQ3VFO0FBQ3NLO0FBQzdLO0FBQ2pEOztBQUV2QyxpQkFBaUIsZ0RBQWdEO0FBQ2pFLGlCQUFpQix3RUFBTztBQUN4Qiw0Q0FBNEMsK0NBQVE7QUFDcEQsWUFBWSxvQkFBb0I7QUFDaEMsSUFBSSxnREFBUztBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZLHNEQUFHLFlBQVksbUlBQW1JO0FBQzlKOztBQUVBO0FBQ0EsWUFBWSwyQkFBMkI7QUFDdkMsWUFBWSxzREFBRyxDQUFDLHVEQUFRLElBQUk7QUFDNUI7QUFDQTtBQUNBLG9CQUFvQixtRUFBbUU7QUFDdkYsc0RBQXNELDhEQUFTO0FBQy9ELGtFQUFrRSxzREFBRyxVQUFVLGtFQUFrRTtBQUNqSixpRUFBaUUsOERBQVM7QUFDMUU7QUFDQSwyQ0FBMkMsc0RBQUcsVUFBVSw2RUFBNkU7QUFDckksb0JBQW9CLHVEQUFJLENBQUMsMkNBQVUsSUFBSSw2REFBNkQ7QUFDcEcsU0FBUyxHQUFHO0FBQ1o7O0FBRUEsK0JBQStC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LHNEQUFHLGVBQWUsZ0lBQWdJLEtBQUs7QUFDOWE7QUFDQSw0REFBNEQsOERBQVM7O0FBRXJFO0FBQ0EsbUVBQVU7QUFDVixVQUFVLDhEQUFTO0FBQ25CO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRTR1RDtBQUM3dUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly95b29tLy4vbm9kZV9tb2R1bGVzLy5wbnBtL0BzdHJlYW0taW8rdmlkZW8tcmVhY3Qtc2RrQDAuNS4xMl9yZWFjdC1kb21AMTguMy4xX3JlYWN0QDE4LjMuMV9fcmVhY3RAMTguMy4xL25vZGVfbW9kdWxlcy9Ac3RyZWFtLWlvL3ZpZGVvLXJlYWN0LXNkay9kaXN0L2luZGV4LmVzLmpzPzY0ZWIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2Z1TW9kZWxzLCBDYWxsaW5nU3RhdGUsIE93bkNhcGFiaWxpdHksIG5hbWUsIFZpc2liaWxpdHlTdGF0ZSwgQnJvd3NlcnMsIHBhZ2luYXRlZExheW91dFNvcnRQcmVzZXQsIGNvbWJpbmVDb21wYXJhdG9ycywgc2NyZWVuU2hhcmluZywgc3BlYWtlckxheW91dFNvcnRQcmVzZXQsIENhbGxUeXBlcywgZGVmYXVsdFNvcnRQcmVzZXQsIHNldFNka0luZm8gfSBmcm9tICdAc3RyZWFtLWlvL3ZpZGVvLWNsaWVudCc7XG5leHBvcnQgKiBmcm9tICdAc3RyZWFtLWlvL3ZpZGVvLWNsaWVudCc7XG5pbXBvcnQgeyB1c2VDYWxsLCB1c2VDYWxsU3RhdGVIb29rcywgdXNlSTE4biwgUmVzdHJpY3RlZCwgdXNlQ29ubmVjdGVkVXNlciwgU3RyZWFtQ2FsbFByb3ZpZGVyLCBTdHJlYW1WaWRlb1Byb3ZpZGVyIH0gZnJvbSAnQHN0cmVhbS1pby92aWRlby1yZWFjdC1iaW5kaW5ncyc7XG5leHBvcnQgKiBmcm9tICdAc3RyZWFtLWlvL3ZpZGVvLXJlYWN0LWJpbmRpbmdzJztcbmltcG9ydCB7IGpzeCwgRnJhZ21lbnQsIGpzeHMgfSBmcm9tICdyZWFjdC9qc3gtcnVudGltZSc7XG5pbXBvcnQgeyB1c2VTdGF0ZSwgdXNlRWZmZWN0LCBGcmFnbWVudCBhcyBGcmFnbWVudCQxLCBjcmVhdGVDb250ZXh0LCB1c2VDb250ZXh0LCB1c2VDYWxsYmFjaywgdXNlUmVmLCB1c2VNZW1vLCBmb3J3YXJkUmVmLCBpc1ZhbGlkRWxlbWVudCwgdXNlTGF5b3V0RWZmZWN0IH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IGNsc3ggZnJvbSAnY2xzeCc7XG5pbXBvcnQgeyBpc1BsYXRmb3JtU3VwcG9ydGVkLCBsb2FkVEZMaXRlLCBjcmVhdGVSZW5kZXJlciB9IGZyb20gJ0BzdHJlYW0taW8vdmlkZW8tZmlsdGVycy13ZWInO1xuaW1wb3J0IHsgdXNlRmxvYXRpbmcsIG9mZnNldCwgc2hpZnQsIGZsaXAsIHNpemUsIGF1dG9VcGRhdGUsIEZsb2F0aW5nT3ZlcmxheSwgRmxvYXRpbmdQb3J0YWwsIHVzZUxpc3RJdGVtLCB1c2VMaXN0TmF2aWdhdGlvbiwgdXNlVHlwZWFoZWFkLCB1c2VDbGljaywgdXNlRGlzbWlzcywgdXNlUm9sZSwgdXNlSW50ZXJhY3Rpb25zLCBGbG9hdGluZ0ZvY3VzTWFuYWdlciwgRmxvYXRpbmdMaXN0LCB1c2VIb3ZlciB9IGZyb20gJ0BmbG9hdGluZy11aS9yZWFjdCc7XG5pbXBvcnQgeyBDaGFydCwgQ2F0ZWdvcnlTY2FsZSwgTGluZWFyU2NhbGUsIExpbmVFbGVtZW50LCBQb2ludEVsZW1lbnQgfSBmcm9tICdjaGFydC5qcyc7XG5pbXBvcnQgeyBMaW5lIH0gZnJvbSAncmVhY3QtY2hhcnRqcy0yJztcblxuY29uc3QgQXVkaW8gPSAoeyBwYXJ0aWNpcGFudCwgdHJhY2tUeXBlID0gJ2F1ZGlvVHJhY2snLCAuLi5yZXN0IH0pID0+IHtcbiAgICBjb25zdCBjYWxsID0gdXNlQ2FsbCgpO1xuICAgIGNvbnN0IFthdWRpb0VsZW1lbnQsIHNldEF1ZGlvRWxlbWVudF0gPSB1c2VTdGF0ZShudWxsKTtcbiAgICBjb25zdCB7IHVzZXJJZCwgc2Vzc2lvbklkIH0gPSBwYXJ0aWNpcGFudDtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoIWNhbGwgfHwgIWF1ZGlvRWxlbWVudClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgY2xlYW51cCA9IGNhbGwuYmluZEF1ZGlvRWxlbWVudChhdWRpb0VsZW1lbnQsIHNlc3Npb25JZCwgdHJhY2tUeXBlKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIGNsZWFudXA/LigpO1xuICAgICAgICB9O1xuICAgIH0sIFtjYWxsLCBzZXNzaW9uSWQsIGF1ZGlvRWxlbWVudCwgdHJhY2tUeXBlXSk7XG4gICAgcmV0dXJuIChqc3goXCJhdWRpb1wiLCB7IGF1dG9QbGF5OiB0cnVlLCAuLi5yZXN0LCByZWY6IHNldEF1ZGlvRWxlbWVudCwgXCJkYXRhLXVzZXItaWRcIjogdXNlcklkLCBcImRhdGEtc2Vzc2lvbi1pZFwiOiBzZXNzaW9uSWQsIFwiZGF0YS10cmFjay10eXBlXCI6IHRyYWNrVHlwZSB9KSk7XG59O1xuXG5jb25zdCBQYXJ0aWNpcGFudHNBdWRpbyA9IChwcm9wcykgPT4ge1xuICAgIGNvbnN0IHsgcGFydGljaXBhbnRzLCBhdWRpb1Byb3BzIH0gPSBwcm9wcztcbiAgICByZXR1cm4gKGpzeChGcmFnbWVudCwgeyBjaGlsZHJlbjogcGFydGljaXBhbnRzLm1hcCgocGFydGljaXBhbnQpID0+IHtcbiAgICAgICAgICAgIGlmIChwYXJ0aWNpcGFudC5pc0xvY2FsUGFydGljaXBhbnQpXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICBjb25zdCB7IHB1Ymxpc2hlZFRyYWNrcywgYXVkaW9TdHJlYW0sIHNjcmVlblNoYXJlQXVkaW9TdHJlYW0sIHNlc3Npb25JZCwgfSA9IHBhcnRpY2lwYW50O1xuICAgICAgICAgICAgY29uc3QgaGFzQXVkaW8gPSBwdWJsaXNoZWRUcmFja3MuaW5jbHVkZXMoU2Z1TW9kZWxzLlRyYWNrVHlwZS5BVURJTyk7XG4gICAgICAgICAgICBjb25zdCBhdWRpb1RyYWNrRWxlbWVudCA9IGhhc0F1ZGlvICYmIGF1ZGlvU3RyZWFtICYmIChqc3goQXVkaW8sIHsgLi4uYXVkaW9Qcm9wcywgdHJhY2tUeXBlOiBcImF1ZGlvVHJhY2tcIiwgcGFydGljaXBhbnQ6IHBhcnRpY2lwYW50IH0pKTtcbiAgICAgICAgICAgIGNvbnN0IGhhc1NjcmVlblNoYXJlQXVkaW8gPSBwdWJsaXNoZWRUcmFja3MuaW5jbHVkZXMoU2Z1TW9kZWxzLlRyYWNrVHlwZS5TQ1JFRU5fU0hBUkVfQVVESU8pO1xuICAgICAgICAgICAgY29uc3Qgc2NyZWVuU2hhcmVBdWRpb1RyYWNrRWxlbWVudCA9IGhhc1NjcmVlblNoYXJlQXVkaW8gJiZcbiAgICAgICAgICAgICAgICBzY3JlZW5TaGFyZUF1ZGlvU3RyZWFtICYmIChqc3goQXVkaW8sIHsgLi4uYXVkaW9Qcm9wcywgdHJhY2tUeXBlOiBcInNjcmVlblNoYXJlQXVkaW9UcmFja1wiLCBwYXJ0aWNpcGFudDogcGFydGljaXBhbnQgfSkpO1xuICAgICAgICAgICAgcmV0dXJuIChqc3hzKEZyYWdtZW50JDEsIHsgY2hpbGRyZW46IFthdWRpb1RyYWNrRWxlbWVudCwgc2NyZWVuU2hhcmVBdWRpb1RyYWNrRWxlbWVudF0gfSwgc2Vzc2lvbklkKSk7XG4gICAgICAgIH0pIH0pKTtcbn07XG5cbmNvbnN0IFBhcnRpY2lwYW50Vmlld0NvbnRleHQgPSBjcmVhdGVDb250ZXh0KHVuZGVmaW5lZCk7XG5jb25zdCB1c2VQYXJ0aWNpcGFudFZpZXdDb250ZXh0ID0gKCkgPT4gdXNlQ29udGV4dChQYXJ0aWNpcGFudFZpZXdDb250ZXh0KTtcblxuY29uc3QgQXZhdGFyID0gKHsgaW1hZ2VTcmMsIG5hbWUsIHN0eWxlLCBjbGFzc05hbWUsIC4uLnJlc3QgfSkgPT4ge1xuICAgIGNvbnN0IFtlcnJvciwgc2V0RXJyb3JdID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIHJldHVybiAoanN4cyhGcmFnbWVudCwgeyBjaGlsZHJlbjogWyghaW1hZ2VTcmMgfHwgZXJyb3IpICYmIG5hbWUgJiYgKGpzeChBdmF0YXJGYWxsYmFjaywgeyBjbGFzc05hbWU6IGNsYXNzTmFtZSwgc3R5bGU6IHN0eWxlLCBuYW1lczogW25hbWVdIH0pKSwgaW1hZ2VTcmMgJiYgIWVycm9yICYmIChqc3goXCJpbWdcIiwgeyBvbkVycm9yOiAoKSA9PiBzZXRFcnJvcih0cnVlKSwgYWx0OiBcImF2YXRhclwiLCBjbGFzc05hbWU6IGNsc3goJ3N0ci12aWRlb19fYXZhdGFyJywgY2xhc3NOYW1lKSwgc3JjOiBpbWFnZVNyYywgc3R5bGU6IHN0eWxlLCAuLi5yZXN0IH0pKV0gfSkpO1xufTtcbmNvbnN0IEF2YXRhckZhbGxiYWNrID0gKHsgY2xhc3NOYW1lLCBuYW1lcywgc3R5bGUsIH0pID0+IHtcbiAgICByZXR1cm4gKGpzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogY2xzeCgnc3RyLXZpZGVvX19hdmF0YXItLWluaXRpYWxzLWZhbGxiYWNrJywgY2xhc3NOYW1lKSwgc3R5bGU6IHN0eWxlLCBjaGlsZHJlbjoganN4cyhcImRpdlwiLCB7IGNoaWxkcmVuOiBbbmFtZXNbMF1bMF0sIG5hbWVzWzFdPy5bMF1dIH0pIH0pKTtcbn07XG5cbi8qKlxuICogVGhlIGNvbnRleHQgZm9yIHRoZSBiYWNrZ3JvdW5kIGZpbHRlcnMuXG4gKi9cbmNvbnN0IEJhY2tncm91bmRGaWx0ZXJzQ29udGV4dCA9IGNyZWF0ZUNvbnRleHQodW5kZWZpbmVkKTtcbi8qKlxuICogQSBob29rIHRvIGFjY2VzcyB0aGUgYmFja2dyb3VuZCBmaWx0ZXJzIGNvbnRleHQgQVBJLlxuICovXG5jb25zdCB1c2VCYWNrZ3JvdW5kRmlsdGVycyA9ICgpID0+IHtcbiAgICBjb25zdCBjb250ZXh0ID0gdXNlQ29udGV4dChCYWNrZ3JvdW5kRmlsdGVyc0NvbnRleHQpO1xuICAgIGlmICghY29udGV4dCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3VzZUJhY2tncm91bmRGaWx0ZXJzIG11c3QgYmUgdXNlZCB3aXRoaW4gYSBCYWNrZ3JvdW5kRmlsdGVyc1Byb3ZpZGVyJyk7XG4gICAgfVxuICAgIHJldHVybiBjb250ZXh0O1xufTtcbi8qKlxuICogQSBwcm92aWRlciBjb21wb25lbnQgdGhhdCBlbmFibGVzIHRoZSB1c2Ugb2YgYmFja2dyb3VuZCBmaWx0ZXJzIGluIHlvdXIgYXBwLlxuICpcbiAqIFBsZWFzZSBtYWtlIHN1cmUgeW91IGhhdmUgdGhlIGBAc3RyZWFtLWlvL3ZpZGVvLWZpbHRlcnMtd2ViYCBwYWNrYWdlIGluc3RhbGxlZFxuICogaW4geW91ciBwcm9qZWN0IGJlZm9yZSB1c2luZyB0aGlzIGNvbXBvbmVudC5cbiAqL1xuY29uc3QgQmFja2dyb3VuZEZpbHRlcnNQcm92aWRlciA9IChwcm9wcykgPT4ge1xuICAgIGNvbnN0IHsgY2hpbGRyZW4sIGlzQmx1cnJpbmdFbmFibGVkID0gdHJ1ZSwgYmFja2dyb3VuZEltYWdlcyA9IFtdLCBiYWNrZ3JvdW5kRmlsdGVyOiBiZ0ZpbHRlckZyb21Qcm9wcyA9IHVuZGVmaW5lZCwgYmFja2dyb3VuZEltYWdlOiBiZ0ltYWdlRnJvbVByb3BzID0gdW5kZWZpbmVkLCBiYWNrZ3JvdW5kQmx1ckxldmVsOiBiZ0JsdXJMZXZlbEZyb21Qcm9wcyA9ICdoaWdoJywgdGZGaWxlUGF0aCwgbW9kZWxGaWxlUGF0aCwgYmFzZVBhdGgsIH0gPSBwcm9wcztcbiAgICBjb25zdCBbYmFja2dyb3VuZEZpbHRlciwgc2V0QmFja2dyb3VuZEZpbHRlcl0gPSB1c2VTdGF0ZShiZ0ZpbHRlckZyb21Qcm9wcyk7XG4gICAgY29uc3QgW2JhY2tncm91bmRJbWFnZSwgc2V0QmFja2dyb3VuZEltYWdlXSA9IHVzZVN0YXRlKGJnSW1hZ2VGcm9tUHJvcHMpO1xuICAgIGNvbnN0IFtiYWNrZ3JvdW5kQmx1ckxldmVsLCBzZXRCYWNrZ3JvdW5kQmx1ckxldmVsXSA9IHVzZVN0YXRlKGJnQmx1ckxldmVsRnJvbVByb3BzKTtcbiAgICBjb25zdCBhcHBseUJhY2tncm91bmRJbWFnZUZpbHRlciA9IHVzZUNhbGxiYWNrKChpbWFnZVVybCkgPT4ge1xuICAgICAgICBzZXRCYWNrZ3JvdW5kRmlsdGVyKCdpbWFnZScpO1xuICAgICAgICBzZXRCYWNrZ3JvdW5kSW1hZ2UoaW1hZ2VVcmwpO1xuICAgIH0sIFtdKTtcbiAgICBjb25zdCBhcHBseUJhY2tncm91bmRCbHVyRmlsdGVyID0gdXNlQ2FsbGJhY2soKGJsdXJMZXZlbCA9ICdoaWdoJykgPT4ge1xuICAgICAgICBzZXRCYWNrZ3JvdW5kRmlsdGVyKCdibHVyJyk7XG4gICAgICAgIHNldEJhY2tncm91bmRCbHVyTGV2ZWwoYmx1ckxldmVsKTtcbiAgICB9LCBbXSk7XG4gICAgY29uc3QgZGlzYWJsZUJhY2tncm91bmRGaWx0ZXIgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICAgIHNldEJhY2tncm91bmRGaWx0ZXIodW5kZWZpbmVkKTtcbiAgICAgICAgc2V0QmFja2dyb3VuZEltYWdlKHVuZGVmaW5lZCk7XG4gICAgICAgIHNldEJhY2tncm91bmRCbHVyTGV2ZWwoJ2hpZ2gnKTtcbiAgICB9LCBbXSk7XG4gICAgY29uc3QgW2lzU3VwcG9ydGVkLCBzZXRJc1N1cHBvcnRlZF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaXNQbGF0Zm9ybVN1cHBvcnRlZCgpLnRoZW4oc2V0SXNTdXBwb3J0ZWQpO1xuICAgIH0sIFtdKTtcbiAgICBjb25zdCBbdGZMaXRlLCBzZXRUZkxpdGVdID0gdXNlU3RhdGUoKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICAvLyBkb24ndCB0cnkgdG8gbG9hZCBURkxpdGUgaWYgdGhlIHBsYXRmb3JtIGlzIG5vdCBzdXBwb3J0ZWRcbiAgICAgICAgaWYgKCFpc1N1cHBvcnRlZClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbG9hZFRGTGl0ZSh7IGJhc2VQYXRoLCBtb2RlbEZpbGVQYXRoLCB0ZkZpbGVQYXRoIH0pXG4gICAgICAgICAgICAudGhlbihzZXRUZkxpdGUpXG4gICAgICAgICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGxvYWQgVEZMaXRlJywgZXJyKSk7XG4gICAgfSwgW2Jhc2VQYXRoLCBpc1N1cHBvcnRlZCwgbW9kZWxGaWxlUGF0aCwgdGZGaWxlUGF0aF0pO1xuICAgIHJldHVybiAoanN4cyhCYWNrZ3JvdW5kRmlsdGVyc0NvbnRleHQuUHJvdmlkZXIsIHsgdmFsdWU6IHtcbiAgICAgICAgICAgIGlzU3VwcG9ydGVkLFxuICAgICAgICAgICAgaXNSZWFkeTogISF0ZkxpdGUsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kSW1hZ2UsXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQmx1ckxldmVsLFxuICAgICAgICAgICAgYmFja2dyb3VuZEZpbHRlcixcbiAgICAgICAgICAgIGRpc2FibGVCYWNrZ3JvdW5kRmlsdGVyLFxuICAgICAgICAgICAgYXBwbHlCYWNrZ3JvdW5kQmx1ckZpbHRlcixcbiAgICAgICAgICAgIGFwcGx5QmFja2dyb3VuZEltYWdlRmlsdGVyLFxuICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlcyxcbiAgICAgICAgICAgIGlzQmx1cnJpbmdFbmFibGVkLFxuICAgICAgICAgICAgdGZGaWxlUGF0aCxcbiAgICAgICAgICAgIG1vZGVsRmlsZVBhdGgsXG4gICAgICAgICAgICBiYXNlUGF0aCxcbiAgICAgICAgfSwgY2hpbGRyZW46IFtjaGlsZHJlbiwgdGZMaXRlICYmIGJhY2tncm91bmRGaWx0ZXIgJiYganN4KEJhY2tncm91bmRGaWx0ZXJzLCB7IHRmTGl0ZTogdGZMaXRlIH0pXSB9KSk7XG59O1xuY29uc3QgQmFja2dyb3VuZEZpbHRlcnMgPSAocHJvcHMpID0+IHtcbiAgICBjb25zdCB7IHRmTGl0ZSB9ID0gcHJvcHM7XG4gICAgY29uc3QgY2FsbCA9IHVzZUNhbGwoKTtcbiAgICBjb25zdCB7IGJhY2tncm91bmRJbWFnZSwgYmFja2dyb3VuZEZpbHRlciB9ID0gdXNlQmFja2dyb3VuZEZpbHRlcnMoKTtcbiAgICBjb25zdCBbdmlkZW9SZWYsIHNldFZpZGVvUmVmXSA9IHVzZVN0YXRlKG51bGwpO1xuICAgIGNvbnN0IFtiZ0ltYWdlUmVmLCBzZXRCZ0ltYWdlUmVmXSA9IHVzZVN0YXRlKG51bGwpO1xuICAgIGNvbnN0IFtjYW52YXNSZWYsIHNldENhbnZhc1JlZl0gPSB1c2VTdGF0ZShudWxsKTtcbiAgICBjb25zdCBbd2lkdGgsIHNldFdpZHRoXSA9IHVzZVN0YXRlKDE5MjApO1xuICAgIGNvbnN0IFtoZWlnaHQsIHNldEhlaWdodF0gPSB1c2VTdGF0ZSgxMDgwKTtcbiAgICBjb25zdCByZXNvbHZlRmlsdGVyUmVmID0gdXNlUmVmKCk7XG4gICAgY29uc3QgW21lZGlhU3RyZWFtLCBzZXRNZWRpYVN0cmVhbV0gPSB1c2VTdGF0ZSgpO1xuICAgIGNvbnN0IHJlZ2lzdGVyRmlsdGVyUmVmID0gdXNlUmVmKFByb21pc2UucmVzb2x2ZShhc3luYyAoKSA9PiB7IH0pKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoIWNhbGwgfHwgIWJhY2tncm91bmRGaWx0ZXIpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHJlZ2lzdGVyRmlsdGVyUmVmLmN1cnJlbnQgPSByZWdpc3RlckZpbHRlclJlZi5jdXJyZW50LnRoZW4oKCkgPT4gY2FsbC5jYW1lcmEucmVnaXN0ZXJGaWx0ZXIoYXN5bmMgKG1zKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgICAgICBzZXRNZWRpYVN0cmVhbShtcyk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZUZpbHRlclJlZi5jdXJyZW50ID0gcmVzb2x2ZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSk7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICByZWdpc3RlckZpbHRlclJlZi5jdXJyZW50XG4gICAgICAgICAgICAgICAgLnRoZW4oKHVucmVnaXN0ZXIpID0+IHVucmVnaXN0ZXIoKSlcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiBzZXRNZWRpYVN0cmVhbSh1bmRlZmluZWQpKVxuICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gdW5yZWdpc3RlciBmaWx0ZXInLCBlcnIpKTtcbiAgICAgICAgfTtcbiAgICB9LCBbYmFja2dyb3VuZEZpbHRlciwgY2FsbF0pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmICghbWVkaWFTdHJlYW0gfHwgIXZpZGVvUmVmIHx8ICFjYW52YXNSZWYpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGhhbmRsZU9uUGxheSA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IFt0cmFja10gPSBtZWRpYVN0cmVhbS5nZXRWaWRlb1RyYWNrcygpO1xuICAgICAgICAgICAgaWYgKHRyYWNrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyB3aWR0aDogdyA9IDAsIGhlaWdodDogaCA9IDAgfSA9IHRyYWNrLmdldFNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgc2V0V2lkdGgodyk7XG4gICAgICAgICAgICAgICAgc2V0SGVpZ2h0KGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzb2x2ZUZpbHRlciA9IHJlc29sdmVGaWx0ZXJSZWYuY3VycmVudDtcbiAgICAgICAgICAgIGlmICghcmVzb2x2ZUZpbHRlcilcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjb25zdCBmaWx0ZXIgPSBjYW52YXNSZWYuY2FwdHVyZVN0cmVhbSgpO1xuICAgICAgICAgICAgcmVzb2x2ZUZpbHRlcihmaWx0ZXIpO1xuICAgICAgICB9O1xuICAgICAgICB2aWRlb1JlZi5hZGRFdmVudExpc3RlbmVyKCdwbGF5JywgaGFuZGxlT25QbGF5KTtcbiAgICAgICAgdmlkZW9SZWYuc3JjT2JqZWN0ID0gbWVkaWFTdHJlYW07XG4gICAgICAgIHZpZGVvUmVmLnBsYXkoKS5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gcGxheSB2aWRlbycsIGVycikpO1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgdmlkZW9SZWYucmVtb3ZlRXZlbnRMaXN0ZW5lcigncGxheScsIGhhbmRsZU9uUGxheSk7XG4gICAgICAgICAgICB2aWRlb1JlZi5zcmNPYmplY3QgPSBudWxsO1xuICAgICAgICB9O1xuICAgIH0sIFtjYW52YXNSZWYsIG1lZGlhU3RyZWFtLCB2aWRlb1JlZl0pO1xuICAgIHJldHVybiAoanN4cyhcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2JhY2tncm91bmQtZmlsdGVyc1wiLCBzdHlsZToge1xuICAgICAgICAgICAgd2lkdGg6IGAke3dpZHRofXB4YCxcbiAgICAgICAgICAgIGhlaWdodDogYCR7aGVpZ2h0fXB4YCxcbiAgICAgICAgfSwgY2hpbGRyZW46IFttZWRpYVN0cmVhbSAmJiAoanN4KFJlbmRlclBpcGVsaW5lLCB7IHRmTGl0ZTogdGZMaXRlLCB2aWRlb1JlZjogdmlkZW9SZWYsIGNhbnZhc1JlZjogY2FudmFzUmVmLCBiYWNrZ3JvdW5kSW1hZ2VSZWY6IGJnSW1hZ2VSZWYgfSkpLCBqc3goXCJ2aWRlb1wiLCB7IGNsYXNzTmFtZTogY2xzeCgnc3RyLXZpZGVvX19iYWNrZ3JvdW5kLWZpbHRlcnNfX3ZpZGVvJywgaGVpZ2h0ID4gd2lkdGggJiYgJ3N0ci12aWRlb19fYmFja2dyb3VuZC1maWx0ZXJzX192aWRlby0tdGFsbCcpLCByZWY6IHNldFZpZGVvUmVmLCBhdXRvUGxheTogdHJ1ZSwgcGxheXNJbmxpbmU6IHRydWUsIGNvbnRyb2xzOiBmYWxzZSwgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCwgbXV0ZWQ6IHRydWUsIGxvb3A6IHRydWUgfSksIGJhY2tncm91bmRJbWFnZSAmJiAoanN4KFwiaW1nXCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fYmFja2dyb3VuZC1maWx0ZXJzX19iYWNrZ3JvdW5kLWltYWdlXCIsIGFsdDogXCJCYWNrZ3JvdW5kXCIsIHJlZjogc2V0QmdJbWFnZVJlZiwgc3JjOiBiYWNrZ3JvdW5kSW1hZ2UsIHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQgfSwgYmFja2dyb3VuZEltYWdlKSksIGpzeChcImNhbnZhc1wiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2JhY2tncm91bmQtZmlsdGVyc19fdGFyZ2V0LWNhbnZhc1wiLCB3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0LCByZWY6IHNldENhbnZhc1JlZiB9LCBga2V5LSR7d2lkdGh9JHtoZWlnaHR9YCldIH0pKTtcbn07XG5jb25zdCBSZW5kZXJQaXBlbGluZSA9IChwcm9wcykgPT4ge1xuICAgIGNvbnN0IHsgdGZMaXRlLCB2aWRlb1JlZiwgY2FudmFzUmVmLCBiYWNrZ3JvdW5kSW1hZ2VSZWYgfSA9IHByb3BzO1xuICAgIGNvbnN0IHsgYmFja2dyb3VuZEZpbHRlciwgYmFja2dyb3VuZEJsdXJMZXZlbCB9ID0gdXNlQmFja2dyb3VuZEZpbHRlcnMoKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoIXZpZGVvUmVmIHx8ICFjYW52YXNSZWYgfHwgIWJhY2tncm91bmRGaWx0ZXIpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmIChiYWNrZ3JvdW5kRmlsdGVyID09PSAnaW1hZ2UnICYmICFiYWNrZ3JvdW5kSW1hZ2VSZWYpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gY3JlYXRlUmVuZGVyZXIodGZMaXRlLCB2aWRlb1JlZiwgY2FudmFzUmVmLCB7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kRmlsdGVyLFxuICAgICAgICAgICAgYmFja2dyb3VuZEltYWdlOiBiYWNrZ3JvdW5kSW1hZ2VSZWYgPz8gdW5kZWZpbmVkLFxuICAgICAgICAgICAgYmFja2dyb3VuZEJsdXJMZXZlbCxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICByZW5kZXJlci5kaXNwb3NlKCk7XG4gICAgICAgIH07XG4gICAgfSwgW1xuICAgICAgICBiYWNrZ3JvdW5kQmx1ckxldmVsLFxuICAgICAgICBiYWNrZ3JvdW5kRmlsdGVyLFxuICAgICAgICBiYWNrZ3JvdW5kSW1hZ2VSZWYsXG4gICAgICAgIGNhbnZhc1JlZixcbiAgICAgICAgdGZMaXRlLFxuICAgICAgICB2aWRlb1JlZixcbiAgICBdKTtcbiAgICByZXR1cm4gbnVsbDtcbn07XG5cbmNvbnN0IHVzZUZsb2F0aW5nVUlQcmVzZXQgPSAoeyBwbGFjZW1lbnQsIHN0cmF0ZWd5LCBvZmZzZXQ6IG9mZnNldEluUHggPSAxMCwgfSkgPT4ge1xuICAgIGNvbnN0IHsgcmVmcywgeCwgeSwgdXBkYXRlLCBlbGVtZW50czogeyBkb21SZWZlcmVuY2UsIGZsb2F0aW5nIH0sIH0gPSB1c2VGbG9hdGluZyh7XG4gICAgICAgIHBsYWNlbWVudCxcbiAgICAgICAgc3RyYXRlZ3ksXG4gICAgICAgIG1pZGRsZXdhcmU6IFtcbiAgICAgICAgICAgIG9mZnNldChvZmZzZXRJblB4KSxcbiAgICAgICAgICAgIHNoaWZ0KCksXG4gICAgICAgICAgICBmbGlwKCksXG4gICAgICAgICAgICBzaXplKHtcbiAgICAgICAgICAgICAgICBwYWRkaW5nOiAxMCxcbiAgICAgICAgICAgICAgICBhcHBseTogKHsgYXZhaWxhYmxlSGVpZ2h0LCBlbGVtZW50cyB9KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZWxlbWVudHMuZmxvYXRpbmcuc3R5bGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1heEhlaWdodDogYCR7YXZhaWxhYmxlSGVpZ2h0fXB4YCxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICBdLFxuICAgIH0pO1xuICAgIC8vIGhhbmRsZSB3aW5kb3cgcmVzaXppbmdcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoIWRvbVJlZmVyZW5jZSB8fCAhZmxvYXRpbmcpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGNsZWFudXAgPSBhdXRvVXBkYXRlKGRvbVJlZmVyZW5jZSwgZmxvYXRpbmcsIHVwZGF0ZSk7XG4gICAgICAgIHJldHVybiAoKSA9PiBjbGVhbnVwKCk7XG4gICAgfSwgW2RvbVJlZmVyZW5jZSwgZmxvYXRpbmcsIHVwZGF0ZV0pO1xuICAgIHJldHVybiB7IHJlZnMsIHgsIHksIGRvbVJlZmVyZW5jZSwgZmxvYXRpbmcsIHN0cmF0ZWd5IH07XG59O1xuXG4vKipcbiAqIFRoaXMgaG9vayB3aWxsIHBlcnNpc3QgdGhlIGRldmljZSBzZXR0aW5ncyB0byBsb2NhbCBzdG9yYWdlLlxuICpcbiAqIEBwYXJhbSBrZXkgdGhlIGtleSB0byB1c2UgZm9yIGxvY2FsIHN0b3JhZ2UuXG4gKi9cbmNvbnN0IHVzZVBlcnNpc3REZXZpY2VQcmVmZXJlbmNlcyA9IChrZXkpID0+IHtcbiAgICBjb25zdCB7IHVzZU1pY3JvcGhvbmVTdGF0ZSwgdXNlQ2FtZXJhU3RhdGUsIHVzZVNwZWFrZXJTdGF0ZSwgdXNlQ2FsbFNldHRpbmdzLCB9ID0gdXNlQ2FsbFN0YXRlSG9va3MoKTtcbiAgICBjb25zdCBjYWxsID0gdXNlQ2FsbCgpO1xuICAgIGNvbnN0IG1pYyA9IHVzZU1pY3JvcGhvbmVTdGF0ZSgpO1xuICAgIGNvbnN0IGNhbWVyYSA9IHVzZUNhbWVyYVN0YXRlKCk7XG4gICAgY29uc3Qgc3BlYWtlciA9IHVzZVNwZWFrZXJTdGF0ZSgpO1xuICAgIGNvbnN0IHNldHRpbmdzID0gdXNlQ2FsbFNldHRpbmdzKCk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKCFjYWxsIHx8ICFzZXR0aW5ncylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKGNhbGwuc3RhdGUuY2FsbGluZ1N0YXRlID09PSBDYWxsaW5nU3RhdGUuTEVGVClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGhhc1ByZWZlcmVuY2VzID0gISF3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcbiAgICAgICAgICAgIGNvbnN0IHsgYXVkaW8sIHZpZGVvIH0gPSBzZXR0aW5ncztcbiAgICAgICAgICAgIGNvbnN0IGRlZmF1bHREZXZpY2UgPSAnZGVmYXVsdCc7XG4gICAgICAgICAgICBjb25zdCBwcmVmZXJlbmNlcyA9IHtcbiAgICAgICAgICAgICAgICBtaWM6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWREZXZpY2VJZDogbWljLnNlbGVjdGVkRGV2aWNlIHx8IGRlZmF1bHREZXZpY2UsXG4gICAgICAgICAgICAgICAgICAgIG11dGVkOiBoYXNQcmVmZXJlbmNlcyA/IG1pYy5pc011dGUgOiAhYXVkaW8ubWljX2RlZmF1bHRfb24sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjYW1lcmE6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWREZXZpY2VJZDogY2FtZXJhLnNlbGVjdGVkRGV2aWNlIHx8IGRlZmF1bHREZXZpY2UsXG4gICAgICAgICAgICAgICAgICAgIG11dGVkOiBoYXNQcmVmZXJlbmNlcyA/IGNhbWVyYS5pc011dGUgOiAhdmlkZW8uY2FtZXJhX2RlZmF1bHRfb24sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzcGVha2VyOiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkRGV2aWNlSWQ6IHNwZWFrZXIuc2VsZWN0ZWREZXZpY2UgfHwgZGVmYXVsdERldmljZSxcbiAgICAgICAgICAgICAgICAgICAgbXV0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkocHJlZmVyZW5jZXMpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBzYXZlIGRldmljZSBwcmVmZXJlbmNlcycsIGVycik7XG4gICAgICAgIH1cbiAgICB9LCBbXG4gICAgICAgIGNhbGwsXG4gICAgICAgIGNhbWVyYS5pc011dGUsXG4gICAgICAgIGNhbWVyYS5zZWxlY3RlZERldmljZSxcbiAgICAgICAga2V5LFxuICAgICAgICBtaWMuaXNNdXRlLFxuICAgICAgICBtaWMuc2VsZWN0ZWREZXZpY2UsXG4gICAgICAgIHNldHRpbmdzLFxuICAgICAgICBzcGVha2VyLnNlbGVjdGVkRGV2aWNlLFxuICAgIF0pO1xufTtcbi8qKlxuICogVGhpcyBob29rIHdpbGwgYXBwbHkgdGhlIGRldmljZSBzZXR0aW5ncyBmcm9tIGxvY2FsIHN0b3JhZ2UuXG4gKlxuICogQHBhcmFtIGtleSB0aGUga2V5IHRvIHVzZSBmb3IgbG9jYWwgc3RvcmFnZS5cbiAqL1xuY29uc3QgdXNlQXBwbHlEZXZpY2VQcmVmZXJlbmNlcyA9IChrZXkpID0+IHtcbiAgICBjb25zdCBjYWxsID0gdXNlQ2FsbCgpO1xuICAgIGNvbnN0IHsgdXNlQ2FsbFNldHRpbmdzIH0gPSB1c2VDYWxsU3RhdGVIb29rcygpO1xuICAgIGNvbnN0IHNldHRpbmdzID0gdXNlQ2FsbFNldHRpbmdzKCk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKCFjYWxsIHx8ICFzZXR0aW5ncylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgYXBwbHkgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpbml0TWljID0gYXN5bmMgKHNldHRpbmcpID0+IHtcbiAgICAgICAgICAgICAgICBhd2FpdCBjYWxsLm1pY3JvcGhvbmUuc2VsZWN0KHNldHRpbmcuc2VsZWN0ZWREZXZpY2VJZCk7XG4gICAgICAgICAgICAgICAgaWYgKHNldHRpbmcubXV0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY2FsbC5taWNyb3Bob25lLmRpc2FibGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGNhbGwubWljcm9waG9uZS5lbmFibGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgaW5pdENhbWVyYSA9IGFzeW5jIChzZXR0aW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgYXdhaXQgY2FsbC5jYW1lcmEuc2VsZWN0KHNldHRpbmcuc2VsZWN0ZWREZXZpY2VJZCk7XG4gICAgICAgICAgICAgICAgaWYgKHNldHRpbmcubXV0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY2FsbC5jYW1lcmEuZGlzYWJsZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY2FsbC5jYW1lcmEuZW5hYmxlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IGluaXRTcGVha2VyID0gKHNldHRpbmcpID0+IHtcbiAgICAgICAgICAgICAgICBjYWxsLnNwZWFrZXIuc2VsZWN0KHNldHRpbmcuc2VsZWN0ZWREZXZpY2VJZCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgbGV0IHByZWZlcmVuY2VzID0gbnVsbDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcHJlZmVyZW5jZXMgPSBKU09OLnBhcnNlKHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBsb2FkIGRldmljZSBwcmVmZXJlbmNlcycsIGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocHJlZmVyZW5jZXMpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBpbml0TWljKHByZWZlcmVuY2VzLm1pYyk7XG4gICAgICAgICAgICAgICAgYXdhaXQgaW5pdENhbWVyYShwcmVmZXJlbmNlcy5jYW1lcmEpO1xuICAgICAgICAgICAgICAgIGluaXRTcGVha2VyKHByZWZlcmVuY2VzLnNwZWFrZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBhdWRpbywgdmlkZW8gfSA9IHNldHRpbmdzO1xuICAgICAgICAgICAgICAgIGlmIChhdWRpby5taWNfZGVmYXVsdF9vbilcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY2FsbC5taWNyb3Bob25lLmVuYWJsZSgpO1xuICAgICAgICAgICAgICAgIGlmICh2aWRlby5jYW1lcmFfZGVmYXVsdF9vbilcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY2FsbC5jYW1lcmEuZW5hYmxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGFwcGx5KCkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gYXBwbHkgZGV2aWNlIHByZWZlcmVuY2VzJywgZXJyKTtcbiAgICAgICAgfSk7XG4gICAgfSwgW2NhbGwsIGtleSwgc2V0dGluZ3NdKTtcbn07XG4vKipcbiAqIFRoaXMgaG9vayB3aWxsIGFwcGx5IGFuZCBwZXJzaXN0IHRoZSBkZXZpY2UgcHJlZmVyZW5jZXMgZnJvbSBsb2NhbCBzdG9yYWdlLlxuICpcbiAqIEBwYXJhbSBrZXkgdGhlIGtleSB0byB1c2UgZm9yIGxvY2FsIHN0b3JhZ2UuXG4gKi9cbmNvbnN0IHVzZVBlcnNpc3RlZERldmljZVByZWZlcmVuY2VzID0gKGtleSA9ICdAc3RyZWFtLWlvL2RldmljZS1wcmVmZXJlbmNlcycpID0+IHtcbiAgICB1c2VBcHBseURldmljZVByZWZlcmVuY2VzKGtleSk7XG4gICAgdXNlUGVyc2lzdERldmljZVByZWZlcmVuY2VzKGtleSk7XG59O1xuXG5jb25zdCBTQ1JPTExfVEhSRVNIT0xEID0gMTA7XG4vKipcbiAqIEhvb2sgd2hpY2ggb2JzZXJ2ZXMgZWxlbWVudCdzIHNjcm9sbCBwb3NpdGlvbiBhbmQgcmV0dXJucyB0ZXh0IHZhbHVlIGJhc2VkIG9uIHRoZVxuICogcG9zaXRpb24gb2YgdGhlIHNjcm9sbGJhciAoYHRvcGAsIGBib3R0b21gLCBgYmV0d2VlbmAgYW5kIGBudWxsYCBpZiBubyBzY3JvbGxiYXIgaXMgYXZhaWxhYmxlKVxuICovXG5jb25zdCB1c2VWZXJ0aWNhbFNjcm9sbFBvc2l0aW9uID0gKHNjcm9sbEVsZW1lbnQsIHRocmVzaG9sZCA9IFNDUk9MTF9USFJFU0hPTEQpID0+IHtcbiAgICBjb25zdCBbc2Nyb2xsUG9zaXRpb24sIHNldFNjcm9sbFBvc2l0aW9uXSA9IHVzZVN0YXRlKG51bGwpO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmICghc2Nyb2xsRWxlbWVudClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3Qgc2Nyb2xsSGFuZGxlciA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBzY3JvbGxFbGVtZW50O1xuICAgICAgICAgICAgY29uc3QgaGFzVmVydGljYWxTY3JvbGxiYXIgPSBlbGVtZW50LnNjcm9sbEhlaWdodCA+IGVsZW1lbnQuY2xpZW50SGVpZ2h0O1xuICAgICAgICAgICAgaWYgKCFoYXNWZXJ0aWNhbFNjcm9sbGJhcilcbiAgICAgICAgICAgICAgICByZXR1cm4gc2V0U2Nyb2xsUG9zaXRpb24obnVsbCk7XG4gICAgICAgICAgICBjb25zdCBpc0F0VGhlVG9wID0gZWxlbWVudC5zY3JvbGxUb3AgPD0gdGhyZXNob2xkO1xuICAgICAgICAgICAgaWYgKGlzQXRUaGVUb3ApXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNldFNjcm9sbFBvc2l0aW9uKCd0b3AnKTtcbiAgICAgICAgICAgIGNvbnN0IGlzQXRUaGVCb3R0b20gPSBNYXRoLmFicyhlbGVtZW50LnNjcm9sbEhlaWdodCAtIGVsZW1lbnQuc2Nyb2xsVG9wIC0gZWxlbWVudC5jbGllbnRIZWlnaHQpIDw9IHRocmVzaG9sZDtcbiAgICAgICAgICAgIGlmIChpc0F0VGhlQm90dG9tKVxuICAgICAgICAgICAgICAgIHJldHVybiBzZXRTY3JvbGxQb3NpdGlvbignYm90dG9tJyk7XG4gICAgICAgICAgICBzZXRTY3JvbGxQb3NpdGlvbignYmV0d2VlbicpO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCByZXNpemVPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcihzY3JvbGxIYW5kbGVyKTtcbiAgICAgICAgcmVzaXplT2JzZXJ2ZXIub2JzZXJ2ZShzY3JvbGxFbGVtZW50KTtcbiAgICAgICAgc2Nyb2xsRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBzY3JvbGxIYW5kbGVyKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIHNjcm9sbEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgc2Nyb2xsSGFuZGxlcik7XG4gICAgICAgICAgICByZXNpemVPYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgICAgIH07XG4gICAgfSwgW3Njcm9sbEVsZW1lbnQsIHRocmVzaG9sZF0pO1xuICAgIHJldHVybiBzY3JvbGxQb3NpdGlvbjtcbn07XG5jb25zdCB1c2VIb3Jpem9udGFsU2Nyb2xsUG9zaXRpb24gPSAoc2Nyb2xsRWxlbWVudCwgdGhyZXNob2xkID0gU0NST0xMX1RIUkVTSE9MRCkgPT4ge1xuICAgIGNvbnN0IFtzY3JvbGxQb3NpdGlvbiwgc2V0U2Nyb2xsUG9zaXRpb25dID0gdXNlU3RhdGUobnVsbCk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKCFzY3JvbGxFbGVtZW50KVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBzY3JvbGxIYW5kbGVyID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IHNjcm9sbEVsZW1lbnQ7XG4gICAgICAgICAgICBjb25zdCBoYXNIb3Jpem9udGFsU2Nyb2xsYmFyID0gZWxlbWVudC5zY3JvbGxXaWR0aCA+IGVsZW1lbnQuY2xpZW50V2lkdGg7XG4gICAgICAgICAgICBpZiAoIWhhc0hvcml6b250YWxTY3JvbGxiYXIpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNldFNjcm9sbFBvc2l0aW9uKG51bGwpO1xuICAgICAgICAgICAgY29uc3QgaXNBdFRoZVN0YXJ0ID0gZWxlbWVudC5zY3JvbGxMZWZ0IDw9IHRocmVzaG9sZDtcbiAgICAgICAgICAgIGlmIChpc0F0VGhlU3RhcnQpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNldFNjcm9sbFBvc2l0aW9uKCdzdGFydCcpO1xuICAgICAgICAgICAgY29uc3QgaXNBdFRoZUVuZCA9IE1hdGguYWJzKGVsZW1lbnQuc2Nyb2xsV2lkdGggLSBlbGVtZW50LnNjcm9sbExlZnQgLSBlbGVtZW50LmNsaWVudFdpZHRoKSA8PSB0aHJlc2hvbGQ7XG4gICAgICAgICAgICBpZiAoaXNBdFRoZUVuZClcbiAgICAgICAgICAgICAgICByZXR1cm4gc2V0U2Nyb2xsUG9zaXRpb24oJ2VuZCcpO1xuICAgICAgICAgICAgc2V0U2Nyb2xsUG9zaXRpb24oJ2JldHdlZW4nKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcmVzaXplT2JzZXJ2ZXIgPSBuZXcgUmVzaXplT2JzZXJ2ZXIoc2Nyb2xsSGFuZGxlcik7XG4gICAgICAgIHJlc2l6ZU9ic2VydmVyLm9ic2VydmUoc2Nyb2xsRWxlbWVudCk7XG4gICAgICAgIHNjcm9sbEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgc2Nyb2xsSGFuZGxlcik7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICBzY3JvbGxFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHNjcm9sbEhhbmRsZXIpO1xuICAgICAgICAgICAgcmVzaXplT2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgICAgICB9O1xuICAgIH0sIFtzY3JvbGxFbGVtZW50LCB0aHJlc2hvbGRdKTtcbiAgICByZXR1cm4gc2Nyb2xsUG9zaXRpb247XG59O1xuXG5jb25zdCB1c2VUb2dnbGVDYWxsUmVjb3JkaW5nID0gKCkgPT4ge1xuICAgIGNvbnN0IGNhbGwgPSB1c2VDYWxsKCk7XG4gICAgY29uc3QgeyB1c2VJc0NhbGxSZWNvcmRpbmdJblByb2dyZXNzIH0gPSB1c2VDYWxsU3RhdGVIb29rcygpO1xuICAgIGNvbnN0IGlzQ2FsbFJlY29yZGluZ0luUHJvZ3Jlc3MgPSB1c2VJc0NhbGxSZWNvcmRpbmdJblByb2dyZXNzKCk7XG4gICAgY29uc3QgW2lzQXdhaXRpbmdSZXNwb25zZSwgc2V0SXNBd2FpdGluZ1Jlc3BvbnNlXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICAvLyBUT0RPOiBhZGQgcGVybWlzc2lvbnNcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICAvLyB3ZSB3YWl0IHVudGlsIGNhbGwucmVjb3JkaW5nX3N0YXJ0ZWQvc3RvcHBlZCBldmVudCB0byBmbGlwcyB0aGVcbiAgICAgICAgLy8gYGlzQ2FsbFJlY29yZGluZ0luUHJvZ3Jlc3NgIHN0YXRlIHZhcmlhYmxlLlxuICAgICAgICAvLyBPbmNlIHRoZSBmbGlwIGhhcHBlbnMsIHdlIHJlbW92ZSB0aGUgbG9hZGluZyBpbmRpY2F0b3JcbiAgICAgICAgc2V0SXNBd2FpdGluZ1Jlc3BvbnNlKChpc0F3YWl0aW5nKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNBd2FpdGluZylcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICByZXR1cm4gaXNBd2FpdGluZztcbiAgICAgICAgfSk7XG4gICAgfSwgW2lzQ2FsbFJlY29yZGluZ0luUHJvZ3Jlc3NdKTtcbiAgICBjb25zdCB0b2dnbGVDYWxsUmVjb3JkaW5nID0gdXNlQ2FsbGJhY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgc2V0SXNBd2FpdGluZ1Jlc3BvbnNlKHRydWUpO1xuICAgICAgICAgICAgaWYgKGlzQ2FsbFJlY29yZGluZ0luUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBjYWxsPy5zdG9wUmVjb3JkaW5nKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBjYWxsPy5zdGFydFJlY29yZGluZygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgc3RhcnQgcmVjb3JkaW5nYCwgZSk7XG4gICAgICAgIH1cbiAgICB9LCBbY2FsbCwgaXNDYWxsUmVjb3JkaW5nSW5Qcm9ncmVzc10pO1xuICAgIHJldHVybiB7IHRvZ2dsZUNhbGxSZWNvcmRpbmcsIGlzQXdhaXRpbmdSZXNwb25zZSwgaXNDYWxsUmVjb3JkaW5nSW5Qcm9ncmVzcyB9O1xufTtcblxuY29uc3QgdXNlUmVxdWVzdFBlcm1pc3Npb24gPSAocGVybWlzc2lvbikgPT4ge1xuICAgIGNvbnN0IGNhbGwgPSB1c2VDYWxsKCk7XG4gICAgY29uc3QgeyB1c2VIYXNQZXJtaXNzaW9ucyB9ID0gdXNlQ2FsbFN0YXRlSG9va3MoKTtcbiAgICBjb25zdCBoYXNQZXJtaXNzaW9uID0gdXNlSGFzUGVybWlzc2lvbnMocGVybWlzc2lvbik7XG4gICAgY29uc3QgW2lzQXdhaXRpbmdQZXJtaXNzaW9uLCBzZXRJc0F3YWl0aW5nUGVybWlzc2lvbl0gPSB1c2VTdGF0ZShmYWxzZSk7IC8vIFRPRE86IGxvYWQgd2l0aCBwb3NzaWJseSBwZW5kaW5nIHN0YXRlXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzZXQgPSAoKSA9PiBzZXRJc0F3YWl0aW5nUGVybWlzc2lvbihmYWxzZSk7XG4gICAgICAgIGlmIChoYXNQZXJtaXNzaW9uKVxuICAgICAgICAgICAgcmVzZXQoKTtcbiAgICB9LCBbaGFzUGVybWlzc2lvbl0pO1xuICAgIGNvbnN0IHJlcXVlc3RQZXJtaXNzaW9uID0gdXNlQ2FsbGJhY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAoaGFzUGVybWlzc2lvbilcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICBjb25zdCBjYW5SZXF1ZXN0UGVybWlzc2lvbiA9ICEhY2FsbD8ucGVybWlzc2lvbnNDb250ZXh0LmNhblJlcXVlc3QocGVybWlzc2lvbik7XG4gICAgICAgIGlmIChpc0F3YWl0aW5nUGVybWlzc2lvbiB8fCAhY2FuUmVxdWVzdFBlcm1pc3Npb24pXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIHNldElzQXdhaXRpbmdQZXJtaXNzaW9uKHRydWUpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgY2FsbD8ucmVxdWVzdFBlcm1pc3Npb25zKHtcbiAgICAgICAgICAgICAgICBwZXJtaXNzaW9uczogW3Blcm1pc3Npb25dLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBzZXRJc0F3YWl0aW5nUGVybWlzc2lvbihmYWxzZSk7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYHJlcXVlc3RQZXJtaXNzaW9uIGZhaWxlZDogJHtlcnJvcn1gKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSwgW2NhbGwsIGhhc1Blcm1pc3Npb24sIGlzQXdhaXRpbmdQZXJtaXNzaW9uLCBwZXJtaXNzaW9uXSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVxdWVzdFBlcm1pc3Npb24sXG4gICAgICAgIGhhc1Blcm1pc3Npb24sXG4gICAgICAgIGNhblJlcXVlc3RQZXJtaXNzaW9uOiAhIWNhbGw/LnBlcm1pc3Npb25zQ29udGV4dC5jYW5SZXF1ZXN0KHBlcm1pc3Npb24pLFxuICAgICAgICBpc0F3YWl0aW5nUGVybWlzc2lvbixcbiAgICB9O1xufTtcblxudmFyIE1lbnVWaXN1YWxUeXBlO1xuKGZ1bmN0aW9uIChNZW51VmlzdWFsVHlwZSkge1xuICAgIE1lbnVWaXN1YWxUeXBlW1wiUE9SVEFMXCJdID0gXCJwb3J0YWxcIjtcbiAgICBNZW51VmlzdWFsVHlwZVtcIk1FTlVcIl0gPSBcIm1lbnVcIjtcbn0pKE1lbnVWaXN1YWxUeXBlIHx8IChNZW51VmlzdWFsVHlwZSA9IHt9KSk7XG4vKipcbiAqIFVzZWQgdG8gcHJvdmlkZSB1dGlsaXR5IEFQSXMgdG8gdGhlIGNvbXBvbmVudHMgcmVuZGVyZWQgaW5zaWRlIHRoZSBwb3J0YWwuXG4gKi9cbmNvbnN0IE1lbnVDb250ZXh0ID0gY3JlYXRlQ29udGV4dCh7fSk7XG4vKipcbiAqIEFjY2VzcyB0byB0aGUgY2xvc2VzIE1lbnVDb250ZXh0LlxuICovXG5jb25zdCB1c2VNZW51Q29udGV4dCA9ICgpID0+IHtcbiAgICByZXR1cm4gdXNlQ29udGV4dChNZW51Q29udGV4dCk7XG59O1xuY29uc3QgTWVudVBvcnRhbCA9ICh7IGNoaWxkcmVuLCByZWZzLCB9KSA9PiB7XG4gICAgY29uc3QgcG9ydGFsSWQgPSB1c2VNZW1vKCgpID0+IGBzdHItdmlkZW8tcG9ydGFsLSR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDkpfWAsIFtdKTtcbiAgICByZXR1cm4gKGpzeHMoRnJhZ21lbnQsIHsgY2hpbGRyZW46IFtqc3goXCJkaXZcIiwgeyBpZDogcG9ydGFsSWQsIGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3BvcnRhbFwiIH0pLCBqc3goRmxvYXRpbmdPdmVybGF5LCB7IGNoaWxkcmVuOiBqc3goRmxvYXRpbmdQb3J0YWwsIHsgaWQ6IHBvcnRhbElkLCBjaGlsZHJlbjoganN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fcG9ydGFsLWNvbnRlbnRcIiwgcmVmOiByZWZzLnNldEZsb2F0aW5nLCBjaGlsZHJlbjogY2hpbGRyZW4gfSkgfSkgfSldIH0pKTtcbn07XG5jb25zdCBNZW51VG9nZ2xlID0gKHsgVG9nZ2xlQnV0dG9uLCBwbGFjZW1lbnQgPSAndG9wLXN0YXJ0Jywgc3RyYXRlZ3kgPSAnYWJzb2x1dGUnLCBvZmZzZXQsIHZpc3VhbFR5cGUgPSBNZW51VmlzdWFsVHlwZS5NRU5VLCBjaGlsZHJlbiwgfSkgPT4ge1xuICAgIGNvbnN0IFttZW51U2hvd24sIHNldE1lbnVTaG93bl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgeyBmbG9hdGluZywgZG9tUmVmZXJlbmNlLCByZWZzLCB4LCB5IH0gPSB1c2VGbG9hdGluZ1VJUHJlc2V0KHtcbiAgICAgICAgcGxhY2VtZW50LFxuICAgICAgICBzdHJhdGVneSxcbiAgICAgICAgb2Zmc2V0LFxuICAgIH0pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGNvbnN0IGhhbmRsZUNsaWNrID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBpZiAoIWZsb2F0aW5nICYmIGRvbVJlZmVyZW5jZT8uY29udGFpbnMoZXZlbnQudGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgIHNldE1lbnVTaG93bih0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZsb2F0aW5nICYmICFmbG9hdGluZz8uY29udGFpbnMoZXZlbnQudGFyZ2V0KSkge1xuICAgICAgICAgICAgICAgIHNldE1lbnVTaG93bihmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGhhbmRsZUtleURvd24gPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGlmIChldmVudC5rZXkudG9Mb3dlckNhc2UoKSA9PT0gJ2VzY2FwZScgJiZcbiAgICAgICAgICAgICAgICAhZXZlbnQuYWx0S2V5ICYmXG4gICAgICAgICAgICAgICAgIWV2ZW50LmN0cmxLZXkpIHtcbiAgICAgICAgICAgICAgICBzZXRNZW51U2hvd24oZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBkb2N1bWVudD8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVDbGljaywgeyBjYXB0dXJlOiB0cnVlIH0pO1xuICAgICAgICBkb2N1bWVudD8uYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGhhbmRsZUtleURvd24pO1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgZG9jdW1lbnQ/LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQ2xpY2ssIHsgY2FwdHVyZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIGRvY3VtZW50Py5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgaGFuZGxlS2V5RG93bik7XG4gICAgICAgIH07XG4gICAgfSwgW2Zsb2F0aW5nLCBkb21SZWZlcmVuY2VdKTtcbiAgICByZXR1cm4gKGpzeHMoRnJhZ21lbnQsIHsgY2hpbGRyZW46IFttZW51U2hvd24gJiYgKGpzeChNZW51Q29udGV4dC5Qcm92aWRlciwgeyB2YWx1ZTogeyBjbG9zZTogKCkgPT4gc2V0TWVudVNob3duKGZhbHNlKSB9LCBjaGlsZHJlbjogdmlzdWFsVHlwZSA9PT0gTWVudVZpc3VhbFR5cGUuUE9SVEFMID8gKGpzeChNZW51UG9ydGFsLCB7IHJlZnM6IHJlZnMsIGNoaWxkcmVuOiBjaGlsZHJlbiB9KSkgOiB2aXN1YWxUeXBlID09PSBNZW51VmlzdWFsVHlwZS5NRU5VID8gKGpzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX21lbnUtY29udGFpbmVyXCIsIHJlZjogcmVmcy5zZXRGbG9hdGluZywgc3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBzdHJhdGVneSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogeSA/PyAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogeCA/PyAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3dZOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgICAgIH0sIGNoaWxkcmVuOiBjaGlsZHJlbiB9KSkgOiBudWxsIH0pKSwganN4KFRvZ2dsZUJ1dHRvbiwgeyBtZW51U2hvd246IG1lbnVTaG93biwgcmVmOiByZWZzLnNldFJlZmVyZW5jZSB9KV0gfSkpO1xufTtcblxuY29uc3QgR2VuZXJpY01lbnUgPSAoeyBjaGlsZHJlbiwgb25JdGVtQ2xpY2ssIH0pID0+IHtcbiAgICBjb25zdCByZWYgPSB1c2VSZWYobnVsbCk7XG4gICAgcmV0dXJuIChqc3goXCJ1bFwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2dlbmVyaWMtbWVudVwiLCByZWY6IHJlZiwgb25DbGljazogKGUpID0+IHtcbiAgICAgICAgICAgIGlmIChvbkl0ZW1DbGljayAmJlxuICAgICAgICAgICAgICAgIGUudGFyZ2V0ICE9PSByZWYuY3VycmVudCAmJlxuICAgICAgICAgICAgICAgIHJlZi5jdXJyZW50Py5jb250YWlucyhlLnRhcmdldCkpIHtcbiAgICAgICAgICAgICAgICBvbkl0ZW1DbGljayhlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgY2hpbGRyZW46IGNoaWxkcmVuIH0pKTtcbn07XG5jb25zdCBHZW5lcmljTWVudUJ1dHRvbkl0ZW0gPSAoeyBjaGlsZHJlbiwgLi4ucmVzdCB9KSA9PiB7XG4gICAgcmV0dXJuIChqc3goXCJsaVwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2dlbmVyaWMtbWVudS0taXRlbVwiLCBjaGlsZHJlbjoganN4KFwiYnV0dG9uXCIsIHsgLi4ucmVzdCwgY2hpbGRyZW46IGNoaWxkcmVuIH0pIH0pKTtcbn07XG5cbmNvbnN0IEljb24gPSAoeyBjbGFzc05hbWUsIGljb24gfSkgPT4gKGpzeChcInNwYW5cIiwgeyBjbGFzc05hbWU6IGNsc3goJ3N0ci12aWRlb19faWNvbicsIGljb24gJiYgYHN0ci12aWRlb19faWNvbi0tJHtpY29ufWAsIGNsYXNzTmFtZSkgfSkpO1xuXG5jb25zdCBJY29uQnV0dG9uID0gZm9yd2FyZFJlZihmdW5jdGlvbiBJY29uQnV0dG9uKHByb3BzLCByZWYpIHtcbiAgICBjb25zdCB7IGljb24sIGVuYWJsZWQsIHZhcmlhbnQsIG9uQ2xpY2ssIGNsYXNzTmFtZSwgLi4ucmVzdCB9ID0gcHJvcHM7XG4gICAgcmV0dXJuIChqc3goXCJidXR0b25cIiwgeyBjbGFzc05hbWU6IGNsc3goJ3N0ci12aWRlb19fY2FsbC1jb250cm9sc19fYnV0dG9uJywgY2xhc3NOYW1lLCB7XG4gICAgICAgICAgICBbYHN0ci12aWRlb19fY2FsbC1jb250cm9sc19fYnV0dG9uLS12YXJpYW50LSR7dmFyaWFudH1gXTogdmFyaWFudCxcbiAgICAgICAgICAgICdzdHItdmlkZW9fX2NhbGwtY29udHJvbHNfX2J1dHRvbi0tZW5hYmxlZCc6IGVuYWJsZWQsXG4gICAgICAgIH0pLCBvbkNsaWNrOiAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgb25DbGljaz8uKGUpO1xuICAgICAgICB9LCByZWY6IHJlZiwgLi4ucmVzdCwgY2hpbGRyZW46IGpzeChJY29uLCB7IGljb246IGljb24gfSkgfSkpO1xufSk7XG5cbmNvbnN0IGlzQ29tcG9uZW50VHlwZSA9IChlbGVtZW50T3JDb21wb25lbnQpID0+IHtcbiAgICByZXR1cm4gZWxlbWVudE9yQ29tcG9uZW50ID09PSBudWxsXG4gICAgICAgID8gZmFsc2VcbiAgICAgICAgOiAhaXNWYWxpZEVsZW1lbnQoZWxlbWVudE9yQ29tcG9uZW50KTtcbn07XG5cbmNvbnN0IGNodW5rID0gKGFycmF5LCBzaXplKSA9PiB7XG4gICAgY29uc3QgY2h1bmtDb3VudCA9IE1hdGguY2VpbChhcnJheS5sZW5ndGggLyBzaXplKTtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogY2h1bmtDb3VudCB9LCAoXywgaW5kZXgpID0+IGFycmF5LnNsaWNlKHNpemUgKiBpbmRleCwgc2l6ZSAqIGluZGV4ICsgc2l6ZSkpO1xufTtcblxuY29uc3QgYXBwbHlFbGVtZW50VG9SZWYgPSAocmVmLCBlbGVtZW50KSA9PiB7XG4gICAgaWYgKCFyZWYpXG4gICAgICAgIHJldHVybjtcbiAgICBpZiAodHlwZW9mIHJlZiA9PT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgcmV0dXJuIHJlZihlbGVtZW50KTtcbiAgICByZWYuY3VycmVudCA9IGVsZW1lbnQ7XG59O1xuXG5jb25zdCBDb21wb3NpdGVCdXR0b24gPSBmb3J3YXJkUmVmKGZ1bmN0aW9uIENvbXBvc2l0ZUJ1dHRvbih7IGNhcHRpb24sIGNoaWxkcmVuLCBjbGFzc05hbWUsIGFjdGl2ZSwgTWVudSwgbWVudVBsYWNlbWVudCwgbWVudU9mZnNldCwgdGl0bGUsIFRvZ2dsZU1lbnVCdXR0b24gPSBEZWZhdWx0VG9nZ2xlTWVudUJ1dHRvbiwgdmFyaWFudCwgb25DbGljaywgLi4ucmVzdEJ1dHRvblByb3BzIH0sIHJlZikge1xuICAgIHJldHVybiAoanN4cyhcImRpdlwiLCB7IGNsYXNzTmFtZTogY2xzeCgnc3RyLXZpZGVvX19jb21wb3NpdGUtYnV0dG9uJywgY2xhc3NOYW1lLCB7XG4gICAgICAgICAgICAnc3RyLXZpZGVvX19jb21wb3NpdGUtYnV0dG9uLS1jYXB0aW9uJzogY2FwdGlvbixcbiAgICAgICAgICAgICdzdHItdmlkZW9fX2NvbXBvc2l0ZS1idXR0b24tLW1lbnUnOiBNZW51LFxuICAgICAgICB9KSwgdGl0bGU6IHRpdGxlLCByZWY6IHJlZiwgY2hpbGRyZW46IFtqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBjbHN4KCdzdHItdmlkZW9fX2NvbXBvc2l0ZS1idXR0b25fX2J1dHRvbi1ncm91cCcsIHtcbiAgICAgICAgICAgICAgICAgICAgJ3N0ci12aWRlb19fY29tcG9zaXRlLWJ1dHRvbl9fYnV0dG9uLWdyb3VwLS1hY3RpdmUnOiBhY3RpdmUsXG4gICAgICAgICAgICAgICAgICAgICdzdHItdmlkZW9fX2NvbXBvc2l0ZS1idXR0b25fX2J1dHRvbi1ncm91cC0tYWN0aXZlLXByaW1hcnknOiBhY3RpdmUgJiYgdmFyaWFudCA9PT0gJ3ByaW1hcnknLFxuICAgICAgICAgICAgICAgICAgICAnc3RyLXZpZGVvX19jb21wb3NpdGUtYnV0dG9uX19idXR0b24tZ3JvdXAtLWFjdGl2ZS1zZWNvbmRhcnknOiBhY3RpdmUgJiYgdmFyaWFudCA9PT0gJ3NlY29uZGFyeScsXG4gICAgICAgICAgICAgICAgfSksIGNoaWxkcmVuOiBbanN4KFwiYnV0dG9uXCIsIHsgdHlwZTogXCJidXR0b25cIiwgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY29tcG9zaXRlLWJ1dHRvbl9fYnV0dG9uXCIsIG9uQ2xpY2s6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s/LihlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIC4uLnJlc3RCdXR0b25Qcm9wcywgY2hpbGRyZW46IGNoaWxkcmVuIH0pLCBNZW51ICYmIChqc3goTWVudVRvZ2dsZSwgeyBvZmZzZXQ6IG1lbnVPZmZzZXQsIHBsYWNlbWVudDogbWVudVBsYWNlbWVudCwgVG9nZ2xlQnV0dG9uOiBUb2dnbGVNZW51QnV0dG9uLCBjaGlsZHJlbjogaXNDb21wb25lbnRUeXBlKE1lbnUpID8ganN4KE1lbnUsIHt9KSA6IE1lbnUgfSkpXSB9KSwgY2FwdGlvbiAmJiAoanN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY29tcG9zaXRlLWJ1dHRvbl9fY2FwdGlvblwiLCBjaGlsZHJlbjogY2FwdGlvbiB9KSldIH0pKTtcbn0pO1xuY29uc3QgRGVmYXVsdFRvZ2dsZU1lbnVCdXR0b24gPSBmb3J3YXJkUmVmKGZ1bmN0aW9uIERlZmF1bHRUb2dnbGVNZW51QnV0dG9uKHsgbWVudVNob3duIH0sIHJlZikge1xuICAgIHJldHVybiAoanN4KEljb25CdXR0b24sIHsgY2xhc3NOYW1lOiBjbHN4KCdzdHItdmlkZW9fX21lbnUtdG9nZ2xlLWJ1dHRvbicsIHtcbiAgICAgICAgICAgICdzdHItdmlkZW9fX21lbnUtdG9nZ2xlLWJ1dHRvbi0tYWN0aXZlJzogbWVudVNob3duLFxuICAgICAgICB9KSwgaWNvbjogbWVudVNob3duID8gJ2NhcmV0LWRvd24nIDogJ2NhcmV0LXVwJywgcmVmOiByZWYgfSkpO1xufSk7XG5cbmNvbnN0IFRleHRCdXR0b24gPSAoeyBjaGlsZHJlbiwgLi4ucmVzdCB9KSA9PiB7XG4gICAgcmV0dXJuIChqc3goXCJidXR0b25cIiwgeyAuLi5yZXN0LCBjbGFzc05hbWU6IFwic3RyLXZpZGVvX190ZXh0LWJ1dHRvblwiLCBjaGlsZHJlbjogY2hpbGRyZW4gfSkpO1xufTtcblxuY29uc3QgQWNjZXB0Q2FsbEJ1dHRvbiA9ICh7IGRpc2FibGVkLCBvbkFjY2VwdCwgb25DbGljaywgfSkgPT4ge1xuICAgIGNvbnN0IGNhbGwgPSB1c2VDYWxsKCk7XG4gICAgY29uc3QgaGFuZGxlQ2xpY2sgPSB1c2VDYWxsYmFjayhhc3luYyAoZSkgPT4ge1xuICAgICAgICBpZiAob25DbGljaykge1xuICAgICAgICAgICAgb25DbGljayhlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjYWxsKSB7XG4gICAgICAgICAgICBhd2FpdCBjYWxsLmpvaW4oKTtcbiAgICAgICAgICAgIG9uQWNjZXB0Py4oKTtcbiAgICAgICAgfVxuICAgIH0sIFtvbkNsaWNrLCBvbkFjY2VwdCwgY2FsbF0pO1xuICAgIHJldHVybiAoanN4KEljb25CdXR0b24sIHsgZGlzYWJsZWQ6IGRpc2FibGVkLCBpY29uOiBcImNhbGwtYWNjZXB0XCIsIHZhcmlhbnQ6IFwic3VjY2Vzc1wiLCBcImRhdGEtdGVzdGlkXCI6IFwiYWNjZXB0LWNhbGwtYnV0dG9uXCIsIG9uQ2xpY2s6IGhhbmRsZUNsaWNrIH0pKTtcbn07XG5cbmNvbnN0IE5vdGlmaWNhdGlvbiA9IChwcm9wcykgPT4ge1xuICAgIGNvbnN0IHsgaXNWaXNpYmxlLCBtZXNzYWdlLCBjaGlsZHJlbiwgdmlzaWJpbGl0eVRpbWVvdXQsIHJlc2V0SXNWaXNpYmxlLCBwbGFjZW1lbnQgPSAndG9wJywgaWNvbkNsYXNzTmFtZSA9ICdzdHItdmlkZW9fX25vdGlmaWNhdGlvbl9faWNvbicsIGNsb3NlLCB9ID0gcHJvcHM7XG4gICAgY29uc3QgeyByZWZzLCB4LCB5LCBzdHJhdGVneSB9ID0gdXNlRmxvYXRpbmdVSVByZXNldCh7XG4gICAgICAgIHBsYWNlbWVudCxcbiAgICAgICAgc3RyYXRlZ3k6ICdhYnNvbHV0ZScsXG4gICAgfSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKCFpc1Zpc2libGUgfHwgIXZpc2liaWxpdHlUaW1lb3V0IHx8ICFyZXNldElzVmlzaWJsZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgcmVzZXRJc1Zpc2libGUoKTtcbiAgICAgICAgfSwgdmlzaWJpbGl0eVRpbWVvdXQpO1xuICAgICAgICByZXR1cm4gKCkgPT4gY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgIH0sIFtpc1Zpc2libGUsIHJlc2V0SXNWaXNpYmxlLCB2aXNpYmlsaXR5VGltZW91dF0pO1xuICAgIHJldHVybiAoanN4cyhcImRpdlwiLCB7IHJlZjogcmVmcy5zZXRSZWZlcmVuY2UsIGNoaWxkcmVuOiBbaXNWaXNpYmxlICYmIChqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fbm90aWZpY2F0aW9uXCIsIHJlZjogcmVmcy5zZXRGbG9hdGluZywgc3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHN0cmF0ZWd5LFxuICAgICAgICAgICAgICAgICAgICB0b3A6IHkgPz8gMCxcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogeCA/PyAwLFxuICAgICAgICAgICAgICAgICAgICBvdmVyZmxvd1k6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICB9LCBjaGlsZHJlbjogW2ljb25DbGFzc05hbWUgJiYganN4KFwiaVwiLCB7IGNsYXNzTmFtZTogaWNvbkNsYXNzTmFtZSB9KSwganN4KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX25vdGlmaWNhdGlvbl9fbWVzc2FnZVwiLCBjaGlsZHJlbjogbWVzc2FnZSB9KSwgY2xvc2UgPyAoanN4KFwiaVwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2ljb24gc3RyLXZpZGVvX19pY29uLS1jbG9zZSBzdHItdmlkZW9fX25vdGlmaWNhdGlvbl9fY2xvc2VcIiwgb25DbGljazogY2xvc2UgfSkpIDogbnVsbF0gfSkpLCBjaGlsZHJlbl0gfSkpO1xufTtcblxuY29uc3QgUGVybWlzc2lvbk5vdGlmaWNhdGlvbiA9IChwcm9wcykgPT4ge1xuICAgIGNvbnN0IHsgcGVybWlzc2lvbiwgaXNBd2FpdGluZ0FwcHJvdmFsLCBtZXNzYWdlQXBwcm92ZWQsIG1lc3NhZ2VBd2FpdGluZ0FwcHJvdmFsLCBtZXNzYWdlUmV2b2tlZCwgdmlzaWJpbGl0eVRpbWVvdXQgPSAzNTAwLCBjaGlsZHJlbiwgfSA9IHByb3BzO1xuICAgIGNvbnN0IHsgdXNlSGFzUGVybWlzc2lvbnMgfSA9IHVzZUNhbGxTdGF0ZUhvb2tzKCk7XG4gICAgY29uc3QgaGFzUGVybWlzc2lvbiA9IHVzZUhhc1Blcm1pc3Npb25zKHBlcm1pc3Npb24pO1xuICAgIGNvbnN0IHByZXZIYXNQZXJtaXNzaW9uID0gdXNlUmVmKGhhc1Blcm1pc3Npb24pO1xuICAgIGNvbnN0IFtzaG93Tm90aWZpY2F0aW9uLCBzZXRTaG93Tm90aWZpY2F0aW9uXSA9IHVzZVN0YXRlKCk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKGhhc1Blcm1pc3Npb24gJiYgIXByZXZIYXNQZXJtaXNzaW9uLmN1cnJlbnQpIHtcbiAgICAgICAgICAgIHNldFNob3dOb3RpZmljYXRpb24oJ2dyYW50ZWQnKTtcbiAgICAgICAgICAgIHByZXZIYXNQZXJtaXNzaW9uLmN1cnJlbnQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFoYXNQZXJtaXNzaW9uICYmIHByZXZIYXNQZXJtaXNzaW9uLmN1cnJlbnQpIHtcbiAgICAgICAgICAgIHNldFNob3dOb3RpZmljYXRpb24oJ3Jldm9rZWQnKTtcbiAgICAgICAgICAgIHByZXZIYXNQZXJtaXNzaW9uLmN1cnJlbnQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0sIFtoYXNQZXJtaXNzaW9uXSk7XG4gICAgY29uc3QgcmVzZXRJc1Zpc2libGUgPSB1c2VDYWxsYmFjaygoKSA9PiBzZXRTaG93Tm90aWZpY2F0aW9uKHVuZGVmaW5lZCksIFtdKTtcbiAgICBpZiAoaXNBd2FpdGluZ0FwcHJvdmFsKSB7XG4gICAgICAgIHJldHVybiAoanN4KE5vdGlmaWNhdGlvbiwgeyBpc1Zpc2libGU6IGlzQXdhaXRpbmdBcHByb3ZhbCAmJiAhaGFzUGVybWlzc2lvbiwgbWVzc2FnZTogbWVzc2FnZUF3YWl0aW5nQXBwcm92YWwsIGNoaWxkcmVuOiBjaGlsZHJlbiB9KSk7XG4gICAgfVxuICAgIHJldHVybiAoanN4KE5vdGlmaWNhdGlvbiwgeyBpc1Zpc2libGU6ICEhc2hvd05vdGlmaWNhdGlvbiwgdmlzaWJpbGl0eVRpbWVvdXQ6IHZpc2liaWxpdHlUaW1lb3V0LCByZXNldElzVmlzaWJsZTogcmVzZXRJc1Zpc2libGUsIG1lc3NhZ2U6IHNob3dOb3RpZmljYXRpb24gPT09ICdncmFudGVkJyA/IG1lc3NhZ2VBcHByb3ZlZCA6IG1lc3NhZ2VSZXZva2VkLCBjaGlsZHJlbjogY2hpbGRyZW4gfSkpO1xufTtcblxuY29uc3QgU3BlYWtpbmdXaGlsZU11dGVkTm90aWZpY2F0aW9uID0gKHsgY2hpbGRyZW4sIHRleHQsIHBsYWNlbWVudCwgfSkgPT4ge1xuICAgIGNvbnN0IHsgdXNlTWljcm9waG9uZVN0YXRlIH0gPSB1c2VDYWxsU3RhdGVIb29rcygpO1xuICAgIGNvbnN0IHsgaXNTcGVha2luZ1doaWxlTXV0ZWQgfSA9IHVzZU1pY3JvcGhvbmVTdGF0ZSgpO1xuICAgIGNvbnN0IHsgdCB9ID0gdXNlSTE4bigpO1xuICAgIGNvbnN0IG1lc3NhZ2UgPSB0ZXh0ID8/IHQoJ1lvdSBhcmUgbXV0ZWQuIFVubXV0ZSB0byBzcGVhay4nKTtcbiAgICByZXR1cm4gKGpzeChOb3RpZmljYXRpb24sIHsgbWVzc2FnZTogbWVzc2FnZSwgaXNWaXNpYmxlOiBpc1NwZWFraW5nV2hpbGVNdXRlZCwgcGxhY2VtZW50OiBwbGFjZW1lbnQgfHwgJ3RvcC1zdGFydCcsIGNoaWxkcmVuOiBjaGlsZHJlbiB9KSk7XG59O1xuXG5jb25zdCBSZWNvcmRpbmdJblByb2dyZXNzTm90aWZpY2F0aW9uID0gKHsgY2hpbGRyZW4sIHRleHQsIH0pID0+IHtcbiAgICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcbiAgICBjb25zdCB7IGlzQ2FsbFJlY29yZGluZ0luUHJvZ3Jlc3MgfSA9IHVzZVRvZ2dsZUNhbGxSZWNvcmRpbmcoKTtcbiAgICBjb25zdCBbaXNWaXNpYmxlLCBzZXRWaXNpYmxlXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBtZXNzYWdlID0gdGV4dCA/PyB0KCdSZWNvcmRpbmcgaW4gcHJvZ3Jlc3MuLi4nKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoaXNDYWxsUmVjb3JkaW5nSW5Qcm9ncmVzcykge1xuICAgICAgICAgICAgc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICB9XG4gICAgfSwgW2lzQ2FsbFJlY29yZGluZ0luUHJvZ3Jlc3NdKTtcbiAgICByZXR1cm4gKGpzeChOb3RpZmljYXRpb24sIHsgbWVzc2FnZTogbWVzc2FnZSwgaWNvbkNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2ljb24gc3RyLXZpZGVvX19pY29uLS1yZWNvcmRpbmctb25cIiwgaXNWaXNpYmxlOiBpc1Zpc2libGUsIHBsYWNlbWVudDogXCJ0b3Atc3RhcnRcIiwgY2xvc2U6ICgpID0+IHNldFZpc2libGUoZmFsc2UpLCBjaGlsZHJlbjogY2hpbGRyZW4gfSkpO1xufTtcblxuY29uc3QgTG9hZGluZ0luZGljYXRvciA9ICh7IGNsYXNzTmFtZSwgdHlwZSA9ICdzcGlubmVyJywgdGV4dCwgdG9vbHRpcCwgfSkgPT4ge1xuICAgIHJldHVybiAoanN4cyhcImRpdlwiLCB7IGNsYXNzTmFtZTogY2xzeCgnc3RyLXZpZGVvX19sb2FkaW5nLWluZGljYXRvcicsIGNsYXNzTmFtZSksIHRpdGxlOiB0b29sdGlwLCBjaGlsZHJlbjogW2pzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogY2xzeCgnc3RyLXZpZGVvX19sb2FkaW5nLWluZGljYXRvcl9faWNvbicsIHR5cGUpIH0pLCB0ZXh0ICYmIGpzeChcInBcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19sb2FkaW5nLWluZGljYXRvci10ZXh0XCIsIGNoaWxkcmVuOiB0ZXh0IH0pXSB9KSk7XG59O1xuXG5jb25zdCBSZWNvcmRFbmRDb25maXJtYXRpb24gPSAoKSA9PiB7XG4gICAgY29uc3QgeyB0IH0gPSB1c2VJMThuKCk7XG4gICAgY29uc3QgeyB0b2dnbGVDYWxsUmVjb3JkaW5nLCBpc0F3YWl0aW5nUmVzcG9uc2UgfSA9IHVzZVRvZ2dsZUNhbGxSZWNvcmRpbmcoKTtcbiAgICBjb25zdCB7IGNsb3NlIH0gPSB1c2VNZW51Q29udGV4dCgpO1xuICAgIHJldHVybiAoanN4cyhcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2VuZC1yZWNvcmRpbmdfX2NvbmZpcm1hdGlvblwiLCBjaGlsZHJlbjogW2pzeHMoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19lbmQtcmVjb3JkaW5nX19oZWFkZXJcIiwgY2hpbGRyZW46IFtqc3goSWNvbiwgeyBpY29uOiBcInJlY29yZGluZy1vblwiIH0pLCBqc3goXCJoMlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2VuZC1yZWNvcmRpbmdfX2hlYWRpbmdcIiwgY2hpbGRyZW46IHQoJ0VuZCByZWNvcmRpbmcnKSB9KV0gfSksIGpzeChcInBcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19lbmQtcmVjb3JkaW5nX19kZXNjcmlwdGlvblwiLCBjaGlsZHJlbjogdCgnQXJlIHlvdSBzdXJlIHlvdSB3YW50IGVuZCB0aGUgcmVjb3JkaW5nPycpIH0pLCBqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fZW5kLXJlY29yZGluZ19fYWN0aW9uc1wiLCBjaGlsZHJlbjogW2pzeChDb21wb3NpdGVCdXR0b24sIHsgdmFyaWFudDogXCJzZWNvbmRhcnlcIiwgb25DbGljazogY2xvc2UsIGNoaWxkcmVuOiB0KCdDYW5jZWwnKSB9KSwganN4KENvbXBvc2l0ZUJ1dHRvbiwgeyB2YXJpYW50OiBcInByaW1hcnlcIiwgb25DbGljazogdG9nZ2xlQ2FsbFJlY29yZGluZywgY2hpbGRyZW46IGlzQXdhaXRpbmdSZXNwb25zZSA/IGpzeChMb2FkaW5nSW5kaWNhdG9yLCB7fSkgOiB0KCdFbmQgcmVjb3JkaW5nJykgfSldIH0pXSB9KSk7XG59O1xuY29uc3QgVG9nZ2xlRW5kUmVjb3JkaW5nTWVudUJ1dHRvbiA9IGZvcndhcmRSZWYoZnVuY3Rpb24gVG9nZ2xlRW5kUmVjb3JkaW5nTWVudUJ1dHRvbihwcm9wcywgcmVmKSB7XG4gICAgcmV0dXJuIChqc3goQ29tcG9zaXRlQnV0dG9uLCB7IHJlZjogcmVmLCBhY3RpdmU6IHRydWUsIHZhcmlhbnQ6IFwic2Vjb25kYXJ5XCIsIFwiZGF0YS10ZXN0aWRcIjogXCJyZWNvcmRpbmctc3RvcC1idXR0b25cIiwgY2hpbGRyZW46IGpzeChJY29uLCB7IGljb246IFwicmVjb3JkaW5nLW9mZlwiIH0pIH0pKTtcbn0pO1xuY29uc3QgUmVjb3JkQ2FsbENvbmZpcm1hdGlvbkJ1dHRvbiA9ICh7IGNhcHRpb24sIH0pID0+IHtcbiAgICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcbiAgICBjb25zdCB7IHRvZ2dsZUNhbGxSZWNvcmRpbmcsIGlzQXdhaXRpbmdSZXNwb25zZSwgaXNDYWxsUmVjb3JkaW5nSW5Qcm9ncmVzcyB9ID0gdXNlVG9nZ2xlQ2FsbFJlY29yZGluZygpO1xuICAgIGlmIChpc0NhbGxSZWNvcmRpbmdJblByb2dyZXNzKSB7XG4gICAgICAgIHJldHVybiAoanN4KFJlc3RyaWN0ZWQsIHsgcmVxdWlyZWRHcmFudHM6IFtcbiAgICAgICAgICAgICAgICBPd25DYXBhYmlsaXR5LlNUQVJUX1JFQ09SRF9DQUxMLFxuICAgICAgICAgICAgICAgIE93bkNhcGFiaWxpdHkuU1RPUF9SRUNPUkRfQ0FMTCxcbiAgICAgICAgICAgIF0sIGNoaWxkcmVuOiBqc3goTWVudVRvZ2dsZSwgeyBUb2dnbGVCdXR0b246IFRvZ2dsZUVuZFJlY29yZGluZ01lbnVCdXR0b24sIHZpc3VhbFR5cGU6IE1lbnVWaXN1YWxUeXBlLlBPUlRBTCwgY2hpbGRyZW46IGpzeChSZWNvcmRFbmRDb25maXJtYXRpb24sIHt9KSB9KSB9KSk7XG4gICAgfVxuICAgIHJldHVybiAoanN4KFJlc3RyaWN0ZWQsIHsgcmVxdWlyZWRHcmFudHM6IFtcbiAgICAgICAgICAgIE93bkNhcGFiaWxpdHkuU1RBUlRfUkVDT1JEX0NBTEwsXG4gICAgICAgICAgICBPd25DYXBhYmlsaXR5LlNUT1BfUkVDT1JEX0NBTEwsXG4gICAgICAgIF0sIGNoaWxkcmVuOiBqc3goQ29tcG9zaXRlQnV0dG9uLCB7IGFjdGl2ZTogaXNDYWxsUmVjb3JkaW5nSW5Qcm9ncmVzcywgY2FwdGlvbjogY2FwdGlvbiwgdGl0bGU6IGNhcHRpb24gfHwgdCgnUmVjb3JkIGNhbGwnKSwgdmFyaWFudDogXCJzZWNvbmRhcnlcIiwgXCJkYXRhLXRlc3RpZFwiOiBcInJlY29yZGluZy1zdGFydC1idXR0b25cIiwgb25DbGljazogaXNBd2FpdGluZ1Jlc3BvbnNlID8gdW5kZWZpbmVkIDogdG9nZ2xlQ2FsbFJlY29yZGluZywgY2hpbGRyZW46IGlzQXdhaXRpbmdSZXNwb25zZSA/IChqc3goTG9hZGluZ0luZGljYXRvciwgeyB0b29sdGlwOiB0KCdXYWl0aW5nIGZvciByZWNvcmRpbmcgdG8gc3RhcnQuLi4nKSB9KSkgOiAoanN4KEljb24sIHsgaWNvbjogXCJyZWNvcmRpbmctb2ZmXCIgfSkpIH0pIH0pKTtcbn07XG5jb25zdCBSZWNvcmRDYWxsQnV0dG9uID0gKHsgY2FwdGlvbiB9KSA9PiB7XG4gICAgY29uc3QgeyB0IH0gPSB1c2VJMThuKCk7XG4gICAgY29uc3QgeyB0b2dnbGVDYWxsUmVjb3JkaW5nLCBpc0F3YWl0aW5nUmVzcG9uc2UsIGlzQ2FsbFJlY29yZGluZ0luUHJvZ3Jlc3MgfSA9IHVzZVRvZ2dsZUNhbGxSZWNvcmRpbmcoKTtcbiAgICBsZXQgdGl0bGUgPSBjYXB0aW9uIHx8IHQoJ1JlY29yZCBjYWxsJyk7XG4gICAgaWYgKGlzQXdhaXRpbmdSZXNwb25zZSkge1xuICAgICAgICB0aXRsZSA9IGlzQ2FsbFJlY29yZGluZ0luUHJvZ3Jlc3NcbiAgICAgICAgICAgID8gdCgnV2FpdGluZyBmb3IgcmVjb3JkaW5nIHRvIHN0b3AuLi4nKVxuICAgICAgICAgICAgOiB0KCdXYWl0aW5nIGZvciByZWNvcmRpbmcgdG8gc3RhcnQuLi4nKTtcbiAgICB9XG4gICAgcmV0dXJuIChqc3goUmVzdHJpY3RlZCwgeyByZXF1aXJlZEdyYW50czogW1xuICAgICAgICAgICAgT3duQ2FwYWJpbGl0eS5TVEFSVF9SRUNPUkRfQ0FMTCxcbiAgICAgICAgICAgIE93bkNhcGFiaWxpdHkuU1RPUF9SRUNPUkRfQ0FMTCxcbiAgICAgICAgXSwgY2hpbGRyZW46IGpzeChDb21wb3NpdGVCdXR0b24sIHsgYWN0aXZlOiBpc0NhbGxSZWNvcmRpbmdJblByb2dyZXNzLCBjYXB0aW9uOiBjYXB0aW9uLCB2YXJpYW50OiBcInNlY29uZGFyeVwiLCBcImRhdGEtdGVzdGlkXCI6IGlzQ2FsbFJlY29yZGluZ0luUHJvZ3Jlc3NcbiAgICAgICAgICAgICAgICA/ICdyZWNvcmRpbmctc3RvcC1idXR0b24nXG4gICAgICAgICAgICAgICAgOiAncmVjb3JkaW5nLXN0YXJ0LWJ1dHRvbicsIHRpdGxlOiB0aXRsZSwgb25DbGljazogaXNBd2FpdGluZ1Jlc3BvbnNlID8gdW5kZWZpbmVkIDogdG9nZ2xlQ2FsbFJlY29yZGluZywgY2hpbGRyZW46IGlzQXdhaXRpbmdSZXNwb25zZSA/IChqc3goTG9hZGluZ0luZGljYXRvciwge30pKSA6IChqc3goSWNvbiwgeyBpY29uOiBpc0NhbGxSZWNvcmRpbmdJblByb2dyZXNzID8gJ3JlY29yZGluZy1vbicgOiAncmVjb3JkaW5nLW9mZicgfSkpIH0pIH0pKTtcbn07XG5cbmNvbnN0IGRlZmF1bHRFbW9qaVJlYWN0aW9uTWFwID0ge1xuICAgICc6bGlrZTonOiAn8J+RjScsXG4gICAgJzpyYWlzZS1oYW5kOic6ICfinIsnLFxuICAgICc6ZmlyZXdvcmtzOic6ICfwn46JJyxcbiAgICAnOmRpc2xpa2U6JzogJ/CfkY4nLFxuICAgICc6aGVhcnQ6JzogJ+KdpO+4jycsXG4gICAgJzpzbWlsZTonOiAn8J+YgCcsXG59O1xuY29uc3QgUmVhY3Rpb24gPSAoeyBwYXJ0aWNpcGFudDogeyByZWFjdGlvbiwgc2Vzc2lvbklkIH0sIGhpZGVBZnRlclRpbWVvdXRJbk1zID0gNTUwMCwgZW1vamlSZWFjdGlvbk1hcCA9IGRlZmF1bHRFbW9qaVJlYWN0aW9uTWFwLCB9KSA9PiB7XG4gICAgY29uc3QgY2FsbCA9IHVzZUNhbGwoKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoIWNhbGwgfHwgIXJlYWN0aW9uKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGNhbGwucmVzZXRSZWFjdGlvbihzZXNzaW9uSWQpO1xuICAgICAgICB9LCBoaWRlQWZ0ZXJUaW1lb3V0SW5Ncyk7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICAgICAgfTtcbiAgICB9LCBbY2FsbCwgaGlkZUFmdGVyVGltZW91dEluTXMsIHJlYWN0aW9uLCBzZXNzaW9uSWRdKTtcbiAgICBpZiAoIXJlYWN0aW9uKVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICBjb25zdCB7IGVtb2ppX2NvZGU6IGVtb2ppQ29kZSB9ID0gcmVhY3Rpb247XG4gICAgcmV0dXJuIChqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19yZWFjdGlvblwiLCBjaGlsZHJlbjoganN4KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3JlYWN0aW9uX19lbW9qaVwiLCBjaGlsZHJlbjogZW1vamlDb2RlICYmIGVtb2ppUmVhY3Rpb25NYXBbZW1vamlDb2RlXSB9KSB9KSk7XG59O1xuXG5jb25zdCBkZWZhdWx0UmVhY3Rpb25zID0gW1xuICAgIHtcbiAgICAgICAgdHlwZTogJ3JlYWN0aW9uJyxcbiAgICAgICAgZW1vamlfY29kZTogJzpsaWtlOicsXG4gICAgfSxcbiAgICB7XG4gICAgICAgIC8vIFRPRE8gT0w6IHVzZSBgcHJvbXB0YCB0eXBlP1xuICAgICAgICB0eXBlOiAncmFpc2VkLWhhbmQnLFxuICAgICAgICBlbW9qaV9jb2RlOiAnOnJhaXNlLWhhbmQ6JyxcbiAgICB9LFxuICAgIHtcbiAgICAgICAgdHlwZTogJ3JlYWN0aW9uJyxcbiAgICAgICAgZW1vamlfY29kZTogJzpmaXJld29ya3M6JyxcbiAgICB9LFxuICAgIHtcbiAgICAgICAgdHlwZTogJ3JlYWN0aW9uJyxcbiAgICAgICAgZW1vamlfY29kZTogJzpkaXNsaWtlOicsXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHR5cGU6ICdyZWFjdGlvbicsXG4gICAgICAgIGVtb2ppX2NvZGU6ICc6aGVhcnQ6JyxcbiAgICB9LFxuICAgIHtcbiAgICAgICAgdHlwZTogJ3JlYWN0aW9uJyxcbiAgICAgICAgZW1vamlfY29kZTogJzpzbWlsZTonLFxuICAgIH0sXG5dO1xuY29uc3QgUmVhY3Rpb25zQnV0dG9uID0gKHsgcmVhY3Rpb25zID0gZGVmYXVsdFJlYWN0aW9ucywgfSkgPT4ge1xuICAgIHJldHVybiAoanN4KFJlc3RyaWN0ZWQsIHsgcmVxdWlyZWRHcmFudHM6IFtPd25DYXBhYmlsaXR5LkNSRUFURV9SRUFDVElPTl0sIGNoaWxkcmVuOiBqc3goTWVudVRvZ2dsZSwgeyBwbGFjZW1lbnQ6IFwidG9wXCIsIFRvZ2dsZUJ1dHRvbjogVG9nZ2xlUmVhY3Rpb25zTWVudUJ1dHRvbiwgdmlzdWFsVHlwZTogTWVudVZpc3VhbFR5cGUuTUVOVSwgY2hpbGRyZW46IGpzeChEZWZhdWx0UmVhY3Rpb25zTWVudSwgeyByZWFjdGlvbnM6IHJlYWN0aW9ucyB9KSB9KSB9KSk7XG59O1xuY29uc3QgVG9nZ2xlUmVhY3Rpb25zTWVudUJ1dHRvbiA9IGZvcndhcmRSZWYoZnVuY3Rpb24gVG9nZ2xlUmVhY3Rpb25zTWVudUJ1dHRvbih7IG1lbnVTaG93biB9LCByZWYpIHtcbiAgICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcbiAgICByZXR1cm4gKGpzeChDb21wb3NpdGVCdXR0b24sIHsgcmVmOiByZWYsIGFjdGl2ZTogbWVudVNob3duLCB2YXJpYW50OiBcInByaW1hcnlcIiwgdGl0bGU6IHQoJ1JlYWN0aW9ucycpLCBjaGlsZHJlbjoganN4KEljb24sIHsgaWNvbjogXCJyZWFjdGlvbnNcIiB9KSB9KSk7XG59KTtcbmNvbnN0IERlZmF1bHRSZWFjdGlvbnNNZW51ID0gKHsgcmVhY3Rpb25zLCBsYXlvdXQgPSAnaG9yaXpvbnRhbCcsIH0pID0+IHtcbiAgICBjb25zdCBjYWxsID0gdXNlQ2FsbCgpO1xuICAgIHJldHVybiAoanN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBjbHN4KCdzdHItdmlkZW9fX3JlYWN0aW9ucy1tZW51Jywge1xuICAgICAgICAgICAgJ3N0ci12aWRlb19fcmVhY3Rpb25zLW1lbnUtLWhvcml6b250YWwnOiBsYXlvdXQgPT09ICdob3Jpem9udGFsJyxcbiAgICAgICAgICAgICdzdHItdmlkZW9fX3JlYWN0aW9ucy1tZW51LS12ZXJ0aWNhbCc6IGxheW91dCA9PT0gJ3ZlcnRpY2FsJyxcbiAgICAgICAgfSksIGNoaWxkcmVuOiByZWFjdGlvbnMubWFwKChyZWFjdGlvbikgPT4gKGpzeChcImJ1dHRvblwiLCB7IHR5cGU6IFwiYnV0dG9uXCIsIGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3JlYWN0aW9ucy1tZW51X19idXR0b25cIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNhbGw/LnNlbmRSZWFjdGlvbihyZWFjdGlvbik7XG4gICAgICAgICAgICB9LCBjaGlsZHJlbjogcmVhY3Rpb24uZW1vamlfY29kZSAmJiBkZWZhdWx0RW1vamlSZWFjdGlvbk1hcFtyZWFjdGlvbi5lbW9qaV9jb2RlXSB9LCByZWFjdGlvbi5lbW9qaV9jb2RlKSkpIH0pKTtcbn07XG5cbmNvbnN0IFNjcmVlblNoYXJlQnV0dG9uID0gKHByb3BzKSA9PiB7XG4gICAgY29uc3QgeyB0IH0gPSB1c2VJMThuKCk7XG4gICAgY29uc3QgeyBjYXB0aW9uIH0gPSBwcm9wcztcbiAgICBjb25zdCB7IHVzZUhhc09uZ29pbmdTY3JlZW5TaGFyZSwgdXNlU2NyZWVuU2hhcmVTdGF0ZSwgdXNlQ2FsbFNldHRpbmdzIH0gPSB1c2VDYWxsU3RhdGVIb29rcygpO1xuICAgIGNvbnN0IGlzU29tZW9uZVNjcmVlblNoYXJpbmcgPSB1c2VIYXNPbmdvaW5nU2NyZWVuU2hhcmUoKTtcbiAgICBjb25zdCB7IGhhc1Blcm1pc3Npb24sIHJlcXVlc3RQZXJtaXNzaW9uLCBpc0F3YWl0aW5nUGVybWlzc2lvbiB9ID0gdXNlUmVxdWVzdFBlcm1pc3Npb24oT3duQ2FwYWJpbGl0eS5TQ1JFRU5TSEFSRSk7XG4gICAgY29uc3QgY2FsbFNldHRpbmdzID0gdXNlQ2FsbFNldHRpbmdzKCk7XG4gICAgY29uc3QgaXNTY3JlZW5TaGFyaW5nQWxsb3dlZCA9IGNhbGxTZXR0aW5ncz8uc2NyZWVuc2hhcmluZy5lbmFibGVkO1xuICAgIGNvbnN0IHsgc2NyZWVuU2hhcmUsIGlzTXV0ZTogYW1JU2NyZWVuU2hhcmluZyB9ID0gdXNlU2NyZWVuU2hhcmVTdGF0ZSgpO1xuICAgIGNvbnN0IGRpc2FibGVTY3JlZW5TaGFyZUJ1dHRvbiA9IGFtSVNjcmVlblNoYXJpbmdcbiAgICAgICAgPyBpc1NvbWVvbmVTY3JlZW5TaGFyaW5nIHx8IGlzU2NyZWVuU2hhcmluZ0FsbG93ZWQgPT09IGZhbHNlXG4gICAgICAgIDogZmFsc2U7XG4gICAgcmV0dXJuIChqc3goUmVzdHJpY3RlZCwgeyByZXF1aXJlZEdyYW50czogW093bkNhcGFiaWxpdHkuU0NSRUVOU0hBUkVdLCBjaGlsZHJlbjoganN4KFBlcm1pc3Npb25Ob3RpZmljYXRpb24sIHsgcGVybWlzc2lvbjogT3duQ2FwYWJpbGl0eS5TQ1JFRU5TSEFSRSwgaXNBd2FpdGluZ0FwcHJvdmFsOiBpc0F3YWl0aW5nUGVybWlzc2lvbiwgbWVzc2FnZUFwcHJvdmVkOiB0KCdZb3UgY2FuIG5vdyBzaGFyZSB5b3VyIHNjcmVlbi4nKSwgbWVzc2FnZUF3YWl0aW5nQXBwcm92YWw6IHQoJ0F3YWl0aW5nIGZvciBhbiBhcHByb3ZhbCB0byBzaGFyZSBzY3JlZW4uJyksIG1lc3NhZ2VSZXZva2VkOiB0KCdZb3UgY2FuIG5vIGxvbmdlciBzaGFyZSB5b3VyIHNjcmVlbi4nKSwgY2hpbGRyZW46IGpzeChDb21wb3NpdGVCdXR0b24sIHsgYWN0aXZlOiBpc1NvbWVvbmVTY3JlZW5TaGFyaW5nLCBjYXB0aW9uOiBjYXB0aW9uLCB0aXRsZTogY2FwdGlvbiB8fCB0KCdTaGFyZSBzY3JlZW4nKSwgdmFyaWFudDogXCJwcmltYXJ5XCIsIFwiZGF0YS10ZXN0aWRcIjogaXNTb21lb25lU2NyZWVuU2hhcmluZ1xuICAgICAgICAgICAgICAgICAgICA/ICdzY3JlZW4tc2hhcmUtc3RvcC1idXR0b24nXG4gICAgICAgICAgICAgICAgICAgIDogJ3NjcmVlbi1zaGFyZS1zdGFydC1idXR0b24nLCBkaXNhYmxlZDogZGlzYWJsZVNjcmVlblNoYXJlQnV0dG9uLCBvbkNsaWNrOiBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaGFzUGVybWlzc2lvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgcmVxdWVzdFBlcm1pc3Npb24oKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNjcmVlblNoYXJlLnRvZ2dsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgY2hpbGRyZW46IGpzeChJY29uLCB7IGljb246IGlzU29tZW9uZVNjcmVlblNoYXJpbmcgPyAnc2NyZWVuLXNoYXJlLW9uJyA6ICdzY3JlZW4tc2hhcmUtb2ZmJyB9KSB9KSB9KSB9KSk7XG59O1xuXG5jb25zdCBTZWxlY3RDb250ZXh0ID0gY3JlYXRlQ29udGV4dCh7fSk7XG5jb25zdCBTZWxlY3QgPSAocHJvcHMpID0+IHtcbiAgICBjb25zdCB7IGNoaWxkcmVuLCBpY29uLCBkZWZhdWx0U2VsZWN0ZWRMYWJlbCwgZGVmYXVsdFNlbGVjdGVkSW5kZXgsIGhhbmRsZVNlbGVjdDogaGFuZGxlU2VsZWN0UHJvcCwgfSA9IHByb3BzO1xuICAgIGNvbnN0IFtpc09wZW4sIHNldElzT3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgW2FjdGl2ZUluZGV4LCBzZXRBY3RpdmVJbmRleF0gPSB1c2VTdGF0ZShudWxsKTtcbiAgICBjb25zdCBbc2VsZWN0ZWRJbmRleCwgc2V0U2VsZWN0ZWRJbmRleF0gPSB1c2VTdGF0ZShkZWZhdWx0U2VsZWN0ZWRJbmRleCk7XG4gICAgY29uc3QgW3NlbGVjdGVkTGFiZWwsIHNldFNlbGVjdGVkTGFiZWxdID0gdXNlU3RhdGUoZGVmYXVsdFNlbGVjdGVkTGFiZWwpO1xuICAgIGNvbnN0IHsgcmVmcywgY29udGV4dCB9ID0gdXNlRmxvYXRpbmcoe1xuICAgICAgICBwbGFjZW1lbnQ6ICdib3R0b20tc3RhcnQnLFxuICAgICAgICBvcGVuOiBpc09wZW4sXG4gICAgICAgIG9uT3BlbkNoYW5nZTogc2V0SXNPcGVuLFxuICAgICAgICB3aGlsZUVsZW1lbnRzTW91bnRlZDogYXV0b1VwZGF0ZSxcbiAgICAgICAgbWlkZGxld2FyZTogW2ZsaXAoKV0sXG4gICAgfSk7XG4gICAgY29uc3QgZWxlbWVudHNSZWYgPSB1c2VSZWYoW10pO1xuICAgIGNvbnN0IGxhYmVsc1JlZiA9IHVzZVJlZihbXSk7XG4gICAgY29uc3QgaGFuZGxlU2VsZWN0ID0gdXNlQ2FsbGJhY2soKGluZGV4KSA9PiB7XG4gICAgICAgIHNldFNlbGVjdGVkSW5kZXgoaW5kZXgpO1xuICAgICAgICBoYW5kbGVTZWxlY3RQcm9wKGluZGV4IHx8IDApO1xuICAgICAgICBzZXRJc09wZW4oZmFsc2UpO1xuICAgICAgICBpZiAoaW5kZXggIT09IG51bGwpIHtcbiAgICAgICAgICAgIHNldFNlbGVjdGVkTGFiZWwobGFiZWxzUmVmLmN1cnJlbnRbaW5kZXhdKTtcbiAgICAgICAgfVxuICAgIH0sIFtoYW5kbGVTZWxlY3RQcm9wXSk7XG4gICAgY29uc3QgaGFuZGxlVHlwZWFoZWFkTWF0Y2ggPSAoaW5kZXgpID0+IHtcbiAgICAgICAgaWYgKGlzT3Blbikge1xuICAgICAgICAgICAgc2V0QWN0aXZlSW5kZXgoaW5kZXgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaGFuZGxlU2VsZWN0KGluZGV4KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3QgbGlzdE5hdiA9IHVzZUxpc3ROYXZpZ2F0aW9uKGNvbnRleHQsIHtcbiAgICAgICAgbGlzdFJlZjogZWxlbWVudHNSZWYsXG4gICAgICAgIGFjdGl2ZUluZGV4LFxuICAgICAgICBzZWxlY3RlZEluZGV4LFxuICAgICAgICBvbk5hdmlnYXRlOiBzZXRBY3RpdmVJbmRleCxcbiAgICB9KTtcbiAgICBjb25zdCB0eXBlYWhlYWQgPSB1c2VUeXBlYWhlYWQoY29udGV4dCwge1xuICAgICAgICBsaXN0UmVmOiBsYWJlbHNSZWYsXG4gICAgICAgIGFjdGl2ZUluZGV4LFxuICAgICAgICBzZWxlY3RlZEluZGV4LFxuICAgICAgICBvbk1hdGNoOiBoYW5kbGVUeXBlYWhlYWRNYXRjaCxcbiAgICB9KTtcbiAgICBjb25zdCBjbGljayA9IHVzZUNsaWNrKGNvbnRleHQpO1xuICAgIGNvbnN0IGRpc21pc3MgPSB1c2VEaXNtaXNzKGNvbnRleHQpO1xuICAgIGNvbnN0IHJvbGUgPSB1c2VSb2xlKGNvbnRleHQsIHsgcm9sZTogJ2xpc3Rib3gnIH0pO1xuICAgIGNvbnN0IHsgZ2V0UmVmZXJlbmNlUHJvcHMsIGdldEZsb2F0aW5nUHJvcHMsIGdldEl0ZW1Qcm9wcyB9ID0gdXNlSW50ZXJhY3Rpb25zKFtsaXN0TmF2LCB0eXBlYWhlYWQsIGNsaWNrLCBkaXNtaXNzLCByb2xlXSk7XG4gICAgY29uc3Qgc2VsZWN0Q29udGV4dCA9IHVzZU1lbW8oKCkgPT4gKHtcbiAgICAgICAgYWN0aXZlSW5kZXgsXG4gICAgICAgIHNlbGVjdGVkSW5kZXgsXG4gICAgICAgIGdldEl0ZW1Qcm9wcyxcbiAgICAgICAgaGFuZGxlU2VsZWN0LFxuICAgIH0pLCBbYWN0aXZlSW5kZXgsIHNlbGVjdGVkSW5kZXgsIGdldEl0ZW1Qcm9wcywgaGFuZGxlU2VsZWN0XSk7XG4gICAgcmV0dXJuIChqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fZHJvcGRvd25cIiwgY2hpbGRyZW46IFtqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fZHJvcGRvd24tc2VsZWN0ZWRcIiwgcmVmOiByZWZzLnNldFJlZmVyZW5jZSwgdGFiSW5kZXg6IDAsIC4uLmdldFJlZmVyZW5jZVByb3BzKCksIGNoaWxkcmVuOiBbanN4cyhcImxhYmVsXCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fZHJvcGRvd24tc2VsZWN0ZWRfX2xhYmVsXCIsIGNoaWxkcmVuOiBbaWNvbiAmJiAoanN4KEljb24sIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fZHJvcGRvd24tc2VsZWN0ZWRfX2ljb25cIiwgaWNvbjogaWNvbiB9KSksIHNlbGVjdGVkTGFiZWxdIH0pLCBqc3goSWNvbiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19kcm9wZG93bi1zZWxlY3RlZF9fY2hldnJvblwiLCBpY29uOiBpc09wZW4gPyAnY2hldnJvbi11cCcgOiAnY2hldnJvbi1kb3duJyB9KV0gfSksIGpzeChTZWxlY3RDb250ZXh0LlByb3ZpZGVyLCB7IHZhbHVlOiBzZWxlY3RDb250ZXh0LCBjaGlsZHJlbjogaXNPcGVuICYmIChqc3goRmxvYXRpbmdGb2N1c01hbmFnZXIsIHsgY29udGV4dDogY29udGV4dCwgbW9kYWw6IGZhbHNlLCBjaGlsZHJlbjoganN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fZHJvcGRvd24tbGlzdFwiLCByZWY6IHJlZnMuc2V0RmxvYXRpbmcsIC4uLmdldEZsb2F0aW5nUHJvcHMoKSwgY2hpbGRyZW46IGpzeChGbG9hdGluZ0xpc3QsIHsgZWxlbWVudHNSZWY6IGVsZW1lbnRzUmVmLCBsYWJlbHNSZWY6IGxhYmVsc1JlZiwgY2hpbGRyZW46IGNoaWxkcmVuIH0pIH0pIH0pKSB9KV0gfSkpO1xufTtcbmNvbnN0IERyb3BEb3duU2VsZWN0T3B0aW9uID0gKHByb3BzKSA9PiB7XG4gICAgY29uc3QgeyBzZWxlY3RlZCwgbGFiZWwsIGljb24gfSA9IHByb3BzO1xuICAgIGNvbnN0IHsgZ2V0SXRlbVByb3BzLCBoYW5kbGVTZWxlY3QgfSA9IHVzZUNvbnRleHQoU2VsZWN0Q29udGV4dCk7XG4gICAgY29uc3QgeyByZWYsIGluZGV4IH0gPSB1c2VMaXN0SXRlbSgpO1xuICAgIHJldHVybiAoanN4cyhcImRpdlwiLCB7IGNsYXNzTmFtZTogY2xzeCgnc3RyLXZpZGVvX19kcm9wZG93bi1vcHRpb24nLCB7XG4gICAgICAgICAgICAnc3RyLXZpZGVvX19kcm9wZG93bi1vcHRpb24tLXNlbGVjdGVkJzogc2VsZWN0ZWQsXG4gICAgICAgIH0pLCByZWY6IHJlZiwgLi4uZ2V0SXRlbVByb3BzKHtcbiAgICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IGhhbmRsZVNlbGVjdChpbmRleCksXG4gICAgICAgIH0pLCBjaGlsZHJlbjogW2pzeChJY29uLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2Ryb3Bkb3duLWljb25cIiwgaWNvbjogaWNvbiB9KSwganN4KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2Ryb3Bkb3duLWxhYmVsXCIsIGNoaWxkcmVuOiBsYWJlbCB9KV0gfSkpO1xufTtcbmNvbnN0IERyb3BEb3duU2VsZWN0ID0gKHByb3BzKSA9PiB7XG4gICAgY29uc3QgeyBjaGlsZHJlbiwgaWNvbiwgaGFuZGxlU2VsZWN0LCBkZWZhdWx0U2VsZWN0ZWRMYWJlbCwgZGVmYXVsdFNlbGVjdGVkSW5kZXgsIH0gPSBwcm9wcztcbiAgICByZXR1cm4gKGpzeChTZWxlY3QsIHsgaWNvbjogaWNvbiwgaGFuZGxlU2VsZWN0OiBoYW5kbGVTZWxlY3QsIGRlZmF1bHRTZWxlY3RlZEluZGV4OiBkZWZhdWx0U2VsZWN0ZWRJbmRleCwgZGVmYXVsdFNlbGVjdGVkTGFiZWw6IGRlZmF1bHRTZWxlY3RlZExhYmVsLCBjaGlsZHJlbjogY2hpbGRyZW4gfSkpO1xufTtcblxuY29uc3QgRGV2aWNlU2VsZWN0b3JPcHRpb24gPSAoeyBkaXNhYmxlZCwgaWQsIGxhYmVsLCBvbkNoYW5nZSwgbmFtZSwgc2VsZWN0ZWQsIGRlZmF1bHRDaGVja2VkLCB2YWx1ZSwgfSkgPT4ge1xuICAgIHJldHVybiAoanN4cyhcImxhYmVsXCIsIHsgY2xhc3NOYW1lOiBjbHN4KCdzdHItdmlkZW9fX2RldmljZS1zZXR0aW5nc19fb3B0aW9uJywge1xuICAgICAgICAgICAgJ3N0ci12aWRlb19fZGV2aWNlLXNldHRpbmdzX19vcHRpb24tLXNlbGVjdGVkJzogc2VsZWN0ZWQsXG4gICAgICAgICAgICAnc3RyLXZpZGVvX19kZXZpY2Utc2V0dGluZ3NfX29wdGlvbi0tZGlzYWJsZWQnOiBkaXNhYmxlZCxcbiAgICAgICAgfSksIGh0bWxGb3I6IGlkLCBjaGlsZHJlbjogW2pzeChcImlucHV0XCIsIHsgdHlwZTogXCJyYWRpb1wiLCBuYW1lOiBuYW1lLCBvbkNoYW5nZTogb25DaGFuZ2UsIHZhbHVlOiB2YWx1ZSwgaWQ6IGlkLCBjaGVja2VkOiBzZWxlY3RlZCwgZGVmYXVsdENoZWNrZWQ6IGRlZmF1bHRDaGVja2VkLCBkaXNhYmxlZDogZGlzYWJsZWQgfSksIGxhYmVsXSB9KSk7XG59O1xuY29uc3QgRGV2aWNlU2VsZWN0b3JMaXN0ID0gKHByb3BzKSA9PiB7XG4gICAgY29uc3QgeyBkZXZpY2VzID0gW10sIHNlbGVjdGVkRGV2aWNlSWQ6IHNlbGVjdGVkRGV2aWNlRnJvbVByb3BzLCB0aXRsZSwgdHlwZSwgb25DaGFuZ2UsIH0gPSBwcm9wcztcbiAgICAvLyBzb21ldGltZXMgdGhlIGJyb3dzZXIgKENocm9tZSkgd2lsbCByZXBvcnQgdGhlIHN5c3RlbS1kZWZhdWx0IGRldmljZVxuICAgIC8vIHdpdGggYW4gaWQgb2YgJ2RlZmF1bHQnLiBJbiBjYXNlIHdoZW4gaXQgZG9lc24ndCwgd2UnbGwgc2VsZWN0IHRoZSBmaXJzdFxuICAgIC8vIGF2YWlsYWJsZSBkZXZpY2UuXG4gICAgbGV0IHNlbGVjdGVkRGV2aWNlSWQgPSBzZWxlY3RlZERldmljZUZyb21Qcm9wcztcbiAgICBpZiAoZGV2aWNlcy5sZW5ndGggPiAwICYmXG4gICAgICAgICFkZXZpY2VzLmZpbmQoKGQpID0+IGQuZGV2aWNlSWQgPT09IHNlbGVjdGVkRGV2aWNlSWQpKSB7XG4gICAgICAgIHNlbGVjdGVkRGV2aWNlSWQgPSBkZXZpY2VzWzBdLmRldmljZUlkO1xuICAgIH1cbiAgICByZXR1cm4gKGpzeHMoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19kZXZpY2Utc2V0dGluZ3NfX2RldmljZS1raW5kXCIsIGNoaWxkcmVuOiBbdGl0bGUgJiYgKGpzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2RldmljZS1zZXR0aW5nc19fZGV2aWNlLXNlbGVjdG9yLXRpdGxlXCIsIGNoaWxkcmVuOiB0aXRsZSB9KSksICFkZXZpY2VzLmxlbmd0aCA/IChqc3goRGV2aWNlU2VsZWN0b3JPcHRpb24sIHsgaWQ6IGAke3R5cGV9LS1kZWZhdWx0YCwgbGFiZWw6IFwiRGVmYXVsdFwiLCBuYW1lOiB0eXBlLCBkZWZhdWx0Q2hlY2tlZDogdHJ1ZSwgdmFsdWU6IFwiZGVmYXVsdFwiIH0pKSA6IChkZXZpY2VzLm1hcCgoZGV2aWNlKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChqc3goRGV2aWNlU2VsZWN0b3JPcHRpb24sIHsgaWQ6IGAke3R5cGV9LS0ke2RldmljZS5kZXZpY2VJZH1gLCB2YWx1ZTogZGV2aWNlLmRldmljZUlkLCBsYWJlbDogZGV2aWNlLmxhYmVsLCBvbkNoYW5nZTogKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPy4oZS50YXJnZXQudmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9LCBuYW1lOiB0eXBlLCBzZWxlY3RlZDogZGV2aWNlLmRldmljZUlkID09PSBzZWxlY3RlZERldmljZUlkIHx8IGRldmljZXMubGVuZ3RoID09PSAxIH0sIGRldmljZS5kZXZpY2VJZCkpO1xuICAgICAgICAgICAgfSkpXSB9KSk7XG59O1xuY29uc3QgRGV2aWNlU2VsZWN0b3JEcm9wZG93biA9IChwcm9wcykgPT4ge1xuICAgIGNvbnN0IHsgZGV2aWNlcyA9IFtdLCBzZWxlY3RlZERldmljZUlkOiBzZWxlY3RlZERldmljZUZyb21Qcm9wcywgdGl0bGUsIG9uQ2hhbmdlLCBpY29uLCB9ID0gcHJvcHM7XG4gICAgLy8gc29tZXRpbWVzIHRoZSBicm93c2VyIChDaHJvbWUpIHdpbGwgcmVwb3J0IHRoZSBzeXN0ZW0tZGVmYXVsdCBkZXZpY2VcbiAgICAvLyB3aXRoIGFuIGlkIG9mICdkZWZhdWx0Jy4gSW4gY2FzZSB3aGVuIGl0IGRvZXNuJ3QsIHdlJ2xsIHNlbGVjdCB0aGUgZmlyc3RcbiAgICAvLyBhdmFpbGFibGUgZGV2aWNlLlxuICAgIGxldCBzZWxlY3RlZERldmljZUlkID0gc2VsZWN0ZWREZXZpY2VGcm9tUHJvcHM7XG4gICAgaWYgKGRldmljZXMubGVuZ3RoID4gMCAmJlxuICAgICAgICAhZGV2aWNlcy5maW5kKChkKSA9PiBkLmRldmljZUlkID09PSBzZWxlY3RlZERldmljZUlkKSkge1xuICAgICAgICBzZWxlY3RlZERldmljZUlkID0gZGV2aWNlc1swXS5kZXZpY2VJZDtcbiAgICB9XG4gICAgY29uc3Qgc2VsZWN0ZWRJbmRleCA9IGRldmljZXMuZmluZEluZGV4KChkKSA9PiBkLmRldmljZUlkID09PSBzZWxlY3RlZERldmljZUlkKTtcbiAgICBjb25zdCBoYW5kbGVTZWxlY3QgPSB1c2VDYWxsYmFjaygoaW5kZXgpID0+IHtcbiAgICAgICAgb25DaGFuZ2U/LihkZXZpY2VzW2luZGV4XS5kZXZpY2VJZCk7XG4gICAgfSwgW2RldmljZXMsIG9uQ2hhbmdlXSk7XG4gICAgcmV0dXJuIChqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fZGV2aWNlLXNldHRpbmdzX19kZXZpY2Uta2luZFwiLCBjaGlsZHJlbjogW2pzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2RldmljZS1zZXR0aW5nc19fZGV2aWNlLXNlbGVjdG9yLXRpdGxlXCIsIGNoaWxkcmVuOiB0aXRsZSB9KSwganN4KERyb3BEb3duU2VsZWN0LCB7IGljb246IGljb24sIGRlZmF1bHRTZWxlY3RlZEluZGV4OiBzZWxlY3RlZEluZGV4LCBkZWZhdWx0U2VsZWN0ZWRMYWJlbDogZGV2aWNlc1tzZWxlY3RlZEluZGV4XT8ubGFiZWwsIGhhbmRsZVNlbGVjdDogaGFuZGxlU2VsZWN0LCBjaGlsZHJlbjogZGV2aWNlcy5tYXAoKGRldmljZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGpzeChEcm9wRG93blNlbGVjdE9wdGlvbiwgeyBpY29uOiBpY29uLCBsYWJlbDogZGV2aWNlLmxhYmVsLCBzZWxlY3RlZDogZGV2aWNlLmRldmljZUlkID09PSBzZWxlY3RlZERldmljZUlkIHx8IGRldmljZXMubGVuZ3RoID09PSAxIH0sIGRldmljZS5kZXZpY2VJZCkpO1xuICAgICAgICAgICAgICAgIH0pIH0pXSB9KSk7XG59O1xuY29uc3QgRGV2aWNlU2VsZWN0b3IgPSAocHJvcHMpID0+IHtcbiAgICBjb25zdCB7IHZpc3VhbFR5cGUgPSAnbGlzdCcsIGljb24sIHBsYWNlaG9sZGVyLCAuLi5yZXN0IH0gPSBwcm9wcztcbiAgICBpZiAodmlzdWFsVHlwZSA9PT0gJ2xpc3QnKSB7XG4gICAgICAgIHJldHVybiBqc3goRGV2aWNlU2VsZWN0b3JMaXN0LCB7IC4uLnJlc3QgfSk7XG4gICAgfVxuICAgIHJldHVybiAoanN4KERldmljZVNlbGVjdG9yRHJvcGRvd24sIHsgLi4ucmVzdCwgaWNvbjogaWNvbiwgcGxhY2Vob2xkZXI6IHBsYWNlaG9sZGVyIH0pKTtcbn07XG5cbmNvbnN0IERldmljZVNlbGVjdG9yQXVkaW9JbnB1dCA9ICh7IHRpdGxlLCB2aXN1YWxUeXBlLCB9KSA9PiB7XG4gICAgY29uc3QgeyB1c2VNaWNyb3Bob25lU3RhdGUgfSA9IHVzZUNhbGxTdGF0ZUhvb2tzKCk7XG4gICAgY29uc3QgeyBtaWNyb3Bob25lLCBzZWxlY3RlZERldmljZSwgZGV2aWNlcyB9ID0gdXNlTWljcm9waG9uZVN0YXRlKCk7XG4gICAgcmV0dXJuIChqc3goRGV2aWNlU2VsZWN0b3IsIHsgZGV2aWNlczogZGV2aWNlcyB8fCBbXSwgc2VsZWN0ZWREZXZpY2VJZDogc2VsZWN0ZWREZXZpY2UsIHR5cGU6IFwiYXVkaW9pbnB1dFwiLCBvbkNoYW5nZTogYXN5bmMgKGRldmljZUlkKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCBtaWNyb3Bob25lLnNlbGVjdChkZXZpY2VJZCk7XG4gICAgICAgIH0sIHRpdGxlOiB0aXRsZSwgdmlzdWFsVHlwZTogdmlzdWFsVHlwZSwgaWNvbjogXCJtaWNcIiB9KSk7XG59O1xuY29uc3QgRGV2aWNlU2VsZWN0b3JBdWRpb091dHB1dCA9ICh7IHRpdGxlLCB2aXN1YWxUeXBlLCB9KSA9PiB7XG4gICAgY29uc3QgeyB1c2VTcGVha2VyU3RhdGUgfSA9IHVzZUNhbGxTdGF0ZUhvb2tzKCk7XG4gICAgY29uc3QgeyBzcGVha2VyLCBzZWxlY3RlZERldmljZSwgZGV2aWNlcywgaXNEZXZpY2VTZWxlY3Rpb25TdXBwb3J0ZWQgfSA9IHVzZVNwZWFrZXJTdGF0ZSgpO1xuICAgIGlmICghaXNEZXZpY2VTZWxlY3Rpb25TdXBwb3J0ZWQpXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIHJldHVybiAoanN4KERldmljZVNlbGVjdG9yLCB7IGRldmljZXM6IGRldmljZXMsIHR5cGU6IFwiYXVkaW9vdXRwdXRcIiwgc2VsZWN0ZWREZXZpY2VJZDogc2VsZWN0ZWREZXZpY2UsIG9uQ2hhbmdlOiAoZGV2aWNlSWQpID0+IHtcbiAgICAgICAgICAgIHNwZWFrZXIuc2VsZWN0KGRldmljZUlkKTtcbiAgICAgICAgfSwgdGl0bGU6IHRpdGxlLCB2aXN1YWxUeXBlOiB2aXN1YWxUeXBlLCBpY29uOiBcInNwZWFrZXJcIiB9KSk7XG59O1xuXG5jb25zdCBEZXZpY2VTZWxlY3RvclZpZGVvID0gKHsgdGl0bGUsIHZpc3VhbFR5cGUsIH0pID0+IHtcbiAgICBjb25zdCB7IHVzZUNhbWVyYVN0YXRlIH0gPSB1c2VDYWxsU3RhdGVIb29rcygpO1xuICAgIGNvbnN0IHsgY2FtZXJhLCBkZXZpY2VzLCBzZWxlY3RlZERldmljZSB9ID0gdXNlQ2FtZXJhU3RhdGUoKTtcbiAgICByZXR1cm4gKGpzeChEZXZpY2VTZWxlY3RvciwgeyBkZXZpY2VzOiBkZXZpY2VzIHx8IFtdLCB0eXBlOiBcInZpZGVvaW5wdXRcIiwgc2VsZWN0ZWREZXZpY2VJZDogc2VsZWN0ZWREZXZpY2UsIG9uQ2hhbmdlOiBhc3luYyAoZGV2aWNlSWQpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IGNhbWVyYS5zZWxlY3QoZGV2aWNlSWQpO1xuICAgICAgICB9LCB0aXRsZTogdGl0bGUsIHZpc3VhbFR5cGU6IHZpc3VhbFR5cGUsIGljb246IFwiY2FtZXJhXCIgfSkpO1xufTtcblxuY29uc3QgRGV2aWNlU2V0dGluZ3MgPSAoeyB2aXN1YWxUeXBlID0gTWVudVZpc3VhbFR5cGUuTUVOVSwgfSkgPT4ge1xuICAgIHJldHVybiAoanN4KE1lbnVUb2dnbGUsIHsgcGxhY2VtZW50OiBcImJvdHRvbS1lbmRcIiwgVG9nZ2xlQnV0dG9uOiBUb2dnbGVEZXZpY2VTZXR0aW5nc01lbnVCdXR0b24sIHZpc3VhbFR5cGU6IHZpc3VhbFR5cGUsIGNoaWxkcmVuOiBqc3goTWVudSwge30pIH0pKTtcbn07XG5jb25zdCBNZW51ID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgdCB9ID0gdXNlSTE4bigpO1xuICAgIHJldHVybiAoanN4cyhcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2RldmljZS1zZXR0aW5nc1wiLCBjaGlsZHJlbjogW2pzeChEZXZpY2VTZWxlY3RvclZpZGVvLCB7IHRpdGxlOiB0KCdTZWxlY3QgYSBDYW1lcmEnKSB9KSwganN4KERldmljZVNlbGVjdG9yQXVkaW9JbnB1dCwgeyB0aXRsZTogdCgnU2VsZWN0IGEgTWljJykgfSksIGpzeChEZXZpY2VTZWxlY3RvckF1ZGlvT3V0cHV0LCB7IHRpdGxlOiB0KCdTZWxlY3QgU3BlYWtlcnMnKSB9KV0gfSkpO1xufTtcbmNvbnN0IFRvZ2dsZURldmljZVNldHRpbmdzTWVudUJ1dHRvbiA9IGZvcndhcmRSZWYoZnVuY3Rpb24gVG9nZ2xlRGV2aWNlU2V0dGluZ3NNZW51QnV0dG9uKHsgbWVudVNob3duIH0sIHJlZikge1xuICAgIGNvbnN0IHsgdCB9ID0gdXNlSTE4bigpO1xuICAgIHJldHVybiAoanN4KEljb25CdXR0b24sIHsgY2xhc3NOYW1lOiBjbHN4KCdzdHItdmlkZW9fX2RldmljZS1zZXR0aW5nc19fYnV0dG9uJywge1xuICAgICAgICAgICAgJ3N0ci12aWRlb19fZGV2aWNlLXNldHRpbmdzX19idXR0b24tLWFjdGl2ZSc6IG1lbnVTaG93bixcbiAgICAgICAgfSksIHRpdGxlOiB0KCdUb2dnbGUgZGV2aWNlIG1lbnUnKSwgaWNvbjogXCJkZXZpY2Utc2V0dGluZ3NcIiwgcmVmOiByZWYgfSkpO1xufSk7XG5cbmNvbnN0IFRvZ2dsZUF1ZGlvUHJldmlld0J1dHRvbiA9IChwcm9wcykgPT4ge1xuICAgIGNvbnN0IHsgY2FwdGlvbiwgTWVudSwgbWVudVBsYWNlbWVudCwgLi4ucmVzdENvbXBvc2l0ZUJ1dHRvblByb3BzIH0gPSBwcm9wcztcbiAgICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcbiAgICBjb25zdCB7IHVzZU1pY3JvcGhvbmVTdGF0ZSB9ID0gdXNlQ2FsbFN0YXRlSG9va3MoKTtcbiAgICBjb25zdCB7IG1pY3JvcGhvbmUsIGlzTXV0ZSwgaGFzQnJvd3NlclBlcm1pc3Npb24gfSA9IHVzZU1pY3JvcGhvbmVTdGF0ZSgpO1xuICAgIHJldHVybiAoanN4cyhDb21wb3NpdGVCdXR0b24sIHsgYWN0aXZlOiBpc011dGUsIGNhcHRpb246IGNhcHRpb24sIGNsYXNzTmFtZTogY2xzeCghaGFzQnJvd3NlclBlcm1pc3Npb24gJiYgJ3N0ci12aWRlb19fZGV2aWNlLXVuYXZhaWxhYmxlJyksIHZhcmlhbnQ6IFwic2Vjb25kYXJ5XCIsIHRpdGxlOiAhaGFzQnJvd3NlclBlcm1pc3Npb25cbiAgICAgICAgICAgID8gdCgnQ2hlY2sgeW91ciBicm93c2VyIGF1ZGlvIHBlcm1pc3Npb25zJylcbiAgICAgICAgICAgIDogY2FwdGlvbiB8fCB0KCdNaWMnKSwgZGlzYWJsZWQ6ICFoYXNCcm93c2VyUGVybWlzc2lvbiwgXCJkYXRhLXRlc3RpZFwiOiBpc011dGUgPyAncHJldmlldy1hdWRpby11bm11dGUtYnV0dG9uJyA6ICdwcmV2aWV3LWF1ZGlvLW11dGUtYnV0dG9uJywgb25DbGljazogKCkgPT4gbWljcm9waG9uZS50b2dnbGUoKSwgTWVudTogTWVudSwgbWVudVBsYWNlbWVudDogbWVudVBsYWNlbWVudCwgLi4ucmVzdENvbXBvc2l0ZUJ1dHRvblByb3BzLCBjaGlsZHJlbjogW2pzeChJY29uLCB7IGljb246ICFpc011dGUgPyAnbWljJyA6ICdtaWMtb2ZmJyB9KSwgIWhhc0Jyb3dzZXJQZXJtaXNzaW9uICYmIChqc3goXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fbm8tbWVkaWEtcGVybWlzc2lvblwiLCB0aXRsZTogdCgnQ2hlY2sgeW91ciBicm93c2VyIGF1ZGlvIHBlcm1pc3Npb25zJyksIGNoaWxkcmVuOiBcIiFcIiB9KSldIH0pKTtcbn07XG5jb25zdCBUb2dnbGVBdWRpb1B1Ymxpc2hpbmdCdXR0b24gPSAocHJvcHMpID0+IHtcbiAgICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcbiAgICBjb25zdCB7IGNhcHRpb24sIE1lbnUgPSBqc3goRGV2aWNlU2VsZWN0b3JBdWRpb0lucHV0LCB7IHZpc3VhbFR5cGU6IFwibGlzdFwiIH0pLCBtZW51UGxhY2VtZW50ID0gJ3RvcCcsIC4uLnJlc3RDb21wb3NpdGVCdXR0b25Qcm9wcyB9ID0gcHJvcHM7XG4gICAgY29uc3QgeyBoYXNQZXJtaXNzaW9uLCByZXF1ZXN0UGVybWlzc2lvbiwgaXNBd2FpdGluZ1Blcm1pc3Npb24gfSA9IHVzZVJlcXVlc3RQZXJtaXNzaW9uKE93bkNhcGFiaWxpdHkuU0VORF9BVURJTyk7XG4gICAgY29uc3QgeyB1c2VNaWNyb3Bob25lU3RhdGUgfSA9IHVzZUNhbGxTdGF0ZUhvb2tzKCk7XG4gICAgY29uc3QgeyBtaWNyb3Bob25lLCBpc011dGUsIGhhc0Jyb3dzZXJQZXJtaXNzaW9uIH0gPSB1c2VNaWNyb3Bob25lU3RhdGUoKTtcbiAgICByZXR1cm4gKGpzeChSZXN0cmljdGVkLCB7IHJlcXVpcmVkR3JhbnRzOiBbT3duQ2FwYWJpbGl0eS5TRU5EX0FVRElPXSwgY2hpbGRyZW46IGpzeChQZXJtaXNzaW9uTm90aWZpY2F0aW9uLCB7IHBlcm1pc3Npb246IE93bkNhcGFiaWxpdHkuU0VORF9BVURJTywgaXNBd2FpdGluZ0FwcHJvdmFsOiBpc0F3YWl0aW5nUGVybWlzc2lvbiwgbWVzc2FnZUFwcHJvdmVkOiB0KCdZb3UgY2FuIG5vdyBzcGVhay4nKSwgbWVzc2FnZUF3YWl0aW5nQXBwcm92YWw6IHQoJ0F3YWl0aW5nIGZvciBhbiBhcHByb3ZhbCB0byBzcGVhay4nKSwgbWVzc2FnZVJldm9rZWQ6IHQoJ1lvdSBjYW4gbm8gbG9uZ2VyIHNwZWFrLicpLCBjaGlsZHJlbjoganN4cyhDb21wb3NpdGVCdXR0b24sIHsgYWN0aXZlOiBpc011dGUsIGNhcHRpb246IGNhcHRpb24sIHRpdGxlOiAhaGFzUGVybWlzc2lvblxuICAgICAgICAgICAgICAgICAgICA/IHQoJ1lvdSBoYXZlIG5vIHBlcm1pc3Npb24gdG8gc2hhcmUgeW91ciBhdWRpbycpXG4gICAgICAgICAgICAgICAgICAgIDogIWhhc0Jyb3dzZXJQZXJtaXNzaW9uXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHQoJ0NoZWNrIHlvdXIgYnJvd3NlciBtaWMgcGVybWlzc2lvbnMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBjYXB0aW9uIHx8IHQoJ01pYycpLCB2YXJpYW50OiBcInNlY29uZGFyeVwiLCBkaXNhYmxlZDogIWhhc0Jyb3dzZXJQZXJtaXNzaW9uIHx8ICFoYXNQZXJtaXNzaW9uLCBcImRhdGEtdGVzdGlkXCI6IGlzTXV0ZSA/ICdhdWRpby11bm11dGUtYnV0dG9uJyA6ICdhdWRpby1tdXRlLWJ1dHRvbicsIG9uQ2xpY2s6IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXNQZXJtaXNzaW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCByZXF1ZXN0UGVybWlzc2lvbigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbWljcm9waG9uZS50b2dnbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIE1lbnU6IE1lbnUsIG1lbnVQbGFjZW1lbnQ6IG1lbnVQbGFjZW1lbnQsIG1lbnVPZmZzZXQ6IDE2LCAuLi5yZXN0Q29tcG9zaXRlQnV0dG9uUHJvcHMsIGNoaWxkcmVuOiBbanN4KEljb24sIHsgaWNvbjogaXNNdXRlID8gJ21pYy1vZmYnIDogJ21pYycgfSksICghaGFzQnJvd3NlclBlcm1pc3Npb24gfHwgIWhhc1Blcm1pc3Npb24pICYmIChqc3goXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fbm8tbWVkaWEtcGVybWlzc2lvblwiLCBjaGlsZHJlbjogXCIhXCIgfSkpXSB9KSB9KSB9KSk7XG59O1xuXG5jb25zdCBUb2dnbGVWaWRlb1ByZXZpZXdCdXR0b24gPSAocHJvcHMpID0+IHtcbiAgICBjb25zdCB7IGNhcHRpb24sIE1lbnUgPSBEZXZpY2VTZWxlY3RvclZpZGVvLCBtZW51UGxhY2VtZW50ID0gJ3RvcCcsIC4uLnJlc3RDb21wb3NpdGVCdXR0b25Qcm9wcyB9ID0gcHJvcHM7XG4gICAgY29uc3QgeyB0IH0gPSB1c2VJMThuKCk7XG4gICAgY29uc3QgeyB1c2VDYW1lcmFTdGF0ZSB9ID0gdXNlQ2FsbFN0YXRlSG9va3MoKTtcbiAgICBjb25zdCB7IGNhbWVyYSwgaXNNdXRlLCBoYXNCcm93c2VyUGVybWlzc2lvbiB9ID0gdXNlQ2FtZXJhU3RhdGUoKTtcbiAgICByZXR1cm4gKGpzeHMoQ29tcG9zaXRlQnV0dG9uLCB7IGFjdGl2ZTogaXNNdXRlLCBjYXB0aW9uOiBjYXB0aW9uLCBjbGFzc05hbWU6IGNsc3goIWhhc0Jyb3dzZXJQZXJtaXNzaW9uICYmICdzdHItdmlkZW9fX2RldmljZS11bmF2YWlsYWJsZScpLCB0aXRsZTogIWhhc0Jyb3dzZXJQZXJtaXNzaW9uXG4gICAgICAgICAgICA/IHQoJ0NoZWNrIHlvdXIgYnJvd3NlciB2aWRlbyBwZXJtaXNzaW9ucycpXG4gICAgICAgICAgICA6IGNhcHRpb24gfHwgdCgnVmlkZW8nKSwgdmFyaWFudDogXCJzZWNvbmRhcnlcIiwgXCJkYXRhLXRlc3RpZFwiOiBpc011dGUgPyAncHJldmlldy12aWRlby11bm11dGUtYnV0dG9uJyA6ICdwcmV2aWV3LXZpZGVvLW11dGUtYnV0dG9uJywgb25DbGljazogKCkgPT4gY2FtZXJhLnRvZ2dsZSgpLCBkaXNhYmxlZDogIWhhc0Jyb3dzZXJQZXJtaXNzaW9uLCBNZW51OiBNZW51LCBtZW51UGxhY2VtZW50OiBtZW51UGxhY2VtZW50LCAuLi5yZXN0Q29tcG9zaXRlQnV0dG9uUHJvcHMsIGNoaWxkcmVuOiBbanN4KEljb24sIHsgaWNvbjogIWlzTXV0ZSA/ICdjYW1lcmEnIDogJ2NhbWVyYS1vZmYnIH0pLCAhaGFzQnJvd3NlclBlcm1pc3Npb24gJiYgKGpzeChcInNwYW5cIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19uby1tZWRpYS1wZXJtaXNzaW9uXCIsIHRpdGxlOiB0KCdDaGVjayB5b3VyIGJyb3dzZXIgdmlkZW8gcGVybWlzc2lvbnMnKSwgY2hpbGRyZW46IFwiIVwiIH0pKV0gfSkpO1xufTtcbmNvbnN0IFRvZ2dsZVZpZGVvUHVibGlzaGluZ0J1dHRvbiA9IChwcm9wcykgPT4ge1xuICAgIGNvbnN0IHsgdCB9ID0gdXNlSTE4bigpO1xuICAgIGNvbnN0IHsgY2FwdGlvbiwgTWVudSA9IGpzeChEZXZpY2VTZWxlY3RvclZpZGVvLCB7IHZpc3VhbFR5cGU6IFwibGlzdFwiIH0pLCBtZW51UGxhY2VtZW50ID0gJ3RvcCcsIC4uLnJlc3RDb21wb3NpdGVCdXR0b25Qcm9wcyB9ID0gcHJvcHM7XG4gICAgY29uc3QgeyBoYXNQZXJtaXNzaW9uLCByZXF1ZXN0UGVybWlzc2lvbiwgaXNBd2FpdGluZ1Blcm1pc3Npb24gfSA9IHVzZVJlcXVlc3RQZXJtaXNzaW9uKE93bkNhcGFiaWxpdHkuU0VORF9WSURFTyk7XG4gICAgY29uc3QgeyB1c2VDYW1lcmFTdGF0ZSwgdXNlQ2FsbFNldHRpbmdzIH0gPSB1c2VDYWxsU3RhdGVIb29rcygpO1xuICAgIGNvbnN0IHsgY2FtZXJhLCBpc011dGUsIGhhc0Jyb3dzZXJQZXJtaXNzaW9uIH0gPSB1c2VDYW1lcmFTdGF0ZSgpO1xuICAgIGNvbnN0IGNhbGxTZXR0aW5ncyA9IHVzZUNhbGxTZXR0aW5ncygpO1xuICAgIGNvbnN0IGlzUHVibGlzaGluZ1ZpZGVvQWxsb3dlZCA9IGNhbGxTZXR0aW5ncz8udmlkZW8uZW5hYmxlZDtcbiAgICByZXR1cm4gKGpzeChSZXN0cmljdGVkLCB7IHJlcXVpcmVkR3JhbnRzOiBbT3duQ2FwYWJpbGl0eS5TRU5EX1ZJREVPXSwgY2hpbGRyZW46IGpzeChQZXJtaXNzaW9uTm90aWZpY2F0aW9uLCB7IHBlcm1pc3Npb246IE93bkNhcGFiaWxpdHkuU0VORF9WSURFTywgaXNBd2FpdGluZ0FwcHJvdmFsOiBpc0F3YWl0aW5nUGVybWlzc2lvbiwgbWVzc2FnZUFwcHJvdmVkOiB0KCdZb3UgY2FuIG5vdyBzaGFyZSB5b3VyIHZpZGVvLicpLCBtZXNzYWdlQXdhaXRpbmdBcHByb3ZhbDogdCgnQXdhaXRpbmcgZm9yIGFuIGFwcHJvdmFsIHRvIHNoYXJlIHlvdXIgdmlkZW8uJyksIG1lc3NhZ2VSZXZva2VkOiB0KCdZb3UgY2FuIG5vIGxvbmdlciBzaGFyZSB5b3VyIHZpZGVvLicpLCBjaGlsZHJlbjoganN4cyhDb21wb3NpdGVCdXR0b24sIHsgYWN0aXZlOiBpc011dGUsIGNhcHRpb246IGNhcHRpb24sIHZhcmlhbnQ6IFwic2Vjb25kYXJ5XCIsIHRpdGxlOiAhaGFzUGVybWlzc2lvblxuICAgICAgICAgICAgICAgICAgICA/IHQoJ1lvdSBoYXZlIG5vIHBlcm1pc3Npb24gdG8gc2hhcmUgeW91ciB2aWRlbycpXG4gICAgICAgICAgICAgICAgICAgIDogIWhhc0Jyb3dzZXJQZXJtaXNzaW9uXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHQoJ0NoZWNrIHlvdXIgYnJvd3NlciB2aWRlbyBwZXJtaXNzaW9ucycpXG4gICAgICAgICAgICAgICAgICAgICAgICA6ICFpc1B1Ymxpc2hpbmdWaWRlb0FsbG93ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHQoJ1ZpZGVvIHB1Ymxpc2hpbmcgaXMgZGlzYWJsZWQgYnkgdGhlIHN5c3RlbScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBjYXB0aW9uIHx8IHQoJ1ZpZGVvJyksIGRpc2FibGVkOiAhaGFzQnJvd3NlclBlcm1pc3Npb24gfHwgIWhhc1Blcm1pc3Npb24gfHwgIWlzUHVibGlzaGluZ1ZpZGVvQWxsb3dlZCwgXCJkYXRhLXRlc3RpZFwiOiBpc011dGUgPyAndmlkZW8tdW5tdXRlLWJ1dHRvbicgOiAndmlkZW8tbXV0ZS1idXR0b24nLCBvbkNsaWNrOiBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaGFzUGVybWlzc2lvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgcmVxdWVzdFBlcm1pc3Npb24oKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGNhbWVyYS50b2dnbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIE1lbnU6IE1lbnUsIG1lbnVQbGFjZW1lbnQ6IG1lbnVQbGFjZW1lbnQsIG1lbnVPZmZzZXQ6IDE2LCAuLi5yZXN0Q29tcG9zaXRlQnV0dG9uUHJvcHMsIGNoaWxkcmVuOiBbanN4KEljb24sIHsgaWNvbjogaXNNdXRlID8gJ2NhbWVyYS1vZmYnIDogJ2NhbWVyYScgfSksICghaGFzQnJvd3NlclBlcm1pc3Npb24gfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICFoYXNQZXJtaXNzaW9uIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAhaXNQdWJsaXNoaW5nVmlkZW9BbGxvd2VkKSAmJiAoanN4KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX25vLW1lZGlhLXBlcm1pc3Npb25cIiwgY2hpbGRyZW46IFwiIVwiIH0pKV0gfSkgfSkgfSkpO1xufTtcblxuY29uc3QgRW5kQ2FsbE1lbnUgPSAocHJvcHMpID0+IHtcbiAgICBjb25zdCB7IG9uTGVhdmUsIG9uRW5kIH0gPSBwcm9wcztcbiAgICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcbiAgICByZXR1cm4gKGpzeHMoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19lbmQtY2FsbF9fY29uZmlybWF0aW9uXCIsIGNoaWxkcmVuOiBbanN4cyhcImJ1dHRvblwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2J1dHRvbiBzdHItdmlkZW9fX2VuZC1jYWxsX19sZWF2ZVwiLCB0eXBlOiBcImJ1dHRvblwiLCBcImRhdGEtdGVzdGlkXCI6IFwibGVhdmUtY2FsbC1idXR0b25cIiwgb25DbGljazogb25MZWF2ZSwgY2hpbGRyZW46IFtqc3goSWNvbiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19idXR0b25fX2ljb24gc3RyLXZpZGVvX19lbmQtY2FsbF9fbGVhdmUtaWNvblwiLCBpY29uOiBcImxvZ291dFwiIH0pLCB0KCdMZWF2ZSBjYWxsJyldIH0pLCBqc3goUmVzdHJpY3RlZCwgeyByZXF1aXJlZEdyYW50czogW093bkNhcGFiaWxpdHkuRU5EX0NBTExdLCBjaGlsZHJlbjoganN4cyhcImJ1dHRvblwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2J1dHRvbiBzdHItdmlkZW9fX2VuZC1jYWxsX19lbmRcIiwgdHlwZTogXCJidXR0b25cIiwgXCJkYXRhLXRlc3RpZFwiOiBcImVuZC1jYWxsLWZvci1hbGwtYnV0dG9uXCIsIG9uQ2xpY2s6IG9uRW5kLCBjaGlsZHJlbjogW2pzeChJY29uLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2J1dHRvbl9faWNvbiBzdHItdmlkZW9fX2VuZC1jYWxsX19lbmQtaWNvblwiLCBpY29uOiBcImNhbGwtZW5kXCIgfSksIHQoJ0VuZCBjYWxsIGZvciBhbGwnKV0gfSkgfSldIH0pKTtcbn07XG5jb25zdCBDYW5jZWxDYWxsVG9nZ2xlTWVudUJ1dHRvbiA9IGZvcndhcmRSZWYoZnVuY3Rpb24gQ2FuY2VsQ2FsbFRvZ2dsZU1lbnVCdXR0b24ocHJvcHMsIHJlZikge1xuICAgIGNvbnN0IHsgdCB9ID0gdXNlSTE4bigpO1xuICAgIHJldHVybiAoanN4KEljb25CdXR0b24sIHsgaWNvbjogXCJjYWxsLWVuZFwiLCB2YXJpYW50OiBcImRhbmdlclwiLCB0aXRsZTogdCgnTGVhdmUgY2FsbCcpLCBcImRhdGEtdGVzdGlkXCI6IFwibGVhdmUtY2FsbC1idXR0b25cIiwgcmVmOiByZWYgfSkpO1xufSk7XG5jb25zdCBDYW5jZWxDYWxsQ29uZmlybUJ1dHRvbiA9ICh7IG9uQ2xpY2ssIG9uTGVhdmUsIH0pID0+IHtcbiAgICBjb25zdCBjYWxsID0gdXNlQ2FsbCgpO1xuICAgIGNvbnN0IGhhbmRsZUxlYXZlID0gdXNlQ2FsbGJhY2soYXN5bmMgKGUpID0+IHtcbiAgICAgICAgaWYgKG9uQ2xpY2spIHtcbiAgICAgICAgICAgIG9uQ2xpY2soZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY2FsbCkge1xuICAgICAgICAgICAgYXdhaXQgY2FsbC5sZWF2ZSgpO1xuICAgICAgICAgICAgb25MZWF2ZT8uKCk7XG4gICAgICAgIH1cbiAgICB9LCBbb25DbGljaywgb25MZWF2ZSwgY2FsbF0pO1xuICAgIGNvbnN0IGhhbmRsZUVuZENhbGwgPSB1c2VDYWxsYmFjayhhc3luYyAoZSkgPT4ge1xuICAgICAgICBpZiAob25DbGljaykge1xuICAgICAgICAgICAgb25DbGljayhlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjYWxsKSB7XG4gICAgICAgICAgICBhd2FpdCBjYWxsLmVuZENhbGwoKTtcbiAgICAgICAgICAgIG9uTGVhdmU/LigpO1xuICAgICAgICB9XG4gICAgfSwgW29uQ2xpY2ssIG9uTGVhdmUsIGNhbGxdKTtcbiAgICByZXR1cm4gKGpzeChNZW51VG9nZ2xlLCB7IHBsYWNlbWVudDogXCJ0b3Atc3RhcnRcIiwgVG9nZ2xlQnV0dG9uOiBDYW5jZWxDYWxsVG9nZ2xlTWVudUJ1dHRvbiwgY2hpbGRyZW46IGpzeChFbmRDYWxsTWVudSwgeyBvbkVuZDogaGFuZGxlRW5kQ2FsbCwgb25MZWF2ZTogaGFuZGxlTGVhdmUgfSkgfSkpO1xufTtcbmNvbnN0IENhbmNlbENhbGxCdXR0b24gPSAoeyBkaXNhYmxlZCwgb25DbGljaywgb25MZWF2ZSwgfSkgPT4ge1xuICAgIGNvbnN0IGNhbGwgPSB1c2VDYWxsKCk7XG4gICAgY29uc3QgeyB0IH0gPSB1c2VJMThuKCk7XG4gICAgY29uc3QgaGFuZGxlQ2xpY2sgPSB1c2VDYWxsYmFjayhhc3luYyAoZSkgPT4ge1xuICAgICAgICBpZiAob25DbGljaykge1xuICAgICAgICAgICAgb25DbGljayhlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjYWxsKSB7XG4gICAgICAgICAgICBhd2FpdCBjYWxsLmxlYXZlKCk7XG4gICAgICAgICAgICBvbkxlYXZlPy4oKTtcbiAgICAgICAgfVxuICAgIH0sIFtvbkNsaWNrLCBvbkxlYXZlLCBjYWxsXSk7XG4gICAgcmV0dXJuIChqc3goSWNvbkJ1dHRvbiwgeyBkaXNhYmxlZDogZGlzYWJsZWQsIGljb246IFwiY2FsbC1lbmRcIiwgdmFyaWFudDogXCJkYW5nZXJcIiwgdGl0bGU6IHQoJ0xlYXZlIGNhbGwnKSwgXCJkYXRhLXRlc3RpZFwiOiBcImNhbmNlbC1jYWxsLWJ1dHRvblwiLCBvbkNsaWNrOiBoYW5kbGVDbGljayB9KSk7XG59O1xuXG5jb25zdCBDYWxsQ29udHJvbHMgPSAoeyBvbkxlYXZlIH0pID0+IChqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY2FsbC1jb250cm9sc1wiLCBjaGlsZHJlbjogW2pzeChSZWNvcmRDYWxsQnV0dG9uLCB7fSksIGpzeChSZWFjdGlvbnNCdXR0b24sIHt9KSwganN4KFNjcmVlblNoYXJlQnV0dG9uLCB7fSksIGpzeChTcGVha2luZ1doaWxlTXV0ZWROb3RpZmljYXRpb24sIHsgY2hpbGRyZW46IGpzeChUb2dnbGVBdWRpb1B1Ymxpc2hpbmdCdXR0b24sIHt9KSB9KSwganN4KFRvZ2dsZVZpZGVvUHVibGlzaGluZ0J1dHRvbiwge30pLCBqc3goQ2FuY2VsQ2FsbEJ1dHRvbiwgeyBvbkxlYXZlOiBvbkxlYXZlIH0pXSB9KSk7XG5cbkNoYXJ0LnJlZ2lzdGVyKENhdGVnb3J5U2NhbGUsIExpbmVhclNjYWxlLCBMaW5lRWxlbWVudCwgUG9pbnRFbGVtZW50KTtcbmNvbnN0IENhbGxTdGF0c0xhdGVuY3lDaGFydCA9IChwcm9wcykgPT4ge1xuICAgIGNvbnN0IHsgdmFsdWVzIH0gPSBwcm9wcztcbiAgICBsZXQgbWF4ID0gMDtcbiAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICBsYWJlbHM6IHZhbHVlcy5tYXAoKHBvaW50KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUocG9pbnQueCAqIDEwMDApO1xuICAgICAgICAgICAgcmV0dXJuIGAke2RhdGUuZ2V0SG91cnMoKX06JHtkYXRlLmdldE1pbnV0ZXMoKX1gO1xuICAgICAgICB9KSxcbiAgICAgICAgZGF0YXNldHM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBkYXRhOiB2YWx1ZXMubWFwKChwb2ludCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHkgfSA9IHBvaW50O1xuICAgICAgICAgICAgICAgICAgICBtYXggPSBNYXRoLm1heChtYXgsIHkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG9pbnQ7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgYm9yZGVyQ29sb3I6ICcjMDBlMmExJyxcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjMDBlMmExJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgfTtcbiAgICBjb25zdCBvcHRpb25zID0gdXNlTWVtbygoKSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBtYWludGFpbkFzcGVjdFJhdGlvOiBmYWxzZSxcbiAgICAgICAgICAgIGFuaW1hdGlvbjoge1xuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAwLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVsZW1lbnRzOiB7XG4gICAgICAgICAgICAgICAgbGluZToge1xuICAgICAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHBvaW50OiB7XG4gICAgICAgICAgICAgICAgICAgIHJhZGl1czogMixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNjYWxlczoge1xuICAgICAgICAgICAgICAgIHk6IHtcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdyaWdodCcsXG4gICAgICAgICAgICAgICAgICAgIHN0YWNrZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG1pbjogMCxcbiAgICAgICAgICAgICAgICAgICAgbWF4OiBNYXRoLm1heCgxODAsIE1hdGguY2VpbCgobWF4ICsgMTApIC8gMTApICogMTApLFxuICAgICAgICAgICAgICAgICAgICBncmlkOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjOTc5Y2EwJyxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdGlja3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXBTaXplOiAzMCxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHg6IHtcbiAgICAgICAgICAgICAgICAgICAgZ3JpZDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHRpY2tzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICB9LCBbbWF4XSk7XG4gICAgcmV0dXJuIChqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLXN0YXRzLWxpbmUtY2hhcnQtY29udGFpbmVyXCIsIGNoaWxkcmVuOiBqc3goTGluZSwgeyBvcHRpb25zOiBvcHRpb25zLCBkYXRhOiBkYXRhLCBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLXN0YXRzX19sYXRlbmN5Y2hhcnRcIiB9KSB9KSk7XG59O1xuXG52YXIgU3RhdHVzZXM7XG4oZnVuY3Rpb24gKFN0YXR1c2VzKSB7XG4gICAgU3RhdHVzZXNbXCJHT09EXCJdID0gXCJHb29kXCI7XG4gICAgU3RhdHVzZXNbXCJPS1wiXSA9IFwiT2tcIjtcbiAgICBTdGF0dXNlc1tcIkJBRFwiXSA9IFwiQmFkXCI7XG59KShTdGF0dXNlcyB8fCAoU3RhdHVzZXMgPSB7fSkpO1xuY29uc3Qgc3RhdHNTdGF0dXMgPSAoeyB2YWx1ZSwgbG93Qm91bmQsIGhpZ2hCb3VuZCwgfSkgPT4ge1xuICAgIGlmICh2YWx1ZSA8PSBsb3dCb3VuZCkge1xuICAgICAgICByZXR1cm4gU3RhdHVzZXMuR09PRDtcbiAgICB9XG4gICAgaWYgKHZhbHVlID49IGxvd0JvdW5kICYmIHZhbHVlIDw9IGhpZ2hCb3VuZCkge1xuICAgICAgICByZXR1cm4gU3RhdHVzZXMuT0s7XG4gICAgfVxuICAgIGlmICh2YWx1ZSA+PSBoaWdoQm91bmQpIHtcbiAgICAgICAgcmV0dXJuIFN0YXR1c2VzLkJBRDtcbiAgICB9XG4gICAgcmV0dXJuIFN0YXR1c2VzLkdPT0Q7XG59O1xuY29uc3QgQ2FsbFN0YXRzID0gKHByb3BzKSA9PiB7XG4gICAgY29uc3QgeyBsYXRlbmN5TG93Qm91bmQgPSA3NSwgbGF0ZW5jeUhpZ2hCb3VuZCA9IDQwMCB9ID0gcHJvcHM7XG4gICAgY29uc3QgW2xhdGVuY3lCdWZmZXIsIHNldExhdGVuY3lCdWZmZXJdID0gdXNlU3RhdGUoKCkgPT4ge1xuICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogMjAgfSwgKF8sIGkpID0+ICh7IHg6IG5vdyArIGksIHk6IDAgfSkpO1xuICAgIH0pO1xuICAgIGNvbnN0IHsgdCB9ID0gdXNlSTE4bigpO1xuICAgIGNvbnN0IFtwdWJsaXNoQml0cmF0ZSwgc2V0UHVibGlzaEJpdHJhdGVdID0gdXNlU3RhdGUoJy0nKTtcbiAgICBjb25zdCBbc3Vic2NyaWJlQml0cmF0ZSwgc2V0U3Vic2NyaWJlQml0cmF0ZV0gPSB1c2VTdGF0ZSgnLScpO1xuICAgIGNvbnN0IHByZXZpb3VzU3RhdHMgPSB1c2VSZWYoKTtcbiAgICBjb25zdCB7IHVzZUNhbGxTdGF0c1JlcG9ydCB9ID0gdXNlQ2FsbFN0YXRlSG9va3MoKTtcbiAgICBjb25zdCBjYWxsU3RhdHNSZXBvcnQgPSB1c2VDYWxsU3RhdHNSZXBvcnQoKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoIWNhbGxTdGF0c1JlcG9ydClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKCFwcmV2aW91c1N0YXRzLmN1cnJlbnQpIHtcbiAgICAgICAgICAgIHByZXZpb3VzU3RhdHMuY3VycmVudCA9IGNhbGxTdGF0c1JlcG9ydDtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwcmV2aW91c0NhbGxTdGF0c1JlcG9ydCA9IHByZXZpb3VzU3RhdHMuY3VycmVudDtcbiAgICAgICAgc2V0UHVibGlzaEJpdHJhdGUoKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGN1bGF0ZVB1Ymxpc2hCaXRyYXRlKHByZXZpb3VzQ2FsbFN0YXRzUmVwb3J0LCBjYWxsU3RhdHNSZXBvcnQpO1xuICAgICAgICB9KTtcbiAgICAgICAgc2V0U3Vic2NyaWJlQml0cmF0ZSgoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gY2FsY3VsYXRlU3Vic2NyaWJlQml0cmF0ZShwcmV2aW91c0NhbGxTdGF0c1JlcG9ydCwgY2FsbFN0YXRzUmVwb3J0KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHNldExhdGVuY3lCdWZmZXIoKGxhdGVuY3lCdWYpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0xhdGVuY3lCdWZmZXIgPSBsYXRlbmN5QnVmLnNsaWNlKC0xOSk7XG4gICAgICAgICAgICBuZXdMYXRlbmN5QnVmZmVyLnB1c2goe1xuICAgICAgICAgICAgICAgIHg6IGNhbGxTdGF0c1JlcG9ydC50aW1lc3RhbXAsXG4gICAgICAgICAgICAgICAgeTogY2FsbFN0YXRzUmVwb3J0LnB1Ymxpc2hlclN0YXRzLmF2ZXJhZ2VSb3VuZFRyaXBUaW1lSW5NcyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIG5ld0xhdGVuY3lCdWZmZXI7XG4gICAgICAgIH0pO1xuICAgICAgICBwcmV2aW91c1N0YXRzLmN1cnJlbnQgPSBjYWxsU3RhdHNSZXBvcnQ7XG4gICAgfSwgW2NhbGxTdGF0c1JlcG9ydF0pO1xuICAgIGNvbnN0IGxhdGVuY3lDb21wYXJpc29uID0ge1xuICAgICAgICBsb3dCb3VuZDogbGF0ZW5jeUxvd0JvdW5kLFxuICAgICAgICBoaWdoQm91bmQ6IGxhdGVuY3lIaWdoQm91bmQsXG4gICAgICAgIHZhbHVlOiBjYWxsU3RhdHNSZXBvcnQ/LnB1Ymxpc2hlclN0YXRzLmF2ZXJhZ2VSb3VuZFRyaXBUaW1lSW5NcyB8fCAwLFxuICAgIH07XG4gICAgcmV0dXJuIChqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLXN0YXRzXCIsIGNoaWxkcmVuOiBjYWxsU3RhdHNSZXBvcnQgJiYgKGpzeHMoRnJhZ21lbnQsIHsgY2hpbGRyZW46IFtqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY2FsbC1zdGF0c19faGVhZGVyXCIsIGNoaWxkcmVuOiBbanN4cyhcImgzXCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY2FsbC1zdGF0c19faGVhZGluZ1wiLCBjaGlsZHJlbjogW2pzeChJY29uLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2NhbGwtc3RhdHNfX2ljb25cIiwgaWNvbjogXCJjYWxsLWxhdGVuY3lcIiB9KSwgdCgnQ2FsbCBMYXRlbmN5JyldIH0pLCBqc3goXCJwXCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY2FsbC1zdGF0c19fZGVzY3JpcHRpb25cIiwgY2hpbGRyZW46IHQoJ1ZlcnkgaGlnaCBsYXRlbmN5IHZhbHVlcyBtYXkgcmVkdWNlIGNhbGwgcXVhbGl0eSwgY2F1c2UgbGFnLCBhbmQgbWFrZSB0aGUgY2FsbCBsZXNzIGVuam95YWJsZS4nKSB9KV0gfSksIGpzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2NhbGwtc3RhdHNfX2xhdGVuY3ljaGFydFwiLCBjaGlsZHJlbjoganN4KENhbGxTdGF0c0xhdGVuY3lDaGFydCwgeyB2YWx1ZXM6IGxhdGVuY3lCdWZmZXIgfSkgfSksIGpzeHMoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLXN0YXRzX19oZWFkZXJcIiwgY2hpbGRyZW46IFtqc3hzKFwiaDNcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLXN0YXRzX19oZWFkaW5nXCIsIGNoaWxkcmVuOiBbanN4KEljb24sIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY2FsbC1zdGF0c19faWNvblwiLCBpY29uOiBcIm5ldHdvcmstcXVhbGl0eVwiIH0pLCB0KCdDYWxsIHBlcmZvcm1hbmNlJyldIH0pLCBqc3goXCJwXCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY2FsbC1zdGF0c19fZGVzY3JpcHRpb25cIiwgY2hpbGRyZW46IHQoJ1ZlcnkgaGlnaCBsYXRlbmN5IHZhbHVlcyBtYXkgcmVkdWNlIGNhbGwgcXVhbGl0eSwgY2F1c2UgbGFnLCBhbmQgbWFrZSB0aGUgY2FsbCBsZXNzIGVuam95YWJsZS4nKSB9KV0gfSksIGpzeHMoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLXN0YXRzX19jYXJkLWNvbnRhaW5lclwiLCBjaGlsZHJlbjogW2pzeChTdGF0Q2FyZCwgeyBsYWJlbDogXCJSZWdpb25cIiwgdmFsdWU6IGNhbGxTdGF0c1JlcG9ydC5kYXRhY2VudGVyIH0pLCBqc3goU3RhdENhcmQsIHsgbGFiZWw6IFwiTGF0ZW5jeVwiLCB2YWx1ZTogYCR7Y2FsbFN0YXRzUmVwb3J0LnB1Ymxpc2hlclN0YXRzLmF2ZXJhZ2VSb3VuZFRyaXBUaW1lSW5Nc30gbXMuYCwgY29tcGFyaXNvbjogbGF0ZW5jeUNvbXBhcmlzb24gfSksIGpzeChTdGF0Q2FyZCwgeyBsYWJlbDogXCJSZWNlaXZlIGppdHRlclwiLCB2YWx1ZTogYCR7Y2FsbFN0YXRzUmVwb3J0LnN1YnNjcmliZXJTdGF0cy5hdmVyYWdlSml0dGVySW5Nc30gbXMuYCwgY29tcGFyaXNvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5sYXRlbmN5Q29tcGFyaXNvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGNhbGxTdGF0c1JlcG9ydC5zdWJzY3JpYmVyU3RhdHMuYXZlcmFnZUppdHRlckluTXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSB9KSwganN4KFN0YXRDYXJkLCB7IGxhYmVsOiBcIlB1Ymxpc2ggaml0dGVyXCIsIHZhbHVlOiBgJHtjYWxsU3RhdHNSZXBvcnQucHVibGlzaGVyU3RhdHMuYXZlcmFnZUppdHRlckluTXN9IG1zLmAsIGNvbXBhcmlzb246IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4ubGF0ZW5jeUNvbXBhcmlzb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBjYWxsU3RhdHNSZXBvcnQucHVibGlzaGVyU3RhdHMuYXZlcmFnZUppdHRlckluTXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSB9KSwganN4KFN0YXRDYXJkLCB7IGxhYmVsOiBcIlB1Ymxpc2ggcmVzb2x1dGlvblwiLCB2YWx1ZTogdG9GcmFtZVNpemUoY2FsbFN0YXRzUmVwb3J0LnB1Ymxpc2hlclN0YXRzKSB9KSwganN4KFN0YXRDYXJkLCB7IGxhYmVsOiBcIlB1Ymxpc2ggcXVhbGl0eSBkcm9wIHJlYXNvblwiLCB2YWx1ZTogY2FsbFN0YXRzUmVwb3J0LnB1Ymxpc2hlclN0YXRzLnF1YWxpdHlMaW1pdGF0aW9uUmVhc29ucyB9KSwganN4KFN0YXRDYXJkLCB7IGxhYmVsOiBcIlJlY2VpdmluZyByZXNvbHV0aW9uXCIsIHZhbHVlOiB0b0ZyYW1lU2l6ZShjYWxsU3RhdHNSZXBvcnQuc3Vic2NyaWJlclN0YXRzKSB9KSwganN4KFN0YXRDYXJkLCB7IGxhYmVsOiBcIlJlY2VpdmUgcXVhbGl0eSBkcm9wIHJlYXNvblwiLCB2YWx1ZTogY2FsbFN0YXRzUmVwb3J0LnN1YnNjcmliZXJTdGF0cy5xdWFsaXR5TGltaXRhdGlvblJlYXNvbnMgfSksIGpzeChTdGF0Q2FyZCwgeyBsYWJlbDogXCJQdWJsaXNoIGJpdHJhdGVcIiwgdmFsdWU6IHB1Ymxpc2hCaXRyYXRlIH0pLCBqc3goU3RhdENhcmQsIHsgbGFiZWw6IFwiUmVjZWl2aW5nIGJpdHJhdGVcIiwgdmFsdWU6IHN1YnNjcmliZUJpdHJhdGUgfSldIH0pXSB9KSkgfSkpO1xufTtcbmNvbnN0IFN0YXRDYXJkRXhwbGFuYXRpb24gPSAocHJvcHMpID0+IHtcbiAgICBjb25zdCB7IGRlc2NyaXB0aW9uIH0gPSBwcm9wcztcbiAgICBjb25zdCBbaXNPcGVuLCBzZXRJc09wZW5dID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IHsgcmVmcywgZmxvYXRpbmdTdHlsZXMsIGNvbnRleHQgfSA9IHVzZUZsb2F0aW5nKHtcbiAgICAgICAgb3BlbjogaXNPcGVuLFxuICAgICAgICBvbk9wZW5DaGFuZ2U6IHNldElzT3BlbixcbiAgICB9KTtcbiAgICBjb25zdCBob3ZlciA9IHVzZUhvdmVyKGNvbnRleHQpO1xuICAgIGNvbnN0IHsgZ2V0UmVmZXJlbmNlUHJvcHMsIGdldEZsb2F0aW5nUHJvcHMgfSA9IHVzZUludGVyYWN0aW9ucyhbaG92ZXJdKTtcbiAgICByZXR1cm4gKGpzeHMoRnJhZ21lbnQsIHsgY2hpbGRyZW46IFtqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLWV4cGxhbmF0aW9uXCIsIHJlZjogcmVmcy5zZXRSZWZlcmVuY2UsIC4uLmdldFJlZmVyZW5jZVByb3BzKCksIGNoaWxkcmVuOiBqc3goSWNvbiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLWV4cGxhbmF0aW9uX19pY29uXCIsIGljb246IFwiaW5mb1wiIH0pIH0pLCBpc09wZW4gJiYgKGpzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2NhbGwtZXhwbGFuYXRpb25fX2Rlc2NyaXB0aW9uXCIsIHJlZjogcmVmcy5zZXRGbG9hdGluZywgc3R5bGU6IGZsb2F0aW5nU3R5bGVzLCAuLi5nZXRGbG9hdGluZ1Byb3BzKCksIGNoaWxkcmVuOiBkZXNjcmlwdGlvbiB9KSldIH0pKTtcbn07XG5jb25zdCBTdGF0c1RhZyA9ICh7IGNoaWxkcmVuLCBzdGF0dXMgPSBTdGF0dXNlcy5HT09ELCB9KSA9PiB7XG4gICAgcmV0dXJuIChqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IGNsc3goJ3N0ci12aWRlb19fY2FsbC1zdGF0c19fdGFnJywge1xuICAgICAgICAgICAgJ3N0ci12aWRlb19fY2FsbC1zdGF0c19fdGFnLS1nb29kJzogc3RhdHVzID09PSBTdGF0dXNlcy5HT09ELFxuICAgICAgICAgICAgJ3N0ci12aWRlb19fY2FsbC1zdGF0c19fdGFnLS1vayc6IHN0YXR1cyA9PT0gU3RhdHVzZXMuT0ssXG4gICAgICAgICAgICAnc3RyLXZpZGVvX19jYWxsLXN0YXRzX190YWctLWJhZCc6IHN0YXR1cyA9PT0gU3RhdHVzZXMuQkFELFxuICAgICAgICB9KSwgY2hpbGRyZW46IGpzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2NhbGwtc3RhdHNfX3RhZ19fdGV4dFwiLCBjaGlsZHJlbjogY2hpbGRyZW4gfSkgfSkpO1xufTtcbmNvbnN0IFN0YXRDYXJkID0gKHByb3BzKSA9PiB7XG4gICAgY29uc3QgeyBsYWJlbCwgdmFsdWUsIGRlc2NyaXB0aW9uLCBjb21wYXJpc29uIH0gPSBwcm9wcztcbiAgICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcbiAgICBjb25zdCBzdGF0dXMgPSBjb21wYXJpc29uID8gc3RhdHNTdGF0dXMoY29tcGFyaXNvbikgOiB1bmRlZmluZWQ7XG4gICAgcmV0dXJuIChqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY2FsbC1zdGF0c19fY2FyZFwiLCBjaGlsZHJlbjogW2pzeHMoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLXN0YXRzX19jYXJkLWNvbnRlbnRcIiwgY2hpbGRyZW46IFtqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY2FsbC1zdGF0c19fY2FyZC1sYWJlbFwiLCBjaGlsZHJlbjogW2xhYmVsLCBkZXNjcmlwdGlvbiAmJiBqc3goU3RhdENhcmRFeHBsYW5hdGlvbiwgeyBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gfSldIH0pLCBqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLXN0YXRzX19jYXJkLXZhbHVlXCIsIGNoaWxkcmVuOiB2YWx1ZSB9KV0gfSksIGNvbXBhcmlzb24gJiYgc3RhdHVzICYmIGpzeChTdGF0c1RhZywgeyBzdGF0dXM6IHN0YXR1cywgY2hpbGRyZW46IHQoc3RhdHVzKSB9KV0gfSkpO1xufTtcbmNvbnN0IHRvRnJhbWVTaXplID0gKHN0YXRzKSA9PiB7XG4gICAgY29uc3QgeyBoaWdoZXN0RnJhbWVXaWR0aDogdywgaGlnaGVzdEZyYW1lSGVpZ2h0OiBoLCBoaWdoZXN0RnJhbWVzUGVyU2Vjb25kOiBmcHMsIH0gPSBzdGF0cztcbiAgICBsZXQgc2l6ZSA9IGAtYDtcbiAgICBpZiAodyAmJiBoKSB7XG4gICAgICAgIHNpemUgPSBgJHt3fXgke2h9YDtcbiAgICAgICAgaWYgKGZwcykge1xuICAgICAgICAgICAgc2l6ZSArPSBgQCR7ZnBzfWZwcy5gO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBzaXplO1xufTtcbmNvbnN0IGNhbGN1bGF0ZVB1Ymxpc2hCaXRyYXRlID0gKHByZXZpb3VzQ2FsbFN0YXRzUmVwb3J0LCBjYWxsU3RhdHNSZXBvcnQpID0+IHtcbiAgICBjb25zdCB7IHB1Ymxpc2hlclN0YXRzOiB7IHRvdGFsQnl0ZXNTZW50OiBwcmV2aW91c1RvdGFsQnl0ZXNTZW50LCB0aW1lc3RhbXA6IHByZXZpb3VzVGltZXN0YW1wLCB9LCB9ID0gcHJldmlvdXNDYWxsU3RhdHNSZXBvcnQ7XG4gICAgY29uc3QgeyBwdWJsaXNoZXJTdGF0czogeyB0b3RhbEJ5dGVzU2VudCwgdGltZXN0YW1wIH0sIH0gPSBjYWxsU3RhdHNSZXBvcnQ7XG4gICAgY29uc3QgYnl0ZXNTZW50ID0gdG90YWxCeXRlc1NlbnQgLSBwcmV2aW91c1RvdGFsQnl0ZXNTZW50O1xuICAgIGNvbnN0IHRpbWVFbGFwc2VkID0gdGltZXN0YW1wIC0gcHJldmlvdXNUaW1lc3RhbXA7XG4gICAgcmV0dXJuIGAkeygoYnl0ZXNTZW50ICogOCkgLyB0aW1lRWxhcHNlZCkudG9GaXhlZCgyKX0ga2Jwc2A7XG59O1xuY29uc3QgY2FsY3VsYXRlU3Vic2NyaWJlQml0cmF0ZSA9IChwcmV2aW91c0NhbGxTdGF0c1JlcG9ydCwgY2FsbFN0YXRzUmVwb3J0KSA9PiB7XG4gICAgY29uc3QgeyBzdWJzY3JpYmVyU3RhdHM6IHsgdG90YWxCeXRlc1JlY2VpdmVkOiBwcmV2aW91c1RvdGFsQnl0ZXNSZWNlaXZlZCwgdGltZXN0YW1wOiBwcmV2aW91c1RpbWVzdGFtcCwgfSwgfSA9IHByZXZpb3VzQ2FsbFN0YXRzUmVwb3J0O1xuICAgIGNvbnN0IHsgc3Vic2NyaWJlclN0YXRzOiB7IHRvdGFsQnl0ZXNSZWNlaXZlZCwgdGltZXN0YW1wIH0sIH0gPSBjYWxsU3RhdHNSZXBvcnQ7XG4gICAgY29uc3QgYnl0ZXNSZWNlaXZlZCA9IHRvdGFsQnl0ZXNSZWNlaXZlZCAtIHByZXZpb3VzVG90YWxCeXRlc1JlY2VpdmVkO1xuICAgIGNvbnN0IHRpbWVFbGFwc2VkID0gdGltZXN0YW1wIC0gcHJldmlvdXNUaW1lc3RhbXA7XG4gICAgcmV0dXJuIGAkeygoYnl0ZXNSZWNlaXZlZCAqIDgpIC8gdGltZUVsYXBzZWQpLnRvRml4ZWQoMil9IGticHNgO1xufTtcblxuY29uc3QgQ2FsbFN0YXRzQnV0dG9uID0gKCkgPT4gKGpzeChNZW51VG9nZ2xlLCB7IHBsYWNlbWVudDogXCJ0b3AtZW5kXCIsIFRvZ2dsZUJ1dHRvbjogVG9nZ2xlTWVudUJ1dHRvbiwgY2hpbGRyZW46IGpzeChDYWxsU3RhdHMsIHt9KSB9KSk7XG5jb25zdCBUb2dnbGVNZW51QnV0dG9uID0gZm9yd2FyZFJlZihmdW5jdGlvbiBUb2dnbGVNZW51QnV0dG9uKHByb3BzLCByZWYpIHtcbiAgICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcbiAgICBjb25zdCB7IGNhcHRpb24sIG1lbnVTaG93biB9ID0gcHJvcHM7XG4gICAgcmV0dXJuIChqc3goQ29tcG9zaXRlQnV0dG9uLCB7IHJlZjogcmVmLCBhY3RpdmU6IG1lbnVTaG93biwgY2FwdGlvbjogY2FwdGlvbiwgdGl0bGU6IGNhcHRpb24gfHwgdCgnU3RhdGlzdGljcycpLCBcImRhdGEtdGVzdGlkXCI6IFwic3RhdHMtYnV0dG9uXCIsIGNoaWxkcmVuOiBqc3goSWNvbiwgeyBpY29uOiBcInN0YXRzXCIgfSkgfSkpO1xufSk7XG5cbmNvbnN0IFRvZ2dsZUF1ZGlvT3V0cHV0QnV0dG9uID0gKHByb3BzKSA9PiB7XG4gICAgY29uc3QgeyB0IH0gPSB1c2VJMThuKCk7XG4gICAgY29uc3QgeyBjYXB0aW9uLCBNZW51ID0gRGV2aWNlU2VsZWN0b3JBdWRpb091dHB1dCwgbWVudVBsYWNlbWVudCA9ICd0b3AnLCB9ID0gcHJvcHM7XG4gICAgcmV0dXJuIChqc3goQ29tcG9zaXRlQnV0dG9uLCB7IE1lbnU6IE1lbnUsIG1lbnVQbGFjZW1lbnQ6IG1lbnVQbGFjZW1lbnQsIGNhcHRpb246IGNhcHRpb24sIHRpdGxlOiBjYXB0aW9uIHx8IHQoJ1NwZWFrZXJzJyksIFwiZGF0YS10ZXN0aWRcIjogXCJhdWRpby1vdXRwdXQtYnV0dG9uXCIsIGNoaWxkcmVuOiBqc3goSWNvbiwgeyBpY29uOiBcInNwZWFrZXJcIiB9KSB9KSk7XG59O1xuXG5jb25zdCBCbG9ja2VkVXNlckxpc3RpbmcgPSAoeyBkYXRhIH0pID0+IHtcbiAgICBpZiAoIWRhdGEubGVuZ3RoKVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICByZXR1cm4gKGpzeChGcmFnbWVudCwgeyBjaGlsZHJlbjoganN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fcGFydGljaXBhbnQtbGlzdGluZ1wiLCBjaGlsZHJlbjogZGF0YS5tYXAoKHVzZXJJZCkgPT4gKGpzeChCbG9ja2VkVXNlckxpc3RpbmdJdGVtLCB7IHVzZXJJZDogdXNlcklkIH0sIHVzZXJJZCkpKSB9KSB9KSk7XG59O1xuY29uc3QgQmxvY2tlZFVzZXJMaXN0aW5nSXRlbSA9ICh7IHVzZXJJZCB9KSA9PiB7XG4gICAgY29uc3QgY2FsbCA9IHVzZUNhbGwoKTtcbiAgICBjb25zdCB1bmJsb2NrVXNlckNsaWNrSGFuZGxlciA9ICgpID0+IHtcbiAgICAgICAgaWYgKHVzZXJJZClcbiAgICAgICAgICAgIGNhbGw/LnVuYmxvY2tVc2VyKHVzZXJJZCk7XG4gICAgfTtcbiAgICByZXR1cm4gKGpzeHMoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19wYXJ0aWNpcGFudC1saXN0aW5nLWl0ZW1cIiwgY2hpbGRyZW46IFtqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19wYXJ0aWNpcGFudC1saXN0aW5nLWl0ZW1fX2Rpc3BsYXktbmFtZVwiLCBjaGlsZHJlbjogdXNlcklkIH0pLCBqc3goUmVzdHJpY3RlZCwgeyByZXF1aXJlZEdyYW50czogW093bkNhcGFiaWxpdHkuQkxPQ0tfVVNFUlNdLCBjaGlsZHJlbjoganN4KFRleHRCdXR0b24sIHsgb25DbGljazogdW5ibG9ja1VzZXJDbGlja0hhbmRsZXIsIGNoaWxkcmVuOiBcIlVuYmxvY2tcIiB9KSB9KV0gfSkpO1xufTtcblxuY29uc3QgQ2FsbFBhcnRpY2lwYW50TGlzdEhlYWRlciA9ICh7IG9uQ2xvc2UsIH0pID0+IHtcbiAgICBjb25zdCB7IHVzZVBhcnRpY2lwYW50cywgdXNlQW5vbnltb3VzUGFydGljaXBhbnRDb3VudCB9ID0gdXNlQ2FsbFN0YXRlSG9va3MoKTtcbiAgICBjb25zdCBwYXJ0aWNpcGFudHMgPSB1c2VQYXJ0aWNpcGFudHMoKTtcbiAgICBjb25zdCBhbm9ueW1vdXNQYXJ0aWNpcGFudENvdW50ID0gdXNlQW5vbnltb3VzUGFydGljaXBhbnRDb3VudCgpO1xuICAgIGNvbnN0IHsgdCB9ID0gdXNlSTE4bigpO1xuICAgIHJldHVybiAoanN4cyhcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3BhcnRpY2lwYW50LWxpc3QtaGVhZGVyXCIsIGNoaWxkcmVuOiBbanN4cyhcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3BhcnRpY2lwYW50LWxpc3QtaGVhZGVyX190aXRsZVwiLCBjaGlsZHJlbjogW3QoJ1BhcnRpY2lwYW50cycpLCAnICcsIGpzeHMoXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fcGFydGljaXBhbnQtbGlzdC1oZWFkZXJfX3RpdGxlLWNvdW50XCIsIGNoaWxkcmVuOiBbXCJbXCIsIHBhcnRpY2lwYW50cy5sZW5ndGgsIFwiXVwiXSB9KSwgYW5vbnltb3VzUGFydGljaXBhbnRDb3VudCA+IDAgJiYgKGpzeChcInNwYW5cIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19wYXJ0aWNpcGFudC1saXN0LWhlYWRlcl9fdGl0bGUtYW5vbnltb3VzXCIsIGNoaWxkcmVuOiB0KCdBbm9ueW1vdXMnLCB7IGNvdW50OiBhbm9ueW1vdXNQYXJ0aWNpcGFudENvdW50IH0pIH0pKV0gfSksIGpzeChJY29uQnV0dG9uLCB7IG9uQ2xpY2s6IG9uQ2xvc2UsIGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3BhcnRpY2lwYW50LWxpc3QtaGVhZGVyX19jbG9zZS1idXR0b25cIiwgaWNvbjogXCJjbG9zZVwiIH0pXSB9KSk7XG59O1xuXG5jb25zdCBUb29sdGlwID0gKHsgY2hpbGRyZW4sIHJlZmVyZW5jZUVsZW1lbnQsIHRvb2x0aXBDbGFzc05hbWUsIHRvb2x0aXBQbGFjZW1lbnQgPSAndG9wJywgdmlzaWJsZSA9IGZhbHNlLCB9KSA9PiB7XG4gICAgY29uc3QgeyByZWZzLCB4LCB5LCBzdHJhdGVneSB9ID0gdXNlRmxvYXRpbmdVSVByZXNldCh7XG4gICAgICAgIHBsYWNlbWVudDogdG9vbHRpcFBsYWNlbWVudCxcbiAgICAgICAgc3RyYXRlZ3k6ICdhYnNvbHV0ZScsXG4gICAgfSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgcmVmcy5zZXRSZWZlcmVuY2UocmVmZXJlbmNlRWxlbWVudCk7XG4gICAgfSwgW3JlZmVyZW5jZUVsZW1lbnQsIHJlZnNdKTtcbiAgICBpZiAoIXZpc2libGUpXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIHJldHVybiAoanN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBjbHN4KCdzdHItdmlkZW9fX3Rvb2x0aXAnLCB0b29sdGlwQ2xhc3NOYW1lKSwgcmVmOiByZWZzLnNldEZsb2F0aW5nLCBzdHlsZToge1xuICAgICAgICAgICAgcG9zaXRpb246IHN0cmF0ZWd5LFxuICAgICAgICAgICAgdG9wOiB5ID8/IDAsXG4gICAgICAgICAgICBsZWZ0OiB4ID8/IDAsXG4gICAgICAgICAgICBvdmVyZmxvd1k6ICdhdXRvJyxcbiAgICAgICAgfSwgY2hpbGRyZW46IGNoaWxkcmVuIH0pKTtcbn07XG5cbmNvbnN0IHVzZUVudGVyTGVhdmVIYW5kbGVycyA9ICh7IG9uTW91c2VFbnRlciwgb25Nb3VzZUxlYXZlLCB9ID0ge30pID0+IHtcbiAgICBjb25zdCBbdG9vbHRpcFZpc2libGUsIHNldFRvb2x0aXBWaXNpYmxlXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBoYW5kbGVNb3VzZUVudGVyID0gdXNlQ2FsbGJhY2soKGUpID0+IHtcbiAgICAgICAgc2V0VG9vbHRpcFZpc2libGUodHJ1ZSk7XG4gICAgICAgIG9uTW91c2VFbnRlcj8uKGUpO1xuICAgIH0sIFtvbk1vdXNlRW50ZXJdKTtcbiAgICBjb25zdCBoYW5kbGVNb3VzZUxlYXZlID0gdXNlQ2FsbGJhY2soKGUpID0+IHtcbiAgICAgICAgc2V0VG9vbHRpcFZpc2libGUoZmFsc2UpO1xuICAgICAgICBvbk1vdXNlTGVhdmU/LihlKTtcbiAgICB9LCBbb25Nb3VzZUxlYXZlXSk7XG4gICAgcmV0dXJuIHsgaGFuZGxlTW91c2VFbnRlciwgaGFuZGxlTW91c2VMZWF2ZSwgdG9vbHRpcFZpc2libGUgfTtcbn07XG5cbi8vIHRvZG86IGR1cGxpY2F0ZSBvZiBDYWxsUGFydGljaXBhbnRMaXN0LnRzeCNNZWRpYUluZGljYXRvciAtIHJlZmFjdG9yIHRvIGEgc2luZ2xlIGNvbXBvbmVudFxuY29uc3QgV2l0aFRvb2x0aXAgPSAoeyB0aXRsZSwgdG9vbHRpcENsYXNzTmFtZSwgdG9vbHRpcFBsYWNlbWVudCwgLi4ucHJvcHMgfSkgPT4ge1xuICAgIGNvbnN0IHsgaGFuZGxlTW91c2VFbnRlciwgaGFuZGxlTW91c2VMZWF2ZSwgdG9vbHRpcFZpc2libGUgfSA9IHVzZUVudGVyTGVhdmVIYW5kbGVycygpO1xuICAgIGNvbnN0IFt0b29sdGlwQW5jaG9yLCBzZXRUb29sdGlwQW5jaG9yXSA9IHVzZVN0YXRlKG51bGwpO1xuICAgIHJldHVybiAoanN4cyhGcmFnbWVudCwgeyBjaGlsZHJlbjogW2pzeChUb29sdGlwLCB7IHJlZmVyZW5jZUVsZW1lbnQ6IHRvb2x0aXBBbmNob3IsIHZpc2libGU6IHRvb2x0aXBWaXNpYmxlLCB0b29sdGlwQ2xhc3NOYW1lOiB0b29sdGlwQ2xhc3NOYW1lLCB0b29sdGlwUGxhY2VtZW50OiB0b29sdGlwUGxhY2VtZW50LCBjaGlsZHJlbjogdGl0bGUgfHwgJycgfSksIGpzeChcImRpdlwiLCB7IHJlZjogc2V0VG9vbHRpcEFuY2hvciwgb25Nb3VzZUVudGVyOiBoYW5kbGVNb3VzZUVudGVyLCBvbk1vdXNlTGVhdmU6IGhhbmRsZU1vdXNlTGVhdmUsIC4uLnByb3BzIH0pXSB9KSk7XG59O1xuXG5jb25zdCBDYWxsUGFydGljaXBhbnRMaXN0aW5nSXRlbSA9ICh7IHBhcnRpY2lwYW50LCBEaXNwbGF5TmFtZSA9IERlZmF1bHREaXNwbGF5TmFtZSwgfSkgPT4ge1xuICAgIGNvbnN0IGlzQXVkaW9PbiA9IHBhcnRpY2lwYW50LnB1Ymxpc2hlZFRyYWNrcy5pbmNsdWRlcyhTZnVNb2RlbHMuVHJhY2tUeXBlLkFVRElPKTtcbiAgICBjb25zdCBpc1ZpZGVvT24gPSBwYXJ0aWNpcGFudC5wdWJsaXNoZWRUcmFja3MuaW5jbHVkZXMoU2Z1TW9kZWxzLlRyYWNrVHlwZS5WSURFTyk7XG4gICAgY29uc3QgaXNQaW5uZWQgPSAhIXBhcnRpY2lwYW50LnBpbjtcbiAgICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcbiAgICByZXR1cm4gKGpzeHMoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19wYXJ0aWNpcGFudC1saXN0aW5nLWl0ZW1cIiwgY2hpbGRyZW46IFtqc3goQXZhdGFyLCB7IG5hbWU6IHBhcnRpY2lwYW50Lm5hbWUsIGltYWdlU3JjOiBwYXJ0aWNpcGFudC5pbWFnZSB9KSwganN4KERpc3BsYXlOYW1lLCB7IHBhcnRpY2lwYW50OiBwYXJ0aWNpcGFudCB9KSwganN4cyhcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3BhcnRpY2lwYW50LWxpc3RpbmctaXRlbV9fbWVkaWEtaW5kaWNhdG9yLWdyb3VwXCIsIGNoaWxkcmVuOiBbanN4KE1lZGlhSW5kaWNhdG9yLCB7IHRpdGxlOiBpc0F1ZGlvT24gPyB0KCdNaWNyb3Bob25lIG9uJykgOiB0KCdNaWNyb3Bob25lIG9mZicpLCBjbGFzc05hbWU6IGNsc3goJ3N0ci12aWRlb19fcGFydGljaXBhbnQtbGlzdGluZy1pdGVtX19pY29uJywgYHN0ci12aWRlb19fcGFydGljaXBhbnQtbGlzdGluZy1pdGVtX19pY29uLSR7aXNBdWRpb09uID8gJ21pYycgOiAnbWljLW9mZid9YCkgfSksIGpzeChNZWRpYUluZGljYXRvciwgeyB0aXRsZTogaXNWaWRlb09uID8gdCgnQ2FtZXJhIG9uJykgOiB0KCdDYW1lcmEgb2ZmJyksIGNsYXNzTmFtZTogY2xzeCgnc3RyLXZpZGVvX19wYXJ0aWNpcGFudC1saXN0aW5nLWl0ZW1fX2ljb24nLCBgc3RyLXZpZGVvX19wYXJ0aWNpcGFudC1saXN0aW5nLWl0ZW1fX2ljb24tJHtpc1ZpZGVvT24gPyAnY2FtZXJhJyA6ICdjYW1lcmEtb2ZmJ31gKSB9KSwgaXNQaW5uZWQgJiYgKGpzeChNZWRpYUluZGljYXRvciwgeyB0aXRsZTogdCgnUGlubmVkJyksIGNsYXNzTmFtZTogY2xzeCgnc3RyLXZpZGVvX19wYXJ0aWNpcGFudC1saXN0aW5nLWl0ZW1fX2ljb24nLCAnc3RyLXZpZGVvX19wYXJ0aWNpcGFudC1saXN0aW5nLWl0ZW1fX2ljb24tcGlubmVkJykgfSkpLCBqc3goTWVudVRvZ2dsZSwgeyBwbGFjZW1lbnQ6IFwiYm90dG9tLWVuZFwiLCBUb2dnbGVCdXR0b246IFRvZ2dsZUJ1dHRvbiQyLCBjaGlsZHJlbjoganN4KFBhcnRpY2lwYW50Vmlld0NvbnRleHQuUHJvdmlkZXIsIHsgdmFsdWU6IHsgcGFydGljaXBhbnQsIHRyYWNrVHlwZTogJ25vbmUnIH0sIGNoaWxkcmVuOiBqc3goUGFydGljaXBhbnRBY3Rpb25zQ29udGV4dE1lbnUsIHt9KSB9KSB9KV0gfSldIH0pKTtcbn07XG5jb25zdCBNZWRpYUluZGljYXRvciA9IChwcm9wcykgPT4gKGpzeChXaXRoVG9vbHRpcCwgeyAuLi5wcm9wcyB9KSk7XG5jb25zdCBEZWZhdWx0RGlzcGxheU5hbWUgPSAoeyBwYXJ0aWNpcGFudCB9KSA9PiB7XG4gICAgY29uc3QgY29ubmVjdGVkVXNlciA9IHVzZUNvbm5lY3RlZFVzZXIoKTtcbiAgICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcbiAgICBjb25zdCBtZUZsYWcgPSBwYXJ0aWNpcGFudC51c2VySWQgPT09IGNvbm5lY3RlZFVzZXI/LmlkID8gdCgnTWUnKSA6ICcnO1xuICAgIGNvbnN0IG5hbWVPcklkID0gcGFydGljaXBhbnQubmFtZSB8fCBwYXJ0aWNpcGFudC51c2VySWQgfHwgdCgnVW5rbm93bicpO1xuICAgIGxldCBkaXNwbGF5TmFtZTtcbiAgICBpZiAoIXBhcnRpY2lwYW50Lm5hbWUpIHtcbiAgICAgICAgZGlzcGxheU5hbWUgPSBtZUZsYWcgfHwgbmFtZU9ySWQgfHwgdCgnVW5rbm93bicpO1xuICAgIH1cbiAgICBlbHNlIGlmIChtZUZsYWcpIHtcbiAgICAgICAgZGlzcGxheU5hbWUgPSBgJHtuYW1lT3JJZH0gKCR7bWVGbGFnfSlgO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZGlzcGxheU5hbWUgPSBuYW1lT3JJZDtcbiAgICB9XG4gICAgcmV0dXJuIChqc3goV2l0aFRvb2x0aXAsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fcGFydGljaXBhbnQtbGlzdGluZy1pdGVtX19kaXNwbGF5LW5hbWVcIiwgdGl0bGU6IGRpc3BsYXlOYW1lLCBjaGlsZHJlbjogZGlzcGxheU5hbWUgfSkpO1xufTtcbmNvbnN0IFRvZ2dsZUJ1dHRvbiQyID0gZm9yd2FyZFJlZihmdW5jdGlvbiBUb2dnbGVCdXR0b24ocHJvcHMsIHJlZikge1xuICAgIHJldHVybiBqc3goSWNvbkJ1dHRvbiwgeyBlbmFibGVkOiBwcm9wcy5tZW51U2hvd24sIGljb246IFwiZWxsaXBzaXNcIiwgcmVmOiByZWYgfSk7XG59KTtcblxuY29uc3QgQ2FsbFBhcnRpY2lwYW50TGlzdGluZyA9ICh7IGRhdGEsIH0pID0+IChqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19wYXJ0aWNpcGFudC1saXN0aW5nXCIsIGNoaWxkcmVuOiBkYXRhLm1hcCgocGFydGljaXBhbnQpID0+IChqc3goQ2FsbFBhcnRpY2lwYW50TGlzdGluZ0l0ZW0sIHsgcGFydGljaXBhbnQ6IHBhcnRpY2lwYW50IH0sIHBhcnRpY2lwYW50LnNlc3Npb25JZCkpKSB9KSk7XG5cbmNvbnN0IEVtcHR5UGFydGljaXBhbnRTZWFyY2hMaXN0ID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgdCB9ID0gdXNlSTE4bigpO1xuICAgIHJldHVybiAoanN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fcGFydGljaXBhbnQtbGlzdC0tZW1wdHlcIiwgY2hpbGRyZW46IHQoJ05vIHBhcnRpY2lwYW50cyBmb3VuZCcpIH0pKTtcbn07XG5cbmNvbnN0IFNlYXJjaElucHV0ID0gKHsgZXhpdFNlYXJjaCwgaXNBY3RpdmUsIC4uLnJlc3QgfSkgPT4ge1xuICAgIGNvbnN0IFtpbnB1dEVsZW1lbnQsIHNldElucHV0RWxlbWVudF0gPSB1c2VTdGF0ZShudWxsKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoIWlucHV0RWxlbWVudClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgaGFuZGxlS2V5RG93biA9IChlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZS5rZXkudG9Mb3dlckNhc2UoKSA9PT0gJ2VzY2FwZScpXG4gICAgICAgICAgICAgICAgZXhpdFNlYXJjaCgpO1xuICAgICAgICB9O1xuICAgICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGhhbmRsZUtleURvd24pO1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgaW5wdXRFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBoYW5kbGVLZXlEb3duKTtcbiAgICAgICAgfTtcbiAgICB9LCBbZXhpdFNlYXJjaCwgaW5wdXRFbGVtZW50XSk7XG4gICAgcmV0dXJuIChqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBjbHN4KCdzdHItdmlkZW9fX3NlYXJjaC1pbnB1dF9fY29udGFpbmVyJywge1xuICAgICAgICAgICAgJ3N0ci12aWRlb19fc2VhcmNoLWlucHV0X19jb250YWluZXItLWFjdGl2ZSc6IGlzQWN0aXZlLFxuICAgICAgICB9KSwgY2hpbGRyZW46IFtqc3goXCJpbnB1dFwiLCB7IHBsYWNlaG9sZGVyOiBcIlNlYXJjaFwiLCAuLi5yZXN0LCByZWY6IHNldElucHV0RWxlbWVudCB9KSwgaXNBY3RpdmUgPyAoanN4KFwiYnV0dG9uXCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fc2VhcmNoLWlucHV0X19jbGVhci1idG5cIiwgb25DbGljazogZXhpdFNlYXJjaCwgY2hpbGRyZW46IGpzeChcInNwYW5cIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19zZWFyY2gtaW5wdXRfX2ljb24tLWFjdGl2ZVwiIH0pIH0pKSA6IChqc3goXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fc2VhcmNoLWlucHV0X19pY29uXCIgfSkpXSB9KSk7XG59O1xuXG5jb25zdCBTZWFyY2hSZXN1bHRzID0gKHsgRW1wdHlTZWFyY2hSZXN1bHRDb21wb25lbnQsIExvYWRpbmdJbmRpY2F0b3I6IExvYWRpbmdJbmRpY2F0b3IkMSA9IExvYWRpbmdJbmRpY2F0b3IsIHNlYXJjaFF1ZXJ5SW5Qcm9ncmVzcywgc2VhcmNoUmVzdWx0cywgU2VhcmNoUmVzdWx0TGlzdCwgfSkgPT4ge1xuICAgIGlmIChzZWFyY2hRdWVyeUluUHJvZ3Jlc3MpIHtcbiAgICAgICAgcmV0dXJuIChqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19zZWFyY2gtcmVzdWx0cy0tbG9hZGluZ1wiLCBjaGlsZHJlbjoganN4KExvYWRpbmdJbmRpY2F0b3IkMSwge30pIH0pKTtcbiAgICB9XG4gICAgaWYgKCFzZWFyY2hSZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4ganN4KEVtcHR5U2VhcmNoUmVzdWx0Q29tcG9uZW50LCB7fSk7XG4gICAgfVxuICAgIHJldHVybiBqc3goU2VhcmNoUmVzdWx0TGlzdCwgeyBkYXRhOiBzZWFyY2hSZXN1bHRzIH0pO1xufTtcblxuY29uc3QgdXNlU2VhcmNoID0gKHsgZGVib3VuY2VJbnRlcnZhbCwgc2VhcmNoRm4sIHNlYXJjaFF1ZXJ5ID0gJycsIH0pID0+IHtcbiAgICBjb25zdCBbc2VhcmNoUmVzdWx0cywgc2V0U2VhcmNoUmVzdWx0c10gPSB1c2VTdGF0ZShbXSk7XG4gICAgY29uc3QgW3NlYXJjaFF1ZXJ5SW5Qcm9ncmVzcywgc2V0U2VhcmNoUXVlcnlJblByb2dyZXNzXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoIXNlYXJjaFF1ZXJ5Lmxlbmd0aCkge1xuICAgICAgICAgICAgc2V0U2VhcmNoUXVlcnlJblByb2dyZXNzKGZhbHNlKTtcbiAgICAgICAgICAgIHNldFNlYXJjaFJlc3VsdHMoW10pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHNldFNlYXJjaFF1ZXJ5SW5Qcm9ncmVzcyh0cnVlKTtcbiAgICAgICAgY29uc3QgdGltZW91dCA9IHNldFRpbWVvdXQoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgc2VhcmNoRm4oc2VhcmNoUXVlcnkpO1xuICAgICAgICAgICAgICAgIHNldFNlYXJjaFJlc3VsdHMocmVzdWx0cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgICAgIHNldFNlYXJjaFF1ZXJ5SW5Qcm9ncmVzcyhmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGRlYm91bmNlSW50ZXJ2YWwpO1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICB9O1xuICAgIH0sIFtkZWJvdW5jZUludGVydmFsLCBzZWFyY2hGbiwgc2VhcmNoUXVlcnldKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBzZWFyY2hRdWVyeUluUHJvZ3Jlc3MsXG4gICAgICAgIHNlYXJjaFJlc3VsdHMsXG4gICAgfTtcbn07XG5cbmNvbnN0IFVzZXJMaXN0VHlwZXMgPSB7XG4gICAgYWN0aXZlOiAnQWN0aXZlIHVzZXJzJyxcbiAgICBibG9ja2VkOiAnQmxvY2tlZCB1c2VycycsXG59O1xuY29uc3QgREVGQVVMVF9ERUJPVU5DRV9TRUFSQ0hfSU5URVJWQUwgPSAyMDA7XG5jb25zdCBDYWxsUGFydGljaXBhbnRzTGlzdCA9ICh7IG9uQ2xvc2UsIGFjdGl2ZVVzZXJzU2VhcmNoRm4sIGJsb2NrZWRVc2Vyc1NlYXJjaEZuLCBkZWJvdW5jZVNlYXJjaEludGVydmFsLCB9KSA9PiB7XG4gICAgY29uc3QgW3NlYXJjaFF1ZXJ5LCBzZXRTZWFyY2hRdWVyeV0gPSB1c2VTdGF0ZSgnJyk7XG4gICAgY29uc3QgW3VzZXJMaXN0VHlwZSwgc2V0VXNlckxpc3RUeXBlXSA9IHVzZVN0YXRlKCdhY3RpdmUnKTtcbiAgICBjb25zdCBleGl0U2VhcmNoID0gdXNlQ2FsbGJhY2soKCkgPT4gc2V0U2VhcmNoUXVlcnkoJycpLCBbXSk7XG4gICAgcmV0dXJuIChqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fcGFydGljaXBhbnQtbGlzdFwiLCBjaGlsZHJlbjogW2pzeChDYWxsUGFydGljaXBhbnRMaXN0SGVhZGVyLCB7IG9uQ2xvc2U6IG9uQ2xvc2UgfSksIGpzeChTZWFyY2hJbnB1dCwgeyB2YWx1ZTogc2VhcmNoUXVlcnksIG9uQ2hhbmdlOiAoeyBjdXJyZW50VGFyZ2V0IH0pID0+IHNldFNlYXJjaFF1ZXJ5KGN1cnJlbnRUYXJnZXQudmFsdWUpLCBleGl0U2VhcmNoOiBleGl0U2VhcmNoLCBpc0FjdGl2ZTogISFzZWFyY2hRdWVyeSB9KSwganN4KENhbGxQYXJ0aWNpcGFudExpc3RDb250ZW50SGVhZGVyLCB7IHVzZXJMaXN0VHlwZTogdXNlckxpc3RUeXBlLCBzZXRVc2VyTGlzdFR5cGU6IHNldFVzZXJMaXN0VHlwZSB9KSwganN4cyhcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3BhcnRpY2lwYW50LWxpc3RfX2NvbnRlbnRcIiwgY2hpbGRyZW46IFt1c2VyTGlzdFR5cGUgPT09ICdhY3RpdmUnICYmIChqc3goQWN0aXZlVXNlcnNTZWFyY2hSZXN1bHRzLCB7IHNlYXJjaFF1ZXJ5OiBzZWFyY2hRdWVyeSwgYWN0aXZlVXNlcnNTZWFyY2hGbjogYWN0aXZlVXNlcnNTZWFyY2hGbiwgZGVib3VuY2VTZWFyY2hJbnRlcnZhbDogZGVib3VuY2VTZWFyY2hJbnRlcnZhbCB9KSksIHVzZXJMaXN0VHlwZSA9PT0gJ2Jsb2NrZWQnICYmIChqc3goQmxvY2tlZFVzZXJzU2VhcmNoUmVzdWx0cywgeyBzZWFyY2hRdWVyeTogc2VhcmNoUXVlcnksIGJsb2NrZWRVc2Vyc1NlYXJjaEZuOiBibG9ja2VkVXNlcnNTZWFyY2hGbiwgZGVib3VuY2VTZWFyY2hJbnRlcnZhbDogZGVib3VuY2VTZWFyY2hJbnRlcnZhbCB9KSldIH0pXSB9KSk7XG59O1xuY29uc3QgQ2FsbFBhcnRpY2lwYW50TGlzdENvbnRlbnRIZWFkZXIgPSAoeyB1c2VyTGlzdFR5cGUsIHNldFVzZXJMaXN0VHlwZSwgfSkgPT4ge1xuICAgIGNvbnN0IGNhbGwgPSB1c2VDYWxsKCk7XG4gICAgY29uc3QgbXV0ZUFsbCA9ICgpID0+IHtcbiAgICAgICAgY2FsbD8ubXV0ZUFsbFVzZXJzKCdhdWRpbycpO1xuICAgIH07XG4gICAgcmV0dXJuIChqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fcGFydGljaXBhbnQtbGlzdF9fY29udGVudC1oZWFkZXJcIiwgY2hpbGRyZW46IFtqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19wYXJ0aWNpcGFudC1saXN0X19jb250ZW50LWhlYWRlci10aXRsZVwiLCBjaGlsZHJlbjogdXNlckxpc3RUeXBlID09PSAnYWN0aXZlJyAmJiAoanN4KFJlc3RyaWN0ZWQsIHsgcmVxdWlyZWRHcmFudHM6IFtPd25DYXBhYmlsaXR5Lk1VVEVfVVNFUlNdLCBoYXNQZXJtaXNzaW9uc09ubHk6IHRydWUsIGNoaWxkcmVuOiBqc3goVGV4dEJ1dHRvbiwgeyBvbkNsaWNrOiBtdXRlQWxsLCBjaGlsZHJlbjogXCJNdXRlIGFsbFwiIH0pIH0pKSB9KSwganN4KE1lbnVUb2dnbGUsIHsgcGxhY2VtZW50OiBcImJvdHRvbS1lbmRcIiwgVG9nZ2xlQnV0dG9uOiBUb2dnbGVCdXR0b24kMSwgY2hpbGRyZW46IGpzeChHZW5lcmljTWVudSwgeyBjaGlsZHJlbjogT2JqZWN0LmtleXMoVXNlckxpc3RUeXBlcykubWFwKChsdCkgPT4gKGpzeChHZW5lcmljTWVudUJ1dHRvbkl0ZW0sIHsgXCJhcmlhLXNlbGVjdGVkXCI6IGx0ID09PSB1c2VyTGlzdFR5cGUsIG9uQ2xpY2s6ICgpID0+IHNldFVzZXJMaXN0VHlwZShsdCksIGNoaWxkcmVuOiBVc2VyTGlzdFR5cGVzW2x0XSB9LCBsdCkpKSB9KSB9KV0gfSkpO1xufTtcbmNvbnN0IEFjdGl2ZVVzZXJzU2VhcmNoUmVzdWx0cyA9ICh7IHNlYXJjaFF1ZXJ5LCBhY3RpdmVVc2Vyc1NlYXJjaEZuOiBhY3RpdmVVc2Vyc1NlYXJjaEZuRnJvbVByb3BzLCBkZWJvdW5jZVNlYXJjaEludGVydmFsID0gREVGQVVMVF9ERUJPVU5DRV9TRUFSQ0hfSU5URVJWQUwsIH0pID0+IHtcbiAgICBjb25zdCB7IHVzZVBhcnRpY2lwYW50cyB9ID0gdXNlQ2FsbFN0YXRlSG9va3MoKTtcbiAgICBjb25zdCBwYXJ0aWNpcGFudHMgPSB1c2VQYXJ0aWNpcGFudHMoeyBzb3J0Qnk6IG5hbWUgfSk7XG4gICAgY29uc3QgYWN0aXZlVXNlcnNTZWFyY2hGbiA9IHVzZUNhbGxiYWNrKChxdWVyeVN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCBxdWVyeVJlZ0V4cCA9IG5ldyBSZWdFeHAocXVlcnlTdHJpbmcsICdpJyk7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocGFydGljaXBhbnRzLmZpbHRlcigocGFydGljaXBhbnQpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBwYXJ0aWNpcGFudC5uYW1lLm1hdGNoKHF1ZXJ5UmVnRXhwKTtcbiAgICAgICAgfSkpO1xuICAgIH0sIFtwYXJ0aWNpcGFudHNdKTtcbiAgICBjb25zdCB7IHNlYXJjaFF1ZXJ5SW5Qcm9ncmVzcywgc2VhcmNoUmVzdWx0cyB9ID0gdXNlU2VhcmNoKHtcbiAgICAgICAgc2VhcmNoRm46IGFjdGl2ZVVzZXJzU2VhcmNoRm5Gcm9tUHJvcHMgPz8gYWN0aXZlVXNlcnNTZWFyY2hGbixcbiAgICAgICAgZGVib3VuY2VJbnRlcnZhbDogZGVib3VuY2VTZWFyY2hJbnRlcnZhbCxcbiAgICAgICAgc2VhcmNoUXVlcnksXG4gICAgfSk7XG4gICAgcmV0dXJuIChqc3goU2VhcmNoUmVzdWx0cywgeyBFbXB0eVNlYXJjaFJlc3VsdENvbXBvbmVudDogRW1wdHlQYXJ0aWNpcGFudFNlYXJjaExpc3QsIExvYWRpbmdJbmRpY2F0b3I6IExvYWRpbmdJbmRpY2F0b3IsIHNlYXJjaFF1ZXJ5SW5Qcm9ncmVzczogc2VhcmNoUXVlcnlJblByb2dyZXNzLCBzZWFyY2hSZXN1bHRzOiBzZWFyY2hRdWVyeSA/IHNlYXJjaFJlc3VsdHMgOiBwYXJ0aWNpcGFudHMsIFNlYXJjaFJlc3VsdExpc3Q6IENhbGxQYXJ0aWNpcGFudExpc3RpbmcgfSkpO1xufTtcbmNvbnN0IEJsb2NrZWRVc2Vyc1NlYXJjaFJlc3VsdHMgPSAoeyBibG9ja2VkVXNlcnNTZWFyY2hGbjogYmxvY2tlZFVzZXJzU2VhcmNoRm5Gcm9tUHJvcHMsIGRlYm91bmNlU2VhcmNoSW50ZXJ2YWwgPSBERUZBVUxUX0RFQk9VTkNFX1NFQVJDSF9JTlRFUlZBTCwgc2VhcmNoUXVlcnksIH0pID0+IHtcbiAgICBjb25zdCB7IHVzZUNhbGxCbG9ja2VkVXNlcklkcyB9ID0gdXNlQ2FsbFN0YXRlSG9va3MoKTtcbiAgICBjb25zdCBibG9ja2VkVXNlcnMgPSB1c2VDYWxsQmxvY2tlZFVzZXJJZHMoKTtcbiAgICBjb25zdCBibG9ja2VkVXNlcnNTZWFyY2hGbiA9IHVzZUNhbGxiYWNrKChxdWVyeVN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCBxdWVyeVJlZ0V4cCA9IG5ldyBSZWdFeHAocXVlcnlTdHJpbmcsICdpJyk7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoYmxvY2tlZFVzZXJzLmZpbHRlcigoYmxvY2tlZFVzZXIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBibG9ja2VkVXNlci5tYXRjaChxdWVyeVJlZ0V4cCk7XG4gICAgICAgIH0pKTtcbiAgICB9LCBbYmxvY2tlZFVzZXJzXSk7XG4gICAgY29uc3QgeyBzZWFyY2hRdWVyeUluUHJvZ3Jlc3MsIHNlYXJjaFJlc3VsdHMgfSA9IHVzZVNlYXJjaCh7XG4gICAgICAgIHNlYXJjaEZuOiBibG9ja2VkVXNlcnNTZWFyY2hGbkZyb21Qcm9wcyA/PyBibG9ja2VkVXNlcnNTZWFyY2hGbixcbiAgICAgICAgZGVib3VuY2VJbnRlcnZhbDogZGVib3VuY2VTZWFyY2hJbnRlcnZhbCxcbiAgICAgICAgc2VhcmNoUXVlcnksXG4gICAgfSk7XG4gICAgcmV0dXJuIChqc3goU2VhcmNoUmVzdWx0cywgeyBFbXB0eVNlYXJjaFJlc3VsdENvbXBvbmVudDogRW1wdHlQYXJ0aWNpcGFudFNlYXJjaExpc3QsIExvYWRpbmdJbmRpY2F0b3I6IExvYWRpbmdJbmRpY2F0b3IsIHNlYXJjaFF1ZXJ5SW5Qcm9ncmVzczogc2VhcmNoUXVlcnlJblByb2dyZXNzLCBzZWFyY2hSZXN1bHRzOiBzZWFyY2hRdWVyeSA/IHNlYXJjaFJlc3VsdHMgOiBibG9ja2VkVXNlcnMsIFNlYXJjaFJlc3VsdExpc3Q6IEJsb2NrZWRVc2VyTGlzdGluZyB9KSk7XG59O1xuY29uc3QgVG9nZ2xlQnV0dG9uJDEgPSBmb3J3YXJkUmVmKGZ1bmN0aW9uIFRvZ2dsZUJ1dHRvbihwcm9wcywgcmVmKSB7XG4gICAgcmV0dXJuIGpzeChJY29uQnV0dG9uLCB7IGVuYWJsZWQ6IHByb3BzLm1lbnVTaG93biwgaWNvbjogXCJmaWx0ZXJcIiwgcmVmOiByZWYgfSk7XG59KTtcblxuY29uc3QgQ2FsbFByZXZpZXcgPSAocHJvcHMpID0+IHtcbiAgICBjb25zdCB7IGNsYXNzTmFtZSwgc3R5bGUgfSA9IHByb3BzO1xuICAgIGNvbnN0IGNhbGwgPSB1c2VDYWxsKCk7XG4gICAgY29uc3QgeyB1c2VDYWxsVGh1bWJuYWlsIH0gPSB1c2VDYWxsU3RhdGVIb29rcygpO1xuICAgIGNvbnN0IHRodW1ibmFpbCA9IHVzZUNhbGxUaHVtYm5haWwoKTtcbiAgICBjb25zdCBbaW1hZ2VSZWYsIHNldEltYWdlUmVmXSA9IHVzZVN0YXRlKG51bGwpO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmICghaW1hZ2VSZWYgfHwgIWNhbGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGNsZWFudXAgPSBjYWxsLmJpbmRDYWxsVGh1bWJuYWlsRWxlbWVudChpbWFnZVJlZik7XG4gICAgICAgIHJldHVybiAoKSA9PiBjbGVhbnVwKCk7XG4gICAgfSwgW2ltYWdlUmVmLCBjYWxsXSk7XG4gICAgaWYgKCF0aHVtYm5haWwpXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIHJldHVybiAoanN4KFwiaW1nXCIsIHsgY2xhc3NOYW1lOiBjbHN4KCdzdHItdmlkZW9fX2NhbGwtcHJldmlldycsIGNsYXNzTmFtZSksIHN0eWxlOiBzdHlsZSwgYWx0OiBcIkNhbGwgUHJldmlldyBUaHVtYm5haWxcIiwgcmVmOiBzZXRJbWFnZVJlZiB9KSk7XG59O1xuXG5jb25zdCBDYWxsUmVjb3JkaW5nTGlzdEhlYWRlciA9ICh7IGNhbGxSZWNvcmRpbmdzLCBvblJlZnJlc2gsIH0pID0+IHtcbiAgICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcbiAgICByZXR1cm4gKGpzeHMoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLXJlY29yZGluZy1saXN0X19oZWFkZXJcIiwgY2hpbGRyZW46IFtqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY2FsbC1yZWNvcmRpbmctbGlzdF9fdGl0bGVcIiwgY2hpbGRyZW46IFtqc3goXCJzcGFuXCIsIHsgY2hpbGRyZW46IHQoJ0NhbGwgUmVjb3JkaW5ncycpIH0pLCBjYWxsUmVjb3JkaW5ncy5sZW5ndGggPyBqc3hzKFwic3BhblwiLCB7IGNoaWxkcmVuOiBbXCIoXCIsIGNhbGxSZWNvcmRpbmdzLmxlbmd0aCwgXCIpXCJdIH0pIDogbnVsbF0gfSksIG9uUmVmcmVzaCAmJiAoanN4KEljb25CdXR0b24sIHsgaWNvbjogXCJyZWZyZXNoXCIsIHRpdGxlOiB0KCdSZWZyZXNoJyksIG9uQ2xpY2s6IG9uUmVmcmVzaCB9KSldIH0pKTtcbn07XG5cbmNvbnN0IGRhdGVGb3JtYXQgPSAoZGF0ZSkgPT4ge1xuICAgIGNvbnN0IGZvcm1hdCA9IG5ldyBEYXRlKGRhdGUpO1xuICAgIHJldHVybiBmb3JtYXQudG9UaW1lU3RyaW5nKCkuc3BsaXQoJyAnKVswXTtcbn07XG5jb25zdCBDYWxsUmVjb3JkaW5nTGlzdEl0ZW0gPSAoeyByZWNvcmRpbmcsIH0pID0+IHtcbiAgICByZXR1cm4gKGpzeHMoXCJsaVwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2NhbGwtcmVjb3JkaW5nLWxpc3RfX2l0ZW1cIiwgY2hpbGRyZW46IFtqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLXJlY29yZGluZy1saXN0X190YWJsZS1jZWxsIHN0ci12aWRlb19fY2FsbC1yZWNvcmRpbmctbGlzdF9fZmlsZW5hbWVcIiwgY2hpbGRyZW46IHJlY29yZGluZy5maWxlbmFtZSB9KSwganN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY2FsbC1yZWNvcmRpbmctbGlzdF9fdGFibGUtY2VsbCBzdHItdmlkZW9fX2NhbGwtcmVjb3JkaW5nLWxpc3RfX3RpbWVcIiwgY2hpbGRyZW46IGRhdGVGb3JtYXQocmVjb3JkaW5nLnN0YXJ0X3RpbWUpIH0pLCBqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLXJlY29yZGluZy1saXN0X190YWJsZS1jZWxsIHN0ci12aWRlb19fY2FsbC1yZWNvcmRpbmctbGlzdF9fdGltZVwiLCBjaGlsZHJlbjogZGF0ZUZvcm1hdChyZWNvcmRpbmcuZW5kX3RpbWUpIH0pLCBqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLXJlY29yZGluZy1saXN0X190YWJsZS1jZWxsIHN0ci12aWRlb19fY2FsbC1yZWNvcmRpbmctbGlzdF9fZG93bmxvYWRcIiwgY2hpbGRyZW46IGpzeChcImFcIiwgeyBjbGFzc05hbWU6IGNsc3goJ3N0ci12aWRlb19fY2FsbC1yZWNvcmRpbmctbGlzdC1pdGVtX19hY3Rpb24tYnV0dG9uJywgJ3N0ci12aWRlb19fY2FsbC1yZWNvcmRpbmctbGlzdC1pdGVtX19hY3Rpb24tYnV0dG9uLS1kb3dubG9hZCcpLCByb2xlOiBcImJ1dHRvblwiLCBocmVmOiByZWNvcmRpbmcudXJsLCBkb3dubG9hZDogcmVjb3JkaW5nLmZpbGVuYW1lLCB0aXRsZTogXCJEb3dubG9hZCB0aGUgcmVjb3JkaW5nXCIsIGNoaWxkcmVuOiBqc3goSWNvbiwgeyBpY29uOiBcImRvd25sb2FkXCIgfSkgfSkgfSldIH0pKTtcbn07XG5cbmNvbnN0IEVtcHR5Q2FsbFJlY29yZGluZ0xpc3RpbmcgPSAoKSA9PiB7XG4gICAgcmV0dXJuIChqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY2FsbC1yZWNvcmRpbmctbGlzdF9fbGlzdGluZyBzdHItdmlkZW9fX2NhbGwtcmVjb3JkaW5nLWxpc3RfX2xpc3RpbmctLWVtcHR5XCIsIGNoaWxkcmVuOiBbanN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY2FsbC1yZWNvcmRpbmctbGlzdF9fbGlzdGluZy0taWNvbi1lbXB0eVwiIH0pLCBqc3goXCJwXCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY2FsbC1yZWNvcmRpbmctbGlzdF9fbGlzdGluZy0tdGV4dC1lbXB0eVwiLCBjaGlsZHJlbjogXCJObyByZWNvcmRpbmdzIGF2YWlsYWJsZVwiIH0pXSB9KSk7XG59O1xuXG5jb25zdCBMb2FkaW5nQ2FsbFJlY29yZGluZ0xpc3RpbmcgPSAoeyBjYWxsUmVjb3JkaW5ncywgfSkgPT4ge1xuICAgIHJldHVybiAoanN4cyhGcmFnbWVudCwgeyBjaGlsZHJlbjogW2NhbGxSZWNvcmRpbmdzLm1hcCgocmVjb3JkaW5nKSA9PiAoanN4KENhbGxSZWNvcmRpbmdMaXN0SXRlbSwgeyByZWNvcmRpbmc6IHJlY29yZGluZyB9LCByZWNvcmRpbmcuZmlsZW5hbWUpKSksIGpzeChMb2FkaW5nSW5kaWNhdG9yLCB7IHRleHQ6IFwiUmVjb3JkaW5nIGdldHRpbmcgcmVhZHlcIiB9KV0gfSkpO1xufTtcblxuY29uc3QgQ2FsbFJlY29yZGluZ0xpc3QgPSAoeyBjYWxsUmVjb3JkaW5ncywgQ2FsbFJlY29yZGluZ0xpc3RIZWFkZXI6IENhbGxSZWNvcmRpbmdMaXN0SGVhZGVyJDEgPSBDYWxsUmVjb3JkaW5nTGlzdEhlYWRlciwgQ2FsbFJlY29yZGluZ0xpc3RJdGVtOiBDYWxsUmVjb3JkaW5nTGlzdEl0ZW0kMSA9IENhbGxSZWNvcmRpbmdMaXN0SXRlbSwgRW1wdHlDYWxsUmVjb3JkaW5nTGlzdCA9IEVtcHR5Q2FsbFJlY29yZGluZ0xpc3RpbmcsIGxvYWRpbmcsIExvYWRpbmdDYWxsUmVjb3JkaW5nTGlzdCA9IExvYWRpbmdDYWxsUmVjb3JkaW5nTGlzdGluZywgb25SZWZyZXNoLCB9KSA9PiB7XG4gICAgcmV0dXJuIChqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY2FsbC1yZWNvcmRpbmctbGlzdFwiLCBjaGlsZHJlbjogW2pzeChDYWxsUmVjb3JkaW5nTGlzdEhlYWRlciQxLCB7IGNhbGxSZWNvcmRpbmdzOiBjYWxsUmVjb3JkaW5ncywgb25SZWZyZXNoOiBvblJlZnJlc2ggfSksIGpzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2NhbGwtcmVjb3JkaW5nLWxpc3RfX2xpc3RpbmdcIiwgY2hpbGRyZW46IGxvYWRpbmcgPyAoanN4KExvYWRpbmdDYWxsUmVjb3JkaW5nTGlzdCwgeyBjYWxsUmVjb3JkaW5nczogY2FsbFJlY29yZGluZ3MgfSkpIDogY2FsbFJlY29yZGluZ3MubGVuZ3RoID8gKGpzeHMoRnJhZ21lbnQsIHsgY2hpbGRyZW46IFtqc3goXCJ1bFwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2NhbGwtcmVjb3JkaW5nLWxpc3RfX2xpc3RcIiwgY2hpbGRyZW46IGpzeHMoXCJsaVwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2NhbGwtcmVjb3JkaW5nLWxpc3RfX2l0ZW1cIiwgY2hpbGRyZW46IFtqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLXJlY29yZGluZy1saXN0X19maWxlbmFtZVwiLCBjaGlsZHJlbjogXCJOYW1lXCIgfSksIGpzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2NhbGwtcmVjb3JkaW5nLWxpc3RfX3RpbWVcIiwgY2hpbGRyZW46IFwiU3RhcnQgdGltZVwiIH0pLCBqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLXJlY29yZGluZy1saXN0X190aW1lXCIsIGNoaWxkcmVuOiBcIkVuZCB0aW1lXCIgfSksIGpzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2NhbGwtcmVjb3JkaW5nLWxpc3RfX2Rvd25sb2FkXCIgfSldIH0pIH0pLCBqc3goXCJ1bFwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2NhbGwtcmVjb3JkaW5nLWxpc3RfX2xpc3RcIiwgY2hpbGRyZW46IGNhbGxSZWNvcmRpbmdzLm1hcCgocmVjb3JkaW5nKSA9PiAoanN4KENhbGxSZWNvcmRpbmdMaXN0SXRlbSQxLCB7IHJlY29yZGluZzogcmVjb3JkaW5nIH0sIHJlY29yZGluZy5maWxlbmFtZSkpKSB9KV0gfSkpIDogKGpzeChFbXB0eUNhbGxSZWNvcmRpbmdMaXN0LCB7fSkpIH0pXSB9KSk7XG59O1xuXG5jb25zdCBSaW5naW5nQ2FsbENvbnRyb2xzID0gKCkgPT4ge1xuICAgIGNvbnN0IGNhbGwgPSB1c2VDYWxsKCk7XG4gICAgY29uc3QgeyB1c2VDYWxsQ2FsbGluZ1N0YXRlIH0gPSB1c2VDYWxsU3RhdGVIb29rcygpO1xuICAgIGNvbnN0IGNhbGxDYWxsaW5nU3RhdGUgPSB1c2VDYWxsQ2FsbGluZ1N0YXRlKCk7XG4gICAgaWYgKCFjYWxsKVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICBjb25zdCBidXR0b25zRGlzYWJsZWQgPSBjYWxsQ2FsbGluZ1N0YXRlICE9PSBDYWxsaW5nU3RhdGUuUklOR0lORztcbiAgICByZXR1cm4gKGpzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3BlbmRpbmctY2FsbC1jb250cm9sc1wiLCBjaGlsZHJlbjogY2FsbC5pc0NyZWF0ZWRCeU1lID8gKGpzeChDYW5jZWxDYWxsQnV0dG9uLCB7IGRpc2FibGVkOiBidXR0b25zRGlzYWJsZWQgfSkpIDogKGpzeHMoRnJhZ21lbnQsIHsgY2hpbGRyZW46IFtqc3goQWNjZXB0Q2FsbEJ1dHRvbiwgeyBkaXNhYmxlZDogYnV0dG9uc0Rpc2FibGVkIH0pLCBqc3goQ2FuY2VsQ2FsbEJ1dHRvbiwgeyBvbkNsaWNrOiAoKSA9PiBjYWxsLmxlYXZlKHsgcmVqZWN0OiB0cnVlIH0pLCBkaXNhYmxlZDogYnV0dG9uc0Rpc2FibGVkIH0pXSB9KSkgfSkpO1xufTtcblxuY29uc3QgQ0FMTElOR19TVEFURV9UT19MQUJFTCA9IHtcbiAgICBbQ2FsbGluZ1N0YXRlLkpPSU5JTkddOiAnSm9pbmluZycsXG4gICAgW0NhbGxpbmdTdGF0ZS5SSU5HSU5HXTogJ1JpbmdpbmcnLFxuICAgIFtDYWxsaW5nU3RhdGUuTUlHUkFUSU5HXTogJ01pZ3JhdGluZycsXG4gICAgW0NhbGxpbmdTdGF0ZS5SRUNPTk5FQ1RJTkddOiAnUmUtY29ubmVjdGluZycsXG4gICAgW0NhbGxpbmdTdGF0ZS5SRUNPTk5FQ1RJTkdfRkFJTEVEXTogJ0ZhaWxlZCcsXG4gICAgW0NhbGxpbmdTdGF0ZS5PRkZMSU5FXTogJ05vIGludGVybmV0IGNvbm5lY3Rpb24nLFxuICAgIFtDYWxsaW5nU3RhdGUuSURMRV06ICcnLFxuICAgIFtDYWxsaW5nU3RhdGUuVU5LTk9XTl06ICcnLFxuICAgIFtDYWxsaW5nU3RhdGUuSk9JTkVEXTogJ0pvaW5lZCcsXG4gICAgW0NhbGxpbmdTdGF0ZS5MRUZUXTogJ0xlZnQgY2FsbCcsXG59O1xuY29uc3QgUmluZ2luZ0NhbGwgPSAocHJvcHMpID0+IHtcbiAgICBjb25zdCB7IGluY2x1ZGVTZWxmID0gZmFsc2UsIHRvdGFsTWVtYmVyc1RvU2hvdyA9IDMgfSA9IHByb3BzO1xuICAgIGNvbnN0IGNhbGwgPSB1c2VDYWxsKCk7XG4gICAgY29uc3QgeyB0IH0gPSB1c2VJMThuKCk7XG4gICAgY29uc3QgeyB1c2VDYWxsQ2FsbGluZ1N0YXRlLCB1c2VDYWxsTWVtYmVycyB9ID0gdXNlQ2FsbFN0YXRlSG9va3MoKTtcbiAgICBjb25zdCBjYWxsaW5nU3RhdGUgPSB1c2VDYWxsQ2FsbGluZ1N0YXRlKCk7XG4gICAgY29uc3QgbWVtYmVycyA9IHVzZUNhbGxNZW1iZXJzKCk7XG4gICAgY29uc3QgY29ubmVjdGVkVXNlciA9IHVzZUNvbm5lY3RlZFVzZXIoKTtcbiAgICBpZiAoIWNhbGwpXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIC8vIHRha2UgdGhlIGZpcnN0IE4gbWVtYmVycyB0byBzaG93IHRoZWlyIGF2YXRhcnNcbiAgICBjb25zdCBtZW1iZXJzVG9TaG93ID0gKG1lbWJlcnMgfHwgW10pXG4gICAgICAgIC5zbGljZSgwLCB0b3RhbE1lbWJlcnNUb1Nob3cpXG4gICAgICAgIC5tYXAoKHsgdXNlciB9KSA9PiB1c2VyKVxuICAgICAgICAuZmlsdGVyKCh1c2VyKSA9PiB1c2VyLmlkICE9PSBjb25uZWN0ZWRVc2VyPy5pZCB8fCBpbmNsdWRlU2VsZik7XG4gICAgaWYgKGluY2x1ZGVTZWxmICYmXG4gICAgICAgICFtZW1iZXJzVG9TaG93LmZpbmQoKHVzZXIpID0+IHVzZXIuaWQgPT09IGNvbm5lY3RlZFVzZXI/LmlkKSkge1xuICAgICAgICAvLyBpZiB0aGUgY3VycmVudCB1c2VyIGlzIG5vdCBpbiB0aGUgaW5pdGlhbCBiYXRjaCBvZiBtZW1iZXJzLFxuICAgICAgICAvLyByZXBsYWNlIHRoZSBmaXJzdCBpdGVtIGluIG1lbWJlcnNUb1Nob3cgYXJyYXkgd2l0aCB0aGUgY3VycmVudCB1c2VyXG4gICAgICAgIGNvbnN0IHNlbGYgPSBtZW1iZXJzLmZpbmQoKHsgdXNlciB9KSA9PiB1c2VyLmlkID09PSBjb25uZWN0ZWRVc2VyPy5pZCk7XG4gICAgICAgIGlmIChzZWxmKSB7XG4gICAgICAgICAgICBtZW1iZXJzVG9TaG93LnNwbGljZSgwLCAxLCBzZWxmLnVzZXIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGNhbGxpbmdTdGF0ZUxhYmVsID0gQ0FMTElOR19TVEFURV9UT19MQUJFTFtjYWxsaW5nU3RhdGVdO1xuICAgIHJldHVybiAoanN4cyhcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2NhbGwtcGFuZWwgc3RyLXZpZGVvX19jYWxsLXBhbmVsLS1yaW5naW5nXCIsIGNoaWxkcmVuOiBbanN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fY2FsbC1wYW5lbF9fbWVtYmVycy1saXN0XCIsIGNoaWxkcmVuOiBtZW1iZXJzVG9TaG93Lm1hcCgodXNlcikgPT4gKGpzeHMoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLXBhbmVsX19tZW1iZXItYm94XCIsIGNoaWxkcmVuOiBbanN4KEF2YXRhciwgeyBuYW1lOiB1c2VyLm5hbWUsIGltYWdlU3JjOiB1c2VyLmltYWdlIH0pLCB1c2VyLm5hbWUgJiYgKGpzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX21lbWJlcl9kZXRhaWxzXCIsIGNoaWxkcmVuOiBqc3goXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fbWVtYmVyX25hbWVcIiwgY2hpbGRyZW46IHVzZXIubmFtZSB9KSB9KSldIH0sIHVzZXIuaWQpKSkgfSksIGNhbGxpbmdTdGF0ZUxhYmVsICYmIChqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19jYWxsLXBhbmVsX19jYWxsaW5nLXN0YXRlLWxhYmVsXCIsIGNoaWxkcmVuOiB0KGNhbGxpbmdTdGF0ZUxhYmVsKSB9KSksIFtDYWxsaW5nU3RhdGUuUklOR0lORywgQ2FsbGluZ1N0YXRlLkpPSU5JTkddLmluY2x1ZGVzKGNhbGxpbmdTdGF0ZSkgJiYgKGpzeChSaW5naW5nQ2FsbENvbnRyb2xzLCB7fSkpXSB9KSk7XG59O1xuXG5jb25zdCBieU5hbWVPcklkID0gKGEsIGIpID0+IHtcbiAgICBpZiAoYS5uYW1lICYmIGIubmFtZSAmJiBhLm5hbWUgPCBiLm5hbWUpXG4gICAgICAgIHJldHVybiAtMTtcbiAgICBpZiAoYS5uYW1lICYmIGIubmFtZSAmJiBhLm5hbWUgPiBiLm5hbWUpXG4gICAgICAgIHJldHVybiAxO1xuICAgIGlmIChhLmlkIDwgYi5pZClcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIGlmIChhLmlkID4gYi5pZClcbiAgICAgICAgcmV0dXJuIDE7XG4gICAgcmV0dXJuIDA7XG59O1xuY29uc3QgUGVybWlzc2lvblJlcXVlc3RzID0gKCkgPT4ge1xuICAgIGNvbnN0IGNhbGwgPSB1c2VDYWxsKCk7XG4gICAgY29uc3QgeyB1c2VMb2NhbFBhcnRpY2lwYW50LCB1c2VIYXNQZXJtaXNzaW9ucyB9ID0gdXNlQ2FsbFN0YXRlSG9va3MoKTtcbiAgICBjb25zdCBsb2NhbFBhcnRpY2lwYW50ID0gdXNlTG9jYWxQYXJ0aWNpcGFudCgpO1xuICAgIGNvbnN0IFtleHBhbmRlZCwgc2V0RXhwYW5kZWRdID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IFtwZXJtaXNzaW9uUmVxdWVzdHMsIHNldFBlcm1pc3Npb25SZXF1ZXN0c10gPSB1c2VTdGF0ZShbXSk7XG4gICAgY29uc3QgY2FuVXBkYXRlQ2FsbFBlcm1pc3Npb25zID0gdXNlSGFzUGVybWlzc2lvbnMoT3duQ2FwYWJpbGl0eS5VUERBVEVfQ0FMTF9QRVJNSVNTSU9OUyk7XG4gICAgY29uc3QgbG9jYWxVc2VySWQgPSBsb2NhbFBhcnRpY2lwYW50Py51c2VySWQ7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKCFjYWxsIHx8ICFjYW5VcGRhdGVDYWxsUGVybWlzc2lvbnMpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHJldHVybiBjYWxsLm9uKCdjYWxsLnBlcm1pc3Npb25fcmVxdWVzdCcsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGV2ZW50LnVzZXIuaWQgIT09IGxvY2FsVXNlcklkKSB7XG4gICAgICAgICAgICAgICAgc2V0UGVybWlzc2lvblJlcXVlc3RzKChyZXF1ZXN0cykgPT4gWy4uLnJlcXVlc3RzLCBldmVudF0uc29ydCgoYSwgYikgPT4gYnlOYW1lT3JJZChhLnVzZXIsIGIudXNlcikpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSwgW2NhbGwsIGNhblVwZGF0ZUNhbGxQZXJtaXNzaW9ucywgbG9jYWxVc2VySWRdKTtcbiAgICBjb25zdCBoYW5kbGVVcGRhdGVQZXJtaXNzaW9uID0gKHJlcXVlc3QsIHR5cGUpID0+IHtcbiAgICAgICAgcmV0dXJuIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgdXNlciwgcGVybWlzc2lvbnMgfSA9IHJlcXVlc3Q7XG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdncmFudCc6XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGNhbGw/LmdyYW50UGVybWlzc2lvbnModXNlci5pZCwgcGVybWlzc2lvbnMpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdyZXZva2UnOlxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBjYWxsPy5yZXZva2VQZXJtaXNzaW9ucyh1c2VyLmlkLCBwZXJtaXNzaW9ucyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0UGVybWlzc2lvblJlcXVlc3RzKChyZXF1ZXN0cykgPT4gcmVxdWVzdHMuZmlsdGVyKChyKSA9PiByICE9PSByZXF1ZXN0KSk7XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBjb25zdCB7IHJlZnMsIHgsIHksIHN0cmF0ZWd5IH0gPSB1c2VGbG9hdGluZ1VJUHJlc2V0KHtcbiAgICAgICAgcGxhY2VtZW50OiAnYm90dG9tJyxcbiAgICAgICAgc3RyYXRlZ3k6ICdhYnNvbHV0ZScsXG4gICAgfSk7XG4gICAgLy8gZG9uJ3QgcmVuZGVyIGFueXRoaW5nIGlmIHRoZXJlIGFyZSBubyBwZXJtaXNzaW9uIHJlcXVlc3RzXG4gICAgaWYgKHBlcm1pc3Npb25SZXF1ZXN0cy5sZW5ndGggPT09IDApXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIHJldHVybiAoanN4cyhcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3Blcm1pc3Npb24tcmVxdWVzdHNcIiwgcmVmOiByZWZzLnNldFJlZmVyZW5jZSwgY2hpbGRyZW46IFtqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fcGVybWlzc2lvbi1yZXF1ZXN0c19fbm90aWZpY2F0aW9uXCIsIGNoaWxkcmVuOiBbanN4cyhcInNwYW5cIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19wZXJtaXNzaW9uLXJlcXVlc3RzX19ub3RpZmljYXRpb25fX21lc3NhZ2VcIiwgY2hpbGRyZW46IFtwZXJtaXNzaW9uUmVxdWVzdHMubGVuZ3RoLCBcIiBwZW5kaW5nIHBlcm1pc3Npb24gcmVxdWVzdHNcIl0gfSksIGpzeChCdXR0b24sIHsgdHlwZTogXCJidXR0b25cIiwgb25DbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldEV4cGFuZGVkKChlKSA9PiAhZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBjaGlsZHJlbjogZXhwYW5kZWQgPyAnSGlkZSByZXF1ZXN0cycgOiAnU2hvdyByZXF1ZXN0cycgfSldIH0pLCBleHBhbmRlZCAmJiAoanN4KFBlcm1pc3Npb25SZXF1ZXN0TGlzdCwgeyByZWY6IHJlZnMuc2V0RmxvYXRpbmcsIHN0eWxlOiB7XG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBzdHJhdGVneSxcbiAgICAgICAgICAgICAgICAgICAgdG9wOiB5ID8/IDAsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IHggPz8gMCxcbiAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3dZOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgfSwgcGVybWlzc2lvblJlcXVlc3RzOiBwZXJtaXNzaW9uUmVxdWVzdHMsIGhhbmRsZVVwZGF0ZVBlcm1pc3Npb246IGhhbmRsZVVwZGF0ZVBlcm1pc3Npb24gfSkpXSB9KSk7XG59O1xuY29uc3QgUGVybWlzc2lvblJlcXVlc3RMaXN0ID0gZm9yd2FyZFJlZihmdW5jdGlvbiBQZXJtaXNzaW9uUmVxdWVzdExpc3QocHJvcHMsIHJlZikge1xuICAgIGNvbnN0IHsgcGVybWlzc2lvblJlcXVlc3RzLCBoYW5kbGVVcGRhdGVQZXJtaXNzaW9uLCAuLi5yZXN0IH0gPSBwcm9wcztcbiAgICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcbiAgICByZXR1cm4gKGpzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3Blcm1pc3Npb24tcmVxdWVzdHMtbGlzdFwiLCByZWY6IHJlZiwgLi4ucmVzdCwgY2hpbGRyZW46IHBlcm1pc3Npb25SZXF1ZXN0cy5tYXAoKHJlcXVlc3QsIHJlcUluZGV4KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHVzZXIsIHBlcm1pc3Npb25zIH0gPSByZXF1ZXN0O1xuICAgICAgICAgICAgcmV0dXJuIChqc3goRnJhZ21lbnQkMSwgeyBjaGlsZHJlbjogcGVybWlzc2lvbnMubWFwKChwZXJtaXNzaW9uKSA9PiAoanN4cyhcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3Blcm1pc3Npb24tcmVxdWVzdFwiLCBjaGlsZHJlbjogW2pzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3Blcm1pc3Npb24tcmVxdWVzdF9fbWVzc2FnZVwiLCBjaGlsZHJlbjogbWVzc2FnZUZvclBlcm1pc3Npb24odXNlci5uYW1lIHx8IHVzZXIuaWQsIHBlcm1pc3Npb24sIHQpIH0pLCBqc3goQnV0dG9uLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3Blcm1pc3Npb24tcmVxdWVzdF9fYnV0dG9uLS1hbGxvd1wiLCB0eXBlOiBcImJ1dHRvblwiLCBvbkNsaWNrOiBoYW5kbGVVcGRhdGVQZXJtaXNzaW9uKHJlcXVlc3QsICdncmFudCcpLCBjaGlsZHJlbjogdCgnQWxsb3cnKSB9KSwganN4KEJ1dHRvbiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19wZXJtaXNzaW9uLXJlcXVlc3RfX2J1dHRvbi0tcmVqZWN0XCIsIHR5cGU6IFwiYnV0dG9uXCIsIG9uQ2xpY2s6IGhhbmRsZVVwZGF0ZVBlcm1pc3Npb24ocmVxdWVzdCwgJ3Jldm9rZScpLCBjaGlsZHJlbjogdCgnUmV2b2tlJykgfSksIGpzeChCdXR0b24sIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fcGVybWlzc2lvbi1yZXF1ZXN0X19idXR0b24tLXJlamVjdFwiLCB0eXBlOiBcImJ1dHRvblwiLCBvbkNsaWNrOiBoYW5kbGVVcGRhdGVQZXJtaXNzaW9uKHJlcXVlc3QsICdkaXNtaXNzJyksIGNoaWxkcmVuOiB0KCdEaXNtaXNzJykgfSldIH0sIHBlcm1pc3Npb24pKSkgfSwgYCR7dXNlci5pZH0vJHtyZXFJbmRleH1gKSk7XG4gICAgICAgIH0pIH0pKTtcbn0pO1xuY29uc3QgQnV0dG9uID0gKHByb3BzKSA9PiB7XG4gICAgY29uc3QgeyBjbGFzc05hbWUsIC4uLnJlc3QgfSA9IHByb3BzO1xuICAgIHJldHVybiAoanN4KFwiYnV0dG9uXCIsIHsgY2xhc3NOYW1lOiBjbHN4KCdzdHItdmlkZW9fX3Blcm1pc3Npb24tcmVxdWVzdF9fYnV0dG9uJywgY2xhc3NOYW1lKSwgLi4ucmVzdCB9KSk7XG59O1xuY29uc3QgbWVzc2FnZUZvclBlcm1pc3Npb24gPSAodXNlck5hbWUsIHBlcm1pc3Npb24sIHQpID0+IHtcbiAgICBzd2l0Y2ggKHBlcm1pc3Npb24pIHtcbiAgICAgICAgY2FzZSBPd25DYXBhYmlsaXR5LlNFTkRfQVVESU86XG4gICAgICAgICAgICByZXR1cm4gdCgne3sgdXNlck5hbWUgfX0gaXMgcmVxdWVzdGluZyB0byBzcGVhaycsIHsgdXNlck5hbWUgfSk7XG4gICAgICAgIGNhc2UgT3duQ2FwYWJpbGl0eS5TRU5EX1ZJREVPOlxuICAgICAgICAgICAgcmV0dXJuIHQoJ3t7IHVzZXJOYW1lIH19IGlzIHJlcXVlc3RpbmcgdG8gc2hhcmUgdGhlaXIgY2FtZXJhJywge1xuICAgICAgICAgICAgICAgIHVzZXJOYW1lLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIGNhc2UgT3duQ2FwYWJpbGl0eS5TQ1JFRU5TSEFSRTpcbiAgICAgICAgICAgIHJldHVybiB0KCd7eyB1c2VyTmFtZSB9fSBpcyByZXF1ZXN0aW5nIHRvIHByZXNlbnQgdGhlaXIgc2NyZWVuJywge1xuICAgICAgICAgICAgICAgIHVzZXJOYW1lLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gdCgne3sgdXNlck5hbWUgfX0gaXMgcmVxdWVzdGluZyBwZXJtaXNzaW9uOiB7eyBwZXJtaXNzaW9uIH19Jywge1xuICAgICAgICAgICAgICAgIHVzZXJOYW1lLFxuICAgICAgICAgICAgICAgIHBlcm1pc3Npb24sXG4gICAgICAgICAgICB9KTtcbiAgICB9XG59O1xuXG5jb25zdCBTdHJlYW1UaGVtZSA9ICh7IGFzOiBDb21wb25lbnQgPSAnZGl2JywgY2xhc3NOYW1lLCBjaGlsZHJlbiwgLi4ucHJvcHMgfSkgPT4ge1xuICAgIHJldHVybiAoanN4KENvbXBvbmVudCwgeyAuLi5wcm9wcywgY2xhc3NOYW1lOiBjbHN4KCdzdHItdmlkZW8nLCBjbGFzc05hbWUpLCBjaGlsZHJlbjogY2hpbGRyZW4gfSkpO1xufTtcblxuY29uc3QgRGVmYXVsdFZpZGVvUGxhY2Vob2xkZXIgPSBmb3J3YXJkUmVmKGZ1bmN0aW9uIERlZmF1bHRWaWRlb1BsYWNlaG9sZGVyKHsgcGFydGljaXBhbnQsIHN0eWxlIH0sIHJlZikge1xuICAgIGNvbnN0IHsgdCB9ID0gdXNlSTE4bigpO1xuICAgIGNvbnN0IFtlcnJvciwgc2V0RXJyb3JdID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IG5hbWUgPSBwYXJ0aWNpcGFudC5uYW1lIHx8IHBhcnRpY2lwYW50LnVzZXJJZDtcbiAgICByZXR1cm4gKGpzeHMoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX192aWRlby1wbGFjZWhvbGRlclwiLCBzdHlsZTogc3R5bGUsIHJlZjogcmVmLCBjaGlsZHJlbjogWyghcGFydGljaXBhbnQuaW1hZ2UgfHwgZXJyb3IpICYmXG4gICAgICAgICAgICAgICAgKG5hbWUgPyAoanN4KEluaXRpYWxzRmFsbGJhY2ssIHsgbmFtZTogbmFtZSB9KSkgOiAoanN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fdmlkZW8tcGxhY2Vob2xkZXJfX25vLXZpZGVvLWxhYmVsXCIsIGNoaWxkcmVuOiB0KCdWaWRlbyBpcyBkaXNhYmxlZCcpIH0pKSksIHBhcnRpY2lwYW50LmltYWdlICYmICFlcnJvciAmJiAoanN4KFwiaW1nXCIsIHsgb25FcnJvcjogKCkgPT4gc2V0RXJyb3IodHJ1ZSksIGFsdDogXCJ2aWRlby1wbGFjZWhvbGRlclwiLCBjbGFzc05hbWU6IFwic3RyLXZpZGVvX192aWRlby1wbGFjZWhvbGRlcl9fYXZhdGFyXCIsIHNyYzogcGFydGljaXBhbnQuaW1hZ2UgfSkpXSB9KSk7XG59KTtcbmNvbnN0IEluaXRpYWxzRmFsbGJhY2sgPSAocHJvcHMpID0+IHtcbiAgICBjb25zdCB7IG5hbWUgfSA9IHByb3BzO1xuICAgIGNvbnN0IGluaXRpYWxzID0gbmFtZVxuICAgICAgICAuc3BsaXQoJyAnKVxuICAgICAgICAuc2xpY2UoMCwgMilcbiAgICAgICAgLm1hcCgobikgPT4gblswXSlcbiAgICAgICAgLmpvaW4oJycpO1xuICAgIHJldHVybiAoanN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fdmlkZW8tcGxhY2Vob2xkZXJfX2luaXRpYWxzLWZhbGxiYWNrXCIsIGNoaWxkcmVuOiBpbml0aWFscyB9KSk7XG59O1xuXG5jb25zdCBWaWRlbyQxID0gKHsgdHJhY2tUeXBlLCBwYXJ0aWNpcGFudCwgY2xhc3NOYW1lLCBWaWRlb1BsYWNlaG9sZGVyID0gRGVmYXVsdFZpZGVvUGxhY2Vob2xkZXIsIHJlZnMsIC4uLnJlc3QgfSkgPT4ge1xuICAgIGNvbnN0IHsgc2Vzc2lvbklkLCB2aWRlb1N0cmVhbSwgc2NyZWVuU2hhcmVTdHJlYW0sIHB1Ymxpc2hlZFRyYWNrcywgdmlld3BvcnRWaXNpYmlsaXR5U3RhdGUsIGlzTG9jYWxQYXJ0aWNpcGFudCwgdXNlcklkLCB9ID0gcGFydGljaXBhbnQ7XG4gICAgY29uc3QgY2FsbCA9IHVzZUNhbGwoKTtcbiAgICBjb25zdCBbdmlkZW9FbGVtZW50LCBzZXRWaWRlb0VsZW1lbnRdID0gdXNlU3RhdGUobnVsbCk7XG4gICAgLy8gc3RhcnQgd2l0aCB0cnVlLCB3aWxsIGZsaXAgb25jZSB0aGUgdmlkZW8gc3RhcnRzIHBsYXlpbmdcbiAgICBjb25zdCBbaXNWaWRlb1BhdXNlZCwgc2V0SXNWaWRlb1BhdXNlZF0gPSB1c2VTdGF0ZSh0cnVlKTtcbiAgICBjb25zdCBbaXNXaWRlTW9kZSwgc2V0SXNXaWRlTW9kZV0gPSB1c2VTdGF0ZSh0cnVlKTtcbiAgICBjb25zdCBzdHJlYW0gPSB0cmFja1R5cGUgPT09ICd2aWRlb1RyYWNrJ1xuICAgICAgICA/IHZpZGVvU3RyZWFtXG4gICAgICAgIDogdHJhY2tUeXBlID09PSAnc2NyZWVuU2hhcmVUcmFjaydcbiAgICAgICAgICAgID8gc2NyZWVuU2hhcmVTdHJlYW1cbiAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgIHVzZUxheW91dEVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmICghY2FsbCB8fCAhdmlkZW9FbGVtZW50IHx8IHRyYWNrVHlwZSA9PT0gJ25vbmUnKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBjbGVhbnVwID0gY2FsbC5iaW5kVmlkZW9FbGVtZW50KHZpZGVvRWxlbWVudCwgc2Vzc2lvbklkLCB0cmFja1R5cGUpO1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgY2xlYW51cD8uKCk7XG4gICAgICAgIH07XG4gICAgfSwgW2NhbGwsIHRyYWNrVHlwZSwgc2Vzc2lvbklkLCB2aWRlb0VsZW1lbnRdKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoIXN0cmVhbSB8fCAhdmlkZW9FbGVtZW50KVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBbdHJhY2tdID0gc3RyZWFtLmdldFZpZGVvVHJhY2tzKCk7XG4gICAgICAgIGlmICghdHJhY2spXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGhhbmRsZVBsYXlQYXVzZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHNldElzVmlkZW9QYXVzZWQodmlkZW9FbGVtZW50LnBhdXNlZCk7XG4gICAgICAgICAgICBjb25zdCB7IHdpZHRoID0gMCwgaGVpZ2h0ID0gMCB9ID0gdHJhY2suZ2V0U2V0dGluZ3MoKTtcbiAgICAgICAgICAgIHNldElzV2lkZU1vZGUod2lkdGggPj0gaGVpZ2h0KTtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gcGxheWJhY2sgbWF5IGhhdmUgc3RhcnRlZCBiZWZvcmUgd2UgaGFkIGEgY2hhbmNlIHRvXG4gICAgICAgIC8vIGF0dGFjaCB0aGUgJ3BsYXkvcGF1c2UnIGV2ZW50IGxpc3RlbmVyLCBzbyB3ZSBzZXQgdGhlIHN0YXRlXG4gICAgICAgIC8vIGhlcmUgdG8gbWFrZSBzdXJlIGl0J3MgaW4gc3luY1xuICAgICAgICBzZXRJc1ZpZGVvUGF1c2VkKHZpZGVvRWxlbWVudC5wYXVzZWQpO1xuICAgICAgICB2aWRlb0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncGxheScsIGhhbmRsZVBsYXlQYXVzZSk7XG4gICAgICAgIHZpZGVvRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdwYXVzZScsIGhhbmRsZVBsYXlQYXVzZSk7XG4gICAgICAgIHRyYWNrLmFkZEV2ZW50TGlzdGVuZXIoJ3VubXV0ZScsIGhhbmRsZVBsYXlQYXVzZSk7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICB2aWRlb0VsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncGxheScsIGhhbmRsZVBsYXlQYXVzZSk7XG4gICAgICAgICAgICB2aWRlb0VsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncGF1c2UnLCBoYW5kbGVQbGF5UGF1c2UpO1xuICAgICAgICAgICAgdHJhY2sucmVtb3ZlRXZlbnRMaXN0ZW5lcigndW5tdXRlJywgaGFuZGxlUGxheVBhdXNlKTtcbiAgICAgICAgICAgIC8vIHJlc2V0IHRoZSAncGF1c2UnIHN0YXRlIG9uY2Ugd2UgdW5tb3VudCB0aGUgdmlkZW8gZWxlbWVudFxuICAgICAgICAgICAgc2V0SXNWaWRlb1BhdXNlZCh0cnVlKTtcbiAgICAgICAgfTtcbiAgICB9LCBbc3RyZWFtLCB2aWRlb0VsZW1lbnRdKTtcbiAgICBpZiAoIWNhbGwpXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIGNvbnN0IGlzUHVibGlzaGluZ1RyYWNrID0gdHJhY2tUeXBlID09PSAndmlkZW9UcmFjaydcbiAgICAgICAgPyBwdWJsaXNoZWRUcmFja3MuaW5jbHVkZXMoU2Z1TW9kZWxzLlRyYWNrVHlwZS5WSURFTylcbiAgICAgICAgOiB0cmFja1R5cGUgPT09ICdzY3JlZW5TaGFyZVRyYWNrJ1xuICAgICAgICAgICAgPyBwdWJsaXNoZWRUcmFja3MuaW5jbHVkZXMoU2Z1TW9kZWxzLlRyYWNrVHlwZS5TQ1JFRU5fU0hBUkUpXG4gICAgICAgICAgICA6IGZhbHNlO1xuICAgIGNvbnN0IGlzSW52aXNpYmxlID0gdHJhY2tUeXBlID09PSAnbm9uZScgfHxcbiAgICAgICAgdmlld3BvcnRWaXNpYmlsaXR5U3RhdGU/Llt0cmFja1R5cGVdID09PSBWaXNpYmlsaXR5U3RhdGUuSU5WSVNJQkxFO1xuICAgIGNvbnN0IGhhc05vVmlkZW9PckludmlzaWJsZSA9ICFpc1B1Ymxpc2hpbmdUcmFjayB8fCBpc0ludmlzaWJsZTtcbiAgICBjb25zdCBtaXJyb3JWaWRlbyA9IGlzTG9jYWxQYXJ0aWNpcGFudCAmJiB0cmFja1R5cGUgPT09ICd2aWRlb1RyYWNrJztcbiAgICBjb25zdCBpc1NjcmVlblNoYXJlVHJhY2sgPSB0cmFja1R5cGUgPT09ICdzY3JlZW5TaGFyZVRyYWNrJztcbiAgICByZXR1cm4gKGpzeHMoRnJhZ21lbnQsIHsgY2hpbGRyZW46IFshaGFzTm9WaWRlb09ySW52aXNpYmxlICYmIChqc3goXCJ2aWRlb1wiLCB7IC4uLnJlc3QsIGNsYXNzTmFtZTogY2xzeCgnc3RyLXZpZGVvX192aWRlbycsIGNsYXNzTmFtZSwge1xuICAgICAgICAgICAgICAgICAgICAnc3RyLXZpZGVvX192aWRlby0tbm90LXBsYXlpbmcnOiBpc1ZpZGVvUGF1c2VkLFxuICAgICAgICAgICAgICAgICAgICAnc3RyLXZpZGVvX192aWRlby0tdGFsbCc6ICFpc1dpZGVNb2RlLFxuICAgICAgICAgICAgICAgICAgICAnc3RyLXZpZGVvX192aWRlby0tbWlycm9yJzogbWlycm9yVmlkZW8sXG4gICAgICAgICAgICAgICAgICAgICdzdHItdmlkZW9fX3ZpZGVvLS1zY3JlZW4tc2hhcmUnOiBpc1NjcmVlblNoYXJlVHJhY2ssXG4gICAgICAgICAgICAgICAgfSksIFwiZGF0YS11c2VyLWlkXCI6IHVzZXJJZCwgXCJkYXRhLXNlc3Npb24taWRcIjogc2Vzc2lvbklkLCByZWY6IChlbGVtZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHNldFZpZGVvRWxlbWVudChlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgcmVmcz8uc2V0VmlkZW9FbGVtZW50Py4oZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfSB9KSksIChoYXNOb1ZpZGVvT3JJbnZpc2libGUgfHwgaXNWaWRlb1BhdXNlZCkgJiYgVmlkZW9QbGFjZWhvbGRlciAmJiAoanN4KFZpZGVvUGxhY2Vob2xkZXIsIHsgc3R5bGU6IHsgcG9zaXRpb246ICdhYnNvbHV0ZScgfSwgcGFydGljaXBhbnQ6IHBhcnRpY2lwYW50LCByZWY6IHJlZnM/LnNldFZpZGVvUGxhY2Vob2xkZXJFbGVtZW50IH0pKV0gfSkpO1xufTtcblxuLyoqXG4gKiBAZGVzY3JpcHRpb24gRXh0ZW5kcyB2aWRlbyBlbGVtZW50IHdpdGggYHN0cmVhbWAgcHJvcGVydHlcbiAqIChgc3JjT2JqZWN0YCkgdG8gcmVhY3RpdmVseSBoYW5kbGUgc3RyZWFtIGNoYW5nZXNcbiAqL1xuY29uc3QgQmFzZVZpZGVvID0gZm9yd2FyZFJlZihmdW5jdGlvbiBCYXNlVmlkZW8oeyBzdHJlYW0sIC4uLnJlc3QgfSwgcmVmKSB7XG4gICAgY29uc3QgW3ZpZGVvRWxlbWVudCwgc2V0VmlkZW9FbGVtZW50XSA9IHVzZVN0YXRlKG51bGwpO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmICghdmlkZW9FbGVtZW50IHx8ICFzdHJlYW0pXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGlmIChzdHJlYW0gPT09IHZpZGVvRWxlbWVudC5zcmNPYmplY3QpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHZpZGVvRWxlbWVudC5zcmNPYmplY3QgPSBzdHJlYW07XG4gICAgICAgIGlmIChCcm93c2Vycy5pc1NhZmFyaSgpIHx8IEJyb3dzZXJzLmlzRmlyZWZveCgpKSB7XG4gICAgICAgICAgICAvLyBGaXJlZm94IGFuZCBTYWZhcmkgaGF2ZSBzb21lIHRpbWluZyBpc3N1ZVxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmlkZW9FbGVtZW50LnNyY09iamVjdCA9IHN0cmVhbTtcbiAgICAgICAgICAgICAgICB2aWRlb0VsZW1lbnQucGxheSgpLmNhdGNoKChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBwbGF5IHN0cmVhbWAsIGUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIHZpZGVvRWxlbWVudC5wYXVzZSgpO1xuICAgICAgICAgICAgdmlkZW9FbGVtZW50LnNyY09iamVjdCA9IG51bGw7XG4gICAgICAgIH07XG4gICAgfSwgW3N0cmVhbSwgdmlkZW9FbGVtZW50XSk7XG4gICAgcmV0dXJuIChqc3goXCJ2aWRlb1wiLCB7IGF1dG9QbGF5OiB0cnVlLCBwbGF5c0lubGluZTogdHJ1ZSwgLi4ucmVzdCwgcmVmOiAoZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgYXBwbHlFbGVtZW50VG9SZWYocmVmLCBlbGVtZW50KTtcbiAgICAgICAgICAgIHNldFZpZGVvRWxlbWVudChlbGVtZW50KTtcbiAgICAgICAgfSB9KSk7XG59KTtcblxuY29uc3QgRGVmYXVsdERpc2FibGVkVmlkZW9QcmV2aWV3ID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgdCB9ID0gdXNlSTE4bigpO1xuICAgIHJldHVybiAoanN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0cl92aWRlb19fdmlkZW8tcHJldmlld19fZGlzYWJsZWQtdmlkZW8tcHJldmlld1wiLCBjaGlsZHJlbjogdCgnVmlkZW8gaXMgZGlzYWJsZWQnKSB9KSk7XG59O1xuY29uc3QgRGVmYXVsdE5vQ2FtZXJhUHJldmlldyA9ICgpID0+IHtcbiAgICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcbiAgICByZXR1cm4gKGpzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHJfdmlkZW9fX3ZpZGVvLXByZXZpZXdfX25vLWNhbWVyYS1wcmV2aWV3XCIsIGNoaWxkcmVuOiB0KCdObyBjYW1lcmEgZm91bmQnKSB9KSk7XG59O1xuY29uc3QgVmlkZW9QcmV2aWV3ID0gKHsgY2xhc3NOYW1lLCBtaXJyb3IgPSB0cnVlLCBEaXNhYmxlZFZpZGVvUHJldmlldyA9IERlZmF1bHREaXNhYmxlZFZpZGVvUHJldmlldywgTm9DYW1lcmFQcmV2aWV3ID0gRGVmYXVsdE5vQ2FtZXJhUHJldmlldywgU3RhcnRpbmdDYW1lcmFQcmV2aWV3ID0gTG9hZGluZ0luZGljYXRvciwgfSkgPT4ge1xuICAgIGNvbnN0IHsgdXNlQ2FtZXJhU3RhdGUgfSA9IHVzZUNhbGxTdGF0ZUhvb2tzKCk7XG4gICAgY29uc3QgeyBkZXZpY2VzLCBzdGF0dXMsIGlzTXV0ZSwgbWVkaWFTdHJlYW0gfSA9IHVzZUNhbWVyYVN0YXRlKCk7XG4gICAgbGV0IGNvbnRlbnRzO1xuICAgIGlmIChpc011dGUgJiYgZGV2aWNlcz8ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGNvbnRlbnRzID0ganN4KE5vQ2FtZXJhUHJldmlldywge30pO1xuICAgIH1cbiAgICBlbHNlIGlmIChzdGF0dXMgPT09ICdlbmFibGVkJykge1xuICAgICAgICBjb25zdCBsb2FkaW5nID0gIW1lZGlhU3RyZWFtO1xuICAgICAgICBjb250ZW50cyA9IChqc3hzKEZyYWdtZW50LCB7IGNoaWxkcmVuOiBbbWVkaWFTdHJlYW0gJiYgKGpzeChCYXNlVmlkZW8sIHsgc3RyZWFtOiBtZWRpYVN0cmVhbSwgY2xhc3NOYW1lOiBjbHN4KCdzdHItdmlkZW9fX3ZpZGVvLXByZXZpZXcnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnc3RyLXZpZGVvX192aWRlby1wcmV2aWV3LS1taXJyb3InOiBtaXJyb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAnc3RyLXZpZGVvX192aWRlby1wcmV2aWV3LS1sb2FkaW5nJzogbG9hZGluZyxcbiAgICAgICAgICAgICAgICAgICAgfSkgfSkpLCBsb2FkaW5nICYmIGpzeChTdGFydGluZ0NhbWVyYVByZXZpZXcsIHt9KV0gfSkpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29udGVudHMgPSBqc3goRGlzYWJsZWRWaWRlb1ByZXZpZXcsIHt9KTtcbiAgICB9XG4gICAgcmV0dXJuIChqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IGNsc3goJ3N0ci12aWRlb19fdmlkZW8tcHJldmlldy1jb250YWluZXInLCBjbGFzc05hbWUpLCBjaGlsZHJlbjogY29udGVudHMgfSkpO1xufTtcblxuY29uc3QgUGFydGljaXBhbnRBY3Rpb25zQ29udGV4dE1lbnUgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBwYXJ0aWNpcGFudCwgcGFydGljaXBhbnRWaWV3RWxlbWVudCwgdmlkZW9FbGVtZW50IH0gPSB1c2VQYXJ0aWNpcGFudFZpZXdDb250ZXh0KCk7XG4gICAgY29uc3QgW2Z1bGxzY3JlZW5Nb2RlT24sIHNldEZ1bGxzY3JlZW5Nb2RlT25dID0gdXNlU3RhdGUoISFkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCk7XG4gICAgY29uc3QgW3BpY3R1cmVJblBpY3R1cmVFbGVtZW50LCBzZXRQaWN0dXJlSW5QaWN0dXJlRWxlbWVudF0gPSB1c2VTdGF0ZShkb2N1bWVudC5waWN0dXJlSW5QaWN0dXJlRWxlbWVudCk7XG4gICAgY29uc3QgY2FsbCA9IHVzZUNhbGwoKTtcbiAgICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcbiAgICBjb25zdCB7IHBpbiwgcHVibGlzaGVkVHJhY2tzLCBzZXNzaW9uSWQsIHVzZXJJZCB9ID0gcGFydGljaXBhbnQ7XG4gICAgY29uc3QgaGFzQXVkaW8gPSBwdWJsaXNoZWRUcmFja3MuaW5jbHVkZXMoU2Z1TW9kZWxzLlRyYWNrVHlwZS5BVURJTyk7XG4gICAgY29uc3QgaGFzVmlkZW8gPSBwdWJsaXNoZWRUcmFja3MuaW5jbHVkZXMoU2Z1TW9kZWxzLlRyYWNrVHlwZS5WSURFTyk7XG4gICAgY29uc3QgaGFzU2NyZWVuU2hhcmUgPSBwdWJsaXNoZWRUcmFja3MuaW5jbHVkZXMoU2Z1TW9kZWxzLlRyYWNrVHlwZS5TQ1JFRU5fU0hBUkUpO1xuICAgIGNvbnN0IGhhc1NjcmVlblNoYXJlQXVkaW8gPSBwdWJsaXNoZWRUcmFja3MuaW5jbHVkZXMoU2Z1TW9kZWxzLlRyYWNrVHlwZS5TQ1JFRU5fU0hBUkVfQVVESU8pO1xuICAgIGNvbnN0IGJsb2NrVXNlciA9ICgpID0+IGNhbGw/LmJsb2NrVXNlcih1c2VySWQpO1xuICAgIGNvbnN0IG11dGVBdWRpbyA9ICgpID0+IGNhbGw/Lm11dGVVc2VyKHVzZXJJZCwgJ2F1ZGlvJyk7XG4gICAgY29uc3QgbXV0ZVZpZGVvID0gKCkgPT4gY2FsbD8ubXV0ZVVzZXIodXNlcklkLCAndmlkZW8nKTtcbiAgICBjb25zdCBtdXRlU2NyZWVuU2hhcmUgPSAoKSA9PiBjYWxsPy5tdXRlVXNlcih1c2VySWQsICdzY3JlZW5zaGFyZScpO1xuICAgIGNvbnN0IG11dGVTY3JlZW5TaGFyZUF1ZGlvID0gKCkgPT4gY2FsbD8ubXV0ZVVzZXIodXNlcklkLCAnc2NyZWVuc2hhcmVfYXVkaW8nKTtcbiAgICBjb25zdCBncmFudFBlcm1pc3Npb24gPSAocGVybWlzc2lvbikgPT4gKCkgPT4ge1xuICAgICAgICBjYWxsPy51cGRhdGVVc2VyUGVybWlzc2lvbnMoe1xuICAgICAgICAgICAgdXNlcl9pZDogdXNlcklkLFxuICAgICAgICAgICAgZ3JhbnRfcGVybWlzc2lvbnM6IFtwZXJtaXNzaW9uXSxcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjb25zdCByZXZva2VQZXJtaXNzaW9uID0gKHBlcm1pc3Npb24pID0+ICgpID0+IHtcbiAgICAgICAgY2FsbD8udXBkYXRlVXNlclBlcm1pc3Npb25zKHtcbiAgICAgICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgICAgIHJldm9rZV9wZXJtaXNzaW9uczogW3Blcm1pc3Npb25dLFxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGNvbnN0IHRvZ2dsZVBhcnRpY2lwYW50UGluID0gKCkgPT4ge1xuICAgICAgICBpZiAocGluKSB7XG4gICAgICAgICAgICBjYWxsPy51bnBpbihzZXNzaW9uSWQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY2FsbD8ucGluKHNlc3Npb25JZCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IHBpbkZvckV2ZXJ5b25lID0gKCkgPT4ge1xuICAgICAgICBjYWxsXG4gICAgICAgICAgICA/LnBpbkZvckV2ZXJ5b25lKHtcbiAgICAgICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgICAgIHNlc3Npb25faWQ6IHNlc3Npb25JZCxcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gcGluIHBhcnRpY2lwYW50ICR7dXNlcklkfWAsIGVycik7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgY29uc3QgdW5waW5Gb3JFdmVyeW9uZSA9ICgpID0+IHtcbiAgICAgICAgY2FsbFxuICAgICAgICAgICAgPy51bnBpbkZvckV2ZXJ5b25lKHtcbiAgICAgICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgICAgIHNlc3Npb25faWQ6IHNlc3Npb25JZCxcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gdW5waW4gcGFydGljaXBhbnQgJHt1c2VySWR9YCwgZXJyKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjb25zdCB0b2dnbGVGdWxsc2NyZWVuTW9kZSA9ICgpID0+IHtcbiAgICAgICAgaWYgKCFmdWxsc2NyZWVuTW9kZU9uKSB7XG4gICAgICAgICAgICByZXR1cm4gcGFydGljaXBhbnRWaWV3RWxlbWVudD8ucmVxdWVzdEZ1bGxzY3JlZW4oKS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4oKS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgICB9O1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIC8vIGhhbmRsZXMgdGhlIGNhc2Ugd2hlbiBmdWxsc2NyZWVuIG1vZGUgaXMgdG9nZ2xlZCBleHRlcm5hbGx5LFxuICAgICAgICAvLyBlLmcuLCBieSBwcmVzc2luZyBFU0Mga2V5IG9yIHNvbWUgb3RoZXIga2V5Ym9hcmQgc2hvcnRjdXRcbiAgICAgICAgY29uc3QgaGFuZGxlRnVsbHNjcmVlbkNoYW5nZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHNldEZ1bGxzY3JlZW5Nb2RlT24oISFkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCk7XG4gICAgICAgIH07XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5jaGFuZ2UnLCBoYW5kbGVGdWxsc2NyZWVuQ2hhbmdlKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5jaGFuZ2UnLCBoYW5kbGVGdWxsc2NyZWVuQ2hhbmdlKTtcbiAgICAgICAgfTtcbiAgICB9LCBbXSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKCF2aWRlb0VsZW1lbnQpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGhhbmRsZVBpUCA9ICgpID0+IHtcbiAgICAgICAgICAgIHNldFBpY3R1cmVJblBpY3R1cmVFbGVtZW50KGRvY3VtZW50LnBpY3R1cmVJblBpY3R1cmVFbGVtZW50KTtcbiAgICAgICAgfTtcbiAgICAgICAgdmlkZW9FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2VudGVycGljdHVyZWlucGljdHVyZScsIGhhbmRsZVBpUCk7XG4gICAgICAgIHZpZGVvRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdsZWF2ZXBpY3R1cmVpbnBpY3R1cmUnLCBoYW5kbGVQaVApO1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgdmlkZW9FbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2VudGVycGljdHVyZWlucGljdHVyZScsIGhhbmRsZVBpUCk7XG4gICAgICAgICAgICB2aWRlb0VsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbGVhdmVwaWN0dXJlaW5waWN0dXJlJywgaGFuZGxlUGlQKTtcbiAgICAgICAgfTtcbiAgICB9LCBbdmlkZW9FbGVtZW50XSk7XG4gICAgY29uc3QgdG9nZ2xlUGljdHVyZUluUGljdHVyZSA9ICgpID0+IHtcbiAgICAgICAgaWYgKHZpZGVvRWxlbWVudCAmJiBwaWN0dXJlSW5QaWN0dXJlRWxlbWVudCAhPT0gdmlkZW9FbGVtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gdmlkZW9FbGVtZW50XG4gICAgICAgICAgICAgICAgLnJlcXVlc3RQaWN0dXJlSW5QaWN0dXJlKClcbiAgICAgICAgICAgICAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmV4aXRQaWN0dXJlSW5QaWN0dXJlKCkuY2F0Y2goY29uc29sZS5lcnJvcik7XG4gICAgfTtcbiAgICBjb25zdCB7IGNsb3NlIH0gPSB1c2VNZW51Q29udGV4dCgpIHx8IHt9O1xuICAgIHJldHVybiAoanN4cyhHZW5lcmljTWVudSwgeyBvbkl0ZW1DbGljazogY2xvc2UsIGNoaWxkcmVuOiBbanN4cyhHZW5lcmljTWVudUJ1dHRvbkl0ZW0sIHsgb25DbGljazogdG9nZ2xlUGFydGljaXBhbnRQaW4sIGRpc2FibGVkOiBwaW4gJiYgIXBpbi5pc0xvY2FsUGluLCBjaGlsZHJlbjogW2pzeChJY29uLCB7IGljb246IFwicGluXCIgfSksIHBpbiA/IHQoJ1VucGluJykgOiB0KCdQaW4nKV0gfSksIGpzeHMoUmVzdHJpY3RlZCwgeyByZXF1aXJlZEdyYW50czogW093bkNhcGFiaWxpdHkuUElOX0ZPUl9FVkVSWU9ORV0sIGNoaWxkcmVuOiBbanN4cyhHZW5lcmljTWVudUJ1dHRvbkl0ZW0sIHsgb25DbGljazogcGluRm9yRXZlcnlvbmUsIGRpc2FibGVkOiBwaW4gJiYgIXBpbi5pc0xvY2FsUGluLCBjaGlsZHJlbjogW2pzeChJY29uLCB7IGljb246IFwicGluXCIgfSksIHQoJ1BpbiBmb3IgZXZlcnlvbmUnKV0gfSksIGpzeHMoR2VuZXJpY01lbnVCdXR0b25JdGVtLCB7IG9uQ2xpY2s6IHVucGluRm9yRXZlcnlvbmUsIGRpc2FibGVkOiAhcGluIHx8IHBpbi5pc0xvY2FsUGluLCBjaGlsZHJlbjogW2pzeChJY29uLCB7IGljb246IFwicGluXCIgfSksIHQoJ1VucGluIGZvciBldmVyeW9uZScpXSB9KV0gfSksIGpzeChSZXN0cmljdGVkLCB7IHJlcXVpcmVkR3JhbnRzOiBbT3duQ2FwYWJpbGl0eS5CTE9DS19VU0VSU10sIGNoaWxkcmVuOiBqc3hzKEdlbmVyaWNNZW51QnV0dG9uSXRlbSwgeyBvbkNsaWNrOiBibG9ja1VzZXIsIGNoaWxkcmVuOiBbanN4KEljb24sIHsgaWNvbjogXCJub3QtYWxsb3dlZFwiIH0pLCB0KCdCbG9jaycpXSB9KSB9KSwganN4cyhSZXN0cmljdGVkLCB7IHJlcXVpcmVkR3JhbnRzOiBbT3duQ2FwYWJpbGl0eS5NVVRFX1VTRVJTXSwgY2hpbGRyZW46IFtoYXNWaWRlbyAmJiAoanN4cyhHZW5lcmljTWVudUJ1dHRvbkl0ZW0sIHsgb25DbGljazogbXV0ZVZpZGVvLCBjaGlsZHJlbjogW2pzeChJY29uLCB7IGljb246IFwiY2FtZXJhLW9mZi1vdXRsaW5lXCIgfSksIHQoJ1R1cm4gb2ZmIHZpZGVvJyldIH0pKSwgaGFzU2NyZWVuU2hhcmUgJiYgKGpzeHMoR2VuZXJpY01lbnVCdXR0b25JdGVtLCB7IG9uQ2xpY2s6IG11dGVTY3JlZW5TaGFyZSwgY2hpbGRyZW46IFtqc3goSWNvbiwgeyBpY29uOiBcInNjcmVlbi1zaGFyZS1vZmZcIiB9KSwgdCgnVHVybiBvZmYgc2NyZWVuIHNoYXJlJyldIH0pKSwgaGFzQXVkaW8gJiYgKGpzeHMoR2VuZXJpY01lbnVCdXR0b25JdGVtLCB7IG9uQ2xpY2s6IG11dGVBdWRpbywgY2hpbGRyZW46IFtqc3goSWNvbiwgeyBpY29uOiBcIm5vLWF1ZGlvXCIgfSksIHQoJ011dGUgYXVkaW8nKV0gfSkpLCBoYXNTY3JlZW5TaGFyZUF1ZGlvICYmIChqc3hzKEdlbmVyaWNNZW51QnV0dG9uSXRlbSwgeyBvbkNsaWNrOiBtdXRlU2NyZWVuU2hhcmVBdWRpbywgY2hpbGRyZW46IFtqc3goSWNvbiwgeyBpY29uOiBcIm5vLWF1ZGlvXCIgfSksIHQoJ011dGUgc2NyZWVuIHNoYXJlIGF1ZGlvJyldIH0pKV0gfSksIHBhcnRpY2lwYW50Vmlld0VsZW1lbnQgJiYgKGpzeChHZW5lcmljTWVudUJ1dHRvbkl0ZW0sIHsgb25DbGljazogdG9nZ2xlRnVsbHNjcmVlbk1vZGUsIGNoaWxkcmVuOiB0KCd7eyBkaXJlY3Rpb24gfX0gZnVsbHNjcmVlbicsIHtcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiBmdWxsc2NyZWVuTW9kZU9uID8gdCgnTGVhdmUnKSA6IHQoJ0VudGVyJyksXG4gICAgICAgICAgICAgICAgfSkgfSkpLCB2aWRlb0VsZW1lbnQgJiYgZG9jdW1lbnQucGljdHVyZUluUGljdHVyZUVuYWJsZWQgJiYgKGpzeChHZW5lcmljTWVudUJ1dHRvbkl0ZW0sIHsgb25DbGljazogdG9nZ2xlUGljdHVyZUluUGljdHVyZSwgY2hpbGRyZW46IHQoJ3t7IGRpcmVjdGlvbiB9fSBwaWN0dXJlLWluLXBpY3R1cmUnLCB7XG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogcGljdHVyZUluUGljdHVyZUVsZW1lbnQgPT09IHZpZGVvRWxlbWVudFxuICAgICAgICAgICAgICAgICAgICAgICAgPyB0KCdMZWF2ZScpXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHQoJ0VudGVyJyksXG4gICAgICAgICAgICAgICAgfSkgfSkpLCBqc3hzKFJlc3RyaWN0ZWQsIHsgcmVxdWlyZWRHcmFudHM6IFtPd25DYXBhYmlsaXR5LlVQREFURV9DQUxMX1BFUk1JU1NJT05TXSwgY2hpbGRyZW46IFtqc3goR2VuZXJpY01lbnVCdXR0b25JdGVtLCB7IG9uQ2xpY2s6IGdyYW50UGVybWlzc2lvbihPd25DYXBhYmlsaXR5LlNFTkRfQVVESU8pLCBjaGlsZHJlbjogdCgnQWxsb3cgYXVkaW8nKSB9KSwganN4KEdlbmVyaWNNZW51QnV0dG9uSXRlbSwgeyBvbkNsaWNrOiBncmFudFBlcm1pc3Npb24oT3duQ2FwYWJpbGl0eS5TRU5EX1ZJREVPKSwgY2hpbGRyZW46IHQoJ0FsbG93IHZpZGVvJykgfSksIGpzeChHZW5lcmljTWVudUJ1dHRvbkl0ZW0sIHsgb25DbGljazogZ3JhbnRQZXJtaXNzaW9uKE93bkNhcGFiaWxpdHkuU0NSRUVOU0hBUkUpLCBjaGlsZHJlbjogdCgnQWxsb3cgc2NyZWVuIHNoYXJpbmcnKSB9KSwganN4KEdlbmVyaWNNZW51QnV0dG9uSXRlbSwgeyBvbkNsaWNrOiByZXZva2VQZXJtaXNzaW9uKE93bkNhcGFiaWxpdHkuU0VORF9BVURJTyksIGNoaWxkcmVuOiB0KCdEaXNhYmxlIGF1ZGlvJykgfSksIGpzeChHZW5lcmljTWVudUJ1dHRvbkl0ZW0sIHsgb25DbGljazogcmV2b2tlUGVybWlzc2lvbihPd25DYXBhYmlsaXR5LlNFTkRfVklERU8pLCBjaGlsZHJlbjogdCgnRGlzYWJsZSB2aWRlbycpIH0pLCBqc3goR2VuZXJpY01lbnVCdXR0b25JdGVtLCB7IG9uQ2xpY2s6IHJldm9rZVBlcm1pc3Npb24oT3duQ2FwYWJpbGl0eS5TQ1JFRU5TSEFSRSksIGNoaWxkcmVuOiB0KCdEaXNhYmxlIHNjcmVlbiBzaGFyaW5nJykgfSldIH0pXSB9KSk7XG59O1xuXG5jb25zdCB1c2VUcmFja0VsZW1lbnRWaXNpYmlsaXR5ID0gKHsgdHJhY2tlZEVsZW1lbnQsIGR5bmFzY2FsZU1hbmFnZXI6IHByb3BzRHluYXNjYWxlTWFuYWdlciwgc2Vzc2lvbklkLCB0cmFja1R5cGUsIH0pID0+IHtcbiAgICBjb25zdCBjYWxsID0gdXNlQ2FsbCgpO1xuICAgIGNvbnN0IG1hbmFnZXIgPSBwcm9wc0R5bmFzY2FsZU1hbmFnZXIgPz8gY2FsbD8uZHluYXNjYWxlTWFuYWdlcjtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoIXRyYWNrZWRFbGVtZW50IHx8ICFtYW5hZ2VyIHx8ICFjYWxsIHx8IHRyYWNrVHlwZSA9PT0gJ25vbmUnKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCB1bm9ic2VydmUgPSBtYW5hZ2VyLnRyYWNrRWxlbWVudFZpc2liaWxpdHkodHJhY2tlZEVsZW1lbnQsIHNlc3Npb25JZCwgdHJhY2tUeXBlKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIHVub2JzZXJ2ZSgpO1xuICAgICAgICB9O1xuICAgIH0sIFt0cmFja2VkRWxlbWVudCwgbWFuYWdlciwgY2FsbCwgc2Vzc2lvbklkLCB0cmFja1R5cGVdKTtcbn07XG5cbmNvbnN0IFRvZ2dsZUJ1dHRvbiA9IGZvcndhcmRSZWYoZnVuY3Rpb24gVG9nZ2xlQnV0dG9uKHByb3BzLCByZWYpIHtcbiAgICByZXR1cm4ganN4KEljb25CdXR0b24sIHsgZW5hYmxlZDogcHJvcHMubWVudVNob3duLCBpY29uOiBcImVsbGlwc2lzXCIsIHJlZjogcmVmIH0pO1xufSk7XG5jb25zdCBEZWZhdWx0U2NyZWVuU2hhcmVPdmVybGF5ID0gKCkgPT4ge1xuICAgIGNvbnN0IGNhbGwgPSB1c2VDYWxsKCk7XG4gICAgY29uc3QgeyB0IH0gPSB1c2VJMThuKCk7XG4gICAgY29uc3Qgc3RvcFNjcmVlblNoYXJlID0gKCkgPT4ge1xuICAgICAgICBjYWxsPy5zY3JlZW5TaGFyZS5kaXNhYmxlKCk7XG4gICAgfTtcbiAgICByZXR1cm4gKGpzeHMoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19zY3JlZW4tc2hhcmUtb3ZlcmxheVwiLCBjaGlsZHJlbjogW2pzeChJY29uLCB7IGljb246IFwic2NyZWVuLXNoYXJlLW9mZlwiIH0pLCBqc3goXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fc2NyZWVuLXNoYXJlLW92ZXJsYXlfX3RpdGxlXCIsIGNoaWxkcmVuOiB0KCdZb3UgYXJlIHByZXNlbnRpbmcgeW91ciBzY3JlZW4nKSB9KSwganN4cyhcImJ1dHRvblwiLCB7IG9uQ2xpY2s6IHN0b3BTY3JlZW5TaGFyZSwgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fc2NyZWVuLXNoYXJlLW92ZXJsYXlfX2J1dHRvblwiLCBjaGlsZHJlbjogW2pzeChJY29uLCB7IGljb246IFwiY2xvc2VcIiB9KSwgXCIgXCIsIHQoJ1N0b3AgU2NyZWVuIFNoYXJpbmcnKV0gfSldIH0pKTtcbn07XG5jb25zdCBEZWZhdWx0UGFydGljaXBhbnRWaWV3VUkgPSAoeyBpbmRpY2F0b3JzVmlzaWJsZSA9IHRydWUsIG1lbnVQbGFjZW1lbnQgPSAnYm90dG9tLXN0YXJ0Jywgc2hvd01lbnVCdXR0b24gPSB0cnVlLCBQYXJ0aWNpcGFudEFjdGlvbnNDb250ZXh0TWVudTogUGFydGljaXBhbnRBY3Rpb25zQ29udGV4dE1lbnUkMSA9IFBhcnRpY2lwYW50QWN0aW9uc0NvbnRleHRNZW51LCB9KSA9PiB7XG4gICAgY29uc3QgeyBwYXJ0aWNpcGFudCwgdHJhY2tUeXBlIH0gPSB1c2VQYXJ0aWNpcGFudFZpZXdDb250ZXh0KCk7XG4gICAgY29uc3QgeyBwdWJsaXNoZWRUcmFja3MgfSA9IHBhcnRpY2lwYW50O1xuICAgIGNvbnN0IGhhc1NjcmVlblNoYXJlID0gcHVibGlzaGVkVHJhY2tzLmluY2x1ZGVzKFNmdU1vZGVscy5UcmFja1R5cGUuU0NSRUVOX1NIQVJFKTtcbiAgICBpZiAocGFydGljaXBhbnQuaXNMb2NhbFBhcnRpY2lwYW50ICYmXG4gICAgICAgIGhhc1NjcmVlblNoYXJlICYmXG4gICAgICAgIHRyYWNrVHlwZSA9PT0gJ3NjcmVlblNoYXJlVHJhY2snKSB7XG4gICAgICAgIHJldHVybiAoanN4cyhGcmFnbWVudCwgeyBjaGlsZHJlbjogW2pzeChEZWZhdWx0U2NyZWVuU2hhcmVPdmVybGF5LCB7fSksIGpzeChQYXJ0aWNpcGFudERldGFpbHMsIHsgaW5kaWNhdG9yc1Zpc2libGU6IGluZGljYXRvcnNWaXNpYmxlIH0pXSB9KSk7XG4gICAgfVxuICAgIHJldHVybiAoanN4cyhGcmFnbWVudCwgeyBjaGlsZHJlbjogW3Nob3dNZW51QnV0dG9uICYmIChqc3goTWVudVRvZ2dsZSwgeyBzdHJhdGVneTogXCJmaXhlZFwiLCBwbGFjZW1lbnQ6IG1lbnVQbGFjZW1lbnQsIFRvZ2dsZUJ1dHRvbjogVG9nZ2xlQnV0dG9uLCBjaGlsZHJlbjoganN4KFBhcnRpY2lwYW50QWN0aW9uc0NvbnRleHRNZW51JDEsIHt9KSB9KSksIGpzeChSZWFjdGlvbiwgeyBwYXJ0aWNpcGFudDogcGFydGljaXBhbnQgfSksIGpzeChQYXJ0aWNpcGFudERldGFpbHMsIHsgaW5kaWNhdG9yc1Zpc2libGU6IGluZGljYXRvcnNWaXNpYmxlIH0pXSB9KSk7XG59O1xuY29uc3QgUGFydGljaXBhbnREZXRhaWxzID0gKHsgaW5kaWNhdG9yc1Zpc2libGUgPSB0cnVlLCB9KSA9PiB7XG4gICAgY29uc3QgeyBwYXJ0aWNpcGFudCB9ID0gdXNlUGFydGljaXBhbnRWaWV3Q29udGV4dCgpO1xuICAgIGNvbnN0IHsgaXNMb2NhbFBhcnRpY2lwYW50LCBjb25uZWN0aW9uUXVhbGl0eSwgcHVibGlzaGVkVHJhY2tzLCBwaW4sIHNlc3Npb25JZCwgbmFtZSwgdXNlcklkLCB9ID0gcGFydGljaXBhbnQ7XG4gICAgY29uc3QgY2FsbCA9IHVzZUNhbGwoKTtcbiAgICBjb25zdCB7IHQgfSA9IHVzZUkxOG4oKTtcbiAgICBjb25zdCBjb25uZWN0aW9uUXVhbGl0eUFzU3RyaW5nID0gISFjb25uZWN0aW9uUXVhbGl0eSAmJlxuICAgICAgICBTZnVNb2RlbHMuQ29ubmVjdGlvblF1YWxpdHlbY29ubmVjdGlvblF1YWxpdHldLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgaGFzQXVkaW8gPSBwdWJsaXNoZWRUcmFja3MuaW5jbHVkZXMoU2Z1TW9kZWxzLlRyYWNrVHlwZS5BVURJTyk7XG4gICAgY29uc3QgaGFzVmlkZW8gPSBwdWJsaXNoZWRUcmFja3MuaW5jbHVkZXMoU2Z1TW9kZWxzLlRyYWNrVHlwZS5WSURFTyk7XG4gICAgY29uc3QgY2FuVW5waW4gPSAhIXBpbiAmJiBwaW4uaXNMb2NhbFBpbjtcbiAgICByZXR1cm4gKGpzeHMoRnJhZ21lbnQsIHsgY2hpbGRyZW46IFtqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19wYXJ0aWNpcGFudC1kZXRhaWxzXCIsIGNoaWxkcmVuOiBqc3hzKFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3BhcnRpY2lwYW50LWRldGFpbHNfX25hbWVcIiwgY2hpbGRyZW46IFtuYW1lIHx8IHVzZXJJZCwgaW5kaWNhdG9yc1Zpc2libGUgJiYgIWhhc0F1ZGlvICYmIChqc3goXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fcGFydGljaXBhbnQtZGV0YWlsc19fbmFtZS0tYXVkaW8tbXV0ZWRcIiB9KSksIGluZGljYXRvcnNWaXNpYmxlICYmICFoYXNWaWRlbyAmJiAoanN4KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3BhcnRpY2lwYW50LWRldGFpbHNfX25hbWUtLXZpZGVvLW11dGVkXCIgfSkpLCBpbmRpY2F0b3JzVmlzaWJsZSAmJiBjYW5VbnBpbiAmJiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUT0RPOiByZW1vdmUgdGhpcyBtb25zdHJvc2l0eSBvbmNlIHdlIGhhdmUgYSBwcm9wZXIgZGVzaWduXG4gICAgICAgICAgICAgICAgICAgICAgICBqc3goXCJzcGFuXCIsIHsgdGl0bGU6IHQoJ1VucGluJyksIG9uQ2xpY2s6ICgpID0+IGNhbGw/LnVucGluKHNlc3Npb25JZCksIGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3BhcnRpY2lwYW50LWRldGFpbHNfX25hbWUtLXBpbm5lZFwiIH0pKSwgaW5kaWNhdG9yc1Zpc2libGUgJiYganN4KFNwZWVjaEluZGljYXRvciwge30pXSB9KSB9KSwgaW5kaWNhdG9yc1Zpc2libGUgJiYgKGpzeChOb3RpZmljYXRpb24sIHsgaXNWaXNpYmxlOiBpc0xvY2FsUGFydGljaXBhbnQgJiZcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvblF1YWxpdHkgPT09IFNmdU1vZGVscy5Db25uZWN0aW9uUXVhbGl0eS5QT09SLCBtZXNzYWdlOiB0KCdQb29yIGNvbm5lY3Rpb24gcXVhbGl0eScpLCBjaGlsZHJlbjogY29ubmVjdGlvblF1YWxpdHlBc1N0cmluZyAmJiAoanN4KFwic3BhblwiLCB7IGNsYXNzTmFtZTogY2xzeCgnc3RyLXZpZGVvX19wYXJ0aWNpcGFudC1kZXRhaWxzX19jb25uZWN0aW9uLXF1YWxpdHknLCBgc3RyLXZpZGVvX19wYXJ0aWNpcGFudC1kZXRhaWxzX19jb25uZWN0aW9uLXF1YWxpdHktLSR7Y29ubmVjdGlvblF1YWxpdHlBc1N0cmluZ31gKSwgdGl0bGU6IGNvbm5lY3Rpb25RdWFsaXR5QXNTdHJpbmcgfSkpIH0pKV0gfSkpO1xufTtcbmNvbnN0IFNwZWVjaEluZGljYXRvciA9ICgpID0+IHtcbiAgICBjb25zdCB7IHBhcnRpY2lwYW50IH0gPSB1c2VQYXJ0aWNpcGFudFZpZXdDb250ZXh0KCk7XG4gICAgY29uc3QgeyBpc1NwZWFraW5nLCBpc0RvbWluYW50U3BlYWtlciB9ID0gcGFydGljaXBhbnQ7XG4gICAgcmV0dXJuIChqc3hzKFwic3BhblwiLCB7IGNsYXNzTmFtZTogY2xzeCgnc3RyLXZpZGVvX19zcGVlY2gtaW5kaWNhdG9yJywgaXNTcGVha2luZyAmJiAnc3RyLXZpZGVvX19zcGVlY2gtaW5kaWNhdG9yLS1zcGVha2luZycsIGlzRG9taW5hbnRTcGVha2VyICYmICdzdHItdmlkZW9fX3NwZWVjaC1pbmRpY2F0b3ItLWRvbWluYW50JyksIGNoaWxkcmVuOiBbanN4KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3NwZWVjaC1pbmRpY2F0b3JfX2JhclwiIH0pLCBqc3goXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fc3BlZWNoLWluZGljYXRvcl9fYmFyXCIgfSksIGpzeChcInNwYW5cIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19zcGVlY2gtaW5kaWNhdG9yX19iYXJcIiB9KV0gfSkpO1xufTtcblxuY29uc3QgUGFydGljaXBhbnRWaWV3ID0gZm9yd2FyZFJlZihmdW5jdGlvbiBQYXJ0aWNpcGFudFZpZXcoeyBwYXJ0aWNpcGFudCwgdHJhY2tUeXBlID0gJ3ZpZGVvVHJhY2snLCBtdXRlQXVkaW8sIHJlZnM6IHsgc2V0VmlkZW9FbGVtZW50LCBzZXRWaWRlb1BsYWNlaG9sZGVyRWxlbWVudCB9ID0ge30sIGNsYXNzTmFtZSwgVmlkZW9QbGFjZWhvbGRlciwgUGFydGljaXBhbnRWaWV3VUkgPSBEZWZhdWx0UGFydGljaXBhbnRWaWV3VUksIH0sIHJlZikge1xuICAgIGNvbnN0IHsgaXNMb2NhbFBhcnRpY2lwYW50LCBpc1NwZWFraW5nLCBpc0RvbWluYW50U3BlYWtlciwgcHVibGlzaGVkVHJhY2tzLCBzZXNzaW9uSWQsIH0gPSBwYXJ0aWNpcGFudDtcbiAgICBjb25zdCBoYXNBdWRpbyA9IHB1Ymxpc2hlZFRyYWNrcy5pbmNsdWRlcyhTZnVNb2RlbHMuVHJhY2tUeXBlLkFVRElPKTtcbiAgICBjb25zdCBoYXNWaWRlbyA9IHB1Ymxpc2hlZFRyYWNrcy5pbmNsdWRlcyhTZnVNb2RlbHMuVHJhY2tUeXBlLlZJREVPKTtcbiAgICBjb25zdCBoYXNTY3JlZW5TaGFyZUF1ZGlvID0gcHVibGlzaGVkVHJhY2tzLmluY2x1ZGVzKFNmdU1vZGVscy5UcmFja1R5cGUuU0NSRUVOX1NIQVJFX0FVRElPKTtcbiAgICBjb25zdCBbdHJhY2tlZEVsZW1lbnQsIHNldFRyYWNrZWRFbGVtZW50XSA9IHVzZVN0YXRlKG51bGwpO1xuICAgIGNvbnN0IFtjb250ZXh0VmlkZW9FbGVtZW50LCBzZXRDb250ZXh0VmlkZW9FbGVtZW50XSA9IHVzZVN0YXRlKG51bGwpO1xuICAgIGNvbnN0IFtjb250ZXh0VmlkZW9QbGFjZWhvbGRlckVsZW1lbnQsIHNldENvbnRleHRWaWRlb1BsYWNlaG9sZGVyRWxlbWVudF0gPSB1c2VTdGF0ZShudWxsKTtcbiAgICAvLyBUT0RPOiBhbGxvdyB0byBwYXNzIGN1c3RvbSBWaWV3cG9ydFRyYWNrZXIgaW5zdGFuY2UgZnJvbSBwcm9wc1xuICAgIHVzZVRyYWNrRWxlbWVudFZpc2liaWxpdHkoe1xuICAgICAgICBzZXNzaW9uSWQsXG4gICAgICAgIHRyYWNrZWRFbGVtZW50LFxuICAgICAgICB0cmFja1R5cGUsXG4gICAgfSk7XG4gICAgY29uc3QgcGFydGljaXBhbnRWaWV3Q29udGV4dFZhbHVlID0gdXNlTWVtbygoKSA9PiAoe1xuICAgICAgICBwYXJ0aWNpcGFudCxcbiAgICAgICAgcGFydGljaXBhbnRWaWV3RWxlbWVudDogdHJhY2tlZEVsZW1lbnQsXG4gICAgICAgIHZpZGVvRWxlbWVudDogY29udGV4dFZpZGVvRWxlbWVudCxcbiAgICAgICAgdmlkZW9QbGFjZWhvbGRlckVsZW1lbnQ6IGNvbnRleHRWaWRlb1BsYWNlaG9sZGVyRWxlbWVudCxcbiAgICAgICAgdHJhY2tUeXBlLFxuICAgIH0pLCBbXG4gICAgICAgIGNvbnRleHRWaWRlb0VsZW1lbnQsXG4gICAgICAgIGNvbnRleHRWaWRlb1BsYWNlaG9sZGVyRWxlbWVudCxcbiAgICAgICAgcGFydGljaXBhbnQsXG4gICAgICAgIHRyYWNrZWRFbGVtZW50LFxuICAgICAgICB0cmFja1R5cGUsXG4gICAgXSk7XG4gICAgY29uc3QgdmlkZW9SZWZzID0gdXNlTWVtbygoKSA9PiAoe1xuICAgICAgICBzZXRWaWRlb0VsZW1lbnQ6IChlbGVtZW50KSA9PiB7XG4gICAgICAgICAgICBzZXRWaWRlb0VsZW1lbnQ/LihlbGVtZW50KTtcbiAgICAgICAgICAgIHNldENvbnRleHRWaWRlb0VsZW1lbnQoZWxlbWVudCk7XG4gICAgICAgIH0sXG4gICAgICAgIHNldFZpZGVvUGxhY2Vob2xkZXJFbGVtZW50OiAoZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgc2V0VmlkZW9QbGFjZWhvbGRlckVsZW1lbnQ/LihlbGVtZW50KTtcbiAgICAgICAgICAgIHNldENvbnRleHRWaWRlb1BsYWNlaG9sZGVyRWxlbWVudChlbGVtZW50KTtcbiAgICAgICAgfSxcbiAgICB9KSwgW3NldFZpZGVvRWxlbWVudCwgc2V0VmlkZW9QbGFjZWhvbGRlckVsZW1lbnRdKTtcbiAgICByZXR1cm4gKGpzeChcImRpdlwiLCB7IFwiZGF0YS10ZXN0aWRcIjogXCJwYXJ0aWNpcGFudC12aWV3XCIsIHJlZjogKGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgIGFwcGx5RWxlbWVudFRvUmVmKHJlZiwgZWxlbWVudCk7XG4gICAgICAgICAgICBzZXRUcmFja2VkRWxlbWVudChlbGVtZW50KTtcbiAgICAgICAgfSwgY2xhc3NOYW1lOiBjbHN4KCdzdHItdmlkZW9fX3BhcnRpY2lwYW50LXZpZXcnLCBpc0RvbWluYW50U3BlYWtlciAmJiAnc3RyLXZpZGVvX19wYXJ0aWNpcGFudC12aWV3LS1kb21pbmFudC1zcGVha2VyJywgaXNTcGVha2luZyAmJiAnc3RyLXZpZGVvX19wYXJ0aWNpcGFudC12aWV3LS1zcGVha2luZycsICFoYXNWaWRlbyAmJiAnc3RyLXZpZGVvX19wYXJ0aWNpcGFudC12aWV3LS1uby12aWRlbycsICFoYXNBdWRpbyAmJiAnc3RyLXZpZGVvX19wYXJ0aWNpcGFudC12aWV3LS1uby1hdWRpbycsIGNsYXNzTmFtZSksIGNoaWxkcmVuOiBqc3hzKFBhcnRpY2lwYW50Vmlld0NvbnRleHQuUHJvdmlkZXIsIHsgdmFsdWU6IHBhcnRpY2lwYW50Vmlld0NvbnRleHRWYWx1ZSwgY2hpbGRyZW46IFshaXNMb2NhbFBhcnRpY2lwYW50ICYmICFtdXRlQXVkaW8gJiYgKGpzeHMoRnJhZ21lbnQsIHsgY2hpbGRyZW46IFtoYXNBdWRpbyAmJiAoanN4KEF1ZGlvLCB7IHBhcnRpY2lwYW50OiBwYXJ0aWNpcGFudCwgdHJhY2tUeXBlOiBcImF1ZGlvVHJhY2tcIiB9KSksIGhhc1NjcmVlblNoYXJlQXVkaW8gJiYgKGpzeChBdWRpbywgeyBwYXJ0aWNpcGFudDogcGFydGljaXBhbnQsIHRyYWNrVHlwZTogXCJzY3JlZW5TaGFyZUF1ZGlvVHJhY2tcIiB9KSldIH0pKSwganN4KFZpZGVvJDEsIHsgVmlkZW9QbGFjZWhvbGRlcjogVmlkZW9QbGFjZWhvbGRlciwgcGFydGljaXBhbnQ6IHBhcnRpY2lwYW50LCB0cmFja1R5cGU6IHRyYWNrVHlwZSwgcmVmczogdmlkZW9SZWZzLCBhdXRvUGxheTogdHJ1ZSB9KSwgaXNDb21wb25lbnRUeXBlKFBhcnRpY2lwYW50Vmlld1VJKSA/IChqc3goUGFydGljaXBhbnRWaWV3VUksIHt9KSkgOiAoUGFydGljaXBhbnRWaWV3VUkpXSB9KSB9KSk7XG59KTtcblxuLy8gcmUtZXhwb3J0aW5nIHRoZSBTdHJlYW1DYWxsUHJvdmlkZXIgYXMgU3RyZWFtQ2FsbFxuY29uc3QgU3RyZWFtQ2FsbCA9IFN0cmVhbUNhbGxQcm92aWRlcjtcblxudmFyIEpvaW5pbmcgPSBcIkpvaW5pbmdcIjtcbnZhciBNaWMgPSBcIk1pY1wiO1xudmFyIFJpbmdpbmcgPSBcIlJpbmdpbmdcIjtcbnZhciBTcGVha2VycyA9IFwiU3BlYWtlcnNcIjtcbnZhciBWaWRlbyA9IFwiVmlkZW9cIjtcbnZhciBMaXZlID0gXCJMaXZlXCI7XG52YXIgUmVhY3Rpb25zID0gXCJSZWFjdGlvbnNcIjtcbnZhciBTdGF0aXN0aWNzID0gXCJTdGF0aXN0aWNzXCI7XG52YXIgSW52aXRlID0gXCJJbnZpdGVcIjtcbnZhciBKb2luID0gXCJKb2luXCI7XG52YXIgWW91ID0gXCJZb3VcIjtcbnZhciBNZSA9IFwiTWVcIjtcbnZhciBVbmtub3duID0gXCJVbmtub3duXCI7XG52YXIgUmVmcmVzaCA9IFwiUmVmcmVzaFwiO1xudmFyIEFsbG93ID0gXCJBbGxvd1wiO1xudmFyIFJldm9rZSA9IFwiUmV2b2tlXCI7XG52YXIgRGlzbWlzcyA9IFwiRGlzbWlzc1wiO1xudmFyIFBpbm5lZCA9IFwiUGlubmVkXCI7XG52YXIgVW5waW4gPSBcIlVucGluXCI7XG52YXIgUGluID0gXCJQaW5cIjtcbnZhciBCbG9jayA9IFwiQmxvY2tcIjtcbnZhciBFbnRlciA9IFwiRW50ZXJcIjtcbnZhciBMZWF2ZSA9IFwiTGVhdmVcIjtcbnZhciBQYXJ0aWNpcGFudHMgPSBcIlBhcnRpY2lwYW50c1wiO1xudmFyIEFub255bW91cyA9IFwiLCBhbmQgKHt7IGNvdW50IH19KSBhbm9ueW1vdXNcIjtcbnZhciBlbiA9IHtcblx0Sm9pbmluZzogSm9pbmluZyxcblx0TWljOiBNaWMsXG5cdFwiTm8gaW50ZXJuZXQgY29ubmVjdGlvblwiOiBcIk5vIGludGVybmV0IGNvbm5lY3Rpb25cIixcblx0XCJSZS1jb25uZWN0aW5nXCI6IFwiUmUtY29ubmVjdGluZ1wiLFxuXHRSaW5naW5nOiBSaW5naW5nLFxuXHRcIlNjcmVlbiBTaGFyZVwiOiBcIlNjcmVlbiBTaGFyZVwiLFxuXHRcIlNlbGVjdCBhIENhbWVyYVwiOiBcIlNlbGVjdCBhIENhbWVyYVwiLFxuXHRcIlNlbGVjdCBhIE1pY1wiOiBcIlNlbGVjdCBhIE1pY1wiLFxuXHRcIlNlbGVjdCBTcGVha2Vyc1wiOiBcIlNlbGVjdCBTcGVha2Vyc1wiLFxuXHRTcGVha2VyczogU3BlYWtlcnMsXG5cdFZpZGVvOiBWaWRlbyxcblx0XCJZb3UgYXJlIG11dGVkLiBVbm11dGUgdG8gc3BlYWsuXCI6IFwiWW91IGFyZSBtdXRlZC4gVW5tdXRlIHRvIHNwZWFrLlwiLFxuXHRMaXZlOiBMaXZlLFxuXHRcIllvdSBjYW4gbm93IHNwZWFrLlwiOiBcIllvdSBjYW4gbm93IHNwZWFrLlwiLFxuXHRcIkF3YWl0aW5nIGZvciBhbiBhcHByb3ZhbCB0byBzcGVhay5cIjogXCJBd2FpdGluZyBmb3IgYW4gYXBwcm92YWwgdG8gc3BlYWsuXCIsXG5cdFwiWW91IGNhbiBubyBsb25nZXIgc3BlYWsuXCI6IFwiWW91IGNhbiBubyBsb25nZXIgc3BlYWsuXCIsXG5cdFwiWW91IGNhbiBub3cgc2hhcmUgeW91ciB2aWRlby5cIjogXCJZb3UgY2FuIG5vdyBzaGFyZSB5b3VyIHZpZGVvLlwiLFxuXHRcIkF3YWl0aW5nIGZvciBhbiBhcHByb3ZhbCB0byBzaGFyZSB5b3VyIHZpZGVvLlwiOiBcIkF3YWl0aW5nIGZvciBhbiBhcHByb3ZhbCB0byBzaGFyZSB5b3VyIHZpZGVvLlwiLFxuXHRcIllvdSBjYW4gbm8gbG9uZ2VyIHNoYXJlIHlvdXIgdmlkZW8uXCI6IFwiWW91IGNhbiBubyBsb25nZXIgc2hhcmUgeW91ciB2aWRlby5cIixcblx0XCJXYWl0aW5nIGZvciByZWNvcmRpbmcgdG8gc3RvcC4uLlwiOiBcIldhaXRpbmcgZm9yIHJlY29yZGluZyB0byBzdG9wLi4uXCIsXG5cdFwiV2FpdGluZyBmb3IgcmVjb3JkaW5nIHRvIHN0YXJ0Li4uXCI6IFwiV2FpdGluZyBmb3IgcmVjb3JkaW5nIHRvIHN0YXJ0Li4uXCIsXG5cdFwiUmVjb3JkIGNhbGxcIjogXCJSZWNvcmQgY2FsbFwiLFxuXHRSZWFjdGlvbnM6IFJlYWN0aW9ucyxcblx0U3RhdGlzdGljczogU3RhdGlzdGljcyxcblx0XCJZb3UgY2FuIG5vdyBzaGFyZSB5b3VyIHNjcmVlbi5cIjogXCJZb3UgY2FuIG5vdyBzaGFyZSB5b3VyIHNjcmVlbi5cIixcblx0XCJBd2FpdGluZyBmb3IgYW4gYXBwcm92YWwgdG8gc2hhcmUgc2NyZWVuLlwiOiBcIkF3YWl0aW5nIGZvciBhbiBhcHByb3ZhbCB0byBzaGFyZSBzY3JlZW4uXCIsXG5cdFwiWW91IGNhbiBubyBsb25nZXIgc2hhcmUgeW91ciBzY3JlZW4uXCI6IFwiWW91IGNhbiBubyBsb25nZXIgc2hhcmUgeW91ciBzY3JlZW4uXCIsXG5cdFwiU2hhcmUgc2NyZWVuXCI6IFwiU2hhcmUgc2NyZWVuXCIsXG5cdFwiSW5jb21pbmcgQ2FsbC4uLlwiOiBcIkluY29taW5nIENhbGwuLi5cIixcblx0XCJDYWxsaW5nLi4uXCI6IFwiQ2FsbGluZy4uLlwiLFxuXHRcIk11dGUgQWxsXCI6IFwiTXV0ZSBBbGxcIixcblx0SW52aXRlOiBJbnZpdGUsXG5cdEpvaW46IEpvaW4sXG5cdFlvdTogWW91LFxuXHRNZTogTWUsXG5cdFVua25vd246IFVua25vd24sXG5cdFwiVG9nZ2xlIGRldmljZSBtZW51XCI6IFwiVG9nZ2xlIGRldmljZSBtZW51XCIsXG5cdFwiQ2FsbCBSZWNvcmRpbmdzXCI6IFwiQ2FsbCBSZWNvcmRpbmdzXCIsXG5cdFJlZnJlc2g6IFJlZnJlc2gsXG5cdFwiQ2hlY2sgeW91ciBicm93c2VyIHZpZGVvIHBlcm1pc3Npb25zXCI6IFwiQ2hlY2sgeW91ciBicm93c2VyIHZpZGVvIHBlcm1pc3Npb25zXCIsXG5cdFwiVmlkZW8gcHVibGlzaGluZyBpcyBkaXNhYmxlZCBieSB0aGUgc3lzdGVtXCI6IFwiVmlkZW8gcHVibGlzaGluZyBpcyBkaXNhYmxlZCBieSB0aGUgc3lzdGVtXCIsXG5cdFwiWW91IGhhdmUgbm8gcGVybWlzc2lvbiB0byBzaGFyZSB5b3VyIHZpZGVvXCI6IFwiWW91IGhhdmUgbm8gcGVybWlzc2lvbiB0byBzaGFyZSB5b3VyIHZpZGVvXCIsXG5cdFwiWW91IGhhdmUgbm8gcGVybWlzc2lvbiB0byBzaGFyZSB5b3VyIGF1ZGlvXCI6IFwiWW91IGhhdmUgbm8gcGVybWlzc2lvbiB0byBzaGFyZSB5b3VyIGF1ZGlvXCIsXG5cdFwiWW91IGFyZSBwcmVzZW50aW5nIHlvdXIgc2NyZWVuXCI6IFwiWW91IGFyZSBwcmVzZW50aW5nIHlvdXIgc2NyZWVuXCIsXG5cdFwiU3RvcCBTY3JlZW4gU2hhcmluZ1wiOiBcIlN0b3AgU2NyZWVuIFNoYXJpbmdcIixcblx0QWxsb3c6IEFsbG93LFxuXHRSZXZva2U6IFJldm9rZSxcblx0RGlzbWlzczogRGlzbWlzcyxcblx0XCJNaWNyb3Bob25lIG9uXCI6IFwiTWljcm9waG9uZSBvblwiLFxuXHRcIk1pY3JvcGhvbmUgb2ZmXCI6IFwiTWljcm9waG9uZSBvZmZcIixcblx0XCJDYW1lcmEgb25cIjogXCJDYW1lcmEgb25cIixcblx0XCJDYW1lcmEgb2ZmXCI6IFwiQ2FtZXJhIG9mZlwiLFxuXHRcIk5vIGNhbWVyYSBmb3VuZFwiOiBcIk5vIGNhbWVyYSBmb3VuZFwiLFxuXHRcIlZpZGVvIGlzIGRpc2FibGVkXCI6IFwiVmlkZW8gaXMgZGlzYWJsZWRcIixcblx0UGlubmVkOiBQaW5uZWQsXG5cdFVucGluOiBVbnBpbixcblx0UGluOiBQaW4sXG5cdFwiUGluIGZvciBldmVyeW9uZVwiOiBcIlBpbiBmb3IgZXZlcnlvbmVcIixcblx0XCJVbnBpbiBmb3IgZXZlcnlvbmVcIjogXCJVbnBpbiBmb3IgZXZlcnlvbmVcIixcblx0QmxvY2s6IEJsb2NrLFxuXHRcIlR1cm4gb2ZmIHZpZGVvXCI6IFwiVHVybiBvZmYgdmlkZW9cIixcblx0XCJUdXJuIG9mZiBzY3JlZW4gc2hhcmVcIjogXCJUdXJuIG9mZiBzY3JlZW4gc2hhcmVcIixcblx0XCJNdXRlIGF1ZGlvXCI6IFwiTXV0ZSBhdWRpb1wiLFxuXHRcIk11dGUgc2NyZWVuIHNoYXJlIGF1ZGlvXCI6IFwiTXV0ZSBzY3JlZW4gc2hhcmUgYXVkaW9cIixcblx0XCJBbGxvdyBhdWRpb1wiOiBcIkFsbG93IGF1ZGlvXCIsXG5cdFwiQWxsb3cgdmlkZW9cIjogXCJBbGxvdyB2aWRlb1wiLFxuXHRcIkFsbG93IHNjcmVlbiBzaGFyaW5nXCI6IFwiQWxsb3cgc2NyZWVuIHNoYXJpbmdcIixcblx0XCJEaXNhYmxlIGF1ZGlvXCI6IFwiRGlzYWJsZSBhdWRpb1wiLFxuXHRcIkRpc2FibGUgdmlkZW9cIjogXCJEaXNhYmxlIHZpZGVvXCIsXG5cdFwiRGlzYWJsZSBzY3JlZW4gc2hhcmluZ1wiOiBcIkRpc2FibGUgc2NyZWVuIHNoYXJpbmdcIixcblx0RW50ZXI6IEVudGVyLFxuXHRMZWF2ZTogTGVhdmUsXG5cdFwiTGVhdmUgY2FsbFwiOiBcIkxlYXZlIGNhbGxcIixcblx0XCJFbmQgY2FsbCBmb3IgYWxsXCI6IFwiRW5kIGNhbGwgZm9yIGFsbFwiLFxuXHRcInt7IGRpcmVjdGlvbiB9fSBmdWxsc2NyZWVuXCI6IFwie3sgZGlyZWN0aW9uIH19IGZ1bGxzY3JlZW5cIixcblx0XCJ7eyBkaXJlY3Rpb24gfX0gcGljdHVyZS1pbi1waWN0dXJlXCI6IFwie3sgZGlyZWN0aW9uIH19IHBpY3R1cmUtaW4tcGljdHVyZVwiLFxuXHRcIkRvbWluYW50IFNwZWFrZXJcIjogXCJEb21pbmFudCBTcGVha2VyXCIsXG5cdFwiUG9vciBjb25uZWN0aW9uIHF1YWxpdHlcIjogXCJQb29yIGNvbm5lY3Rpb24gcXVhbGl0eS4gUGxlYXNlIGNoZWNrIHlvdXIgaW50ZXJuZXQgY29ubmVjdGlvbi5cIixcblx0UGFydGljaXBhbnRzOiBQYXJ0aWNpcGFudHMsXG5cdEFub255bW91czogQW5vbnltb3VzLFxuXHRcIk5vIHBhcnRpY2lwYW50cyBmb3VuZFwiOiBcIk5vIHBhcnRpY2lwYW50cyBmb3VuZFwiLFxuXHRcIlBhcnRpY2lwYW50cyAoe3sgbnVtYmVyT2ZQYXJ0aWNpcGFudHMgfX0pXCI6IFwiUGFydGljaXBhbnRzICh7eyBudW1iZXJPZlBhcnRpY2lwYW50cyB9fSlcIixcblx0XCJ7eyB1c2VyTmFtZSB9fSBpcyBzaGFyaW5nIHRoZWlyIHNjcmVlblwiOiBcInt7IHVzZXJOYW1lIH19IGlzIHNoYXJpbmcgdGhlaXIgc2NyZWVuXCIsXG5cdFwie3sgdXNlck5hbWUgfX0gaXMgcmVxdWVzdGluZyB0byBzcGVha1wiOiBcInt7IHVzZXJOYW1lIH19IGlzIHJlcXVlc3RpbmcgdG8gc3BlYWtcIixcblx0XCJ7eyB1c2VyTmFtZSB9fSBpcyByZXF1ZXN0aW5nIHRvIHNoYXJlIHRoZWlyIGNhbWVyYVwiOiBcInt7IHVzZXJOYW1lIH19IGlzIHJlcXVlc3RpbmcgdG8gc2hhcmUgdGhlaXIgY2FtZXJhXCIsXG5cdFwie3sgdXNlck5hbWUgfX0gaXMgcmVxdWVzdGluZyB0byBwcmVzZW50IHRoZWlyIHNjcmVlblwiOiBcInt7IHVzZXJOYW1lIH19IGlzIHJlcXVlc3RpbmcgdG8gcHJlc2VudCB0aGVpciBzY3JlZW5cIixcblx0XCJ7eyB1c2VyTmFtZSB9fSBpcyByZXF1ZXN0aW5nIHBlcm1pc3Npb246IHt7IHBlcm1pc3Npb24gfX1cIjogXCJ7eyB1c2VyTmFtZSB9fSBpcyByZXF1ZXN0aW5nIHBlcm1pc3Npb246IHt7IHBlcm1pc3Npb24gfX1cIlxufTtcblxuY29uc3QgdHJhbnNsYXRpb25zID0geyBlbiB9O1xuXG5jb25zdCBTdHJlYW1WaWRlbyA9IChwcm9wcykgPT4ge1xuICAgIHJldHVybiAoanN4KFN0cmVhbVZpZGVvUHJvdmlkZXIsIHsgdHJhbnNsYXRpb25zT3ZlcnJpZGVzOiB0cmFuc2xhdGlvbnMsIC4uLnByb3BzIH0pKTtcbn07XG5cbmNvbnN0IHVzZVBhZ2luYXRlZExheW91dFNvcnRQcmVzZXQgPSAoY2FsbCkgPT4ge1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmICghY2FsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY2FsbC5zZXRTb3J0UGFydGljaXBhbnRzQnkocGFnaW5hdGVkTGF5b3V0U29ydFByZXNldCk7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICByZXNldFNvcnRQcmVzZXQoY2FsbCk7XG4gICAgICAgIH07XG4gICAgfSwgW2NhbGxdKTtcbn07XG5jb25zdCB1c2VTcGVha2VyTGF5b3V0U29ydFByZXNldCA9IChjYWxsLCBpc09uZU9uT25lQ2FsbCkgPT4ge1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmICghY2FsbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgLy8gYWx3YXlzIHNob3cgdGhlIHJlbW90ZSBwYXJ0aWNpcGFudCBpbiB0aGUgc3BvdGxpZ2h0XG4gICAgICAgIGlmIChpc09uZU9uT25lQ2FsbCkge1xuICAgICAgICAgICAgY2FsbC5zZXRTb3J0UGFydGljaXBhbnRzQnkoY29tYmluZUNvbXBhcmF0b3JzKHNjcmVlblNoYXJpbmcsIGxvZ2dlZEluKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjYWxsLnNldFNvcnRQYXJ0aWNpcGFudHNCeShzcGVha2VyTGF5b3V0U29ydFByZXNldCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIHJlc2V0U29ydFByZXNldChjYWxsKTtcbiAgICAgICAgfTtcbiAgICB9LCBbY2FsbCwgaXNPbmVPbk9uZUNhbGxdKTtcbn07XG5jb25zdCByZXNldFNvcnRQcmVzZXQgPSAoY2FsbCkgPT4ge1xuICAgIC8vIHJlc2V0IHRoZSBzb3J0aW5nIHRvIHRoZSBkZWZhdWx0IGZvciB0aGUgY2FsbCB0eXBlXG4gICAgY29uc3QgY2FsbENvbmZpZyA9IENhbGxUeXBlcy5nZXQoY2FsbC50eXBlKTtcbiAgICBjYWxsLnNldFNvcnRQYXJ0aWNpcGFudHNCeShjYWxsQ29uZmlnLm9wdGlvbnMuc29ydFBhcnRpY2lwYW50c0J5IHx8IGRlZmF1bHRTb3J0UHJlc2V0KTtcbn07XG5jb25zdCBsb2dnZWRJbiA9IChhLCBiKSA9PiB7XG4gICAgaWYgKGEuaXNMb2NhbFBhcnRpY2lwYW50KVxuICAgICAgICByZXR1cm4gMTtcbiAgICBpZiAoYi5pc0xvY2FsUGFydGljaXBhbnQpXG4gICAgICAgIHJldHVybiAtMTtcbiAgICByZXR1cm4gMDtcbn07XG5cbmNvbnN0IExpdmVzdHJlYW1MYXlvdXQgPSAocHJvcHMpID0+IHtcbiAgICBjb25zdCB7IHVzZVBhcnRpY2lwYW50cywgdXNlUmVtb3RlUGFydGljaXBhbnRzLCB1c2VIYXNPbmdvaW5nU2NyZWVuU2hhcmUgfSA9IHVzZUNhbGxTdGF0ZUhvb2tzKCk7XG4gICAgY29uc3QgY2FsbCA9IHVzZUNhbGwoKTtcbiAgICBjb25zdCBbY3VycmVudFNwZWFrZXIsIC4uLm90aGVyUGFydGljaXBhbnRzXSA9IHVzZVBhcnRpY2lwYW50cygpO1xuICAgIGNvbnN0IHJlbW90ZVBhcnRpY2lwYW50cyA9IHVzZVJlbW90ZVBhcnRpY2lwYW50cygpO1xuICAgIGNvbnN0IGhhc09uZ29pbmdTY3JlZW5TaGFyZSA9IHVzZUhhc09uZ29pbmdTY3JlZW5TaGFyZSgpO1xuICAgIGNvbnN0IHByZXNlbnRlciA9IGhhc09uZ29pbmdTY3JlZW5TaGFyZVxuICAgICAgICA/IGhhc1NjcmVlblNoYXJlJDEoY3VycmVudFNwZWFrZXIpICYmIGN1cnJlbnRTcGVha2VyXG4gICAgICAgIDogb3RoZXJQYXJ0aWNpcGFudHMuZmluZChoYXNTY3JlZW5TaGFyZSQxKTtcbiAgICB1c2VQYWdpbmF0ZWRMYXlvdXRTb3J0UHJlc2V0KGNhbGwpO1xuICAgIGNvbnN0IE92ZXJsYXkgPSAoanN4KFBhcnRpY2lwYW50T3ZlcmxheSwgeyBzaG93UGFydGljaXBhbnRDb3VudDogcHJvcHMuc2hvd1BhcnRpY2lwYW50Q291bnQsIHNob3dEdXJhdGlvbjogcHJvcHMuc2hvd0R1cmF0aW9uLCBzaG93TGl2ZUJhZGdlOiBwcm9wcy5zaG93TGl2ZUJhZGdlLCBzaG93U3BlYWtlck5hbWU6IHByb3BzLnNob3dTcGVha2VyTmFtZSB9KSk7XG4gICAgY29uc3QgeyBmbG9hdGluZ1BhcnRpY2lwYW50UHJvcHMgfSA9IHByb3BzO1xuICAgIGNvbnN0IEZsb2F0aW5nUGFydGljaXBhbnRPdmVybGF5ID0gaGFzT25nb2luZ1NjcmVlblNoYXJlICYmIChqc3goUGFydGljaXBhbnRPdmVybGF5XG4gICAgLy8gdGhlc2UgZWxlbWVudHMgYXJlbid0IG5lZWRlZCBmb3IgdGhlIHZpZGVvIGZlZWRcbiAgICAsIHsgXG4gICAgICAgIC8vIHRoZXNlIGVsZW1lbnRzIGFyZW4ndCBuZWVkZWQgZm9yIHRoZSB2aWRlbyBmZWVkXG4gICAgICAgIHNob3dQYXJ0aWNpcGFudENvdW50OiBmbG9hdGluZ1BhcnRpY2lwYW50UHJvcHM/LnNob3dQYXJ0aWNpcGFudENvdW50ID8/IGZhbHNlLCBzaG93RHVyYXRpb246IGZsb2F0aW5nUGFydGljaXBhbnRQcm9wcz8uc2hvd0R1cmF0aW9uID8/IGZhbHNlLCBzaG93TGl2ZUJhZGdlOiBmbG9hdGluZ1BhcnRpY2lwYW50UHJvcHM/LnNob3dMaXZlQmFkZ2UgPz8gZmFsc2UsIHNob3dTcGVha2VyTmFtZTogZmxvYXRpbmdQYXJ0aWNpcGFudFByb3BzPy5zaG93U3BlYWtlck5hbWUgPz8gdHJ1ZSB9KSk7XG4gICAgcmV0dXJuIChqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fbGl2ZXN0cmVhbS1sYXlvdXRfX3dyYXBwZXJcIiwgY2hpbGRyZW46IFtqc3goUGFydGljaXBhbnRzQXVkaW8sIHsgcGFydGljaXBhbnRzOiByZW1vdGVQYXJ0aWNpcGFudHMgfSksIGhhc09uZ29pbmdTY3JlZW5TaGFyZSAmJiBwcmVzZW50ZXIgJiYgKGpzeChQYXJ0aWNpcGFudFZpZXcsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fbGl2ZXN0cmVhbS1sYXlvdXRfX3NjcmVlbi1zaGFyZVwiLCBwYXJ0aWNpcGFudDogcHJlc2VudGVyLCBQYXJ0aWNpcGFudFZpZXdVSTogT3ZlcmxheSwgdHJhY2tUeXBlOiBcInNjcmVlblNoYXJlVHJhY2tcIiwgbXV0ZUF1ZGlvIC8vIGF1ZGlvIGlzIHJlbmRlcmVkIGJ5IFBhcnRpY2lwYW50c0F1ZGlvXG4gICAgICAgICAgICAgICAgOiB0cnVlIH0pKSwgY3VycmVudFNwZWFrZXIgJiYgKGpzeChQYXJ0aWNpcGFudFZpZXcsIHsgY2xhc3NOYW1lOiBjbHN4KGhhc09uZ29pbmdTY3JlZW5TaGFyZSAmJlxuICAgICAgICAgICAgICAgICAgICBjbHN4KCdzdHItdmlkZW9fX2xpdmVzdHJlYW0tbGF5b3V0X19mbG9hdGluZy1wYXJ0aWNpcGFudCcsIGBzdHItdmlkZW9fX2xpdmVzdHJlYW0tbGF5b3V0X19mbG9hdGluZy1wYXJ0aWNpcGFudC0tJHtmbG9hdGluZ1BhcnRpY2lwYW50UHJvcHM/LnBvc2l0aW9uID8/ICd0b3AtcmlnaHQnfWApKSwgcGFydGljaXBhbnQ6IGN1cnJlbnRTcGVha2VyLCBQYXJ0aWNpcGFudFZpZXdVSTogRmxvYXRpbmdQYXJ0aWNpcGFudE92ZXJsYXkgfHwgT3ZlcmxheSwgbXV0ZUF1ZGlvIC8vIGF1ZGlvIGlzIHJlbmRlcmVkIGJ5IFBhcnRpY2lwYW50c0F1ZGlvXG4gICAgICAgICAgICAgICAgOiB0cnVlIH0pKV0gfSkpO1xufTtcbmNvbnN0IGhhc1NjcmVlblNoYXJlJDEgPSAocCkgPT4gISFwPy5wdWJsaXNoZWRUcmFja3MuaW5jbHVkZXMoU2Z1TW9kZWxzLlRyYWNrVHlwZS5TQ1JFRU5fU0hBUkUpO1xuY29uc3QgUGFydGljaXBhbnRPdmVybGF5ID0gKHByb3BzKSA9PiB7XG4gICAgY29uc3QgeyBlbmFibGVGdWxsU2NyZWVuID0gdHJ1ZSwgc2hvd1BhcnRpY2lwYW50Q291bnQgPSB0cnVlLCBzaG93RHVyYXRpb24gPSB0cnVlLCBzaG93TGl2ZUJhZGdlID0gdHJ1ZSwgc2hvd1NwZWFrZXJOYW1lID0gZmFsc2UsIH0gPSBwcm9wcztcbiAgICBjb25zdCB7IHBhcnRpY2lwYW50IH0gPSB1c2VQYXJ0aWNpcGFudFZpZXdDb250ZXh0KCk7XG4gICAgY29uc3QgeyB1c2VQYXJ0aWNpcGFudENvdW50IH0gPSB1c2VDYWxsU3RhdGVIb29rcygpO1xuICAgIGNvbnN0IHBhcnRpY2lwYW50Q291bnQgPSB1c2VQYXJ0aWNpcGFudENvdW50KCk7XG4gICAgY29uc3QgZHVyYXRpb24gPSB1c2VVcGRhdGVDYWxsRHVyYXRpb24oKTtcbiAgICBjb25zdCB0b2dnbGVGdWxsU2NyZWVuID0gdXNlVG9nZ2xlRnVsbFNjcmVlbigpO1xuICAgIGNvbnN0IHsgdCB9ID0gdXNlSTE4bigpO1xuICAgIHJldHVybiAoanN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fbGl2ZXN0cmVhbS1sYXlvdXRfX292ZXJsYXlcIiwgY2hpbGRyZW46IGpzeHMoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19saXZlc3RyZWFtLWxheW91dF9fb3ZlcmxheV9fYmFyXCIsIGNoaWxkcmVuOiBbc2hvd0xpdmVCYWRnZSAmJiAoanN4KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2xpdmVzdHJlYW0tbGF5b3V0X19saXZlLWJhZGdlXCIsIGNoaWxkcmVuOiB0KCdMaXZlJykgfSkpLCBzaG93UGFydGljaXBhbnRDb3VudCAmJiAoanN4KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2xpdmVzdHJlYW0tbGF5b3V0X192aWV3ZXJzLWNvdW50XCIsIGNoaWxkcmVuOiBwYXJ0aWNpcGFudENvdW50IH0pKSwgc2hvd1NwZWFrZXJOYW1lICYmIChqc3goXCJzcGFuXCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fbGl2ZXN0cmVhbS1sYXlvdXRfX3NwZWFrZXItbmFtZVwiLCB0aXRsZTogcGFydGljaXBhbnQubmFtZSB8fCBwYXJ0aWNpcGFudC51c2VySWQgfHwgJycsIGNoaWxkcmVuOiBwYXJ0aWNpcGFudC5uYW1lIHx8IHBhcnRpY2lwYW50LnVzZXJJZCB8fCAnJyB9KSksIHNob3dEdXJhdGlvbiAmJiAoanN4KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2xpdmVzdHJlYW0tbGF5b3V0X19kdXJhdGlvblwiLCBjaGlsZHJlbjogZm9ybWF0RHVyYXRpb24oZHVyYXRpb24pIH0pKSwgZW5hYmxlRnVsbFNjcmVlbiAmJiAoanN4KFwic3BhblwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX2xpdmVzdHJlYW0tbGF5b3V0X19nby1mdWxsc2NyZWVuXCIsIG9uQ2xpY2s6IHRvZ2dsZUZ1bGxTY3JlZW4gfSkpXSB9KSB9KSk7XG59O1xuY29uc3QgdXNlVXBkYXRlQ2FsbER1cmF0aW9uID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgdXNlSXNDYWxsTGl2ZSwgdXNlQ2FsbFNlc3Npb24gfSA9IHVzZUNhbGxTdGF0ZUhvb2tzKCk7XG4gICAgY29uc3QgaXNDYWxsTGl2ZSA9IHVzZUlzQ2FsbExpdmUoKTtcbiAgICBjb25zdCBzZXNzaW9uID0gdXNlQ2FsbFNlc3Npb24oKTtcbiAgICBjb25zdCBbZHVyYXRpb24sIHNldER1cmF0aW9uXSA9IHVzZVN0YXRlKCgpID0+IHtcbiAgICAgICAgaWYgKCFzZXNzaW9uIHx8ICFzZXNzaW9uLmxpdmVfc3RhcnRlZF9hdClcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICBjb25zdCBsaXZlU3RhcnRUaW1lID0gbmV3IERhdGUoc2Vzc2lvbi5saXZlX3N0YXJ0ZWRfYXQpO1xuICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcigobm93LmdldFRpbWUoKSAtIGxpdmVTdGFydFRpbWUuZ2V0VGltZSgpKSAvIDEwMDApO1xuICAgIH0pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmICghaXNDYWxsTGl2ZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICBzZXREdXJhdGlvbigoZCkgPT4gZCArIDEpO1xuICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgICAgICB9O1xuICAgIH0sIFtpc0NhbGxMaXZlXSk7XG4gICAgcmV0dXJuIGR1cmF0aW9uO1xufTtcbmNvbnN0IHVzZVRvZ2dsZUZ1bGxTY3JlZW4gPSAoKSA9PiB7XG4gICAgY29uc3QgeyBwYXJ0aWNpcGFudFZpZXdFbGVtZW50IH0gPSB1c2VQYXJ0aWNpcGFudFZpZXdDb250ZXh0KCk7XG4gICAgY29uc3QgW2lzRnVsbHNjcmVlbiwgc2V0SXNGdWxsc2NyZWVuXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICByZXR1cm4gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgICBpZiAoaXNGdWxsc2NyZWVuKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5leGl0RnVsbHNjcmVlbigpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNldElzRnVsbHNjcmVlbihmYWxzZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHBhcnRpY2lwYW50Vmlld0VsZW1lbnQ/LnJlcXVlc3RGdWxsc2NyZWVuKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2V0SXNGdWxsc2NyZWVuKHRydWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LCBbaXNGdWxsc2NyZWVuLCBwYXJ0aWNpcGFudFZpZXdFbGVtZW50XSk7XG59O1xuY29uc3QgZm9ybWF0RHVyYXRpb24gPSAoZHVyYXRpb25Jbk1zKSA9PiB7XG4gICAgY29uc3QgZGF5cyA9IE1hdGguZmxvb3IoZHVyYXRpb25Jbk1zIC8gODY0MDApO1xuICAgIGNvbnN0IGhvdXJzID0gTWF0aC5mbG9vcihkdXJhdGlvbkluTXMgLyAzNjAwKTtcbiAgICBjb25zdCBtaW51dGVzID0gTWF0aC5mbG9vcigoZHVyYXRpb25Jbk1zICUgMzYwMCkgLyA2MCk7XG4gICAgY29uc3Qgc2Vjb25kcyA9IGR1cmF0aW9uSW5NcyAlIDYwO1xuICAgIHJldHVybiBgJHtkYXlzID8gZGF5cyArICcgJyA6ICcnfSR7aG91cnMgPyBob3VycyArICc6JyA6ICcnfSR7bWludXRlcyA8IDEwID8gJzAnIDogJyd9JHttaW51dGVzfToke3NlY29uZHMgPCAxMCA/ICcwJyA6ICcnfSR7c2Vjb25kc31gO1xufTtcblxuY29uc3QgR1JPVVBfU0laRSA9IDE2O1xuY29uc3QgUGFnaW5hdGVkR3JpZExheW91dEdyb3VwID0gKHsgZ3JvdXAsIFZpZGVvUGxhY2Vob2xkZXIsIFBhcnRpY2lwYW50Vmlld1VJLCB9KSA9PiB7XG4gICAgcmV0dXJuIChqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IGNsc3goJ3N0ci12aWRlb19fcGFnaW5hdGVkLWdyaWQtbGF5b3V0X19ncm91cCcsIHtcbiAgICAgICAgICAgICdzdHItdmlkZW9fX3BhZ2luYXRlZC1ncmlkLWxheW91dC0tb25lJzogZ3JvdXAubGVuZ3RoID09PSAxLFxuICAgICAgICAgICAgJ3N0ci12aWRlb19fcGFnaW5hdGVkLWdyaWQtbGF5b3V0LS10d28tZm91cic6IGdyb3VwLmxlbmd0aCA+PSAyICYmIGdyb3VwLmxlbmd0aCA8PSA0LFxuICAgICAgICAgICAgJ3N0ci12aWRlb19fcGFnaW5hdGVkLWdyaWQtbGF5b3V0LS1maXZlLW5pbmUnOiBncm91cC5sZW5ndGggPj0gNSAmJiBncm91cC5sZW5ndGggPD0gOSxcbiAgICAgICAgfSksIGNoaWxkcmVuOiBncm91cC5tYXAoKHBhcnRpY2lwYW50KSA9PiAoanN4KFBhcnRpY2lwYW50VmlldywgeyBwYXJ0aWNpcGFudDogcGFydGljaXBhbnQsIG11dGVBdWRpbzogdHJ1ZSwgVmlkZW9QbGFjZWhvbGRlcjogVmlkZW9QbGFjZWhvbGRlciwgUGFydGljaXBhbnRWaWV3VUk6IFBhcnRpY2lwYW50Vmlld1VJIH0sIHBhcnRpY2lwYW50LnNlc3Npb25JZCkpKSB9KSk7XG59O1xuY29uc3QgUGFnaW5hdGVkR3JpZExheW91dCA9ICh7IGdyb3VwU2l6ZSA9IEdST1VQX1NJWkUsIGV4Y2x1ZGVMb2NhbFBhcnRpY2lwYW50ID0gZmFsc2UsIHBhZ2VBcnJvd3NWaXNpYmxlID0gdHJ1ZSwgVmlkZW9QbGFjZWhvbGRlciwgUGFydGljaXBhbnRWaWV3VUkgPSBEZWZhdWx0UGFydGljaXBhbnRWaWV3VUksIH0pID0+IHtcbiAgICBjb25zdCBbcGFnZSwgc2V0UGFnZV0gPSB1c2VTdGF0ZSgwKTtcbiAgICBjb25zdCBbcGFnaW5hdGVkR3JpZExheW91dFdyYXBwZXJFbGVtZW50LCBzZXRQYWdpbmF0ZWRHcmlkTGF5b3V0V3JhcHBlckVsZW1lbnQsXSA9IHVzZVN0YXRlKG51bGwpO1xuICAgIGNvbnN0IGNhbGwgPSB1c2VDYWxsKCk7XG4gICAgY29uc3QgeyB1c2VQYXJ0aWNpcGFudHMsIHVzZVJlbW90ZVBhcnRpY2lwYW50cyB9ID0gdXNlQ2FsbFN0YXRlSG9va3MoKTtcbiAgICBjb25zdCBwYXJ0aWNpcGFudHMgPSB1c2VQYXJ0aWNpcGFudHMoKTtcbiAgICAvLyB1c2VkIHRvIHJlbmRlciBhdWRpbyBlbGVtZW50c1xuICAgIGNvbnN0IHJlbW90ZVBhcnRpY2lwYW50cyA9IHVzZVJlbW90ZVBhcnRpY2lwYW50cygpO1xuICAgIHVzZVBhZ2luYXRlZExheW91dFNvcnRQcmVzZXQoY2FsbCk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKCFwYWdpbmF0ZWRHcmlkTGF5b3V0V3JhcHBlckVsZW1lbnQgfHwgIWNhbGwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGNsZWFudXAgPSBjYWxsLnNldFZpZXdwb3J0KHBhZ2luYXRlZEdyaWRMYXlvdXRXcmFwcGVyRWxlbWVudCk7XG4gICAgICAgIHJldHVybiAoKSA9PiBjbGVhbnVwKCk7XG4gICAgfSwgW3BhZ2luYXRlZEdyaWRMYXlvdXRXcmFwcGVyRWxlbWVudCwgY2FsbF0pO1xuICAgIC8vIG9ubHkgdXNlZCB0byByZW5kZXIgdmlkZW8gZWxlbWVudHNcbiAgICBjb25zdCBwYXJ0aWNpcGFudEdyb3VwcyA9IHVzZU1lbW8oKCkgPT4gY2h1bmsoZXhjbHVkZUxvY2FsUGFydGljaXBhbnQgPyByZW1vdGVQYXJ0aWNpcGFudHMgOiBwYXJ0aWNpcGFudHMsIGdyb3VwU2l6ZSksIFtleGNsdWRlTG9jYWxQYXJ0aWNpcGFudCwgcmVtb3RlUGFydGljaXBhbnRzLCBwYXJ0aWNpcGFudHMsIGdyb3VwU2l6ZV0pO1xuICAgIGNvbnN0IHBhZ2VDb3VudCA9IHBhcnRpY2lwYW50R3JvdXBzLmxlbmd0aDtcbiAgICAvLyB1cGRhdGUgcGFnZSB3aGVuIHBhZ2UgY291bnQgaXMgcmVkdWNlZCBhbmQgc2VsZWN0ZWQgcGFnZSBubyBsb25nZXIgZXhpc3RzXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKHBhZ2UgPiBwYWdlQ291bnQgLSAxKSB7XG4gICAgICAgICAgICBzZXRQYWdlKE1hdGgubWF4KDAsIHBhZ2VDb3VudCAtIDEpKTtcbiAgICAgICAgfVxuICAgIH0sIFtwYWdlLCBwYWdlQ291bnRdKTtcbiAgICBjb25zdCBzZWxlY3RlZEdyb3VwID0gcGFydGljaXBhbnRHcm91cHNbcGFnZV07XG4gICAgaWYgKCFjYWxsKVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICByZXR1cm4gKGpzeHMoXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19wYWdpbmF0ZWQtZ3JpZC1sYXlvdXRfX3dyYXBwZXJcIiwgcmVmOiBzZXRQYWdpbmF0ZWRHcmlkTGF5b3V0V3JhcHBlckVsZW1lbnQsIGNoaWxkcmVuOiBbanN4KFBhcnRpY2lwYW50c0F1ZGlvLCB7IHBhcnRpY2lwYW50czogcmVtb3RlUGFydGljaXBhbnRzIH0pLCBqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fcGFnaW5hdGVkLWdyaWQtbGF5b3V0XCIsIGNoaWxkcmVuOiBbcGFnZUFycm93c1Zpc2libGUgJiYgcGFnZUNvdW50ID4gMSAmJiAoanN4KEljb25CdXR0b24sIHsgaWNvbjogXCJjYXJldC1sZWZ0XCIsIGRpc2FibGVkOiBwYWdlID09PSAwLCBvbkNsaWNrOiAoKSA9PiBzZXRQYWdlKChjdXJyZW50UGFnZSkgPT4gTWF0aC5tYXgoMCwgY3VycmVudFBhZ2UgLSAxKSkgfSkpLCBzZWxlY3RlZEdyb3VwICYmIChqc3goUGFnaW5hdGVkR3JpZExheW91dEdyb3VwLCB7IGdyb3VwOiBwYXJ0aWNpcGFudEdyb3Vwc1twYWdlXSwgVmlkZW9QbGFjZWhvbGRlcjogVmlkZW9QbGFjZWhvbGRlciwgUGFydGljaXBhbnRWaWV3VUk6IFBhcnRpY2lwYW50Vmlld1VJIH0pKSwgcGFnZUFycm93c1Zpc2libGUgJiYgcGFnZUNvdW50ID4gMSAmJiAoanN4KEljb25CdXR0b24sIHsgZGlzYWJsZWQ6IHBhZ2UgPT09IHBhZ2VDb3VudCAtIDEsIGljb246IFwiY2FyZXQtcmlnaHRcIiwgb25DbGljazogKCkgPT4gc2V0UGFnZSgoY3VycmVudFBhZ2UpID0+IE1hdGgubWluKHBhZ2VDb3VudCAtIDEsIGN1cnJlbnRQYWdlICsgMSkpIH0pKV0gfSldIH0pKTtcbn07XG5cbmNvbnN0IHVzZUNhbGN1bGF0ZUhhcmRMaW1pdCA9IChcbi8qKlxuICogRWxlbWVudCB0aGF0IHN0cmV0Y2hlcyB0byAxMDAlIG9mIHRoZSB3aG9sZSBsYXlvdXQgY29tcG9uZW50XG4gKi9cbndyYXBwZXJFbGVtZW50LCBcbi8qKlxuICogRWxlbWVudCB0aGF0IGRpcmVjdGx5IGhvc3RzIGluZGl2aWR1YWwgYFBhcnRpY2lwYW50Vmlld2AgKG9yIHdyYXBwZXIpIGVsZW1lbnRzXG4gKi9cbmhvc3RFbGVtZW50LCBsaW1pdCkgPT4ge1xuICAgIGNvbnN0IFtjYWxjdWxhdGVkTGltaXQsIHNldENhbGN1bGF0ZWRMaW1pdF0gPSB1c2VTdGF0ZSh7XG4gICAgICAgIHZlcnRpY2FsOiB0eXBlb2YgbGltaXQgPT09ICdudW1iZXInID8gbGltaXQgOiBudWxsLFxuICAgICAgICBob3Jpem9udGFsOiB0eXBlb2YgbGltaXQgPT09ICdudW1iZXInID8gbGltaXQgOiBudWxsLFxuICAgIH0pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmICghaG9zdEVsZW1lbnQgfHxcbiAgICAgICAgICAgICF3cmFwcGVyRWxlbWVudCB8fFxuICAgICAgICAgICAgdHlwZW9mIGxpbWl0ID09PSAnbnVtYmVyJyB8fFxuICAgICAgICAgICAgdHlwZW9mIGxpbWl0ID09PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgbGV0IGNoaWxkV2lkdGggPSBudWxsO1xuICAgICAgICBsZXQgY2hpbGRIZWlnaHQgPSBudWxsO1xuICAgICAgICBjb25zdCByZXNpemVPYnNlcnZlciA9IG5ldyBSZXNpemVPYnNlcnZlcigoZW50cmllcywgb2JzZXJ2ZXIpID0+IHtcbiAgICAgICAgICAgIC8vIHRoaXMgcGFydCBzaG91bGQgaWRlYWxseSBydW4gYXMgbGl0dGxlIHRpbWVzIGFzIHBvc3NpYmxlXG4gICAgICAgICAgICAvLyBnZXQgY2hpbGQgbWVhc3VyZW1lbnRzIGFuZCBkaXNjb25uZWN0XG4gICAgICAgICAgICAvLyBkb2VzIG5vdCBjb25zaWRlciBkeW5hbWljYWxseSBzaXplZCBjaGlsZHJlblxuICAgICAgICAgICAgLy8gdGhpcyBob29rIGlzIGZvciBTcGVha2VyTGF5b3V0IHVzZSBvbmx5LCB3aGVyZSBjaGlsZHJlbiBpbiB0aGUgYmFyIGFyZSBmaXhlZCBzaXplXG4gICAgICAgICAgICBpZiAoZW50cmllcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2hpbGQgPSBob3N0RWxlbWVudC5maXJzdENoaWxkO1xuICAgICAgICAgICAgICAgIGlmIChjaGlsZCkge1xuICAgICAgICAgICAgICAgICAgICBjaGlsZEhlaWdodCA9IGNoaWxkLmNsaWVudEhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRXaWR0aCA9IGNoaWxkLmNsaWVudFdpZHRoO1xuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci51bm9ic2VydmUoaG9zdEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGtlZXAgdGhlIHN0YXRlIGF0IHsgdmVydGljYWw6IDEsIGhvcml6b250YWw6IDEgfVxuICAgICAgICAgICAgLy8gdW50aWwgd2UgZ2V0IHRoZSBwcm9wZXIgY2hpbGQgbWVhc3VyZW1lbnRzXG4gICAgICAgICAgICBpZiAoY2hpbGRIZWlnaHQgPT09IG51bGwgfHwgY2hpbGRXaWR0aCA9PT0gbnVsbClcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBjb25zdCB2ZXJ0aWNhbCA9IE1hdGguZmxvb3Iod3JhcHBlckVsZW1lbnQuY2xpZW50SGVpZ2h0IC8gY2hpbGRIZWlnaHQpO1xuICAgICAgICAgICAgY29uc3QgaG9yaXpvbnRhbCA9IE1hdGguZmxvb3Iod3JhcHBlckVsZW1lbnQuY2xpZW50V2lkdGggLyBjaGlsZFdpZHRoKTtcbiAgICAgICAgICAgIHNldENhbGN1bGF0ZWRMaW1pdCgocHYpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocHYudmVydGljYWwgIT09IHZlcnRpY2FsIHx8IHB2Lmhvcml6b250YWwgIT09IGhvcml6b250YWwpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHZlcnRpY2FsLCBob3Jpem9udGFsIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIHB2O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXNpemVPYnNlcnZlci5vYnNlcnZlKHdyYXBwZXJFbGVtZW50KTtcbiAgICAgICAgcmVzaXplT2JzZXJ2ZXIub2JzZXJ2ZShob3N0RWxlbWVudCk7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICByZXNpemVPYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgICAgIH07XG4gICAgfSwgW2hvc3RFbGVtZW50LCBsaW1pdCwgd3JhcHBlckVsZW1lbnRdKTtcbiAgICByZXR1cm4gY2FsY3VsYXRlZExpbWl0O1xufTtcblxuY29uc3QgRGVmYXVsdFBhcnRpY2lwYW50Vmlld1VJQmFyID0gKCkgPT4gKGpzeChEZWZhdWx0UGFydGljaXBhbnRWaWV3VUksIHsgbWVudVBsYWNlbWVudDogXCJ0b3AtZW5kXCIgfSkpO1xuY29uc3QgRGVmYXVsdFBhcnRpY2lwYW50Vmlld1VJU3BvdGxpZ2h0ID0gKCkgPT4ganN4KERlZmF1bHRQYXJ0aWNpcGFudFZpZXdVSSwge30pO1xuY29uc3QgU3BlYWtlckxheW91dCA9ICh7IFBhcnRpY2lwYW50Vmlld1VJQmFyID0gRGVmYXVsdFBhcnRpY2lwYW50Vmlld1VJQmFyLCBQYXJ0aWNpcGFudFZpZXdVSVNwb3RsaWdodCA9IERlZmF1bHRQYXJ0aWNpcGFudFZpZXdVSVNwb3RsaWdodCwgVmlkZW9QbGFjZWhvbGRlciwgcGFydGljaXBhbnRzQmFyUG9zaXRpb24gPSAnYm90dG9tJywgcGFydGljaXBhbnRzQmFyTGltaXQsIH0pID0+IHtcbiAgICBjb25zdCBjYWxsID0gdXNlQ2FsbCgpO1xuICAgIGNvbnN0IHsgdXNlUGFydGljaXBhbnRzLCB1c2VSZW1vdGVQYXJ0aWNpcGFudHMgfSA9IHVzZUNhbGxTdGF0ZUhvb2tzKCk7XG4gICAgY29uc3QgW3BhcnRpY2lwYW50SW5TcG90bGlnaHQsIC4uLm90aGVyUGFydGljaXBhbnRzXSA9IHVzZVBhcnRpY2lwYW50cygpO1xuICAgIGNvbnN0IHJlbW90ZVBhcnRpY2lwYW50cyA9IHVzZVJlbW90ZVBhcnRpY2lwYW50cygpO1xuICAgIGNvbnN0IFtwYXJ0aWNpcGFudHNCYXJXcmFwcGVyRWxlbWVudCwgc2V0UGFydGljaXBhbnRzQmFyV3JhcHBlckVsZW1lbnRdID0gdXNlU3RhdGUobnVsbCk7XG4gICAgY29uc3QgW3BhcnRpY2lwYW50c0JhckVsZW1lbnQsIHNldFBhcnRpY2lwYW50c0JhckVsZW1lbnRdID0gdXNlU3RhdGUobnVsbCk7XG4gICAgY29uc3QgW2J1dHRvbnNXcmFwcGVyRWxlbWVudCwgc2V0QnV0dG9uc1dyYXBwZXJFbGVtZW50XSA9IHVzZVN0YXRlKG51bGwpO1xuICAgIGNvbnN0IGlzU3BlYWtlclNjcmVlblNoYXJpbmcgPSBoYXNTY3JlZW5TaGFyZShwYXJ0aWNpcGFudEluU3BvdGxpZ2h0KTtcbiAgICBjb25zdCBoYXJkTGltaXQgPSB1c2VDYWxjdWxhdGVIYXJkTGltaXQoYnV0dG9uc1dyYXBwZXJFbGVtZW50LCBwYXJ0aWNpcGFudHNCYXJFbGVtZW50LCBwYXJ0aWNpcGFudHNCYXJMaW1pdCk7XG4gICAgY29uc3QgaXNWZXJ0aWNhbCA9IHBhcnRpY2lwYW50c0JhclBvc2l0aW9uID09PSAnbGVmdCcgfHwgcGFydGljaXBhbnRzQmFyUG9zaXRpb24gPT09ICdyaWdodCc7XG4gICAgY29uc3QgaXNIb3Jpem9udGFsID0gcGFydGljaXBhbnRzQmFyUG9zaXRpb24gPT09ICd0b3AnIHx8IHBhcnRpY2lwYW50c0JhclBvc2l0aW9uID09PSAnYm90dG9tJztcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoIXBhcnRpY2lwYW50c0JhcldyYXBwZXJFbGVtZW50IHx8ICFjYWxsKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBjbGVhbnVwID0gY2FsbC5zZXRWaWV3cG9ydChwYXJ0aWNpcGFudHNCYXJXcmFwcGVyRWxlbWVudCk7XG4gICAgICAgIHJldHVybiAoKSA9PiBjbGVhbnVwKCk7XG4gICAgfSwgW3BhcnRpY2lwYW50c0JhcldyYXBwZXJFbGVtZW50LCBjYWxsXSk7XG4gICAgY29uc3QgaXNPbmVPbk9uZUNhbGwgPSBvdGhlclBhcnRpY2lwYW50cy5sZW5ndGggPT09IDE7XG4gICAgdXNlU3BlYWtlckxheW91dFNvcnRQcmVzZXQoY2FsbCwgaXNPbmVPbk9uZUNhbGwpO1xuICAgIGxldCBwYXJ0aWNpcGFudHNXaXRoQXBwbGllZExpbWl0ID0gb3RoZXJQYXJ0aWNpcGFudHM7XG4gICAgY29uc3QgaGFyZExpbWl0VG9BcHBseSA9IGlzVmVydGljYWxcbiAgICAgICAgPyBoYXJkTGltaXQudmVydGljYWxcbiAgICAgICAgOiBoYXJkTGltaXQuaG9yaXpvbnRhbDtcbiAgICBpZiAodHlwZW9mIHBhcnRpY2lwYW50c0JhckxpbWl0ICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgICBoYXJkTGltaXRUb0FwcGx5ICE9PSBudWxsKSB7XG4gICAgICAgIHBhcnRpY2lwYW50c1dpdGhBcHBsaWVkTGltaXQgPSBvdGhlclBhcnRpY2lwYW50cy5zbGljZSgwLCBcbiAgICAgICAgLy8gc3VidHJhY3QgMSBpZiBzcGVha2VyIGlzIHNoYXJpbmcgc2NyZWVuIGFzXG4gICAgICAgIC8vIHRoYXQgb25lIGlzIHJlbmRlcmVkIGluZGVwZW5kZW50bHkgZnJvbSBvdGhlclBhcnRpY2lwYW50cyBhcnJheVxuICAgICAgICBoYXJkTGltaXRUb0FwcGx5IC0gKGlzU3BlYWtlclNjcmVlblNoYXJpbmcgPyAxIDogMCkpO1xuICAgIH1cbiAgICBpZiAoIWNhbGwpXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIHJldHVybiAoanN4cyhcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3NwZWFrZXItbGF5b3V0X193cmFwcGVyXCIsIGNoaWxkcmVuOiBbanN4KFBhcnRpY2lwYW50c0F1ZGlvLCB7IHBhcnRpY2lwYW50czogcmVtb3RlUGFydGljaXBhbnRzIH0pLCBqc3hzKFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBjbHN4KCdzdHItdmlkZW9fX3NwZWFrZXItbGF5b3V0JywgcGFydGljaXBhbnRzQmFyUG9zaXRpb24gJiZcbiAgICAgICAgICAgICAgICAgICAgYHN0ci12aWRlb19fc3BlYWtlci1sYXlvdXQtLXZhcmlhbnQtJHtwYXJ0aWNpcGFudHNCYXJQb3NpdGlvbn1gKSwgY2hpbGRyZW46IFtqc3goXCJkaXZcIiwgeyBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19zcGVha2VyLWxheW91dF9fc3BvdGxpZ2h0XCIsIGNoaWxkcmVuOiBwYXJ0aWNpcGFudEluU3BvdGxpZ2h0ICYmIChqc3goUGFydGljaXBhbnRWaWV3LCB7IHBhcnRpY2lwYW50OiBwYXJ0aWNpcGFudEluU3BvdGxpZ2h0LCBtdXRlQXVkaW86IHRydWUsIHRyYWNrVHlwZTogaXNTcGVha2VyU2NyZWVuU2hhcmluZyA/ICdzY3JlZW5TaGFyZVRyYWNrJyA6ICd2aWRlb1RyYWNrJywgUGFydGljaXBhbnRWaWV3VUk6IFBhcnRpY2lwYW50Vmlld1VJU3BvdGxpZ2h0LCBWaWRlb1BsYWNlaG9sZGVyOiBWaWRlb1BsYWNlaG9sZGVyIH0pKSB9KSwgcGFydGljaXBhbnRzV2l0aEFwcGxpZWRMaW1pdC5sZW5ndGggPiAwICYmIHBhcnRpY2lwYW50c0JhclBvc2l0aW9uICYmIChqc3hzKFwiZGl2XCIsIHsgcmVmOiBzZXRCdXR0b25zV3JhcHBlckVsZW1lbnQsIGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3NwZWFrZXItbGF5b3V0X19wYXJ0aWNpcGFudHMtYmFyLWJ1dHRvbnMtd3JhcHBlclwiLCBjaGlsZHJlbjogW2pzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3NwZWFrZXItbGF5b3V0X19wYXJ0aWNpcGFudHMtYmFyLXdyYXBwZXJcIiwgcmVmOiBzZXRQYXJ0aWNpcGFudHNCYXJXcmFwcGVyRWxlbWVudCwgY2hpbGRyZW46IGpzeHMoXCJkaXZcIiwgeyByZWY6IHNldFBhcnRpY2lwYW50c0JhckVsZW1lbnQsIGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3NwZWFrZXItbGF5b3V0X19wYXJ0aWNpcGFudHMtYmFyXCIsIGNoaWxkcmVuOiBbaXNTcGVha2VyU2NyZWVuU2hhcmluZyAmJiAoanN4KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fc3BlYWtlci1sYXlvdXRfX3BhcnRpY2lwYW50LXRpbGVcIiwgY2hpbGRyZW46IGpzeChQYXJ0aWNpcGFudFZpZXcsIHsgcGFydGljaXBhbnQ6IHBhcnRpY2lwYW50SW5TcG90bGlnaHQsIFBhcnRpY2lwYW50Vmlld1VJOiBQYXJ0aWNpcGFudFZpZXdVSUJhciwgVmlkZW9QbGFjZWhvbGRlcjogVmlkZW9QbGFjZWhvbGRlciwgbXV0ZUF1ZGlvOiB0cnVlIH0pIH0sIHBhcnRpY2lwYW50SW5TcG90bGlnaHQuc2Vzc2lvbklkKSksIHBhcnRpY2lwYW50c1dpdGhBcHBsaWVkTGltaXQubWFwKChwYXJ0aWNpcGFudCkgPT4gKGpzeChcImRpdlwiLCB7IGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3NwZWFrZXItbGF5b3V0X19wYXJ0aWNpcGFudC10aWxlXCIsIGNoaWxkcmVuOiBqc3goUGFydGljaXBhbnRWaWV3LCB7IHBhcnRpY2lwYW50OiBwYXJ0aWNpcGFudCwgUGFydGljaXBhbnRWaWV3VUk6IFBhcnRpY2lwYW50Vmlld1VJQmFyLCBWaWRlb1BsYWNlaG9sZGVyOiBWaWRlb1BsYWNlaG9sZGVyLCBtdXRlQXVkaW86IHRydWUgfSkgfSwgcGFydGljaXBhbnQuc2Vzc2lvbklkKSkpXSB9KSB9KSwgaXNWZXJ0aWNhbCAmJiAoanN4KFZlcnRpY2FsU2Nyb2xsQnV0dG9ucywgeyBzY3JvbGxXcmFwcGVyOiBwYXJ0aWNpcGFudHNCYXJXcmFwcGVyRWxlbWVudCB9KSksIGlzSG9yaXpvbnRhbCAmJiAoanN4KEhvcml6b250YWxTY3JvbGxCdXR0b25zLCB7IHNjcm9sbFdyYXBwZXI6IHBhcnRpY2lwYW50c0JhcldyYXBwZXJFbGVtZW50IH0pKV0gfSkpXSB9KV0gfSkpO1xufTtcbmNvbnN0IEhvcml6b250YWxTY3JvbGxCdXR0b25zID0gKHsgc2Nyb2xsV3JhcHBlciwgfSkgPT4ge1xuICAgIGNvbnN0IHNjcm9sbFBvc2l0aW9uID0gdXNlSG9yaXpvbnRhbFNjcm9sbFBvc2l0aW9uKHNjcm9sbFdyYXBwZXIpO1xuICAgIGNvbnN0IHNjcm9sbFN0YXJ0Q2xpY2tIYW5kbGVyID0gKCkgPT4ge1xuICAgICAgICBzY3JvbGxXcmFwcGVyPy5zY3JvbGxCeSh7IGxlZnQ6IC0xNTAsIGJlaGF2aW9yOiAnc21vb3RoJyB9KTtcbiAgICB9O1xuICAgIGNvbnN0IHNjcm9sbEVuZENsaWNrSGFuZGxlciA9ICgpID0+IHtcbiAgICAgICAgc2Nyb2xsV3JhcHBlcj8uc2Nyb2xsQnkoeyBsZWZ0OiAxNTAsIGJlaGF2aW9yOiAnc21vb3RoJyB9KTtcbiAgICB9O1xuICAgIHJldHVybiAoanN4cyhGcmFnbWVudCwgeyBjaGlsZHJlbjogW3Njcm9sbFBvc2l0aW9uICYmIHNjcm9sbFBvc2l0aW9uICE9PSAnc3RhcnQnICYmIChqc3goSWNvbkJ1dHRvbiwgeyBvbkNsaWNrOiBzY3JvbGxTdGFydENsaWNrSGFuZGxlciwgaWNvbjogXCJjYXJldC1sZWZ0XCIsIGNsYXNzTmFtZTogXCJzdHItdmlkZW9fX3NwZWFrZXItbGF5b3V0X19wYXJ0aWNpcGFudHMtYmFyLS1idXR0b24tbGVmdFwiIH0pKSwgc2Nyb2xsUG9zaXRpb24gJiYgc2Nyb2xsUG9zaXRpb24gIT09ICdlbmQnICYmIChqc3goSWNvbkJ1dHRvbiwgeyBvbkNsaWNrOiBzY3JvbGxFbmRDbGlja0hhbmRsZXIsIGljb246IFwiY2FyZXQtcmlnaHRcIiwgY2xhc3NOYW1lOiBcInN0ci12aWRlb19fc3BlYWtlci1sYXlvdXRfX3BhcnRpY2lwYW50cy1iYXItLWJ1dHRvbi1yaWdodFwiIH0pKV0gfSkpO1xufTtcbmNvbnN0IFZlcnRpY2FsU2Nyb2xsQnV0dG9ucyA9ICh7IHNjcm9sbFdyYXBwZXIsIH0pID0+IHtcbiAgICBjb25zdCBzY3JvbGxQb3NpdGlvbiA9IHVzZVZlcnRpY2FsU2Nyb2xsUG9zaXRpb24oc2Nyb2xsV3JhcHBlcik7XG4gICAgY29uc3Qgc2Nyb2xsVG9wQ2xpY2tIYW5kbGVyID0gKCkgPT4ge1xuICAgICAgICBzY3JvbGxXcmFwcGVyPy5zY3JvbGxCeSh7IHRvcDogLTE1MCwgYmVoYXZpb3I6ICdzbW9vdGgnIH0pO1xuICAgIH07XG4gICAgY29uc3Qgc2Nyb2xsQm90dG9tQ2xpY2tIYW5kbGVyID0gKCkgPT4ge1xuICAgICAgICBzY3JvbGxXcmFwcGVyPy5zY3JvbGxCeSh7IHRvcDogMTUwLCBiZWhhdmlvcjogJ3Ntb290aCcgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gKGpzeHMoRnJhZ21lbnQsIHsgY2hpbGRyZW46IFtzY3JvbGxQb3NpdGlvbiAmJiBzY3JvbGxQb3NpdGlvbiAhPT0gJ3RvcCcgJiYgKGpzeChJY29uQnV0dG9uLCB7IG9uQ2xpY2s6IHNjcm9sbFRvcENsaWNrSGFuZGxlciwgaWNvbjogXCJjYXJldC11cFwiLCBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19zcGVha2VyLWxheW91dF9fcGFydGljaXBhbnRzLWJhci0tYnV0dG9uLXRvcFwiIH0pKSwgc2Nyb2xsUG9zaXRpb24gJiYgc2Nyb2xsUG9zaXRpb24gIT09ICdib3R0b20nICYmIChqc3goSWNvbkJ1dHRvbiwgeyBvbkNsaWNrOiBzY3JvbGxCb3R0b21DbGlja0hhbmRsZXIsIGljb246IFwiY2FyZXQtZG93blwiLCBjbGFzc05hbWU6IFwic3RyLXZpZGVvX19zcGVha2VyLWxheW91dF9fcGFydGljaXBhbnRzLWJhci0tYnV0dG9uLWJvdHRvbVwiIH0pKV0gfSkpO1xufTtcbmNvbnN0IGhhc1NjcmVlblNoYXJlID0gKHApID0+ICEhcD8ucHVibGlzaGVkVHJhY2tzLmluY2x1ZGVzKFNmdU1vZGVscy5UcmFja1R5cGUuU0NSRUVOX1NIQVJFKTtcblxuY29uc3QgW21ham9yLCBtaW5vciwgcGF0Y2hdID0gKFwiMC41LjEyXCIgKS5zcGxpdCgnLicpO1xuc2V0U2RrSW5mbyh7XG4gICAgdHlwZTogU2Z1TW9kZWxzLlNka1R5cGUuUkVBQ1QsXG4gICAgbWFqb3IsXG4gICAgbWlub3IsXG4gICAgcGF0Y2gsXG59KTtcblxuZXhwb3J0IHsgQWNjZXB0Q2FsbEJ1dHRvbiwgQXVkaW8sIEF2YXRhciwgQXZhdGFyRmFsbGJhY2ssIEJhY2tncm91bmRGaWx0ZXJzUHJvdmlkZXIsIEJhc2VWaWRlbywgQ2FsbENvbnRyb2xzLCBDYWxsUGFydGljaXBhbnRMaXN0aW5nLCBDYWxsUGFydGljaXBhbnRMaXN0aW5nSXRlbSwgQ2FsbFBhcnRpY2lwYW50c0xpc3QsIENhbGxQcmV2aWV3LCBDYWxsUmVjb3JkaW5nTGlzdCwgQ2FsbFJlY29yZGluZ0xpc3RIZWFkZXIsIENhbGxSZWNvcmRpbmdMaXN0SXRlbSwgQ2FsbFN0YXRzLCBDYWxsU3RhdHNCdXR0b24sIENhbGxTdGF0c0xhdGVuY3lDaGFydCwgQ2FuY2VsQ2FsbEJ1dHRvbiwgQ2FuY2VsQ2FsbENvbmZpcm1CdXR0b24sIENvbXBvc2l0ZUJ1dHRvbiwgRGVmYXVsdFBhcnRpY2lwYW50Vmlld1VJLCBEZWZhdWx0UmVhY3Rpb25zTWVudSwgRGVmYXVsdFNjcmVlblNoYXJlT3ZlcmxheSwgRGVmYXVsdFZpZGVvUGxhY2Vob2xkZXIsIERldmljZVNlbGVjdG9yLCBEZXZpY2VTZWxlY3RvckF1ZGlvSW5wdXQsIERldmljZVNlbGVjdG9yQXVkaW9PdXRwdXQsIERldmljZVNlbGVjdG9yVmlkZW8sIERldmljZVNldHRpbmdzLCBEcm9wRG93blNlbGVjdCwgRHJvcERvd25TZWxlY3RPcHRpb24sIEVtcHR5Q2FsbFJlY29yZGluZ0xpc3RpbmcsIEdlbmVyaWNNZW51LCBHZW5lcmljTWVudUJ1dHRvbkl0ZW0sIEljb24sIEljb25CdXR0b24sIExpdmVzdHJlYW1MYXlvdXQsIExvYWRpbmdDYWxsUmVjb3JkaW5nTGlzdGluZywgTG9hZGluZ0luZGljYXRvciwgTWVudVRvZ2dsZSwgTWVudVZpc3VhbFR5cGUsIE5vdGlmaWNhdGlvbiwgUGFnaW5hdGVkR3JpZExheW91dCwgUGFydGljaXBhbnRBY3Rpb25zQ29udGV4dE1lbnUsIFBhcnRpY2lwYW50RGV0YWlscywgUGFydGljaXBhbnRWaWV3LCBQYXJ0aWNpcGFudFZpZXdDb250ZXh0LCBQYXJ0aWNpcGFudHNBdWRpbywgUGVybWlzc2lvbk5vdGlmaWNhdGlvbiwgUGVybWlzc2lvblJlcXVlc3RMaXN0LCBQZXJtaXNzaW9uUmVxdWVzdHMsIFJlYWN0aW9uc0J1dHRvbiwgUmVjb3JkQ2FsbEJ1dHRvbiwgUmVjb3JkQ2FsbENvbmZpcm1hdGlvbkJ1dHRvbiwgUmVjb3JkaW5nSW5Qcm9ncmVzc05vdGlmaWNhdGlvbiwgUmluZ2luZ0NhbGwsIFJpbmdpbmdDYWxsQ29udHJvbHMsIFNjcmVlblNoYXJlQnV0dG9uLCBTZWFyY2hJbnB1dCwgU2VhcmNoUmVzdWx0cywgU3BlYWtlckxheW91dCwgU3BlYWtpbmdXaGlsZU11dGVkTm90aWZpY2F0aW9uLCBTcGVlY2hJbmRpY2F0b3IsIFN0YXRDYXJkLCBTdGF0Q2FyZEV4cGxhbmF0aW9uLCBTdGF0c1RhZywgU3RhdHVzZXMsIFN0cmVhbUNhbGwsIFN0cmVhbVRoZW1lLCBTdHJlYW1WaWRlbywgVGV4dEJ1dHRvbiwgVG9nZ2xlQXVkaW9PdXRwdXRCdXR0b24sIFRvZ2dsZUF1ZGlvUHJldmlld0J1dHRvbiwgVG9nZ2xlQXVkaW9QdWJsaXNoaW5nQnV0dG9uLCBUb2dnbGVWaWRlb1ByZXZpZXdCdXR0b24sIFRvZ2dsZVZpZGVvUHVibGlzaGluZ0J1dHRvbiwgVG9vbHRpcCwgVmlkZW8kMSBhcyBWaWRlbywgVmlkZW9QcmV2aWV3LCBXaXRoVG9vbHRpcCwgZGVmYXVsdFJlYWN0aW9ucywgdHJhbnNsYXRpb25zLCB1c2VCYWNrZ3JvdW5kRmlsdGVycywgdXNlSG9yaXpvbnRhbFNjcm9sbFBvc2l0aW9uLCB1c2VNZW51Q29udGV4dCwgdXNlUGFydGljaXBhbnRWaWV3Q29udGV4dCwgdXNlUGVyc2lzdGVkRGV2aWNlUHJlZmVyZW5jZXMsIHVzZVJlcXVlc3RQZXJtaXNzaW9uLCB1c2VUcmFja0VsZW1lbnRWaXNpYmlsaXR5LCB1c2VWZXJ0aWNhbFNjcm9sbFBvc2l0aW9uIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5lcy5qcy5tYXBcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/.pnpm/@stream-io+video-react-sdk@0.5.12_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@stream-io/video-react-sdk/dist/index.es.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/.pnpm/@stream-io+video-react-sdk@0.5.12_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@stream-io/video-react-sdk/dist/css/styles.css":
/*!**********************************************************************************************************************************************************************!*\
  !*** ./node_modules/.pnpm/@stream-io+video-react-sdk@0.5.12_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@stream-io/video-react-sdk/dist/css/styles.css ***!
  \**********************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (\"7965c045aba3\");\nif (false) {}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvLnBucG0vQHN0cmVhbS1pbyt2aWRlby1yZWFjdC1zZGtAMC41LjEyX3JlYWN0LWRvbUAxOC4zLjFfcmVhY3RAMTguMy4xX19yZWFjdEAxOC4zLjEvbm9kZV9tb2R1bGVzL0BzdHJlYW0taW8vdmlkZW8tcmVhY3Qtc2RrL2Rpc3QvY3NzL3N0eWxlcy5jc3MiLCJtYXBwaW5ncyI6Ijs7OztBQUFBLGlFQUFlLGNBQWM7QUFDN0IsSUFBSSxLQUFVLEVBQUUsRUFBdUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly95b29tLy4vbm9kZV9tb2R1bGVzLy5wbnBtL0BzdHJlYW0taW8rdmlkZW8tcmVhY3Qtc2RrQDAuNS4xMl9yZWFjdC1kb21AMTguMy4xX3JlYWN0QDE4LjMuMV9fcmVhY3RAMTguMy4xL25vZGVfbW9kdWxlcy9Ac3RyZWFtLWlvL3ZpZGVvLXJlYWN0LXNkay9kaXN0L2Nzcy9zdHlsZXMuY3NzP2MzZDAiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgXCI3OTY1YzA0NWFiYTNcIlxuaWYgKG1vZHVsZS5ob3QpIHsgbW9kdWxlLmhvdC5hY2NlcHQoKSB9XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/.pnpm/@stream-io+video-react-sdk@0.5.12_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@stream-io/video-react-sdk/dist/css/styles.css\n");

/***/ })

};
;